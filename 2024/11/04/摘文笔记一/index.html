<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>æ‘˜æ–‡ç¬”è®°_å¸¸ç”¨æŠ€æœ¯ä¸€ | By_Xb</title><meta name="keywords" content="Spring-Boot,Docker,springmvc,Java"><meta name="author" content="By_Xb"><meta name="copyright" content="By_Xb"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Log4j2ä½¿ç”¨ä»¥åŠå¼‚æ­¥æ€§èƒ½  ,  Springbootå…¨å±€å¼‚å¸¸å¤„ç†   ,  Springbootè‡ªå®šä¹‰æ³¨è§£+æ‹¦æˆªå™¨å®ç°æ•æ„Ÿæ•°æ®åŠ è§£å¯†  ,  Dockerå›¾å½¢åŒ–å·¥å…·    , SpringMVC:æ³¨è§£@ControllerAdviceçš„å·¥ä½œåŸç†   ,  å‡ºè·¯é‡å¤è¯·æ±‚å¹¶è½¬å‘   , SpringAOPè¯¦è§£   , java8 Streamæµå¤±ç¼–ç¨‹.      Log4j2ä½¿ç”¨ä»¥åŠå¼‚æ­¥æ€§èƒ½L"><meta property="og:type" content="article"><meta property="og:title" content="æ‘˜æ–‡ç¬”è®°_å¸¸ç”¨æŠ€æœ¯ä¸€"><meta property="og:url" content="https://wtnl.xyz/2024/11/04/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%B8%80/index.html"><meta property="og:site_name" content="By_Xb"><meta property="og:description" content="Log4j2ä½¿ç”¨ä»¥åŠå¼‚æ­¥æ€§èƒ½  ,  Springbootå…¨å±€å¼‚å¸¸å¤„ç†   ,  Springbootè‡ªå®šä¹‰æ³¨è§£+æ‹¦æˆªå™¨å®ç°æ•æ„Ÿæ•°æ®åŠ è§£å¯†  ,  Dockerå›¾å½¢åŒ–å·¥å…·    , SpringMVC:æ³¨è§£@ControllerAdviceçš„å·¥ä½œåŸç†   ,  å‡ºè·¯é‡å¤è¯·æ±‚å¹¶è½¬å‘   , SpringAOPè¯¦è§£   , java8 Streamæµå¤±ç¼–ç¨‹.      Log4j2ä½¿ç”¨ä»¥åŠå¼‚æ­¥æ€§èƒ½L"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411051341276.png"><meta property="article:published_time" content="2024-11-04T12:45:01.402Z"><meta property="article:modified_time" content="2024-11-05T05:58:07.409Z"><meta property="article:author" content="By_Xb"><meta property="article:tag" content="Spring-Boot"><meta property="article:tag" content="Docker"><meta property="article:tag" content="springmvc"><meta property="article:tag" content="Java"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411051341276.png"><link rel="shortcut icon" href="/img/siteicon/favicon-32x32.png"><link rel="canonical" href="https://wtnl.xyz/2024/11/04/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%B8%80/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"top-center"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
}
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"æ‘˜æ–‡ç¬”è®°_å¸¸ç”¨æŠ€æœ¯ä¸€",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-11-05 13:58:07"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link defer="defer" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/css/extrastyle.css" media="defer" onload='this.media="all"'><link async rel="stylesheet" href="/css/foter.css" media="defer" onload='this.media="all"'><link async rel="stylesheet" href="/css/myblog.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://soobsj.oss-cn-hangzhou.aliyuncs.com/css/loading_style_1.css"><link rel="stylesheet" href="https://soobsj.oss-cn-hangzhou.aliyuncs.com/css/loading_style_2.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="By_Xb" type="application/atom+xml"></head><body><div id="loader"><div class="outer_box"><div class="loader_overlay"></div><div class="loader_cogs"><div class="loader_cogs__top"><div class="top_part"></div><div class="top_part"></div><div class="top_part"></div><div class="top_hole"></div></div><div class="loader_cogs__left"><div class="left_part"></div><div class="left_part"></div><div class="left_part"></div><div class="left_hole"></div></div><div class="loader_cogs__bottom"><div class="bottom_part"></div><div class="bottom_part"></div><div class="bottom_part"></div><div class="bottom_hole"></div></div><p style="text-align:center">&nbsp;&nbsp;&nbsp;loading...</p></div></div></div><script>var endLoading=function(){document.body.style.overflow="auto",document.getElementById("loader").classList.add("loading")};window.addEventListener("load",endLoading)</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050018773.webp" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">88</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">35</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">6</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>æ¸…å•</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa fa-spinner"></i> <span>è¿½ç•ª</span></a></li><li><a class="site-page child" href="/gallery/index.htm"><i class="fa-fw fas fa-images"></i> <span>ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-cloud"></i> <span>åŠ¨æ€</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411051341276.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">By_Xb</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>æ¸…å•</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa fa-spinner"></i> <span>è¿½ç•ª</span></a></li><li><a class="site-page child" href="/gallery/index.htm"><i class="fa-fw fas fa-images"></i> <span>ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-cloud"></i> <span>åŠ¨æ€</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">æ‘˜æ–‡ç¬”è®°_å¸¸ç”¨æŠ€æœ¯ä¸€</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-11-04T12:45:01.402Z" title="å‘è¡¨äº 2024-11-04 20:45:01">2024-11-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-11-05T05:58:07.409Z" title="æ›´æ–°äº 2024-11-05 13:58:07">2024-11-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%F0%9F%93%94-%E5%90%8E%E7%AB%AF-%E7%AC%94%E8%AE%B0/">ğŸ“” åç«¯-ç¬”è®°</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">23.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>94åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="æ‘˜æ–‡ç¬”è®°_å¸¸ç”¨æŠ€æœ¯ä¸€"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="tip cogs"><ol><li>Log4j2ä½¿ç”¨ä»¥åŠå¼‚æ­¥æ€§èƒ½ ,</li><li> Springbootå…¨å±€å¼‚å¸¸å¤„ç† ,</li><li> Springbootè‡ªå®šä¹‰æ³¨è§£+æ‹¦æˆªå™¨å®ç°æ•æ„Ÿæ•°æ®åŠ è§£å¯† ,</li><li> Dockerå›¾å½¢åŒ–å·¥å…· ,</li><li>SpringMVC:æ³¨è§£@ControllerAdviceçš„å·¥ä½œåŸç† ,</li><li> å‡ºè·¯é‡å¤è¯·æ±‚å¹¶è½¬å‘ ,</li><li>SpringAOPè¯¦è§£ ,</li><li>java8 Streamæµå¤±ç¼–ç¨‹.</li></ol></div><h1 id="Log4j2ä½¿ç”¨ä»¥åŠå¼‚æ­¥æ€§èƒ½"><a href="#Log4j2ä½¿ç”¨ä»¥åŠå¼‚æ­¥æ€§èƒ½" class="headerlink" title="Log4j2ä½¿ç”¨ä»¥åŠå¼‚æ­¥æ€§èƒ½"></a>Log4j2ä½¿ç”¨ä»¥åŠå¼‚æ­¥æ€§èƒ½</h1><p>Logback ç®—æ˜¯JAVA é‡Œä¸€ä¸ªè€ç‰Œçš„æ—¥å¿—æ¡†æ¶ï¼Œä»06å¹´å¼€å§‹ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¿­ä»£è‡³ä»Šä¹Ÿåå‡ å¹´äº†ã€‚ä¸è¿‡logbackæœ€è¿‘ä¸€ä¸ªç¨³å®šç‰ˆæœ¬è¿˜åœç•™åœ¨ 2017 å¹´ï¼Œå¥½å‡ å¹´éƒ½æ²¡æœ‰æ›´æ–°ï¼›logbackçš„å…„å¼Ÿ slf4j æœ€è¿‘ä¸€ä¸ªç¨³å®šç‰ˆä¹Ÿæ˜¯2017å¹´ï¼Œæœ‰ç‚¹å‡‰å‡‰çš„æ„æ€ã€‚</p><p>è€Œä¸” logbackçš„å¼‚æ­¥æ€§èƒ½å®åœ¨æ‹‰è·¨ï¼ŒåŠŸèƒ½ç®€é™‹ï¼Œé…ç½®åˆç¹çï¼Œè¿œä¸åŠApache çš„æ–°ä¸€ä»£æ—¥å¿—æ¡†æ¶ - Log4j2</p><p>ç›®å‰æ¥çœ‹ï¼ŒLog4j2 å°±æ˜¯ç‹è€…ï¼Œå…¶ä»–æ—¥å¿—æ¡†æ¶éƒ½ä¸æ˜¯å¯¹æ‰‹</p><h2 id="Log4j2ç®€ä»‹"><a href="#Log4j2ç®€ä»‹" class="headerlink" title="Log4j2ç®€ä»‹"></a>Log4j2ç®€ä»‹</h2><p>Apache Log4j 2æ˜¯ Log4j(1) çš„å‡çº§ç‰ˆï¼Œæ¯”å®ƒçš„ç¥–å…ˆ Log4j 1. x æœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ï¼Œå’Œlogbackå¯¹æ¯”æœ‰å¾ˆå¤§çš„æ”¹è¿›ã€‚é™¤äº†å†…éƒ¨è®¾è®¡çš„è°ƒæ•´å¤–ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹çš„å¤§å‡çº§ï¼š</p><ul><li>æ›´ç®€åŒ–çš„é…ç½®</li><li>æ›´å¼ºå¤§çš„å‚æ•°æ ¼å¼åŒ–</li><li>æœ€å¤¸å¼ çš„å¼‚æ­¥æ€§èƒ½</li></ul><p>Log4j 2ä¸­ï¼Œåˆ†ä¸ºAPI(log4j-apiï¼‰å’Œå®ç°(log4j-core)ä¸¤ä¸ªæ¨¡å—ã€‚API å’Œslf4j æ˜¯ä¸€ä¸ªç±»å‹ï¼Œå±äºæ—¥å¿—æŠ½è±¡/é—¨é¢ï¼Œè€Œå®ç°éƒ¨åˆ†ï¼Œæ‰æ˜¯Log4j 2çš„æ ¸å¿ƒã€‚</p><ul><li>org.apache.logging.log4j Â» log4j-api</li><li>org.apache.logging.log4j Â» log4j-core</li></ul><h2 id="æœ€ç‰›é€¼çš„æ€§èƒ½"><a href="#æœ€ç‰›é€¼çš„æ€§èƒ½" class="headerlink" title="æœ€ç‰›é€¼çš„æ€§èƒ½"></a>æœ€ç‰›é€¼çš„æ€§èƒ½</h2><h3 id="æœ€å¼ºçš„å¼‚æ­¥æ€§èƒ½"><a href="#æœ€å¼ºçš„å¼‚æ­¥æ€§èƒ½" class="headerlink" title="æœ€å¼ºçš„å¼‚æ­¥æ€§èƒ½"></a>æœ€å¼ºçš„å¼‚æ­¥æ€§èƒ½</h3><p>è¿™ä¸ªç‰¹æ€§ï¼Œç®—æ˜¯Log4j2æœ€å¼ºä¹‹å¤„äº†ã€‚log4j2 åœ¨ç›®å‰JAVAä¸­çš„æ—¥å¿—æ¡†æ¶é‡Œï¼Œå¼‚æ­¥æ—¥å¿—çš„æ€§èƒ½æ˜¯æœ€é«˜çš„ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚</p><p>å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œå‡ ç§æ—¥å¿—æ¡†æ¶benchmarkå¯¹æ¯”ç»“æœï¼ˆlog4j2å®˜æ–¹æµ‹è¯•ç»“æœï¼‰ï¼š</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605213907389.png" alt="image-20210605213907389"></p><p>ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œlog4j2çš„å¼‚æ­¥ï¼ˆå…¨å¼‚æ­¥ï¼Œéæ··åˆæ¨¡å¼ï¼‰ä¸‹çš„æ€§èƒ½ï¼Œè¿œè¶…log4j1å’Œlogbackï¼Œç®€ç›´åŠæ‰“ã€‚å‹åŠ›è¶Šå¤§çš„æƒ…å†µä¸‹ï¼Œååä¸Šçš„å·®è·å°±è¶Šå¤§ã€‚åœ¨64çº¿ç¨‹æµ‹è¯•ä¸‹ï¼Œlog4j2çš„ååè¾¾åˆ°äº†180w+/sï¼Œè€Œlogback/log4j1åªæœ‰ä¸åˆ°20wï¼Œç›¸å·®è¿‘åå€</p><h3 id="é›¶GCï¼ˆGarbage-freeï¼‰"><a href="#é›¶GCï¼ˆGarbage-freeï¼‰" class="headerlink" title="é›¶GCï¼ˆGarbage-freeï¼‰"></a>é›¶GCï¼ˆGarbage-freeï¼‰</h3><p>ä»2.6ç‰ˆæœ¬å¼€å§‹ï¼ˆ2016å¹´ï¼‰ï¼Œlog4j2 é»˜è®¤å°±ä»¥é›¶GCæ¨¡å¼è¿è¡Œäº†ã€‚ä»€ä¹ˆå«é›¶GCå‘¢ï¼Ÿå°±æ˜¯ä¸ä¼šç”±äºlog4j2è€Œå¯¼è‡´GCã€‚</p><p>log4j2 ä¸­å„ç§Messageå¯¹è±¡ï¼Œå­—ç¬¦ä¸²æ•°ç»„ï¼Œå­—èŠ‚æ•°ç»„ç­‰å…¨éƒ¨å¤ç”¨ï¼Œä¸é‡å¤åˆ›å»ºï¼Œå¤§å¤§å‡å°‘äº†æ— ç”¨å¯¹è±¡çš„åˆ›å»ºï¼Œä»è€Œåšåˆ°â€œé›¶GCâ€ã€‚</p><h3 id="æ›´é«˜æ€§èƒ½-I-O-å†™å…¥çš„æ”¯æŒ"><a href="#æ›´é«˜æ€§èƒ½-I-O-å†™å…¥çš„æ”¯æŒ" class="headerlink" title="æ›´é«˜æ€§èƒ½ I/O å†™å…¥çš„æ”¯æŒ"></a>æ›´é«˜æ€§èƒ½ I/O å†™å…¥çš„æ”¯æŒ</h3><p>log4j è¿˜æä¾›äº†ä¸€ä¸ªMemoryMappedFileAppenderï¼ŒI/O éƒ¨åˆ†ä½¿ç”¨MemoryMappedFileæ¥å®ç°ï¼Œå¯ä»¥å¾—åˆ°æé«˜çš„I/Oæ€§èƒ½ã€‚ä¸è¿‡åœ¨ä½¿ç”¨MemoryMappedFileAppenderä¹‹å‰ï¼Œå¾—ç¡®å®šä½ è¶³å¤Ÿäº†è§£MemoryMappedFileçš„ç›¸å…³çŸ¥è¯†ï¼Œå¦åˆ™ä¸è¦è½»æ˜“ä½¿ç”¨å‘¦ã€‚</p><h2 id="æ›´å¼ºå¤§çš„å‚æ•°æ ¼å¼åŒ–"><a href="#æ›´å¼ºå¤§çš„å‚æ•°æ ¼å¼åŒ–" class="headerlink" title="æ›´å¼ºå¤§çš„å‚æ•°æ ¼å¼åŒ–"></a>æ›´å¼ºå¤§çš„å‚æ•°æ ¼å¼åŒ–</h2><p>APIæ¨¡å—å’Œslf4jç›¸æ¯”ï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„å‚æ•°æ ¼å¼åŒ–åŠŸèƒ½ã€‚</p><h3 id="ä½¿ç”¨-å ä½ç¬¦æ ¼å¼åŒ–å‚æ•°"><a href="#ä½¿ç”¨-å ä½ç¬¦æ ¼å¼åŒ–å‚æ•°" class="headerlink" title="ä½¿ç”¨{}å ä½ç¬¦æ ¼å¼åŒ–å‚æ•°"></a>ä½¿ç”¨<code>&#123;&#125;</code>å ä½ç¬¦æ ¼å¼åŒ–å‚æ•°</h3><p>åœ¨slf4jé‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>&#123;&#125;</code>çš„æ–¹å¼æ¥å®ç°â€œformatâ€çš„åŠŸèƒ½ï¼ˆå‚æ•°ä¼šç›´æ¥toStringæ›¿æ¢å ä½ç¬¦ï¼‰ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger.debug(<span class="string">&quot;Logging in user &#123;&#125; with birthday &#123;&#125;&quot;</span>, user.getName(), user.getBirthdayCalendar());</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨String-formatçš„å½¢å¼æ ¼å¼åŒ–å‚æ•°"><a href="#ä½¿ç”¨String-formatçš„å½¢å¼æ ¼å¼åŒ–å‚æ•°" class="headerlink" title="ä½¿ç”¨String.formatçš„å½¢å¼æ ¼å¼åŒ–å‚æ•°"></a>ä½¿ç”¨String.formatçš„å½¢å¼æ ¼å¼åŒ–å‚æ•°</h3><p>log4j2 ä¸­é™¤äº†æ”¯æŒ<code>&#123;&#125;</code>çš„å‚æ•°å ä½ç¬¦ï¼Œè¿˜æ”¯æŒString.formatçš„å½¢å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getFormatterLogger(<span class="string">&quot;Foo&quot;</span>);</span><br><span class="line"></span><br><span class="line">logger.debug(<span class="string">&quot;Logging in user %s with birthday %s&quot;</span>, user.getName(), user.getBirthdayCalendar());</span><br><span class="line">logger.debug(<span class="string">&quot;Logging in user %1$s with birthday %2$tm %2$te,%2$tY&quot;</span>, user.getName(), user.getBirthdayCalendar());</span><br><span class="line">logger.debug(<span class="string">&quot;Integer.MAX_VALUE = %,d&quot;</span>, Integer.MAX_VALUE);</span><br><span class="line">logger.debug(<span class="string">&quot;Long.MAX_VALUE = %,d&quot;</span>, Long.MAX_VALUE);</span><br></pre></td></tr></table></figure><p>** æ³¨æ„ï¼Œå¦‚æœæƒ³ä½¿ç”¨String.formatçš„å½¢å¼ï¼Œéœ€è¦ä½¿ç”¨<code>LogManager.getFormatterLogger</code>è€Œä¸æ˜¯<code>LogManager.getLogger</code>**</p><h3 id="ä½¿ç”¨logger-printfæ ¼å¼åŒ–å‚æ•°"><a href="#ä½¿ç”¨logger-printfæ ¼å¼åŒ–å‚æ•°" class="headerlink" title="ä½¿ç”¨logger.printfæ ¼å¼åŒ–å‚æ•°"></a>ä½¿ç”¨logger.printfæ ¼å¼åŒ–å‚æ•°</h3><p>log4j2 çš„ Loggeræ¥å£ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ª<code>printf</code>æ–¹æ³•ï¼Œæ— éœ€åˆ›å»º<code>LogManager.getFormatterLogger</code>ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>String.format</code>çš„å½¢å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logger.printf(Level.INFO, <span class="string">&quot;Logging in user %1$s with birthday %2$tm %2$te,%2$tY&quot;</span>, user.getName(), user.getBirthdayCalendar());</span><br><span class="line"></span><br><span class="line">logger.debug(<span class="string">&quot;Opening connection to &#123;&#125;...&quot;</span>, someDataSource);</span><br></pre></td></tr></table></figure><h3 id="â€œæƒ°æ€§â€æ‰“æ—¥å¿—ï¼ˆlazy-loggingï¼‰"><a href="#â€œæƒ°æ€§â€æ‰“æ—¥å¿—ï¼ˆlazy-loggingï¼‰" class="headerlink" title="â€œæƒ°æ€§â€æ‰“æ—¥å¿—ï¼ˆlazy loggingï¼‰"></a>â€œæƒ°æ€§â€æ‰“æ—¥å¿—ï¼ˆlazy loggingï¼‰</h3><p>è¿™ä¸ªåŠŸèƒ½è™½ç„¶å°ï¼Œä½†éå¸¸å®ç”¨ã€‚</p><p>åœ¨æŸäº›ä¸šåŠ¡æµç¨‹é‡Œï¼Œä¸ºäº†ç•™æ ¹æˆ–è¿½æº¯é—®é¢˜ï¼Œéœ€è¦å®Œæ•´çš„æ‰“å°å…¥å‚ï¼Œä¸€èˆ¬æ˜¯æŠŠå…¥å‚ç»™ç”¨JSON/XMLåºåˆ—åŒ–åç”¨debugçº§åˆ«æ‰“å°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger.debug(<span class="string">&quot;å…¥å‚æŠ¥æ–‡ï¼š&#123;&#125;&quot;</span>,JSON.toJSONString(policyDTO));</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦è¿½æº¯é—®é¢˜æ—¶ï¼Œä¼šå°†ç³»ç»Ÿçš„æ—¥å¿—çº§åˆ«è°ƒåˆ°debug/traceï¼Œè¿™æ ·å°±å¯ä»¥æ‰“å°ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œè™½ç„¶åœ¨infoçº§åˆ«ä¸‹debugä¸ä¼šè¾“å‡ºå†…å®¹ï¼Œä½†JSON.toJSONString()è¿™ä¸ªåºåˆ—åŒ–çš„ä»£ç ä¸€å®šä¼šæ‰§è¡Œï¼Œä¸¥é‡å½±å“æ­£å¸¸æµç¨‹ä¸‹çš„æ‰§è¡Œæ•ˆç‡ã€‚</p><p>æˆ‘ä»¬æœŸæœ›çš„ç»“æœæ˜¯infoçº§åˆ«ä¸‹ï¼Œè¿åºåˆ—åŒ–éƒ½ä¸æ‰§è¡Œã€‚è¿™é‡Œå¯ä»¥é€šè¿‡<code>isDebugEnable</code>æ¥åˆ¤æ–­å½“å‰é…ç½®ä¸‹debugçº§åˆ«æ˜¯å¦å¯ä»¥è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(logger.isDebugEnabled())&#123;</span><br><span class="line">    logger.debug(<span class="string">&quot;å…¥å‚æŠ¥æ–‡ï¼š&#123;&#125;&quot;</span>,JSON.toJSONString(policyDTO));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·è™½ç„¶å¯ä»¥é¿å…ä¸å¿…è¦çš„åºåˆ—åŒ–ï¼Œä½†æ¯ä¸ªåœ°æ–¹éƒ½è¿™ä¹ˆå†™è¿˜æ˜¯æœ‰ç‚¹éš¾å—çš„ï¼Œä¸€è¡Œå˜æˆäº†ä¸‰è¡Œã€‚</p><p>log4j2 çš„ logger å¯¹è±¡ï¼Œæä¾›äº†ä¸€ç³»åˆ—lambdaçš„æ”¯æŒï¼Œé€šè¿‡è¿™äº›æ¥å£å¯ä»¥å®ç°â€œæƒ°æ€§â€æ‰“æ—¥å¿—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">debug</span><span class="params">(String message, Supplier&lt;?&gt;... paramSuppliers)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">info</span><span class="params">(String message, Supplier&lt;?&gt;... paramSuppliers)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">trace</span><span class="params">(String message, Supplier&lt;?&gt;... paramSuppliers)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">error</span><span class="params">(String message, Supplier&lt;?&gt;... paramSuppliers)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç­‰åŒäºä¸‹é¢çš„å…ˆåˆ¤æ–­ï¼Œåæ‰“å°</span></span><br><span class="line">logger.debug(<span class="string">&quot;å…¥å‚æŠ¥æ–‡ï¼š&#123;&#125;&quot;</span>,() -&gt; JSON.toJSONString(policyDTO));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(logger.isDebugEnabled())&#123;</span><br><span class="line">    logger.debug(<span class="string">&quot;å…¥å‚æŠ¥æ–‡ï¼š&#123;&#125;&quot;</span>,JSON.toJSONString(policyDTO));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§ Supplier + Lambda çš„å½¢å¼ï¼Œç­‰åŒäºä¸Šé¢çš„å…ˆåˆ¤æ–­ isDebugEnable ç„¶åæ‰“å°ï¼Œä¸‰è¡Œçš„ä»£ç å˜æˆäº†ä¸€è¡Œã€‚å—¯ï¼ŒçœŸé¦™ã€‚</p><h2 id="æ›´ç®€åŒ–çš„é…ç½®"><a href="#æ›´ç®€åŒ–çš„é…ç½®" class="headerlink" title="æ›´ç®€åŒ–çš„é…ç½®"></a>æ›´ç®€åŒ–çš„é…ç½®</h2><p>Log4j 2 åŒæ—¶æ”¯æŒXML/JSON/YML/Properties å››ç§å½¢å¼çš„é…ç½®æ–‡ä»¶ï¼Œä¸è¿‡æœ€ä¸»æµçš„è¿˜æ˜¯XMLçš„æ–¹å¼ï¼Œæœ€ç›´è§‚ã€‚</p><p>æ¥çœ‹ä¸€ä¸‹logbackå’Œlog4j2çš„é…ç½®æ–‡ä»¶å¯¹æ¯”ï¼ŒåŒæ ·åŠŸèƒ½çš„é…ç½®ä¸‹ï¼š</p><h3 id="logback-xml"><a href="#logback-xml" class="headerlink" title="logback.xml"></a>logback.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span> = <span class="string">&quot;File&quot;</span> <span class="attr">class</span>= <span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>logs/app.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>logs/archives/app-%d&#123;yyyy-MM-dd&#125;.log.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--ä¸€å¤©å†…å¤§äºsizeå°±å•ç‹¬åˆ†éš”--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>1 GB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;File&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="log4j2-xml"><a href="#log4j2-xml" class="headerlink" title="log4j2.xml"></a>log4j2.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">xmlns:xi</span>=<span class="string">&quot;http://www.w3.org/2001/XInclude&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">status</span>=<span class="string">&quot;warn&quot;</span> <span class="attr">name</span>=<span class="string">&quot;XInclude&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;File&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;logs/app.log&quot;</span> <span class="attr">filePattern</span>=<span class="string">&quot;logs/archives/app-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %5p [%t] %-40.40c&#123;1.&#125; : %m%n&quot;</span>/&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> /&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!--ä¸€å¤©å†…å¤§äºsizeå°±å•ç‹¬åˆ†éš”--&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;1 GB&quot;</span>/&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;File&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨log4j2ä¸­ï¼Œappenderçš„é…ç½®ä»ä½¿ç”¨ Appender å®ç°åå³æ ‡ç­¾åçš„å½¢å¼ï¼Œè¯­æ³•ä¸Šæ›´ç®€æ´ä¸€äº›ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;File&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ç­‰åŒäºlogbackä¸­çš„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span> = <span class="string">&quot;File&quot;</span> <span class="attr">class</span>= <span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ä¸å…¶ä»–æ—¥å¿—æŠ½è±¡-é—¨é¢é€‚é…"><a href="#ä¸å…¶ä»–æ—¥å¿—æŠ½è±¡-é—¨é¢é€‚é…" class="headerlink" title="ä¸å…¶ä»–æ—¥å¿—æŠ½è±¡/é—¨é¢é€‚é…"></a>ä¸å…¶ä»–æ—¥å¿—æŠ½è±¡/é—¨é¢é€‚é…</h2><p>log4j2 ç”±äºæ‹†åˆ†ä¸º API å’Œ å®ç°ä¸¤éƒ¨åˆ†ï¼Œæ‰€ä»¥å¯èƒ½ä¹Ÿéœ€è¦å’Œå…¶ä»–æ—¥å¿—æ¡†æ¶è¿›è¡Œé€‚é…ï¼Œè¯¦ç»†çš„æ—¥å¿—æ¡†æ¶é€‚é…æ–¹æ¡ˆè¯·å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ã€Šã€å¯èƒ½æ˜¯å…¨ç½‘æœ€å…¨çš„ã€‘JAVAæ—¥å¿—æ¡†æ¶é€‚é…/å†²çªè§£å†³æ–¹æ¡ˆã€‹<img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214002050.png" alt="image-20210605214002050"></p><h2 id="å…¶ä»–çš„ç‰¹ç‚¹"><a href="#å…¶ä»–çš„ç‰¹ç‚¹" class="headerlink" title="å…¶ä»–çš„ç‰¹ç‚¹"></a>å…¶ä»–çš„ç‰¹ç‚¹</h2><ol><li>å¼‚æ­¥é˜Ÿåˆ—ä½¿ç”¨é«˜æ€§èƒ½é˜Ÿåˆ— - **LMAX Disruptor **</li><li>Appenderä¸°å¯Œï¼Œæœ‰JMS/JPA/KAFKA/Http/MONGODB/CouchDB/Socket/Scriptç­‰å„ç§Appenderçš„æ”¯æŒ</li><li>æ”¯æŒè‡ªå®šä¹‰æ—¥å¿—çº§åˆ«</li><li>â€¦â€¦</li></ol><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><p>ç»ˆäºä»‹ç»å®Œäº†Log4j2çš„å¼ºå¤§ï¼Œç°åœ¨æ¥ä»‹ç»ä¸‹Log4j2çš„åŸºæœ¬ä½¿ç”¨ã€‚</p><h3 id="å¼•ç”¨log4j2çš„mavenä¾èµ–"><a href="#å¼•ç”¨log4j2çš„mavenä¾èµ–" class="headerlink" title="å¼•ç”¨log4j2çš„mavenä¾èµ–"></a>å¼•ç”¨log4j2çš„mavenä¾èµ–</h3><p>log4j-apiåœ¨log4j-coreä¸­å·²ç»æœ‰ä¾èµ–äº†ï¼Œç›´æ¥ä¾èµ–coreå³å¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¼•ç”¨log4j2æ—¶ï¼Œéœ€è¦æ³¨æ„é¡¹ç›®ä¸­æ˜¯å¦æœ‰å¤šå¥—æ—¥å¿—æ¡†æ¶å…±å­˜/å†²çªï¼Œéœ€è¦é€‚é…çš„é—®é¢˜ã€‚ç»†èŠ‚è¯·å‚è€ƒä¸Šé¢çš„ä¸å…¶ä»–æ—¥å¿—æŠ½è±¡/é—¨é¢é€‚é…</p><h3 id="é…ç½®æ–‡ä»¶ç¤ºä¾‹"><a href="#é…ç½®æ–‡ä»¶ç¤ºä¾‹" class="headerlink" title="é…ç½®æ–‡ä»¶ç¤ºä¾‹"></a>é…ç½®æ–‡ä»¶ç¤ºä¾‹</h3><p>é¦–å…ˆæ˜¯é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤çš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸ºï¼š<code>classpath:log4j2.xml</code>ï¼ˆæ¨èä½¿ç”¨xmlï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">xmlns:xi</span>=<span class="string">&quot;http://www.w3.org/2001/XInclude&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">status</span>=<span class="string">&quot;warn&quot;</span> <span class="attr">name</span>=<span class="string">&quot;XInclude&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %5p [%t] %-40.40c&#123;1.&#125; : %m%n&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä»…åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä½¿ç”¨ --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;$&#123;PATTERN&#125;&quot;</span>/&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼Œæ»šåŠ¨åˆ†å‰²æ—¥å¿—æ–‡ä»¶ï¼Œè‡ªåŠ¨æ‰“åŒ…gz--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;File&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;logs/app.log&quot;</span> <span class="attr">filePattern</span>=<span class="string">&quot;logs/archives/app-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;$&#123;PATTERN&#125;&quot;</span>/&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                 <span class="comment">&lt;!--é»˜è®¤ä¸€å¤©ä¸€ä¸ªæ–‡ä»¶--&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> /&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!--ä¸€å¤©å†…å¤§äºsizeå°±å•ç‹¬åˆ†éš”--&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;1 GB&quot;</span>/&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- æ·»åŠ ä½ çš„è‡ªå®šä¹‰loggerï¼Œä¸€èˆ¬ç”¨äºåŒºåˆ†åŒ…åçš„æ—¥å¿—ï¼Œä¸åŒåŒ…åä¸åŒçš„çº§åˆ«/appender --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- additivity æ„æ€æ˜¯ï¼Œè°ƒç”¨å®Œå½“å‰appenderï¼Œæ˜¯å¦ç»§ç»­è°ƒç”¨parent logger appenderï¼Œé»˜è®¤true--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">name</span>=<span class="string">&quot;your logger/package name&quot;</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--é»˜è®¤çš„Root Logger çº§åˆ«--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--è¿™é‡Œéœ€è¦åŒºåˆ†ä¸‹ç¯å¢ƒï¼ˆé…åˆmaven profileä¹‹ç±»çš„ï¼‰--&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- å¼€å‘ç¯å¢ƒä½¿ç”¨Console Appenderï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨File Appender --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;File&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="XMLé…ç½®æ–‡ä»¶è¯­æ³•"><a href="#XMLé…ç½®æ–‡ä»¶è¯­æ³•" class="headerlink" title="XMLé…ç½®æ–‡ä»¶è¯­æ³•"></a>XMLé…ç½®æ–‡ä»¶è¯­æ³•</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>;</span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;name1&quot;</span>&gt;</span>value<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;name2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;value2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>  <span class="attr">...</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">...</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter</span>  <span class="attr">...</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">name</span>=<span class="string">&quot;name1&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter</span>  <span class="attr">...</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Logger</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;level&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºLogger"><a href="#åˆ›å»ºLogger" class="headerlink" title="åˆ›å»ºLogger"></a>åˆ›å»ºLogger</h3><p>ç›´æ¥ä½¿ç”¨log4j2çš„apiï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">Logger logger = LogManager.getLogger(Log4j2Test.class);</span><br><span class="line">logger.error(...);</span><br><span class="line">logger.warn(...);</span><br><span class="line">logger.info(...);</span><br><span class="line">logger.debug(...);</span><br><span class="line">logger.trace(...);</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é…åˆslf4jä½¿ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªéœ€è¦æŒ‰ç…§å‰é¢è¯´çš„ï¼Œæå‰åšå¥½é€‚é…ï¼Œç„¶åä½¿ç”¨slf4jçš„apiå³å¯ã€‚ä¸è¿‡å¦‚æœæ˜¯æ–°ç³»ç»Ÿçš„è¯ï¼Œå»ºè®®ç›´æ¥ä¸Šlog4j2çš„apiå§ï¼Œå¯ä»¥äº«å—æ‰€æœ‰log4j2çš„åŠŸèƒ½ï¼Œä½¿ç”¨slf4jä¹‹ç±»çš„apiæ—¶ï¼Œä¸Šé¢è¯´çš„å‚æ•°æ ¼å¼åŒ–ä¹‹ç±»çš„åŠŸèƒ½å°±æ— æ³•ä½¿ç”¨äº†ã€‚</p><h3 id="å…¨å¼‚æ­¥é…ç½®ï¼ˆé‡è¦ï¼ï¼ï¼‰"><a href="#å…¨å¼‚æ­¥é…ç½®ï¼ˆé‡è¦ï¼ï¼ï¼‰" class="headerlink" title="å…¨å¼‚æ­¥é…ç½®ï¼ˆé‡è¦ï¼ï¼ï¼‰"></a>å…¨å¼‚æ­¥é…ç½®ï¼ˆé‡è¦ï¼ï¼ï¼‰</h3><p>æ¨èé…ç½®log4j2 å…¨å¼‚æ­¥ï¼ˆall asyncï¼‰ï¼Œåªéœ€è¦åœ¨ä¸»ç¨‹åºä»£ç å¼€å¤´ï¼ŒåŠ ä¸€å¥ç³»ç»Ÿå±æ€§çš„ä»£ç ï¼šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(<span class="string">&quot;Log4jContextSelector&quot;</span>, <span class="string">&quot;org.apache.logging.log4j.core.async.AsyncLoggerContextSelector&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Log4j2 å¦‚ä»Šæ€§èƒ½æœ€å¼ºï¼ŒåŠŸèƒ½æœ€å¼ºï¼Œè€Œä¸”æŒç»­æ›´æ–°ç»´æŠ¤ã€‚è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿæ˜¯æ—¶å€™æ›¿æ¢ä½ çš„logback/log4j1äº†ï¼</p><h1 id="SpringBoot-çš„å…¨å±€å¼‚å¸¸å¤„ç†"><a href="#SpringBoot-çš„å…¨å±€å¼‚å¸¸å¤„ç†" class="headerlink" title="SpringBoot çš„å…¨å±€å¼‚å¸¸å¤„ç†"></a>SpringBoot çš„å…¨å±€å¼‚å¸¸å¤„ç†</h1><p>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»çš„æ˜¯SpringBooté¡¹ç›®è¿›è¡Œå…¨å±€å¼‚å¸¸çš„å¤„ç†ã€‚</p><h2 id="SpringBootå…¨å±€å¼‚å¸¸å‡†å¤‡"><a href="#SpringBootå…¨å±€å¼‚å¸¸å‡†å¤‡" class="headerlink" title="SpringBootå…¨å±€å¼‚å¸¸å‡†å¤‡"></a>SpringBootå…¨å±€å¼‚å¸¸å‡†å¤‡</h2><p>è¯´æ˜ï¼šå¦‚æœæƒ³ç›´æ¥è·å–å·¥ç¨‹é‚£ä¹ˆå¯ä»¥ç›´æ¥è·³åˆ°åº•éƒ¨ï¼Œé€šè¿‡é“¾æ¥ä¸‹è½½å·¥ç¨‹ä»£ç ã€‚</p><h3 id="å¼€å‘å‡†å¤‡"><a href="#å¼€å‘å‡†å¤‡" class="headerlink" title="å¼€å‘å‡†å¤‡"></a>å¼€å‘å‡†å¤‡</h3><p>ç¯å¢ƒè¦æ±‚<br>JDKï¼š1.8<br>SpringBootï¼š1.5.17.RELEASE</p><p>é¦–å…ˆè¿˜æ˜¯Mavençš„ç›¸å…³ä¾èµ–:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Spring Boot Web ä¾èµ– æ ¸å¿ƒ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Spring Boot Test ä¾èµ– --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.41<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶è¿™å—åŸºæœ¬ä¸éœ€è¦æ›´æ”¹ï¼Œå…¨å±€å¼‚å¸¸çš„å¤„ç†åªéœ€åœ¨ä»£ç ä¸­å®ç°å³å¯ã€‚</p><h3 id="ä»£ç ç¼–å†™"><a href="#ä»£ç ç¼–å†™" class="headerlink" title="ä»£ç ç¼–å†™"></a>ä»£ç ç¼–å†™</h3><p>SpringBootçš„é¡¹ç›®å·²ç»å¯¹æœ‰ä¸€å®šçš„å¼‚å¸¸å¤„ç†äº†ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬å¼€å‘è€…è€Œè¨€å¯èƒ½å°±ä¸å¤ªåˆé€‚äº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹è¿™äº›å¼‚å¸¸è¿›è¡Œç»Ÿä¸€çš„æ•è·å¹¶å¤„ç†ã€‚SpringBootä¸­æœ‰ä¸€ä¸ª<code>ControllerAdvice</code>çš„æ³¨è§£ï¼Œä½¿ç”¨è¯¥æ³¨è§£è¡¨ç¤ºå¼€å¯äº†å…¨å±€å¼‚å¸¸çš„æ•è·ï¼Œæˆ‘ä»¬åªéœ€åœ¨è‡ªå®šä¹‰ä¸€ä¸ªæ–¹æ³•ä½¿ç”¨<code>ExceptionHandler</code>æ³¨è§£ç„¶åå®šä¹‰æ•è·å¼‚å¸¸çš„ç±»å‹å³å¯å¯¹è¿™äº›æ•è·çš„å¼‚å¸¸è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ã€‚</p><p>æˆ‘ä»¬æ ¹æ®ä¸‹é¢çš„è¿™ä¸ªç¤ºä¾‹æ¥çœ‹è¯¥æ³¨è§£æ˜¯å¦‚ä½•ä½¿ç”¨å§ã€‚</p><p>ç¤ºä¾‹ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value =Exception.class)</span></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">exceptionHandler</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;æœªçŸ¥å¼‚å¸¸ï¼åŸå› æ˜¯:&quot;</span>+e);</span><br><span class="line">        <span class="keyword">return</span> e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¹æ•è·çš„å¼‚å¸¸è¿›è¡Œç®€å•çš„äºŒæ¬¡å¤„ç†ï¼Œè¿”å›å¼‚å¸¸çš„ä¿¡æ¯ï¼Œè™½ç„¶è¿™ç§èƒ½å¤Ÿè®©æˆ‘ä»¬çŸ¥é“å¼‚å¸¸çš„åŸå› ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šçš„æƒ…å†µä¸‹æ¥è¯´ï¼Œå¯èƒ½è¿˜æ˜¯ä¸å¤Ÿäººæ€§åŒ–ï¼Œä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚é‚£ä¹ˆæˆ‘ä»¬è¿™é‡Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„å¼‚å¸¸ç±»ä»¥åŠæšä¸¾ç±»æ¥å®ç°æˆ‘ä»¬æƒ³è¦çš„é‚£ç§æ•°æ®å§ã€‚</p><p>è‡ªå®šä¹‰åŸºç¡€æ¥å£ç±»</p><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªåŸºç¡€çš„æ¥å£ç±»ï¼Œè‡ªå®šä¹‰çš„é”™è¯¯æè¿°æšä¸¾ç±»éœ€å®ç°è¯¥æ¥å£ã€‚ä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BaseErrorInfoInterface</span> &#123;</span><br><span class="line">    <span class="comment">/** é”™è¯¯ç */</span></span><br><span class="line">  String <span class="title function_">getResultCode</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/** é”™è¯¯æè¿°*/</span></span><br><span class="line">  String <span class="title function_">getResultMsg</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰æšä¸¾ç±»</p><p>ç„¶åæˆ‘ä»¬è¿™é‡Œåœ¨è‡ªå®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œå¹¶å®ç°è¯¥æ¥å£ã€‚ä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CommonEnum</span> <span class="keyword">implements</span> <span class="title class_">BaseErrorInfoInterface</span> &#123;</span><br><span class="line"> <span class="comment">// æ•°æ®æ“ä½œé”™è¯¯å®šä¹‰</span></span><br><span class="line"> SUCCESS(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;æˆåŠŸ!&quot;</span>), </span><br><span class="line"> BODY_NOT_MATCH(<span class="string">&quot;400&quot;</span>,<span class="string">&quot;è¯·æ±‚çš„æ•°æ®æ ¼å¼ä¸ç¬¦!&quot;</span>),</span><br><span class="line"> SIGNATURE_NOT_MATCH(<span class="string">&quot;401&quot;</span>,<span class="string">&quot;è¯·æ±‚çš„æ•°å­—ç­¾åä¸åŒ¹é…!&quot;</span>),</span><br><span class="line"> NOT_FOUND(<span class="string">&quot;404&quot;</span>, <span class="string">&quot;æœªæ‰¾åˆ°è¯¥èµ„æº!&quot;</span>), </span><br><span class="line"> INTERNAL_SERVER_ERROR(<span class="string">&quot;500&quot;</span>, <span class="string">&quot;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯!&quot;</span>),</span><br><span class="line"> SERVER_BUSY(<span class="string">&quot;503&quot;</span>,<span class="string">&quot;æœåŠ¡å™¨æ­£å¿™ï¼Œè¯·ç¨åå†è¯•!&quot;</span>)</span><br><span class="line"> ;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/** é”™è¯¯ç  */</span></span><br><span class="line"> <span class="keyword">private</span> String resultCode;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/** é”™è¯¯æè¿° */</span></span><br><span class="line"> <span class="keyword">private</span> String resultMsg;</span><br><span class="line"></span><br><span class="line"> CommonEnum(String resultCode, String resultMsg) &#123;</span><br><span class="line">  <span class="built_in">this</span>.resultCode = resultCode;</span><br><span class="line">  <span class="built_in">this</span>.resultMsg = resultMsg;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">getResultCode</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> resultCode;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">getResultMsg</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> resultMsg;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰å¼‚å¸¸ç±»</p><p>ç„¶åæˆ‘ä»¬åœ¨æ¥è‡ªå®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»ï¼Œç”¨äºå¤„ç†æˆ‘ä»¬å‘ç”Ÿçš„ä¸šåŠ¡å¼‚å¸¸ã€‚ä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BizException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * é”™è¯¯ç </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">protected</span> String errorCode;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">protected</span> String errorMsg;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">BizException</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="built_in">super</span>();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">BizException</span><span class="params">(BaseErrorInfoInterface errorInfoInterface)</span> &#123;</span><br><span class="line">  <span class="built_in">super</span>(errorInfoInterface.getResultCode());</span><br><span class="line">  <span class="built_in">this</span>.errorCode = errorInfoInterface.getResultCode();</span><br><span class="line">  <span class="built_in">this</span>.errorMsg = errorInfoInterface.getResultMsg();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">BizException</span><span class="params">(BaseErrorInfoInterface errorInfoInterface, Throwable cause)</span> &#123;</span><br><span class="line">  <span class="built_in">super</span>(errorInfoInterface.getResultCode(), cause);</span><br><span class="line">  <span class="built_in">this</span>.errorCode = errorInfoInterface.getResultCode();</span><br><span class="line">  <span class="built_in">this</span>.errorMsg = errorInfoInterface.getResultMsg();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">BizException</span><span class="params">(String errorMsg)</span> &#123;</span><br><span class="line">  <span class="built_in">super</span>(errorMsg);</span><br><span class="line">  <span class="built_in">this</span>.errorMsg = errorMsg;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">BizException</span><span class="params">(String errorCode, String errorMsg)</span> &#123;</span><br><span class="line">  <span class="built_in">super</span>(errorCode);</span><br><span class="line">  <span class="built_in">this</span>.errorCode = errorCode;</span><br><span class="line">  <span class="built_in">this</span>.errorMsg = errorMsg;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">BizException</span><span class="params">(String errorCode, String errorMsg, Throwable cause)</span> &#123;</span><br><span class="line">  <span class="built_in">super</span>(errorCode, cause);</span><br><span class="line">  <span class="built_in">this</span>.errorCode = errorCode;</span><br><span class="line">  <span class="built_in">this</span>.errorMsg = errorMsg;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">getErrorCode</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> errorCode;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setErrorCode</span><span class="params">(String errorCode)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.errorCode = errorCode;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">getErrorMsg</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> errorMsg;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setErrorMsg</span><span class="params">(String errorMsg)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.errorMsg = errorMsg;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> errorMsg;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> Throwable <span class="title function_">fillInStackTrace</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰æ•°æ®æ ¼å¼</p><p>é¡ºä¾¿è¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸‹æ•°æ®çš„ä¼ è¾“æ ¼å¼ã€‚ä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResultBody</span> &#123;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å“åº”ä»£ç </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å“åº”æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å“åº”ç»“æœ</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> Object result;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">ResultBody</span><span class="params">()</span> &#123;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">ResultBody</span><span class="params">(BaseErrorInfoInterface errorInfo)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.code = errorInfo.getResultCode();</span><br><span class="line">  <span class="built_in">this</span>.message = errorInfo.getResultMsg();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> code;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(String code)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.code = code;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> message;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.message = message;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> Object <span class="title function_">getResult</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setResult</span><span class="params">(Object result)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.result = result;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æˆåŠŸ</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> ResultBody <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> success(<span class="literal">null</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æˆåŠŸ</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> ResultBody <span class="title function_">success</span><span class="params">(Object data)</span> &#123;</span><br><span class="line">  <span class="type">ResultBody</span> <span class="variable">rb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResultBody</span>();</span><br><span class="line">  rb.setCode(CommonEnum.SUCCESS.getResultCode());</span><br><span class="line">  rb.setMessage(CommonEnum.SUCCESS.getResultMsg());</span><br><span class="line">  rb.setResult(data);</span><br><span class="line">  <span class="keyword">return</span> rb;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å¤±è´¥</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> ResultBody <span class="title function_">error</span><span class="params">(BaseErrorInfoInterface errorInfo)</span> &#123;</span><br><span class="line">  <span class="type">ResultBody</span> <span class="variable">rb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResultBody</span>();</span><br><span class="line">  rb.setCode(errorInfo.getResultCode());</span><br><span class="line">  rb.setMessage(errorInfo.getResultMsg());</span><br><span class="line">  rb.setResult(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> rb;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å¤±è´¥</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> ResultBody <span class="title function_">error</span><span class="params">(String code, String message)</span> &#123;</span><br><span class="line">  <span class="type">ResultBody</span> <span class="variable">rb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResultBody</span>();</span><br><span class="line">  rb.setCode(code);</span><br><span class="line">  rb.setMessage(message);</span><br><span class="line">  rb.setResult(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> rb;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å¤±è´¥</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> ResultBody <span class="title function_">error</span><span class="params">( String message)</span> &#123;</span><br><span class="line">  <span class="type">ResultBody</span> <span class="variable">rb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResultBody</span>();</span><br><span class="line">  rb.setCode(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">  rb.setMessage(message);</span><br><span class="line">  rb.setResult(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> rb;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> JSONObject.toJSONString(<span class="built_in">this</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†ç±»</p><p>æœ€åæˆ‘ä»¬åœ¨æ¥ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†çš„ç±»ã€‚ä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(GlobalExceptionHandler.class);</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å¤„ç†è‡ªå®šä¹‰çš„ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = BizException.class)</span>  </span><br><span class="line">    <span class="meta">@ResponseBody</span>  </span><br><span class="line"> <span class="keyword">public</span>  ResultBody <span class="title function_">bizExceptionHandler</span><span class="params">(HttpServletRequest req, BizException e)</span>&#123;</span><br><span class="line">     logger.error(<span class="string">&quot;å‘ç”Ÿä¸šåŠ¡å¼‚å¸¸ï¼åŸå› æ˜¯ï¼š&#123;&#125;&quot;</span>,e.getErrorMsg());</span><br><span class="line">     <span class="keyword">return</span> ResultBody.error(e.getErrorCode(),e.getErrorMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å¤„ç†ç©ºæŒ‡é’ˆçš„å¼‚å¸¸</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@ExceptionHandler(value =NullPointerException.class)</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="keyword">public</span> ResultBody <span class="title function_">exceptionHandler</span><span class="params">(HttpServletRequest req, NullPointerException e)</span>&#123;</span><br><span class="line">  logger.error(<span class="string">&quot;å‘ç”Ÿç©ºæŒ‡é’ˆå¼‚å¸¸ï¼åŸå› æ˜¯:&quot;</span>,e);</span><br><span class="line">  <span class="keyword">return</span> ResultBody.error(CommonEnum.BODY_NOT_MATCH);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * å¤„ç†å…¶ä»–å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value =Exception.class)</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="keyword">public</span> ResultBody <span class="title function_">exceptionHandler</span><span class="params">(HttpServletRequest req, Exception e)</span>&#123;</span><br><span class="line">     logger.error(<span class="string">&quot;æœªçŸ¥å¼‚å¸¸ï¼åŸå› æ˜¯:&quot;</span>,e);</span><br><span class="line">        <span class="keyword">return</span> ResultBody.error(CommonEnum.INTERNAL_SERVER_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿™é‡Œæˆ‘ä»¬åªæ˜¯ç”¨äºåšå…¨å±€å¼‚å¸¸å¤„ç†çš„åŠŸèƒ½å®ç°ä»¥åŠæµ‹è¯•ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€åœ¨æ·»åŠ ä¸€ä¸ªå®ä½“ç±»å’Œä¸€ä¸ªæ§åˆ¶å±‚ç±»å³å¯ã€‚</p><p>å®ä½“ç±»</p><p>åˆæ˜¯ä¸‡èƒ½çš„ç”¨æˆ·è¡¨ (<em>â–½</em>)</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"> <span class="comment">/** ç¼–å· */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="comment">/** å§“å */</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="comment">/** å¹´é¾„ */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> id;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.id = id;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> name;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> age;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> JSONObject.toJSONString(<span class="built_in">this</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Controller æ§åˆ¶å±‚</p><p>æ§åˆ¶å±‚è¿™è¾¹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨Restfulé£æ ¼å®ç°çš„CRUDåŠŸèƒ½ï¼Œä¸åŒçš„æ˜¯è¿™é‡Œæˆ‘æ•…æ„å¼„å‡ºäº†ä¸€äº›å¼‚å¸¸ï¼Œå¥½è®©è¿™äº›å¼‚å¸¸è¢«æ•è·åˆ°ç„¶åå¤„ç†ã€‚è¿™äº›å¼‚å¸¸ä¸­ï¼Œæœ‰è‡ªå®šä¹‰çš„å¼‚å¸¸æŠ›å‡ºï¼Œä¹Ÿæœ‰ç©ºæŒ‡é’ˆçš„å¼‚å¸¸æŠ›å‡ºï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸æŠ›å‡º(è¿™é‡Œæˆ‘ç”¨ç±»å‹è½¬æ¢å¼‚å¸¸ä»£æ›¿)ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å®Œæˆä»£ç ç¼–å†™ä¹‹åï¼Œçœ‹çœ‹è¿™äº›å¼‚å¸¸æ˜¯å¦èƒ½å¤Ÿè¢«æ•è·å¤„ç†æˆåŠŸå§ï¼</p><p>ä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/api&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRestController</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@PostMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">insert</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;å¼€å§‹æ–°å¢...&quot;</span>);</span><br><span class="line">     <span class="comment">//å¦‚æœå§“åä¸ºç©ºå°±æ‰‹åŠ¨æŠ›å‡ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¼‚å¸¸ï¼</span></span><br><span class="line">        <span class="keyword">if</span>(user.getName()==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span>  <span class="keyword">new</span> <span class="title class_">BizException</span>(<span class="string">&quot;-1&quot;</span>,<span class="string">&quot;ç”¨æˆ·å§“åä¸èƒ½ä¸ºç©ºï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;å¼€å§‹æ›´æ–°...&quot;</span>);</span><br><span class="line">       <span class="comment">//è¿™é‡Œæ•…æ„é€ æˆä¸€ä¸ªç©ºæŒ‡é’ˆçš„å¼‚å¸¸ï¼Œå¹¶ä¸”ä¸è¿›è¡Œå¤„ç†</span></span><br><span class="line">        String str=<span class="literal">null</span>;</span><br><span class="line">        str.equals(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>  &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼€å§‹åˆ é™¤...&quot;</span>);</span><br><span class="line">        <span class="comment">//è¿™é‡Œæ•…æ„é€ æˆä¸€ä¸ªå¼‚å¸¸ï¼Œå¹¶ä¸”ä¸è¿›è¡Œå¤„ç†</span></span><br><span class="line">        Integer.parseInt(<span class="string">&quot;abc123&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findByUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;å¼€å§‹æŸ¥è¯¢...&quot;</span>);</span><br><span class="line">        List&lt;User&gt; userList =<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        User user2=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user2.setId(<span class="number">1L</span>);</span><br><span class="line">        user2.setName(<span class="string">&quot;xuwujing&quot;</span>);</span><br><span class="line">        user2.setAge(<span class="number">18</span>);</span><br><span class="line">        userList.add(user2);</span><br><span class="line">        <span class="keyword">return</span> userList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>App å…¥å£</p><p>å’Œæ™®é€šçš„SpringBooté¡¹ç›®åŸºæœ¬ä¸€æ ·ã€‚</p><p>ä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span></span><br><span class="line">    &#123;</span><br><span class="line">  SpringApplication.run(App.class, args);</span><br><span class="line">  System.out.println(<span class="string">&quot;ç¨‹åºæ­£åœ¨è¿è¡Œ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½æµ‹è¯•"><a href="#åŠŸèƒ½æµ‹è¯•" class="headerlink" title="åŠŸèƒ½æµ‹è¯•"></a>åŠŸèƒ½æµ‹è¯•</h3><p>æˆ‘ä»¬æˆåŠŸå¯åŠ¨è¯¥ç¨‹åºä¹‹åï¼Œä½¿ç”¨Postmanå·¥å…·æ¥è¿›è¡Œæ¥å£æµ‹è¯•ã€‚</p><p>é¦–å…ˆè¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥çœ‹ç¨‹åºæ­£å¸¸è¿è¡Œæ˜¯å¦okï¼Œä½¿ç”¨GET æ–¹å¼è¿›è¡Œè¯·æ±‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET [http://localhost:8181/api/user](http://localhost:8181/api/user)</span><br></pre></td></tr></table></figure><p>è¿”å›å‚æ•°ä¸º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;xuwujing&quot;,&quot;age&quot;:18&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å›¾:<img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214135664.png" alt="image-20210605214135664"></p><p>å¯ä»¥çœ‹åˆ°ç¨‹åºæ­£å¸¸è¿”å›ï¼Œå¹¶æ²¡æœ‰å› è‡ªå®šä¹‰çš„å…¨å±€å¼‚å¸¸è€Œå½±å“ã€‚</p><p>ç„¶åæˆ‘ä»¬å†æ¥æµ‹è¯•ä¸‹è‡ªå®šä¹‰çš„å¼‚å¸¸æ˜¯å¦èƒ½å¤Ÿè¢«æ­£ç¡®çš„æ•è·å¹¶å¤„ç†ã€‚</p><p>ä½¿ç”¨POSTæ–¹å¼è¿›è¡Œè¯·æ±‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST [http://localhost:8181/api/user](http://localhost:8181/api/user)</span><br></pre></td></tr></table></figure><p>Bodyå‚æ•°ä¸º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;id&quot;:1,&quot;age&quot;:18&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›å‚æ•°ä¸º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;code&quot;:&quot;-1&quot;,&quot;message&quot;:&quot;ç”¨æˆ·å§“åä¸èƒ½ä¸ºç©ºï¼&quot;,&quot;result&quot;:null&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å›¾:</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214310706.png" alt="image-20210605214310706"></p><p>å¯ä»¥çœ‹å‡ºå°†æˆ‘ä»¬æŠ›å‡ºçš„å¼‚å¸¸è¿›è¡Œæ•°æ®å°è£…ï¼Œç„¶åå°†å¼‚å¸¸è¿”å›å‡ºæ¥ã€‚</p><p>ç„¶åæˆ‘ä»¬å†æ¥æµ‹è¯•ä¸‹ç©ºæŒ‡é’ˆå¼‚å¸¸æ˜¯å¦èƒ½å¤Ÿè¢«æ­£ç¡®çš„æ•è·å¹¶å¤„ç†ã€‚åœ¨è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸ä¸­ï¼Œæˆ‘ä»¬é™¤äº†å®šä¹‰ç©ºæŒ‡é’ˆçš„å¼‚å¸¸å¤„ç†ï¼Œä¹Ÿå®šä¹‰æœ€é«˜çº§åˆ«ä¹‹ä¸€çš„Exceptionå¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™é‡Œå‘ç”Ÿäº†ç©ºæŒ‡é’ˆå¼‚å¸¸ä¹‹åï¼Œå®ƒæ˜¯å›ä¼˜å…ˆä½¿ç”¨å“ªä¸€ä¸ªå‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸‹ã€‚</p><p>ä½¿ç”¨PUTæ–¹å¼è¿›è¡Œè¯·æ±‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT [http://localhost:8181/api/user](http://localhost:8181/api/user)</span><br></pre></td></tr></table></figure><p>Bodyå‚æ•°ä¸º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;id&quot;:1,&quot;age&quot;:18&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›å‚æ•°ä¸º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;code&quot;:&quot;400&quot;,&quot;message&quot;:&quot;è¯·æ±‚çš„æ•°æ®æ ¼å¼ä¸ç¬¦!&quot;,&quot;result&quot;:null&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å›¾:<img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/8Jeic82Or04lzqxialA7dsHlx17Amiatd40jzOOLraB4nF3mQcz1gTeUtOQPCyetCZryCW2ic7JJquKd6cCw87kD0A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„çš„ç¡®æ˜¯è¿”å›ç©ºæŒ‡é’ˆçš„å¼‚å¸¸æŠ¤ç†ï¼Œå¯ä»¥å¾—å‡ºå…¨å±€å¼‚å¸¸å¤„ç†ä¼˜å…ˆå¤„ç†å­ç±»çš„å¼‚å¸¸ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬åœ¨æ¥è¯•è¯•æœªæŒ‡å®šå…¶å¼‚å¸¸çš„å¤„ç†ï¼Œçœ‹è¯¥å¼‚å¸¸æ˜¯å¦èƒ½å¤Ÿè¢«æ•è·ã€‚</p><p>ä½¿ç”¨DELETEæ–¹å¼è¿›è¡Œè¯·æ±‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE [http://localhost:8181/api/user](http://localhost:8181/api/user)</span><br></pre></td></tr></table></figure><p>Bodyå‚æ•°ä¸º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;id&quot;:1&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›å‚æ•°ä¸º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;code&quot;:&quot;500&quot;,&quot;message&quot;:&quot;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯!&quot;,&quot;result&quot;:null&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214331619.png" alt="image-20210605214331619"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°å®ƒä½¿ç”¨äº†æˆ‘ä»¬åœ¨è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†ç±»ä¸­çš„Exceptionå¼‚å¸¸å¤„ç†çš„æ–¹æ³•ã€‚åˆ°è¿™é‡Œï¼Œæµ‹è¯•å°±ç»“æŸäº†ã€‚é¡ºä¾¿å†è¯´ä¸€ä¸‹ï¼Œè‡ªä¹‰å®šå…¨å±€å¼‚å¸¸å¤„ç†é™¤äº†å¯ä»¥å¤„ç†ä¸Šè¿°çš„æ•°æ®æ ¼å¼ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥å¤„ç†é¡µé¢çš„è·³è½¬ï¼Œåªéœ€åœ¨æ–°å¢çš„å¼‚å¸¸æ–¹æ³•çš„è¿”å›å¤„ç†ä¸Šå¡«å†™è¯¥è·³è½¬çš„è·¯å¾„å¹¶ä¸ä½¿ç”¨<code>ResponseBody</code> æ³¨è§£å³å¯ã€‚ç»†å¿ƒçš„åŒå­¦ä¹Ÿè®¸å‘ç°äº†åœ¨<code>GlobalExceptionHandler</code>ç±»ä¸­ä½¿ç”¨çš„æ˜¯<code>ControllerAdvice</code>æ³¨è§£ï¼Œè€Œé<code>RestControllerAdvice</code>æ³¨è§£ï¼Œå¦‚æœæ˜¯ç”¨çš„<code>RestControllerAdvice</code>æ³¨è§£ï¼Œå®ƒä¼šå°†æ•°æ®è‡ªåŠ¨è½¬æ¢æˆJSONæ ¼å¼ï¼Œè¿™ç§äº<code>Controller</code>å’Œ<code>RestController</code>ç±»ä¼¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†çš„ä¹‹åå¯ä»¥è¿›è¡Œçµæ´»çš„é€‰æ‹©å¤„ç†ã€‚</p><h1 id="åœ¨SpringBooté¡¹ç›®ä¸­ï¼Œè‡ªå®šä¹‰æ³¨è§£-æ‹¦æˆªå™¨ä¼˜é›…çš„å®ç°æ•æ„Ÿæ•°æ®çš„åŠ è§£å¯†ï¼"><a href="#åœ¨SpringBooté¡¹ç›®ä¸­ï¼Œè‡ªå®šä¹‰æ³¨è§£-æ‹¦æˆªå™¨ä¼˜é›…çš„å®ç°æ•æ„Ÿæ•°æ®çš„åŠ è§£å¯†ï¼" class="headerlink" title="åœ¨SpringBooté¡¹ç›®ä¸­ï¼Œè‡ªå®šä¹‰æ³¨è§£+æ‹¦æˆªå™¨ä¼˜é›…çš„å®ç°æ•æ„Ÿæ•°æ®çš„åŠ è§£å¯†ï¼"></a>åœ¨SpringBooté¡¹ç›®ä¸­ï¼Œè‡ªå®šä¹‰æ³¨è§£+æ‹¦æˆªå™¨ä¼˜é›…çš„å®ç°æ•æ„Ÿæ•°æ®çš„åŠ è§£å¯†ï¼</h1><p>åœ¨å®é™…ç”Ÿäº§é¡¹ç›®ä¸­ï¼Œç»å¸¸éœ€è¦å¯¹å¦‚èº«ä»½è¯ä¿¡æ¯ã€æ‰‹æœºå·ã€çœŸå®å§“åç­‰çš„æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†æ•°æ®åº“å­˜å‚¨ï¼Œä½†åœ¨ä¸šåŠ¡ä»£ç ä¸­å¯¹æ•æ„Ÿä¿¡æ¯è¿›è¡Œæ‰‹åŠ¨åŠ è§£å¯†åˆ™ååˆ†ä¸ä¼˜é›…ï¼Œç”šè‡³ä¼šå­˜åœ¨é”™åŠ å¯†ã€æ¼åŠ å¯†ã€ä¸šåŠ¡äººå‘˜éœ€è¦çŸ¥é“å®é™…çš„åŠ å¯†è§„åˆ™ç­‰çš„æƒ…å†µã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»ä½¿ç”¨springboot+mybatisæ‹¦æˆªå™¨+è‡ªå®šä¹‰æ³¨è§£çš„å½¢å¼å¯¹æ•æ„Ÿæ•°æ®è¿›è¡Œå­˜å‚¨å‰æ‹¦æˆªåŠ å¯†çš„è¯¦ç»†è¿‡ç¨‹ã€‚</p><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯Mybatis-Plugin"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯Mybatis-Plugin" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯Mybatis Plugin"></a>ä¸€ã€ä»€ä¹ˆæ˜¯Mybatis Plugin</h2><p>åœ¨mybatiså®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¯¹äºMybatis pluginçš„çš„ä»‹ç»æ˜¯è¿™æ ·çš„ï¼š</p><p>MyBatis å…è®¸ä½ åœ¨å·²æ˜ å°„è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŸä¸€ç‚¹è¿›è¡Œæ‹¦æˆªè°ƒç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMyBatis å…è®¸ä½¿ç”¨æ’ä»¶æ¥æ‹¦æˆªçš„æ–¹æ³•è°ƒç”¨åŒ…æ‹¬ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¯­å¥æ‰§è¡Œæ‹¦æˆª</span></span><br><span class="line">Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚æ•°è·å–ã€è®¾ç½®æ—¶è¿›è¡Œæ‹¦æˆª</span></span><br><span class="line">ParameterHandler (getParameterObject, setParameters)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è¿”å›ç»“æœè¿›è¡Œæ‹¦æˆª</span></span><br><span class="line">ResultSetHandler (handleResultSets, handleOutputParameters)</span><br><span class="line"></span><br><span class="line"><span class="comment">//sqlè¯­å¥æ‹¦æˆª</span></span><br><span class="line">StatementHandler (prepare, parameterize, batch, update, query)</span><br></pre></td></tr></table></figure><p>ç®€è€Œè¨€ä¹‹ï¼Œå³åœ¨æ‰§è¡Œsqlçš„æ•´ä¸ªå‘¨æœŸä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»»æ„åˆ‡å…¥åˆ°æŸä¸€ç‚¹å¯¹sqlçš„å‚æ•°ã€sqlæ‰§è¡Œç»“æœé›†ã€sqlè¯­å¥æœ¬èº«ç­‰è¿›è¡Œåˆ‡é¢å¤„ç†ã€‚åŸºäºè¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨å…¶å¯¹æˆ‘ä»¬éœ€è¦è¿›è¡ŒåŠ å¯†çš„æ•°æ®è¿›è¡Œåˆ‡é¢ç»Ÿä¸€åŠ å¯†å¤„ç†äº†ï¼ˆåˆ†é¡µæ’ä»¶ pageHelper å°±æ˜¯è¿™æ ·å®ç°æ•°æ®åº“åˆ†é¡µæŸ¥è¯¢çš„ï¼‰ã€‚</p><h2 id="äºŒã€å®ç°åŸºäºæ³¨è§£çš„æ•æ„Ÿä¿¡æ¯åŠ è§£å¯†æ‹¦æˆªå™¨"><a href="#äºŒã€å®ç°åŸºäºæ³¨è§£çš„æ•æ„Ÿä¿¡æ¯åŠ è§£å¯†æ‹¦æˆªå™¨" class="headerlink" title="äºŒã€å®ç°åŸºäºæ³¨è§£çš„æ•æ„Ÿä¿¡æ¯åŠ è§£å¯†æ‹¦æˆªå™¨"></a>äºŒã€å®ç°åŸºäºæ³¨è§£çš„æ•æ„Ÿä¿¡æ¯åŠ è§£å¯†æ‹¦æˆªå™¨</h2><h3 id="2-1-å®ç°æ€è·¯"><a href="#2-1-å®ç°æ€è·¯" class="headerlink" title="2.1 å®ç°æ€è·¯"></a>2.1 å®ç°æ€è·¯</h3><p>å¯¹äºæ•°æ®çš„åŠ å¯†ä¸è§£å¯†ï¼Œåº”å½“å­˜åœ¨ä¸¤ä¸ªæ‹¦æˆªå™¨å¯¹æ•°æ®è¿›è¡Œæ‹¦æˆªæ“ä½œ</p><p>å‚ç…§å®˜æ–¹æ–‡æ¡£ï¼Œå› æ­¤æ­¤å¤„æˆ‘ä»¬åº”å½“ä½¿ç”¨ParameterHandleræ‹¦æˆªå™¨å¯¹å…¥å‚è¿›è¡ŒåŠ å¯†</p><p>ä½¿ç”¨ResultSetHandleræ‹¦æˆªå™¨å¯¹å‡ºå‚è¿›è¡Œè§£å¯†æ“ä½œã€‚</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214403484.png" alt="image-20210605214403484"></p><p>ç›®æ ‡éœ€è¦åŠ å¯†ã€è§£å¯†çš„å­—æ®µå¯èƒ½éœ€è¦çµæ´»å˜æ›´ï¼Œæ­¤æ—¶æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œå¯¹éœ€è¦åŠ å¯†çš„å­—æ®µè¿›è¡Œæ³¨è§£ï¼Œé‚£ä¹ˆä¾¿å¯ä»¥é…åˆæ‹¦æˆªå™¨å¯¹éœ€è¦çš„æ•°æ®è¿›è¡ŒåŠ å¯†ä¸è§£å¯†æ“ä½œäº†ã€‚</p><p>mybatisçš„interceptoræ¥å£æœ‰ä»¥ä¸‹æ–¹æ³•éœ€è¦å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//ä¸»è¦å‚æ•°æ‹¦æˆªæ–¹æ³•</span></span><br><span class="line">  Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//mybatisæ’ä»¶é“¾</span></span><br><span class="line">  <span class="keyword">default</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;<span class="keyword">return</span> Plugin.wrap(target, <span class="built_in">this</span>);&#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//è‡ªå®šä¹‰æ’ä»¶é…ç½®æ–‡ä»¶æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-å®šä¹‰éœ€è¦åŠ å¯†è§£å¯†çš„æ•æ„Ÿä¿¡æ¯æ³¨è§£"><a href="#2-2-å®šä¹‰éœ€è¦åŠ å¯†è§£å¯†çš„æ•æ„Ÿä¿¡æ¯æ³¨è§£" class="headerlink" title="2.2 å®šä¹‰éœ€è¦åŠ å¯†è§£å¯†çš„æ•æ„Ÿä¿¡æ¯æ³¨è§£"></a>2.2 å®šä¹‰éœ€è¦åŠ å¯†è§£å¯†çš„æ•æ„Ÿä¿¡æ¯æ³¨è§£</h3><p>å®šä¹‰æ³¨è§£æ•æ„Ÿä¿¡æ¯ç±»ï¼ˆå¦‚å®ä½“ç±»POJO\POï¼‰çš„æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨è§£æ•æ„Ÿä¿¡æ¯ç±»çš„æ³¨è§£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Target(&#123; ElementType.TYPE &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SensitiveData &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰æ³¨è§£æ•æ„Ÿä¿¡æ¯ç±»ä¸­æ•æ„Ÿå­—æ®µçš„æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨è§£æ•æ„Ÿä¿¡æ¯ç±»ä¸­æ•æ„Ÿå­—æ®µçš„æ³¨è§£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Target(&#123; ElementType.Field &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SensitiveField &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-å®šä¹‰åŠ å¯†æ¥å£åŠå…¶å®ç°ç±»"><a href="#2-3-å®šä¹‰åŠ å¯†æ¥å£åŠå…¶å®ç°ç±»" class="headerlink" title="2.3 å®šä¹‰åŠ å¯†æ¥å£åŠå…¶å®ç°ç±»"></a>2.3 å®šä¹‰åŠ å¯†æ¥å£åŠå…¶å®ç°ç±»</h3><p>å®šä¹‰åŠ å¯†æ¥å£ï¼Œæ–¹ä¾¿ä»¥åæ‹“å±•åŠ å¯†æ–¹æ³•ï¼ˆå¦‚AESåŠ å¯†ç®—æ³•æ‹“å±•æ”¯æŒPBEç®—æ³•ï¼Œåªéœ€è¦æ³¨å…¥æ—¶æŒ‡å®šä¸€ä¸‹ä¾¿å¯ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EncryptUtil</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ å¯†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> declaredFields paramsObjectæ‰€å£°æ˜çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramsObject   mapperä¸­paramsTypeçš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> T</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalAccessException å­—æ®µä¸å¯è®¿é—®å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     &lt;T&gt; T <span class="title function_">encrypt</span><span class="params">(Field[] declaredFields, T paramsObject)</span> <span class="keyword">throws</span> IllegalAccessException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EncryptUtil çš„AESåŠ å¯†å®ç°ç±»ï¼Œæ­¤å¤„AESUtilä¸ºè‡ªå°è£…çš„AESåŠ å¯†å·¥å…·ï¼Œéœ€è¦çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œå°è£…ï¼Œæœ¬æ–‡ä¸æä¾›ã€‚ï¼ˆæœç´¢å…¬ä¼—å·JavaçŸ¥éŸ³ï¼Œå›å¤â€œ2021â€ï¼Œé€ä½ ä¸€ä»½Javaé¢è¯•é¢˜å®å…¸ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AESEncrypt</span> <span class="keyword">implements</span> <span class="title class_">EncryptUtil</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AESUtil aesUtil;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ å¯†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> declaredFields paramsObjectæ‰€å£°æ˜çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramsObject   mapperä¸­paramsTypeçš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> T</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalAccessException å­—æ®µä¸å¯è®¿é—®å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">encrypt</span><span class="params">(Field[] declaredFields, T paramsObject)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        <span class="keyword">for</span> (Field field : declaredFields) &#123;</span><br><span class="line">            <span class="comment">//å–å‡ºæ‰€æœ‰è¢«EncryptDecryptFieldæ³¨è§£çš„å­—æ®µ</span></span><br><span class="line">            <span class="type">SensitiveField</span> <span class="variable">sensitiveField</span> <span class="operator">=</span> field.getAnnotation(SensitiveField.class);</span><br><span class="line">            <span class="keyword">if</span> (!Objects.isNull(sensitiveField)) &#123;</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> field.get(paramsObject);</span><br><span class="line">                <span class="comment">//æš‚æ—¶åªå®ç°Stringç±»å‹çš„åŠ å¯†</span></span><br><span class="line">                <span class="keyword">if</span> (object <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) object;</span><br><span class="line">                    <span class="comment">//åŠ å¯†  è¿™é‡Œæˆ‘ä½¿ç”¨è‡ªå®šä¹‰çš„AESåŠ å¯†å·¥å…·</span></span><br><span class="line">                    field.set(paramsObject, aesUtil.encrypt(value));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> paramsObject;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-å®ç°å…¥å‚åŠ å¯†æ‹¦æˆªå™¨"><a href="#2-4-å®ç°å…¥å‚åŠ å¯†æ‹¦æˆªå™¨" class="headerlink" title="2.4 å®ç°å…¥å‚åŠ å¯†æ‹¦æˆªå™¨"></a>2.4 å®ç°å…¥å‚åŠ å¯†æ‹¦æˆªå™¨</h3><p>MyabtisåŒ…ä¸­çš„org.apache.ibatis.plugin.Interceptoræ‹¦æˆªå™¨æ¥å£è¦æ±‚æˆ‘ä»¬å®ç°ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//æ ¸å¿ƒæ‹¦æˆªé€»è¾‘</span></span><br><span class="line">  Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//æ‹¦æˆªå™¨é“¾</span></span><br><span class="line">  <span class="keyword">default</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;<span class="keyword">return</span> Plugin.wrap(target, <span class="built_in">this</span>);&#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ“ä½œ</span></span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªå…¥å‚åŠ å¯†æ‹¦æˆªå™¨ã€‚</p><p>@Intercepts æ³¨è§£å¼€å¯æ‹¦æˆªå™¨ï¼Œ@Signature æ³¨è§£å®šä¹‰æ‹¦æˆªå™¨çš„å®é™…ç±»å‹ã€‚</p><p><strong>@Signatureä¸­</strong></p><ul><li>type å±æ€§æŒ‡å®šå½“å‰æ‹¦æˆªå™¨ä½¿ç”¨StatementHandler ã€ResultSetHandlerã€ParameterHandlerï¼ŒExecutorçš„ä¸€ç§</li><li>method å±æ€§æŒ‡å®šä½¿ç”¨ä»¥ä¸Šå››ç§ç±»å‹çš„å…·ä½“æ–¹æ³•ï¼ˆå¯è¿›å…¥classå†…éƒ¨æŸ¥çœ‹å…¶æ–¹æ³•ï¼‰ã€‚</li><li>args å±æ€§æŒ‡å®šé¢„ç¼–è¯‘è¯­å¥</li></ul><p>æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨äº† ParameterHandler.setParamters()æ–¹æ³•ï¼Œæ‹¦æˆªmapper.xmlä¸­paramsTypeçš„å®ä¾‹ï¼ˆå³åœ¨æ¯ä¸ªå«æœ‰paramsTypeå±æ€§mapperè¯­å¥ä¸­ï¼Œéƒ½æ‰§è¡Œè¯¥æ‹¦æˆªå™¨ï¼Œå¯¹paramsTypeçš„å®ä¾‹è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ å¯†æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> * æ³¨æ„<span class="doctag">@Component</span>æ³¨è§£ä¸€å®šè¦åŠ ä¸Š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : tanzj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2020/1/19.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">        @Signature(type = ParameterHandler.class, method = &quot;setParameters&quot;, args = PreparedStatement.class),</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EncryptDecryptUtil encryptUtil;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EncryptInterceptor</span><span class="params">(EncryptDecryptUtil encryptUtil)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.encryptUtil = encryptUtil;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//@Signature æŒ‡å®šäº† type= parameterHandler åï¼Œè¿™é‡Œçš„ invocation.getTarget() ä¾¿æ˜¯parameterHandler </span></span><br><span class="line">        <span class="comment">//è‹¥æŒ‡å®šResultSetHandler ï¼Œè¿™é‡Œåˆ™èƒ½å¼ºè½¬ä¸ºResultSetHandler</span></span><br><span class="line">        <span class="type">ParameterHandler</span> <span class="variable">parameterHandler</span> <span class="operator">=</span> (ParameterHandler) invocation.getTarget();</span><br><span class="line">        <span class="comment">// è·å–å‚æ•°å¯¹åƒï¼Œå³ mapper ä¸­ paramsType çš„å®ä¾‹</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">parameterField</span> <span class="operator">=</span> parameterHandler.getClass().getDeclaredField(<span class="string">&quot;parameterObject&quot;</span>);</span><br><span class="line">        parameterField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//å–å‡ºå®ä¾‹</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">parameterObject</span> <span class="operator">=</span> parameterField.get(parameterHandler);</span><br><span class="line">        <span class="keyword">if</span> (parameterObject != <span class="literal">null</span>) &#123;</span><br><span class="line">            Class&lt;?&gt; parameterObjectClass = parameterObject.getClass();</span><br><span class="line">            <span class="comment">//æ ¡éªŒè¯¥å®ä¾‹çš„ç±»æ˜¯å¦è¢«@SensitiveDataæ‰€æ³¨è§£</span></span><br><span class="line">            <span class="type">SensitiveData</span> <span class="variable">sensitiveData</span> <span class="operator">=</span> AnnotationUtils.findAnnotation(parameterObjectClass, SensitiveData.class);</span><br><span class="line">            <span class="keyword">if</span> (Objects.nonNull(sensitiveData)) &#123;</span><br><span class="line">                <span class="comment">//å–å‡ºå½“å‰å½“å‰ç±»æ‰€æœ‰å­—æ®µï¼Œä¼ å…¥åŠ å¯†æ–¹æ³•</span></span><br><span class="line">                Field[] declaredFields = parameterObjectClass.getDeclaredFields();</span><br><span class="line">                encryptUtil.encrypt(declaredFields, parameterObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ‡è®°é…ç½®ï¼Œå¦åˆ™å½“å‰æ‹¦æˆªå™¨ä¸ä¼šåŠ å…¥æ‹¦æˆªå™¨é“¾</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">plugin</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(o, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰é…ç½®å†™å…¥ï¼Œæ²¡æœ‰è‡ªå®šä¹‰é…ç½®çš„å¯ä»¥ç›´æ¥ç½®ç©ºæ­¤æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤å®Œæˆè‡ªå®šä¹‰åŠ å¯†æ‹¦æˆªåŠ å¯†ã€‚</p><h3 id="2-5-å®šä¹‰è§£å¯†æ¥å£åŠå…¶å®ç°ç±»"><a href="#2-5-å®šä¹‰è§£å¯†æ¥å£åŠå…¶å®ç°ç±»" class="headerlink" title="2.5 å®šä¹‰è§£å¯†æ¥å£åŠå…¶å®ç°ç±»"></a>2.5 å®šä¹‰è§£å¯†æ¥å£åŠå…¶å®ç°ç±»</h3><p>è§£å¯†æ¥å£ï¼Œå…¶ä¸­resultä¸ºmapper.xmlä¸­resultTypeçš„å®ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DecryptUtil</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£å¯†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result resultTypeçš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> T</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalAccessException å­—æ®µä¸å¯è®¿é—®å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     &lt;T&gt; T <span class="title function_">decrypt</span><span class="params">(T result)</span> <span class="keyword">throws</span> IllegalAccessException;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£å¯†æ¥å£AESå·¥å…·è§£å¯†å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AESDecrypt</span> <span class="keyword">implements</span> <span class="title class_">DecryptUtil</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AESUtil aesUtil;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£å¯†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result resultTypeçš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> T</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalAccessException å­—æ®µä¸å¯è®¿é—®å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">decrypt</span><span class="params">(T result)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">//å–å‡ºresultTypeçš„ç±»</span></span><br><span class="line">        Class&lt;?&gt; resultClass = result.getClass();</span><br><span class="line">        Field[] declaredFields = resultClass.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : declaredFields) &#123;</span><br><span class="line">            <span class="comment">//å–å‡ºæ‰€æœ‰è¢«EncryptDecryptFieldæ³¨è§£çš„å­—æ®µ</span></span><br><span class="line">            <span class="type">SensitiveField</span> <span class="variable">sensitiveField</span> <span class="operator">=</span> field.getAnnotation(SensitiveField.class);</span><br><span class="line">            <span class="keyword">if</span> (!Objects.isNull(sensitiveField)) &#123;</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> field.get(result);</span><br><span class="line">                <span class="comment">//åªæ”¯æŒStringçš„è§£å¯†</span></span><br><span class="line">                <span class="keyword">if</span> (object <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) object;</span><br><span class="line">                    <span class="comment">//å¯¹æ³¨è§£çš„å­—æ®µè¿›è¡Œé€ä¸€è§£å¯†</span></span><br><span class="line">                    field.set(result, aesUtil.decrypt(value));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6-å®šä¹‰å‡ºå‚è§£å¯†æ‹¦æˆªå™¨"><a href="#2-6-å®šä¹‰å‡ºå‚è§£å¯†æ‹¦æˆªå™¨" class="headerlink" title="2.6 å®šä¹‰å‡ºå‚è§£å¯†æ‹¦æˆªå™¨"></a>2.6 å®šä¹‰å‡ºå‚è§£å¯†æ‹¦æˆªå™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">        @Signature(type = ResultSetHandler.class, method = &quot;handleResultSets&quot;, args = &#123;Statement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DecryptInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DecryptUtil aesDecrypt;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//å–å‡ºæŸ¥è¯¢çš„ç»“æœ</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">resultObject</span> <span class="operator">=</span> invocation.proceed();</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(resultObject)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åŸºäºselectList</span></span><br><span class="line">        <span class="keyword">if</span> (resultObject <span class="keyword">instanceof</span> ArrayList) &#123;</span><br><span class="line">            <span class="type">ArrayList</span> <span class="variable">resultList</span> <span class="operator">=</span> (ArrayList) resultObject;</span><br><span class="line">            <span class="keyword">if</span> (!CollectionUtils.isEmpty(resultList) &amp;&amp; needToDecrypt(resultList.get(<span class="number">0</span>))) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Object result : resultList) &#123;</span><br><span class="line">                    <span class="comment">//é€ä¸€è§£å¯†</span></span><br><span class="line">                    aesDecrypt.decrypt(result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//åŸºäºselectOne</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (needToDecrypt(resultObject)) &#123;</span><br><span class="line">                aesDecrypt.decrypt(resultObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resultObject;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">needToDecrypt</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; objectClass = object.getClass();</span><br><span class="line">        <span class="type">SensitiveData</span> <span class="variable">sensitiveData</span> <span class="operator">=</span> AnnotationUtils.findAnnotation(objectClass, SensitiveData.class);</span><br><span class="line">        <span class="keyword">return</span> Objects.nonNull(sensitiveData);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤å®Œæˆè§£å¯†æ‹¦æˆªå™¨çš„é…ç½®å·¥ä½œã€‚</p><h2 id="3ã€æ³¨è§£å®ä½“ç±»ä¸­éœ€è¦åŠ è§£å¯†çš„å­—æ®µ"><a href="#3ã€æ³¨è§£å®ä½“ç±»ä¸­éœ€è¦åŠ è§£å¯†çš„å­—æ®µ" class="headerlink" title="3ã€æ³¨è§£å®ä½“ç±»ä¸­éœ€è¦åŠ è§£å¯†çš„å­—æ®µ"></a>3ã€æ³¨è§£å®ä½“ç±»ä¸­éœ€è¦åŠ è§£å¯†çš„å­—æ®µ</h2><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214516184.png" alt="å›¾ç‰‡"></p><p>æ­¤æ—¶åœ¨mapperä¸­ï¼ŒæŒ‡å®šparamType=User resultType=User ä¾¿å¯å®ç°è„±ç¦»ä¸šåŠ¡å±‚ï¼ŒåŸºäºmybatisæ‹¦æˆªå™¨çš„åŠ è§£å¯†æ“ä½œã€‚</p><h1 id="Docker-å›¾å½¢åŒ–å·¥å…·ï¼šPortainer"><a href="#Docker-å›¾å½¢åŒ–å·¥å…·ï¼šPortainer" class="headerlink" title="Docker å›¾å½¢åŒ–å·¥å…·ï¼šPortainer"></a>Docker å›¾å½¢åŒ–å·¥å…·ï¼šPortainer</h1><h2 id="ä¸€-Dockerå›¾å½¢åŒ–å·¥å…·"><a href="#ä¸€-Dockerå›¾å½¢åŒ–å·¥å…·" class="headerlink" title="ä¸€.Dockerå›¾å½¢åŒ–å·¥å…·"></a>ä¸€.Dockerå›¾å½¢åŒ–å·¥å…·</h2><p>docker å›¾å½¢é¡µé¢ç®¡ç†å·¥å…·å¸¸ç”¨çš„æœ‰ä¸‰ç§ï¼ŒDockerUI ï¼ŒPortainer ï¼ŒShipyard ã€‚DockerUI æ˜¯ Portainer çš„å‰èº«ï¼Œè¿™ä¸‰ä¸ªå·¥å…·é€šè¿‡docker apiæ¥è·å–ç®¡ç†çš„èµ„æºä¿¡æ¯ã€‚</p><p>å¹³æ—¶æˆ‘ä»¬å¸¸å¸¸å¯¹ç€shellå¯¹ç€è¿™äº›å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œå®¡ç¾ä¼šå¾ˆç–²åŠ³ï¼Œå¦‚æœæœ‰æ¼‚äº®çš„å›¾å½¢åŒ–ç•Œé¢å¯ä»¥ç›´è§‚æŸ¥çœ‹dockerèµ„æºä¿¡æ¯ï¼Œä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬å°±æ­å»ºå•æœºç‰ˆçš„ä¸‰ç§å¸¸ç”¨å›¾å½¢é¡µé¢ç®¡ç†å·¥å…·ã€‚è¿™ä¸‰ç§å›¾å½¢åŒ–ç®¡ç†å·¥å…·ä»¥Portaineræœ€ä¸ºå—æ¬¢è¿ã€‚</p><h2 id="äºŒ-DockerUI"><a href="#äºŒ-DockerUI" class="headerlink" title="äºŒ.DockerUI"></a>äºŒ.DockerUI</h2><p>è½»é‡çº§å›¾å½¢é¡µé¢ç®¡ç†ä¹‹DockerUI</p><p>1.æŸ¥çœ‹dockeruié•œåƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker search dockerui</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p><p>2.é€‰æ‹©å–œæ¬¢çš„dockeruié£æ ¼é•œåƒï¼Œä¸‹è½½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker pull abh1nav/dockerui</span><br></pre></td></tr></table></figure><p>3.å¯åŠ¨dockeruiå®¹å™¨ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„å¸¦ä¸Šprivilegedå‚æ•°ï¼Œæå‡æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -d --privileged --name dockerui -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock abh1nav/dockerui</span><br></pre></td></tr></table></figure><p>å‰å¾€ç½‘é¡µæŸ¥çœ‹ä¹‹å‰ï¼Œä½ éœ€è¦æ‰“å¼€æœåŠ¡å™¨çš„9000ç«¯å£ï¼š firewall-cmd â€“permanent â€“zone=public â€“add-port=9000/tcpfirewall-cmd â€“reload</p><p>4.æµè§ˆå™¨æŸ¥çœ‹dockeruiï¼š<a target="_blank" rel="noopener" href="http://192.168.2.119:9000/">http://192.168.2.119:9000</a> æˆ–è€… curl <a target="_blank" rel="noopener" href="http://192.168.2.119:9000/">http://192.168.2.119:9000</a></p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214545816.png" alt="image-20210605214545816"></p><h2 id="ä¸‰-Shipyard"><a href="#ä¸‰-Shipyard" class="headerlink" title="ä¸‰.Shipyard"></a>ä¸‰.Shipyard</h2><p>è½»é‡çº§å›¾å½¢é¡µé¢ç®¡ç†ä¹‹Shipyard</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214608923.png" alt="image-20210605214608923"></p><h2 id="å››-Portainer"><a href="#å››-Portainer" class="headerlink" title="å››.Portainer"></a>å››.Portainer</h2><p>è½»é‡çº§å›¾å½¢é¡µé¢ç®¡ç†ä¹‹Portainer</p><h4 id="1-æŸ¥çœ‹portaineré•œåƒ"><a href="#1-æŸ¥çœ‹portaineré•œåƒ" class="headerlink" title="1.æŸ¥çœ‹portaineré•œåƒ"></a>1.æŸ¥çœ‹portaineré•œåƒ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker search portainer</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p><h4 id="2-é€‰æ‹©å–œæ¬¢çš„portaineré£æ ¼é•œåƒï¼Œä¸‹è½½"><a href="#2-é€‰æ‹©å–œæ¬¢çš„portaineré£æ ¼é•œåƒï¼Œä¸‹è½½" class="headerlink" title="2.é€‰æ‹©å–œæ¬¢çš„portaineré£æ ¼é•œåƒï¼Œä¸‹è½½"></a>2.é€‰æ‹©å–œæ¬¢çš„portaineré£æ ¼é•œåƒï¼Œä¸‹è½½</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull portainer/portainer</span><br></pre></td></tr></table></figure><h4 id="3-å¯åŠ¨dockeruiå®¹å™¨"><a href="#3-å¯åŠ¨dockeruiå®¹å™¨" class="headerlink" title="3.å¯åŠ¨dockeruiå®¹å™¨"></a>3.å¯åŠ¨dockeruiå®¹å™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker volume create portainer_data</span><br><span class="line">docker run -d -p 9000:9000 --name portainer --restart always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>-v /var/run/docker.sock:/var/run/docker.sock</code> ï¼šæŠŠå®¿ä¸»æœºçš„Dockerå®ˆæŠ¤è¿›ç¨‹(Docker daemon)é»˜è®¤ç›‘å¬çš„UnixåŸŸå¥—æ¥å­—æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼›</li><li><code>-v portainer\_data:/data</code> ï¼šæŠŠå®¿ä¸»æœºportainer_dataæ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨/dataç›®å½•ï¼›</li></ul><h4 id="4-webç®¡ç†"><a href="#4-webç®¡ç†" class="headerlink" title="4.webç®¡ç†"></a>4.webç®¡ç†</h4><p>1ã€ç™»é™† <a href="http://x.x.x.x:9000ï¼Œè®¾ç½®ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ã€‚">http://x.x.x.x:9000ï¼Œè®¾ç½®ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ã€‚</a></p><p>2ã€å•æœºç‰ˆåœ¨æ–°é¡µé¢é€‰æ‹© Local å³å¯å®Œæˆå®‰è£…ï¼Œé›†ç¾¤é€‰æ‹©Remoteç„¶åè¾“å…¥SWARMçš„IPåœ°å€ï¼Œç‚¹å‡»Connectå®Œæˆå®‰è£…ã€‚</p><p>æµè§ˆå™¨è®¿é—® <a target="_blank" rel="noopener" href="http://192.168.2.119:9000/">http://192.168.2.119:9000</a> , è®¾ç½®ä¸€ä¸ªå¯†ç å³å¯ï¼Œç‚¹å‡»åˆ›å»ºç”¨æˆ·</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214627660.png" alt="image-20210605214627660"></p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214643133.png" alt="image-20210605214643133"></p><p>æˆ‘ä»¬æ­å»ºçš„æ˜¯å•æœºç‰ˆï¼Œç›´æ¥é€‰æ‹©Local ï¼Œç‚¹å‡»è¿æ¥</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214701580.png" alt="image-20210605214701580"></p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214717308.png" alt="image-20210605214717308"></p><p>ç°åœ¨å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œç‚¹å‡»Localè¿›å…¥ä»ªè¡¨ç›˜ä¸»é¡µé¢ã€‚</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214738253.png" alt="image-20210605214738253"></p><p>å®¹å™¨é¡µé¢</p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210605214750869.png" alt="image-20210605214750869"></p><h1 id="SpringMVCï¼šæ³¨è§£-ControllerAdviceçš„å·¥ä½œåŸç†"><a href="#SpringMVCï¼šæ³¨è§£-ControllerAdviceçš„å·¥ä½œåŸç†" class="headerlink" title="SpringMVCï¼šæ³¨è§£@ControllerAdviceçš„å·¥ä½œåŸç†"></a>SpringMVCï¼šæ³¨è§£@ControllerAdviceçš„å·¥ä½œåŸç†</h1><p><code>Spring MVC</code>ä¸­ï¼Œé€šè¿‡ç»„åˆä½¿ç”¨æ³¨è§£<code>@ControllerAdvice</code>å’Œå…¶ä»–ä¸€äº›æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå¼€å‘äººå‘˜å®ç°çš„æ§åˆ¶å™¨ç±»åšä¸€äº›å…¨å±€æ€§çš„å®šåˆ¶ï¼Œå…·ä½“æ¥è®²ï¼Œå¯ä½œå¦‚ä¸‹å®šåˆ¶ :</p><ul><li><p>ç»“åˆ<code>@ExceptionHandler</code>ä½¿ç”¨ ==&gt; æ·»åŠ ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æ§åˆ¶å™¨æ–¹æ³•</p></li><li><p>ç»“åˆ<code>@ModelAttribute</code>ä½¿ç”¨ ==&gt; ä½¿ç”¨å…±ç”¨æ–¹æ³•æ·»åŠ æ¸²æŸ“è§†å›¾çš„æ•°æ®æ¨¡å‹å±æ€§</p></li><li><p>ç»“åˆ<code>@InitBinder</code>ä½¿ç”¨ ==&gt; ä½¿ç”¨å…±ç”¨æ–¹æ³•åˆå§‹åŒ–æ§åˆ¶å™¨æ–¹æ³•è°ƒç”¨ä½¿ç”¨çš„æ•°æ®ç»‘å®šå™¨</p><blockquote><p>æ•°æ®ç»‘å®šå™¨æ¶‰åŠåˆ°å“ªäº›å‚æ•°/å±æ€§éœ€è¦/ä¸éœ€è¦ç»‘å®šï¼Œè®¾ç½®æ•°æ®ç±»å‹è½¬æ¢æ—¶ä½¿ç”¨çš„<code>PropertyEditor</code>,<code>Formatter</code>ç­‰ã€‚</p></blockquote></li></ul><p>é‚£ä¹ˆï¼Œ<code>@ControllerAdvice</code>çš„å·¥ä½œåŸç†åˆæ˜¯æ€æ ·çš„å‘¢ ï¼Ÿè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±ä¸€æ¢ç©¶ç«Ÿã€‚</p><h2 id="1-æ³¨è§£-ControllerAdviceæ˜¯å¦‚ä½•è¢«å‘ç°çš„"><a href="#1-æ³¨è§£-ControllerAdviceæ˜¯å¦‚ä½•è¢«å‘ç°çš„" class="headerlink" title="1. æ³¨è§£@ControllerAdviceæ˜¯å¦‚ä½•è¢«å‘ç°çš„ ?"></a>1. æ³¨è§£<code>@ControllerAdvice</code>æ˜¯å¦‚ä½•è¢«å‘ç°çš„ ?</h2><p>é¦–å…ˆ,å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¼šå®šä¹‰ç±»å‹ä¸º<code>RequestMappingHandlerAdapter</code>çš„<code>bean</code>ç»„ä»¶ï¼Œè¿™æ˜¯<code>DispatcherServlet</code>ç”¨äºæ‰§è¡Œæ§åˆ¶å™¨æ–¹æ³•çš„<code>HandlerAdapter</code>,å®ƒå®ç°äº†æ¥å£<code>InitializingBean</code>,æ‰€ä»¥è‡ªèº«åœ¨åˆå§‹åŒ–æ—¶å…¶æ–¹æ³•<code>#afterPropertiesSet</code>ä¼šè¢«è°ƒç”¨æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line"> <span class="comment">// Do this first, it may add ResponseBody advice beans</span></span><br><span class="line"> initControllerAdviceCache();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// çœç•¥æ‰æ— å…³ä»£ç  </span></span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œ<code>RequestMappingHandlerAdapter bean</code>ç»„ä»¶åœ¨è‡ªèº«åˆå§‹åŒ–æ—¶è°ƒç”¨äº†<code>#initControllerAdviceCache</code>,ä»è¿™ä¸ªæ–¹æ³•çš„åå­—ä¸Šå°±å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ª<code>ControllerAdvice</code>ç›¸å…³çš„åˆå§‹åŒ–å‡½æ•°ï¼Œè€Œ<code>#initControllerAdviceCache</code>å…·ä½“åˆåšäº†ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­æ¥çœ‹ :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initControllerAdviceCache</span><span class="params">()</span> &#123;</span><br><span class="line"> <span class="keyword">if</span> (getApplicationContext() == <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ‰¾åˆ°æ‰€æœ‰ä½¿ç”¨äº†æ³¨è§£ @ControllerAdvice çš„beanç»„ä»¶ </span></span><br><span class="line"> List&lt;ControllerAdviceBean&gt; adviceBeans = ControllerAdviceBean.findAnnotatedBeans(getApplicationContext());</span><br><span class="line">    <span class="comment">// æ’åº</span></span><br><span class="line"> AnnotationAwareOrderComparator.sort(adviceBeans);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">// this. requestResponseBodyAdvice : </span></span><br><span class="line">   <span class="comment">//   ç”¨äºè®°å½•æ‰€æœ‰ @ControllerAdvice + RequestBodyAdvice/ResponseBodyAdvice bean </span></span><br><span class="line">   <span class="comment">// this.modelAttributeAdviceCache : </span></span><br><span class="line">   <span class="comment">//   ç”¨äºè®°å½•æ‰€æœ‰ @ControllerAdvice beanç»„ä»¶ä¸­çš„ @ModuleAttribute æ–¹æ³•</span></span><br><span class="line">   <span class="comment">// this.initBinderAdviceCache : </span></span><br><span class="line">   <span class="comment">//  ç”¨äºè®°å½•æ‰€æœ‰ @ControllerAdvice beanç»„ä»¶ä¸­çš„ @InitBinder æ–¹æ³•</span></span><br><span class="line">   <span class="comment">// ç”¨äºä¸´æ—¶è®°å½•æ‰€æœ‰ @ControllerAdvice + RequestResponseBodyAdvice bean</span></span><br><span class="line"> List&lt;Object&gt; requestResponseBodyAdviceBeans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// éå†æ¯ä¸ªä½¿ç”¨äº†æ³¨è§£ @ControllerAdvice çš„ bean ç»„ä»¶</span></span><br><span class="line"> <span class="keyword">for</span> (ControllerAdviceBean adviceBean : adviceBeans) &#123;</span><br><span class="line">  Class&lt;?&gt; beanType = adviceBean.getBeanType();</span><br><span class="line">  <span class="keyword">if</span> (beanType == <span class="literal">null</span>) &#123;</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unresolvable type for ControllerAdviceBean: &quot;</span> + adviceBean);</span><br><span class="line">  &#125;</span><br><span class="line">       <span class="comment">// è·å–å½“å‰  ControllerAdviceBean ä¸­æ‰€æœ‰ä½¿ç”¨äº† @ModelAttribute æ³¨è§£çš„æ–¹æ³•</span></span><br><span class="line">  Set&lt;Method&gt; attrMethods = MethodIntrospector.selectMethods(beanType, MODEL_ATTRIBUTE_METHODS);</span><br><span class="line">  <span class="keyword">if</span> (!attrMethods.isEmpty()) &#123;</span><br><span class="line">   <span class="built_in">this</span>.modelAttributeAdviceCache.put(adviceBean, attrMethods);</span><br><span class="line">  &#125;</span><br><span class="line">        </span><br><span class="line">       <span class="comment">// è·å–å½“å‰ ControllerAdviceBean ä¸­æ‰€æœ‰ä½¿ç”¨äº† @InitMethod æ³¨è§£çš„æ–¹æ³•</span></span><br><span class="line">  Set&lt;Method&gt; binderMethods = MethodIntrospector.selectMethods(beanType, INIT_BINDER_METHODS);</span><br><span class="line">  <span class="keyword">if</span> (!binderMethods.isEmpty()) &#123;</span><br><span class="line">   <span class="built_in">this</span>.initBinderAdviceCache.put(adviceBean, binderMethods);</span><br><span class="line">  &#125;</span><br><span class="line">       <span class="comment">// å¦‚æœå½“å‰ ControllerAdviceBean ç»§æ‰¿è‡ª RequestBodyAdviceï¼Œå°†å…¶ç™»è®°åˆ° requestResponseBodyAdviceBeans</span></span><br><span class="line">  <span class="keyword">if</span> (RequestBodyAdvice.class.isAssignableFrom(beanType)) &#123;</span><br><span class="line">   requestResponseBodyAdviceBeans.add(adviceBean);</span><br><span class="line">  &#125;</span><br><span class="line">        </span><br><span class="line">       <span class="comment">// å¦‚æœå½“å‰ ControllerAdviceBean ç»§æ‰¿è‡ª ResponseBodyAdviceï¼Œå°†å…¶ç™»è®°åˆ° requestResponseBodyAdviceBeans  </span></span><br><span class="line">  <span class="keyword">if</span> (ResponseBodyAdvice.class.isAssignableFrom(beanType)) &#123;</span><br><span class="line">   requestResponseBodyAdviceBeans.add(adviceBean);</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">    </span><br><span class="line"> <span class="keyword">if</span> (!requestResponseBodyAdviceBeans.isEmpty()) &#123;</span><br><span class="line">  <span class="built_in">this</span>.requestResponseBodyAdvice.addAll(<span class="number">0</span>, requestResponseBodyAdviceBeans);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">modelSize</span> <span class="operator">=</span> <span class="built_in">this</span>.modelAttributeAdviceCache.size();</span><br><span class="line">  <span class="type">int</span> <span class="variable">binderSize</span> <span class="operator">=</span> <span class="built_in">this</span>.initBinderAdviceCache.size();</span><br><span class="line">  <span class="type">int</span> <span class="variable">reqCount</span> <span class="operator">=</span> getBodyAdviceCount(RequestBodyAdvice.class);</span><br><span class="line">  <span class="type">int</span> <span class="variable">resCount</span> <span class="operator">=</span> getBodyAdviceCount(ResponseBodyAdvice.class);</span><br><span class="line">  <span class="keyword">if</span> (modelSize == <span class="number">0</span> &amp;&amp; binderSize == <span class="number">0</span> &amp;&amp; reqCount == <span class="number">0</span> &amp;&amp; resCount == <span class="number">0</span>) &#123;</span><br><span class="line">   logger.debug(<span class="string">&quot;ControllerAdvice beans: none&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">   logger.debug(<span class="string">&quot;ControllerAdvice beans: &quot;</span> + modelSize + <span class="string">&quot; @ModelAttribute, &quot;</span> + binderSize +</span><br><span class="line">     <span class="string">&quot; @InitBinder, &quot;</span> + reqCount + <span class="string">&quot; RequestBodyAdvice, &quot;</span> + resCount + <span class="string">&quot; ResponseBodyAdvice&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»¥ä¸Š<code>#initControllerAdviceCache</code>æ–¹æ³•çš„å®ç°é€»è¾‘æ¥çœ‹ï¼Œå®ƒå°†å®¹å™¨ä¸­æ‰€æœ‰ä½¿ç”¨äº†æ³¨è§£<code>@ControllerAdvice</code>çš„<code>bean</code>æˆ–è€…å…¶æ–¹æ³•éƒ½åˆ†é—¨åˆ«ç±»åšäº†ç»Ÿè®¡ï¼Œè®°å½•åˆ°äº†<code>RequestMappingHandlerAdapter</code>å®ä¾‹çš„ä¸‰ä¸ªå±æ€§ä¸­ :</p><ul><li><code>requestResponseBodyAdvice</code></li><li>ç”¨äºè®°å½•æ‰€æœ‰<code>@ControllerAdvice</code> + <code>RequestBodyAdvice</code>/<code>ResponseBodyAdvice</code> <code>bean</code>ç»„ä»¶</li><li><code>modelAttributeAdviceCache</code></li><li>ç”¨äºè®°å½•æ‰€æœ‰ <code>@ControllerAdvice</code> <code>bean</code>ç»„ä»¶ä¸­çš„ <code>@ModuleAttribute</code> æ–¹æ³•</li><li><code>initBinderAdviceCache</code></li><li>ç”¨äºè®°å½•æ‰€æœ‰<code>@ControllerAdvice</code> <code>bean</code>ç»„ä»¶ä¸­çš„ <code>@InitBinder</code> æ–¹æ³•</li></ul><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨æ³¨è§£<code>@ControllerAdvice</code>çš„<code>bean</code>ä¸­çš„ä¿¡æ¯è¢«æå–å‡ºæ¥äº†ï¼Œä½†æ˜¯ï¼Œè¿™äº›ä¿¡æ¯åˆæ˜¯æ€ä¹ˆä½¿ç”¨çš„å‘¢ ï¼Ÿæˆ‘ä»¬ç»§ç»­æ¥çœ‹ã€‚</p><h2 id="2-ControllerAdvice-å®šä¹‰ä¿¡æ¯çš„ä½¿ç”¨"><a href="#2-ControllerAdvice-å®šä¹‰ä¿¡æ¯çš„ä½¿ç”¨" class="headerlink" title="2. @ControllerAdvice å®šä¹‰ä¿¡æ¯çš„ä½¿ç”¨"></a>2. <code>@ControllerAdvice</code> å®šä¹‰ä¿¡æ¯çš„ä½¿ç”¨</h2><h3 id="1-requestResponseBodyAdviceçš„ä½¿ç”¨"><a href="#1-requestResponseBodyAdviceçš„ä½¿ç”¨" class="headerlink" title="1. requestResponseBodyAdviceçš„ä½¿ç”¨"></a>1. <code>requestResponseBodyAdvice</code>çš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the list of argument resolvers to use including built-in resolvers</span></span><br><span class="line"><span class="comment"> * and custom resolvers provided via &#123;<span class="doctag">@link</span> #setCustomArgumentResolvers&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;HandlerMethodArgumentResolver&gt; <span class="title function_">getDefaultArgumentResolvers</span><span class="params">()</span> &#123;</span><br><span class="line"> List&lt;HandlerMethodArgumentResolver&gt; resolvers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"> <span class="comment">// ... çœç•¥æ— å…³ä»£ç         </span></span><br><span class="line"> resolvers.add(<span class="keyword">new</span> <span class="title class_">RequestResponseBodyMethodProcessor</span>(getMessageConverters(), </span><br><span class="line">  <span class="built_in">this</span>.requestResponseBodyAdvice));</span><br><span class="line">    <span class="comment">// ... çœç•¥æ— å…³ä»£ç </span></span><br><span class="line"> resolvers.add(<span class="keyword">new</span> <span class="title class_">RequestPartMethodArgumentResolver</span>(getMessageConverters(), </span><br><span class="line">  <span class="built_in">this</span>.requestResponseBodyAdvice));  </span><br><span class="line">    <span class="comment">// ... çœç•¥æ— å…³ä»£ç </span></span><br><span class="line"> resolvers.add(<span class="keyword">new</span> <span class="title class_">HttpEntityMethodProcessor</span>(getMessageConverters(), </span><br><span class="line">  <span class="built_in">this</span>.requestResponseBodyAdvice));</span><br><span class="line"> <span class="comment">// ... çœç•¥æ— å…³ä»£ç </span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> resolvers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>#getDefaultArgumentResolvers</code>æ–¹æ³•ç”¨äºå‡†å¤‡<code>RequestMappingHandlerAdapter</code>æ‰§è¡Œæ§åˆ¶å™¨æ–¹æ³•è¿‡ç¨‹ä¸­ç¼ºçœä½¿ç”¨çš„<code>HandlerMethodArgumentResolver</code>,ä»ä¸Šé¢ä»£ç å¯è§ï¼Œ<code>requestResponseBodyAdvice</code>ä¼šè¢«ä¼ é€’ç»™<code>RequestResponseBodyMethodProcessor</code>/<code>RequestPartMethodArgumentResolver</code>/<code>HttpEntityMethodProcessor</code>è¿™ä¸‰ä¸ªå‚æ•°è§£æå™¨ï¼Œä¸éš¾çŒœæµ‹ï¼Œå®ƒä»¬åœ¨å·¥ä½œæ—¶ä¼šä½¿ç”¨åˆ°è¯¥<code>requestResponseBodyAdvice</code>ï¼Œä½†å…·ä½“æ€ä¹ˆä½¿ç”¨ï¼Œä¸ºé¿å…è¿‡æ·±ç»†èŠ‚å½±å“ç†è§£ï¼Œæœ¬æ–‡æˆ‘ä»¬ä¸ç»§ç»­å±•å¼€ã€‚</p><p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&mid=2247499740&idx=2&sn=5390cf9ce460e3fa6508b58aedeafdab&chksm=ebd5c0f0dca249e62fe73e40fedeb0142542291de704324c5600b79b69aaa5ead4b8d73d71ad&scene=21#wechat_redirect">æ¨èï¼šè¶…çº§å…¨é¢çš„ SpringBoot æ³¨è§£ä»‹ç»</a></p><p>æ–¹æ³•<code>#getDefaultArgumentResolvers</code>ä¹Ÿåœ¨<code>RequestMappingHandlerAdapter</code>åˆå§‹åŒ–æ–¹æ³•ä¸­è¢«è°ƒç”¨æ‰§è¡Œ,å¦‚ä¸‹æ‰€ç¤º :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line"> <span class="comment">// Do this first, it may add ResponseBody advice beans</span></span><br><span class="line"> initControllerAdviceCache();</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (<span class="built_in">this</span>.argumentResolvers == <span class="literal">null</span>) &#123;</span><br><span class="line">  List&lt;HandlerMethodArgumentResolver&gt; resolvers = getDefaultArgumentResolvers(); <span class="comment">// &lt;==</span></span><br><span class="line">  <span class="built_in">this</span>.argumentResolvers = <span class="keyword">new</span> <span class="title class_">HandlerMethodArgumentResolverComposite</span>()</span><br><span class="line">          .addResolvers(resolvers);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœç•¥æ— å…³ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-modelAttributeAdviceCacheçš„ä½¿ç”¨"><a href="#2-modelAttributeAdviceCacheçš„ä½¿ç”¨" class="headerlink" title="2. modelAttributeAdviceCacheçš„ä½¿ç”¨"></a>2. <code>modelAttributeAdviceCache</code>çš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ModelFactory <span class="title function_">getModelFactory</span><span class="params">(HandlerMethod handlerMethod, WebDataBinderFactory binderFactory)</span> &#123;</span><br><span class="line"> <span class="type">SessionAttributesHandler</span> <span class="variable">sessionAttrHandler</span> <span class="operator">=</span> getSessionAttributesHandler(handlerMethod);</span><br><span class="line"> Class&lt;?&gt; handlerType = handlerMethod.getBeanType();</span><br><span class="line"> Set&lt;Method&gt; methods = <span class="built_in">this</span>.modelAttributeCache.get(handlerType);</span><br><span class="line"> <span class="keyword">if</span> (methods == <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="comment">// è·å–å½“å‰æ§åˆ¶å™¨ç±»ä¸­ä½¿ç”¨äº† @ModelAttribute çš„æ–¹æ³•</span></span><br><span class="line">  methods = MethodIntrospector.selectMethods(handlerType, MODEL_ATTRIBUTE_METHODS);</span><br><span class="line">  <span class="built_in">this</span>.modelAttributeCache.put(handlerType, methods);</span><br><span class="line"> &#125;</span><br><span class="line"> List&lt;InvocableHandlerMethod&gt; attrMethods = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"> <span class="comment">// Global methods first</span></span><br><span class="line"> <span class="comment">// éå†@ControllerAdvice beanä¸­æ‰€æœ‰ä½¿ç”¨äº† @ModelAttribute çš„æ–¹æ³•ï¼Œ</span></span><br><span class="line"> <span class="comment">// å°†å…¶åŒ…è£…æˆ InvocableHandlerMethod æ”¾åˆ° attrMethods</span></span><br><span class="line"> <span class="comment">// ********* è¿™é‡Œå°±æ˜¯ modelAttributeAdviceCache è¢«ä½¿ç”¨åˆ°çš„åœ°æ–¹äº† ************</span></span><br><span class="line"> <span class="built_in">this</span>.modelAttributeAdviceCache.forEach((clazz, methodSet) -&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (clazz.isApplicableToBeanType(handlerType)) &#123;</span><br><span class="line">   <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> clazz.resolveBean();</span><br><span class="line">   <span class="keyword">for</span> (Method method : methodSet) &#123;</span><br><span class="line">    attrMethods.add(createModelAttributeMethod(binderFactory, bean, method));</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;);</span><br><span class="line">    </span><br><span class="line"> <span class="comment">// éå†å½“å‰æ§åˆ¶å™¨ç±»ä¸­ä¸­æ‰€æœ‰ä½¿ç”¨äº† @ModelAttribute çš„æ–¹æ³•ï¼Œ</span></span><br><span class="line"> <span class="comment">// ä¹Ÿå°†å…¶åŒ…è£…æˆ InvocableHandlerMethod æ”¾åˆ° attrMethods        </span></span><br><span class="line"> <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">  <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> handlerMethod.getBean();</span><br><span class="line">  attrMethods.add(createModelAttributeMethod(binderFactory, bean, method));</span><br><span class="line"> &#125;</span><br><span class="line">    </span><br><span class="line"> <span class="comment">// æ­¤æ—¶  attrMethods åŒ…å«äº†ä¸¤ç±» InvocableHandlerMethodï¼Œ åˆ†åˆ«æ¥è‡ªäº :</span></span><br><span class="line"> <span class="comment">// 1. @ControllerAdvice bean ä¸­æ‰€æœ‰ä½¿ç”¨äº† @ModelAttribute çš„æ–¹æ³•</span></span><br><span class="line"> <span class="comment">// 2. å½“å‰æ§åˆ¶å™¨ç±»ä¸­ä¸­æ‰€æœ‰ä½¿ç”¨äº† @ModelAttribute çš„æ–¹æ³•</span></span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelFactory</span>(attrMethods, binderFactory, sessionAttrHandler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/ ä»æŒ‡å®š bean çš„æ–¹æ³• method ï¼Œå…¶å®æ˜¯ä¸€ä¸ªä½¿ç”¨äº†æ³¨è§£ <span class="meta">@ModelAttribute</span> çš„æ–¹æ³•ï¼Œ</span><br><span class="line">/ æ„é€ ä¸€ä¸ª InvocableHandlerMethod å¯¹è±¡</span><br><span class="line"><span class="keyword">private</span> InvocableHandlerMethod <span class="title function_">createModelAttributeMethod</span><span class="params">(WebDataBinderFactory factory, </span></span><br><span class="line"><span class="params">  Object bean, Method method)</span> &#123;</span><br><span class="line"> <span class="type">InvocableHandlerMethod</span> <span class="variable">attrMethod</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocableHandlerMethod</span>(bean, method);</span><br><span class="line"> <span class="keyword">if</span> (<span class="built_in">this</span>.argumentResolvers != <span class="literal">null</span>) &#123;</span><br><span class="line">  attrMethod.setHandlerMethodArgumentResolvers(<span class="built_in">this</span>.argumentResolvers);</span><br><span class="line"> &#125;</span><br><span class="line"> attrMethod.setParameterNameDiscoverer(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line"> attrMethod.setDataBinderFactory(factory);</span><br><span class="line"> <span class="keyword">return</span> attrMethod;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>ä»æ­¤æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œ<code>#getModelFactory</code>æ–¹æ³•ä½¿ç”¨åˆ°äº†<code>modelAttributeAdviceCache</code>ï¼Œå®ƒä¼šæ ¹æ®å…¶ä¸­æ¯ä¸ªå…ƒç´ æ„é€ æˆä¸€ä¸ª<code>InvocableHandlerMethod</code>,æœ€ç»ˆä¼ é€’ç»™è¦åˆ›å»ºçš„<code>ModelFactory</code>å¯¹è±¡ã€‚è€Œ<code>#getModelFactory</code>åˆåœ¨ä»€ä¹ˆæ—¶å€™è¢«ä½¿ç”¨å‘¢ ? å®ƒä¼šåœ¨<code>RequestMappingHandlerAdapter</code>æ‰§è¡Œä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•çš„å‡†å¤‡è¿‡ç¨‹ä¸­è¢«è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤º :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">invokeHandlerMethod</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">  HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line"> <span class="type">ServletWebRequest</span> <span class="variable">webRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response);</span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ„é€ è°ƒç”¨ handlerMethod æ‰€è¦ä½¿ç”¨çš„æ•°æ®ç»‘å®šå™¨å·¥å‚  </span></span><br><span class="line">  <span class="type">WebDataBinderFactory</span> <span class="variable">binderFactory</span> <span class="operator">=</span> getDataBinderFactory(handlerMethod);</span><br><span class="line">        <span class="comment">// æ„é€ è°ƒç”¨ handlerMethod æ‰€è¦ä½¿ç”¨çš„æ•°æ®æ¨¡å‹å·¥å‚  </span></span><br><span class="line">  <span class="type">ModelFactory</span> <span class="variable">modelFactory</span> <span class="operator">=</span> getModelFactory(handlerMethod, binderFactory);</span><br><span class="line">      <span class="comment">// çœç•¥æ— å…³ä»£ç  ...            </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-initBinderAdviceCacheçš„ä½¿ç”¨"><a href="#3-initBinderAdviceCacheçš„ä½¿ç”¨" class="headerlink" title="3. initBinderAdviceCacheçš„ä½¿ç”¨"></a>3. <code>initBinderAdviceCache</code>çš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> WebDataBinderFactory <span class="title function_">getDataBinderFactory</span><span class="params">(HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"> Class&lt;?&gt; handlerType = handlerMethod.getBeanType();</span><br><span class="line"> Set&lt;Method&gt; methods = <span class="built_in">this</span>.initBinderCache.get(handlerType);</span><br><span class="line"> <span class="keyword">if</span> (methods == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// è·å–å½“å‰æ§åˆ¶å™¨ç±»ä¸­ä½¿ç”¨äº† @InitBinder çš„æ–¹æ³•  </span></span><br><span class="line">  methods = MethodIntrospector.selectMethods(handlerType, INIT_BINDER_METHODS);</span><br><span class="line">  <span class="built_in">this</span>.initBinderCache.put(handlerType, methods);</span><br><span class="line"> &#125;</span><br><span class="line"> List&lt;InvocableHandlerMethod&gt; initBinderMethods = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"> <span class="comment">// Global methods first</span></span><br><span class="line"> <span class="comment">// éå†@ControllerAdvice beanä¸­æ‰€æœ‰ä½¿ç”¨äº† @InitBinder çš„æ–¹æ³•ï¼Œ</span></span><br><span class="line"> <span class="comment">// å°†å…¶åŒ…è£…æˆ InvocableHandlerMethod æ”¾åˆ° initBinderMethods</span></span><br><span class="line"> <span class="comment">// ********* è¿™é‡Œå°±æ˜¯ initBinderAdviceCache è¢«ä½¿ç”¨åˆ°çš„åœ°æ–¹äº† ************        </span></span><br><span class="line"> <span class="built_in">this</span>.initBinderAdviceCache.forEach((clazz, methodSet) -&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (clazz.isApplicableToBeanType(handlerType)) &#123;</span><br><span class="line">   <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> clazz.resolveBean();</span><br><span class="line">   <span class="keyword">for</span> (Method method : methodSet) &#123;</span><br><span class="line">    initBinderMethods.add(createInitBinderMethod(bean, method));</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;);</span><br><span class="line">    </span><br><span class="line"> <span class="comment">// éå†å½“å‰æ§åˆ¶å™¨ç±»ä¸­æ‰€æœ‰ä½¿ç”¨äº† @InitBinder çš„æ–¹æ³•ï¼Œ</span></span><br><span class="line"> <span class="comment">// å°†å…¶åŒ…è£…æˆ InvocableHandlerMethod æ”¾åˆ° initBinderMethods        </span></span><br><span class="line"> <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">  <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> handlerMethod.getBean();</span><br><span class="line">  initBinderMethods.add(createInitBinderMethod(bean, method));</span><br><span class="line"> &#125;</span><br><span class="line">    </span><br><span class="line"> <span class="comment">// æ­¤æ—¶  initBinderMethods åŒ…å«äº†ä¸¤ç±» InvocableHandlerMethodï¼Œ åˆ†åˆ«æ¥è‡ªäº :</span></span><br><span class="line"> <span class="comment">// 1. @ControllerAdvice bean ä¸­æ‰€æœ‰ä½¿ç”¨äº† @InitBinder çš„æ–¹æ³•</span></span><br><span class="line"> <span class="comment">// 2. å½“å‰æ§åˆ¶å™¨ç±»ä¸­ä¸­æ‰€æœ‰ä½¿ç”¨äº† @InitBinder çš„æ–¹æ³•        </span></span><br><span class="line"> <span class="keyword">return</span> createDataBinderFactory(initBinderMethods);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/ ä»æŒ‡å®š bean çš„æ–¹æ³• method ï¼Œå…¶å®æ˜¯ä¸€ä¸ªä½¿ç”¨äº†æ³¨è§£ <span class="meta">@InitBinder</span> çš„æ–¹æ³•ï¼Œ</span><br><span class="line">/ æ„é€ ä¸€ä¸ª InvocableHandlerMethod å¯¹è±¡</span><br><span class="line"><span class="keyword">private</span> InvocableHandlerMethod <span class="title function_">createInitBinderMethod</span><span class="params">(Object bean, Method method)</span> &#123;</span><br><span class="line"> <span class="type">InvocableHandlerMethod</span> <span class="variable">binderMethod</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocableHandlerMethod</span>(bean, method);</span><br><span class="line"> <span class="keyword">if</span> (<span class="built_in">this</span>.initBinderArgumentResolvers != <span class="literal">null</span>) &#123;</span><br><span class="line">  binderMethod.setHandlerMethodArgumentResolvers(<span class="built_in">this</span>.initBinderArgumentResolvers);</span><br><span class="line"> &#125;</span><br><span class="line"> binderMethod.setDataBinderFactory(<span class="keyword">new</span> <span class="title class_">DefaultDataBinderFactory</span>(<span class="built_in">this</span>.webBindingInitializer));</span><br><span class="line"> binderMethod.setParameterNameDiscoverer(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line"> <span class="keyword">return</span> binderMethod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Template method to create a new InitBinderDataBinderFactory instance.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The default implementation creates a ServletRequestDataBinderFactory.</span></span><br><span class="line"><span class="comment"> * This can be overridden for custom ServletRequestDataBinder subclasses.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> binderMethods &#123;<span class="doctag">@code</span> <span class="doctag">@InitBinder</span>&#125; methods</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the InitBinderDataBinderFactory instance to use</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception in case of invalid state or arguments</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> InitBinderDataBinderFactory <span class="title function_">createDataBinderFactory</span><span class="params">(</span></span><br><span class="line"><span class="params">          List&lt;InvocableHandlerMethod&gt; binderMethods)</span></span><br><span class="line">  <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletRequestDataBinderFactory</span>(binderMethods, getWebBindingInitializer());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»æ­¤æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œ<code>#getDataBinderFactory</code>æ–¹æ³•ä½¿ç”¨åˆ°äº†<code>initBinderAdviceCache</code>ï¼Œå®ƒä¼šæ ¹æ®å…¶ä¸­æ¯ä¸ªå…ƒç´ æ„é€ æˆä¸€ä¸ª<code>InvocableHandlerMethod</code>,æœ€ç»ˆä¼ é€’ç»™è¦åˆ›å»ºçš„<code>InitBinderDataBinderFactory</code>å¯¹è±¡ã€‚è€Œ<code>#getDataBinderFactory</code>åˆåœ¨ä»€ä¹ˆæ—¶å€™è¢«ä½¿ç”¨å‘¢ ? å®ƒä¼šåœ¨<code>RequestMappingHandlerAdapter</code>æ‰§è¡Œä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•çš„å‡†å¤‡è¿‡ç¨‹ä¸­è¢«è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤º :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">invokeHandlerMethod</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">  HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line"> <span class="type">ServletWebRequest</span> <span class="variable">webRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response);</span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ„é€ è°ƒç”¨ handlerMethod æ‰€è¦ä½¿ç”¨çš„æ•°æ®ç»‘å®šå™¨å·¥å‚  </span></span><br><span class="line">  <span class="type">WebDataBinderFactory</span> <span class="variable">binderFactory</span> <span class="operator">=</span> getDataBinderFactory(handlerMethod);</span><br><span class="line">        <span class="comment">// æ„é€ è°ƒç”¨ handlerMethod æ‰€è¦ä½¿ç”¨çš„æ•°æ®æ¨¡å‹å·¥å‚  </span></span><br><span class="line">  <span class="type">ModelFactory</span> <span class="variable">modelFactory</span> <span class="operator">=</span> getModelFactory(handlerMethod, binderFactory);</span><br><span class="line">      <span class="comment">// çœç•¥æ— å…³ä»£ç  ...            </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡<code>@ControllerAdvice</code>æ³¨è§£çš„<code>bean</code>ç»„ä»¶æ‰€å®šä¹‰çš„<code>@ModelAttribute</code>/<code>@InitBinder</code>æ–¹æ³•ï¼Œæˆ–è€…<code>RequestBodyAdvice</code>/<code>ResponseBodyAdvice</code>ï¼Œæ˜¯å¦‚ä½•è¢«<code>RequestMappingHandlerAdapter</code>æå–å’Œä½¿ç”¨çš„äº†ã€‚è™½ç„¶æˆ‘ä»¬å¹¶æœªæ·±å…¥åˆ°æ›´ç»†å¾®çš„ç»„ä»¶ç ”ç©¶å®ƒä»¬æœ€ç»ˆçš„ä½¿ç”¨ï¼Œä¸è¿‡ç»“åˆè¿™äº›ç»„ä»¶å‘½åä»¥åŠè¿™äº›æ›´æ·±ä¸€å±‚çš„ä½¿ç”¨è€…ç»„ä»¶çš„åç§°ï¼Œå³ä¾¿æ˜¯çŒœæµ‹ï¼Œç›¸ä¿¡ä½ ä¹Ÿä¸éš¾ç†è§£çŒœåˆ°å®ƒä»¬å¦‚ä½•è¢«ä½¿ç”¨äº†ã€‚</p><p>ä¸çŸ¥é“ä½ æ³¨æ„åˆ°æ²¡æœ‰ï¼Œå…³äº<code>@ControllerAdvice</code>å’Œ<code>@ExceptionHandler</code>è¿™ä¸€ç»„åˆï¼Œåœ¨ä¸Šé¢æåˆ°çš„<code>RequestMappingHandlerAdapter</code>é€»è¾‘ä¸­ï¼Œå¹¶æœªæ¶‰åŠåˆ°ã€‚é‚£å¦‚æœä½¿ç”¨äº†è¿™ç§ç»„åˆï¼Œåˆä¼šæ˜¯æ€æ ·ä¸€ç§å·¥ä½œæœºåˆ¶å‘¢ ï¼Ÿäº‹å®ä¸Šï¼Œ<code>@ControllerAdvice</code>å’Œ<code>@ExceptionHandler</code>è¿™ä¸€ç»„åˆæ‰€åšçš„å®šä¹‰ï¼Œä¼šè¢«<code>ExceptionHandlerExceptionResolver</code>æ¶ˆè´¹ä½¿ç”¨ã€‚ä¸è¿‡å…³äº<code>ExceptionHandlerExceptionResolver</code>æˆ‘ä»¬ä¼šå¦å¤–è¡Œæ–‡ä»‹ç»ï¼Œé€šè¿‡è¿™ç¯‡æ–‡ç« ä¸­çš„ä¾‹å­ï¼Œç†è§£<code>@ControllerAdvide</code>çš„å·¥ä½œåŸç†å·²ç»ä¸æ˜¯é—®é¢˜äº†ã€‚</p><h1 id="å¦‚ä½•ä¼˜é›…å¤„ç†é‡å¤è¯·æ±‚-å¹¶å‘è¯·æ±‚ï¼Ÿ"><a href="#å¦‚ä½•ä¼˜é›…å¤„ç†é‡å¤è¯·æ±‚-å¹¶å‘è¯·æ±‚ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¼˜é›…å¤„ç†é‡å¤è¯·æ±‚/å¹¶å‘è¯·æ±‚ï¼Ÿ"></a>å¦‚ä½•ä¼˜é›…å¤„ç†é‡å¤è¯·æ±‚/å¹¶å‘è¯·æ±‚ï¼Ÿ</h1><p>å¯¹äºä¸€äº›ç”¨æˆ·è¯·æ±‚ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯å¯èƒ½é‡å¤å‘é€çš„ï¼Œå¦‚æœæ˜¯æŸ¥è¯¢ç±»æ“ä½œå¹¶æ— å¤§ç¢ï¼Œä½†å…¶ä¸­æœ‰äº›æ˜¯æ¶‰åŠå†™å…¥æ“ä½œçš„ï¼Œä¸€æ—¦é‡å¤äº†ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¾ˆä¸¥é‡çš„åæœï¼Œä¾‹å¦‚äº¤æ˜“çš„æ¥å£å¦‚æœé‡å¤è¯·æ±‚å¯èƒ½ä¼šé‡å¤ä¸‹å•ã€‚</p><p>é‡å¤çš„åœºæ™¯æœ‰å¯èƒ½æ˜¯ï¼š</p><ol><li>é»‘å®¢æ‹¦æˆªäº†è¯·æ±‚ï¼Œé‡æ”¾</li><li>å‰ç«¯/å®¢æˆ·ç«¯å› ä¸ºæŸäº›åŸå› è¯·æ±‚é‡å¤å‘é€äº†ï¼Œæˆ–è€…ç”¨æˆ·åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…é‡å¤ç‚¹å‡»äº†ã€‚</li><li>ç½‘å…³é‡å‘</li><li>â€¦.</li></ol><p>æœ¬æ–‡è®¨è®ºçš„æ˜¯å¦‚ä½•åœ¨æœåŠ¡ç«¯ä¼˜é›…åœ°ç»Ÿä¸€å¤„ç†è¿™ç§æƒ…å†µï¼Œå¦‚ä½•ç¦æ­¢ç”¨æˆ·é‡å¤ç‚¹å‡»ç­‰å®¢æˆ·ç«¯æ“ä½œä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒç•´ã€‚</p><h2 id="åˆ©ç”¨å”¯ä¸€è¯·æ±‚ç¼–å·å»é‡"><a href="#åˆ©ç”¨å”¯ä¸€è¯·æ±‚ç¼–å·å»é‡" class="headerlink" title="åˆ©ç”¨å”¯ä¸€è¯·æ±‚ç¼–å·å»é‡"></a>åˆ©ç”¨å”¯ä¸€è¯·æ±‚ç¼–å·å»é‡</h2><p>ä½ å¯èƒ½ä¼šæƒ³åˆ°çš„æ˜¯ï¼Œåªè¦è¯·æ±‚æœ‰å”¯ä¸€çš„è¯·æ±‚ç¼–å·ï¼Œé‚£ä¹ˆå°±èƒ½å€Ÿç”¨Redisåšè¿™ä¸ªå»é‡â€”â€”åªè¦è¿™ä¸ªå”¯ä¸€è¯·æ±‚ç¼–å·åœ¨rediså­˜åœ¨ï¼Œè¯æ˜å¤„ç†è¿‡ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºæ˜¯é‡å¤çš„</p><p>ä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">KEY</span> <span class="operator">=</span> <span class="string">&quot;REQ12343456788&quot;</span>;<span class="comment">//è¯·æ±‚å”¯ä¸€ç¼–å·</span></span><br><span class="line"><span class="type">long</span> <span class="variable">expireTime</span> <span class="operator">=</span>  <span class="number">1000</span>;<span class="comment">// 1000æ¯«ç§’è¿‡æœŸï¼Œ1000mså†…çš„é‡å¤è¯·æ±‚ä¼šè®¤ä¸ºé‡å¤</span></span><br><span class="line"><span class="type">long</span> <span class="variable">expireAt</span> <span class="operator">=</span> System.currentTimeMillis() + expireTime;</span><br><span class="line"><span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> <span class="string">&quot;expireAt@&quot;</span> + expireAt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//redis keyè¿˜å­˜åœ¨çš„è¯è¦å°±è®¤ä¸ºè¯·æ±‚æ˜¯é‡å¤çš„</span></span><br><span class="line"><span class="type">Boolean</span> <span class="variable">firstSet</span> <span class="operator">=</span> stringRedisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; connection.set(KEY.getBytes(), val.getBytes(), Expiration.milliseconds(expireTime), RedisStringCommands.SetOption.SET_IF_ABSENT));</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> isConsiderDup;</span><br><span class="line"><span class="keyword">if</span> (firstSet != <span class="literal">null</span> &amp;&amp; firstSet) &#123;<span class="comment">// ç¬¬ä¸€æ¬¡è®¿é—®</span></span><br><span class="line">    isConsiderDup = <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="comment">// rediså€¼å·²å­˜åœ¨ï¼Œè®¤ä¸ºæ˜¯é‡å¤äº†</span></span><br><span class="line">    isConsiderDup = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸šåŠ¡å‚æ•°å»é‡"><a href="#ä¸šåŠ¡å‚æ•°å»é‡" class="headerlink" title="ä¸šåŠ¡å‚æ•°å»é‡"></a>ä¸šåŠ¡å‚æ•°å»é‡</h2><p>ä¸Šé¢çš„æ–¹æ¡ˆèƒ½è§£å†³å…·å¤‡å”¯ä¸€è¯·æ±‚ç¼–å·çš„åœºæ™¯ï¼Œä¾‹å¦‚æ¯æ¬¡å†™è¯·æ±‚ä¹‹å‰éƒ½æ˜¯æœåŠ¡ç«¯è¿”å›ä¸€ä¸ªå”¯ä¸€ç¼–å·ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¸¦ç€è¿™ä¸ªè¯·æ±‚å·åšè¯·æ±‚ï¼ŒæœåŠ¡ç«¯å³å¯å®Œæˆå»é‡æ‹¦æˆªã€‚</p><p>ä½†æ˜¯ï¼Œå¾ˆå¤šçš„åœºæ™¯ä¸‹ï¼Œè¯·æ±‚å¹¶ä¸ä¼šå¸¦è¿™æ ·çš„å”¯ä¸€ç¼–å·ï¼é‚£ä¹ˆæˆ‘ä»¬èƒ½å¦é’ˆå¯¹è¯·æ±‚çš„å‚æ•°ä½œä¸ºä¸€ä¸ªè¯·æ±‚çš„æ ‡è¯†å‘¢ï¼Ÿ</p><p>å…ˆè€ƒè™‘ç®€å•çš„åœºæ™¯ï¼Œå‡è®¾è¯·æ±‚å‚æ•°åªæœ‰ä¸€ä¸ªå­—æ®µreqParamï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»¥ä¸‹æ ‡è¯†å»åˆ¤æ–­è¿™ä¸ªè¯·æ±‚æ˜¯å¦é‡å¤ã€‚<strong>ç”¨æˆ·ID:æ¥å£å:è¯·æ±‚å‚æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">KEY</span> <span class="operator">=</span> <span class="string">&quot;dedup:U=&quot;</span>+userId + <span class="string">&quot;M=&quot;</span> + method + <span class="string">&quot;P=&quot;</span> + reqParam;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå½“åŒä¸€ä¸ªç”¨æˆ·è®¿é—®åŒä¸€ä¸ªæ¥å£ï¼Œå¸¦ç€åŒæ ·çš„reqParamè¿‡æ¥ï¼Œæˆ‘ä»¬å°±èƒ½å®šä½åˆ°ä»–æ˜¯é‡å¤çš„äº†ã€‚</p><p>ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬çš„æ¥å£é€šå¸¸ä¸æ˜¯è¿™ä¹ˆç®€å•ï¼Œä»¥ç›®å‰çš„ä¸»æµï¼Œæˆ‘ä»¬çš„å‚æ•°é€šå¸¸æ˜¯ä¸€ä¸ªJSONã€‚é‚£ä¹ˆé’ˆå¯¹è¿™ç§åœºæ™¯ï¼Œæˆ‘ä»¬æ€ä¹ˆå»é‡å‘¢ï¼Ÿ</p><h3 id="è®¡ç®—è¯·æ±‚å‚æ•°çš„æ‘˜è¦ä½œä¸ºå‚æ•°æ ‡è¯†"><a href="#è®¡ç®—è¯·æ±‚å‚æ•°çš„æ‘˜è¦ä½œä¸ºå‚æ•°æ ‡è¯†" class="headerlink" title="è®¡ç®—è¯·æ±‚å‚æ•°çš„æ‘˜è¦ä½œä¸ºå‚æ•°æ ‡è¯†"></a>è®¡ç®—è¯·æ±‚å‚æ•°çš„æ‘˜è¦ä½œä¸ºå‚æ•°æ ‡è¯†</h3><p>å‡è®¾æˆ‘ä»¬æŠŠè¯·æ±‚å‚æ•°ï¼ˆJSONï¼‰æŒ‰KEYåšå‡åºæ’åºï¼Œæ’åºåæ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½œä¸ºKEYå€¼å‘¢ï¼Ÿä½†è¿™å¯èƒ½éå¸¸çš„é•¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘å¯¹è¿™ä¸ªå­—ç¬¦ä¸²æ±‚ä¸€ä¸ªMD5ä½œä¸ºå‚æ•°çš„æ‘˜è¦ï¼Œä»¥è¿™ä¸ªæ‘˜è¦å»å–ä»£reqParamçš„ä½ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">KEY</span> <span class="operator">=</span> <span class="string">&quot;dedup:U=&quot;</span>+userId + <span class="string">&quot;M=&quot;</span> + method + <span class="string">&quot;P=&quot;</span> + reqParamMD5;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œè¯·æ±‚çš„å”¯ä¸€æ ‡è¯†å°±æ‰“ä¸Šäº†ï¼</p><p>æ³¨ï¼šMD5ç†è®ºä¸Šå¯èƒ½ä¼šé‡å¤ï¼Œä½†æ˜¯å»é‡é€šå¸¸æ˜¯çŸ­æ—¶é—´çª—å£å†…çš„å»é‡ï¼ˆä¾‹å¦‚ä¸€ç§’ï¼‰ï¼Œä¸€ä¸ªçŸ­æ—¶é—´å†…åŒä¸€ä¸ªç”¨æˆ·åŒæ ·çš„æ¥å£èƒ½æ‹¼å‡ºä¸åŒçš„å‚æ•°å¯¼è‡´ä¸€æ ·çš„MD5å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</p><h3 id="ç»§ç»­ä¼˜åŒ–ï¼Œè€ƒè™‘å‰”é™¤éƒ¨åˆ†æ—¶é—´å› å­"><a href="#ç»§ç»­ä¼˜åŒ–ï¼Œè€ƒè™‘å‰”é™¤éƒ¨åˆ†æ—¶é—´å› å­" class="headerlink" title="ç»§ç»­ä¼˜åŒ–ï¼Œè€ƒè™‘å‰”é™¤éƒ¨åˆ†æ—¶é—´å› å­"></a>ç»§ç»­ä¼˜åŒ–ï¼Œè€ƒè™‘å‰”é™¤éƒ¨åˆ†æ—¶é—´å› å­</h3><p>ä¸Šé¢çš„é—®é¢˜å…¶å®å·²ç»æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„è§£å†³æ–¹æ¡ˆäº†ï¼Œä½†æ˜¯å®é™…æŠ•å…¥ä½¿ç”¨çš„æ—¶å€™å¯èƒ½å‘ç°æœ‰äº›é—®é¢˜ï¼šæŸäº›è¯·æ±‚ç”¨æˆ·çŸ­æ—¶é—´å†…é‡å¤çš„ç‚¹å‡»äº†ï¼ˆä¾‹å¦‚1000æ¯«ç§’å‘é€äº†ä¸‰æ¬¡è¯·æ±‚ï¼‰ï¼Œä½†ç»•è¿‡äº†ä¸Šé¢çš„å»é‡åˆ¤æ–­ï¼ˆä¸åŒçš„KEYå€¼ï¼‰ã€‚</p><p>åŸå› æ˜¯è¿™äº›è¯·æ±‚å‚æ•°çš„å­—æ®µé‡Œé¢ï¼Œ<strong>æ˜¯å¸¦æ—¶é—´å­—æ®µçš„</strong>ï¼Œè¿™ä¸ªå­—æ®µæ ‡è®°ç”¨æˆ·è¯·æ±‚çš„æ—¶é—´ï¼ŒæœåŠ¡ç«¯å¯ä»¥å€Ÿæ­¤ä¸¢å¼ƒæ‰ä¸€äº›è€çš„è¯·æ±‚ï¼ˆä¾‹å¦‚5ç§’å‰ï¼‰ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œè¯·æ±‚çš„å…¶ä»–å‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œé™¤äº†è¯·æ±‚æ—¶é—´ç›¸å·®äº†ä¸€ç§’ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸¤ä¸ªè¯·æ±‚ä¸€æ ·ï¼Œä½†æ˜¯è¯·æ±‚æ—¶é—´å·®ä¸€ç§’</span></span><br><span class="line"> <span class="type">String</span> <span class="variable">req</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">         <span class="string">&quot;\&quot;requestTime\&quot; :\&quot;20190101120001\&quot;,\n&quot;</span> +</span><br><span class="line">         <span class="string">&quot;\&quot;requestValue\&quot; :\&quot;1000\&quot;,\n&quot;</span> +</span><br><span class="line">         <span class="string">&quot;\&quot;requestKey\&quot; :\&quot;key\&quot;\n&quot;</span> +</span><br><span class="line">         <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="type">String</span> <span class="variable">req2</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">         <span class="string">&quot;\&quot;requestTime\&quot; :\&quot;20190101120002\&quot;,\n&quot;</span> +</span><br><span class="line">         <span class="string">&quot;\&quot;requestValue\&quot; :\&quot;1000\&quot;,\n&quot;</span> +</span><br><span class="line">         <span class="string">&quot;\&quot;requestKey\&quot; :\&quot;key\&quot;\n&quot;</span> +</span><br><span class="line">         <span class="string">&quot;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure><p>è¿™ç§è¯·æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå¯èƒ½éœ€è¦æŒ¡ä½åé¢çš„é‡å¤è¯·æ±‚ã€‚æ‰€ä»¥æ±‚ä¸šåŠ¡å‚æ•°æ‘˜è¦ä¹‹å‰ï¼Œéœ€è¦å‰”é™¤è¿™ç±»æ—¶é—´å­—æ®µã€‚è¿˜æœ‰ç±»ä¼¼çš„å­—æ®µå¯èƒ½æ˜¯GPSçš„ç»çº¬åº¦å­—æ®µï¼ˆé‡å¤è¯·æ±‚é—´å¯èƒ½æœ‰æå°çš„å·®åˆ«ï¼‰ã€‚</p><h2 id="è¯·æ±‚å»é‡å·¥å…·ç±»ï¼ŒJavaå®ç°"><a href="#è¯·æ±‚å»é‡å·¥å…·ç±»ï¼ŒJavaå®ç°" class="headerlink" title="è¯·æ±‚å»é‡å·¥å…·ç±»ï¼ŒJavaå®ç°"></a>è¯·æ±‚å»é‡å·¥å…·ç±»ï¼ŒJavaå®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReqDedupHelper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> reqJSON è¯·æ±‚çš„å‚æ•°ï¼Œè¿™é‡Œé€šå¸¸æ˜¯JSON</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> excludeKeys è¯·æ±‚å‚æ•°é‡Œé¢è¦å»é™¤å“ªäº›å­—æ®µå†æ±‚æ‘˜è¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å»é™¤å‚æ•°çš„MD5æ‘˜è¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">dedupParamMD5</span><span class="params">(<span class="keyword">final</span> String reqJSON, String... excludeKeys)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">decreptParam</span> <span class="operator">=</span> reqJSON;</span><br><span class="line"></span><br><span class="line">        <span class="type">TreeMap</span> <span class="variable">paramTreeMap</span> <span class="operator">=</span> JSON.parseObject(decreptParam, TreeMap.class);</span><br><span class="line">        <span class="keyword">if</span> (excludeKeys!=<span class="literal">null</span>) &#123;</span><br><span class="line">            List&lt;String&gt; dedupExcludeKeys = Arrays.asList(excludeKeys);</span><br><span class="line">            <span class="keyword">if</span> (!dedupExcludeKeys.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">for</span> (String dedupExcludeKey : dedupExcludeKeys) &#123;</span><br><span class="line">                    paramTreeMap.remove(dedupExcludeKey);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">paramTreeMapJSON</span> <span class="operator">=</span> JSON.toJSONString(paramTreeMap);</span><br><span class="line">        <span class="type">String</span> <span class="variable">md5deDupParam</span> <span class="operator">=</span> jdkMD5(paramTreeMapJSON);</span><br><span class="line">        log.debug(<span class="string">&quot;md5deDupParam = &#123;&#125;, excludeKeys = &#123;&#125; &#123;&#125;&quot;</span>, md5deDupParam, Arrays.deepToString(excludeKeys), paramTreeMapJSON);</span><br><span class="line">        <span class="keyword">return</span> md5deDupParam;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">jdkMD5</span><span class="params">(String src)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">messageDigest</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] mdBytes = messageDigest.digest(src.getBytes());</span><br><span class="line">            res = DatatypeConverter.printHexBinary(mdBytes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;&quot;</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€äº›æµ‹è¯•æ—¥å¿—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//ä¸¤ä¸ªè¯·æ±‚ä¸€æ ·ï¼Œä½†æ˜¯è¯·æ±‚æ—¶é—´å·®ä¸€ç§’</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">req</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;\&quot;requestTime\&quot; :\&quot;20190101120001\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;\&quot;requestValue\&quot; :\&quot;1000\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;\&quot;requestKey\&quot; :\&quot;key\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">req2</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;\&quot;requestTime\&quot; :\&quot;20190101120002\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;\&quot;requestValue\&quot; :\&quot;1000\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;\&quot;requestKey\&quot; :\&quot;key\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…¨å‚æ•°æ¯”å¯¹ï¼Œæ‰€ä»¥ä¸¤ä¸ªå‚æ•°MD5ä¸åŒ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">dedupMD5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReqDedupHelper</span>().dedupParamMD5(req);</span><br><span class="line">    <span class="type">String</span> <span class="variable">dedupMD52</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReqDedupHelper</span>().dedupParamMD5(req2);</span><br><span class="line">    System.out.println(<span class="string">&quot;req1MD5 = &quot;</span>+ dedupMD5+<span class="string">&quot; , req2MD5=&quot;</span>+dedupMD52);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å»é™¤æ—¶é—´å‚æ•°æ¯”å¯¹ï¼ŒMD5ç›¸åŒ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">dedupMD53</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReqDedupHelper</span>().dedupParamMD5(req,<span class="string">&quot;requestTime&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">dedupMD54</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReqDedupHelper</span>().dedupParamMD5(req2,<span class="string">&quot;requestTime&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;req1MD5 = &quot;</span>+ dedupMD53+<span class="string">&quot; , req2MD5=&quot;</span>+dedupMD54);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¥å¿—è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">req1MD5 = 9E054D36439EBDD0604C5E65EB5C8267 , req2MD5=A2D20BAC78551C4CA09BEF97FE468A3F</span><br><span class="line">req1MD5 = C2A36FED15128E9E878583CAAAFEFDE9 , req2MD5=C2A36FED15128E9E878583CAAAFEFDE9</span><br></pre></td></tr></table></figure><p>æ—¥å¿—è¯´æ˜ï¼š</p><ul><li>ä¸€å¼€å§‹ä¸¤ä¸ªå‚æ•°ç”±äºrequestTimeæ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æ±‚å»é‡å‚æ•°æ‘˜è¦çš„æ—¶å€™å¯ä»¥å‘ç°ä¸¤ä¸ªå€¼æ˜¯ä¸ä¸€æ ·çš„</li><li>ç¬¬äºŒæ¬¡è°ƒç”¨çš„æ—¶å€™ï¼Œå»é™¤äº†requestTimeå†æ±‚æ‘˜è¦ï¼ˆç¬¬äºŒä¸ªå‚æ•°ä¸­ä¼ å…¥äº†â€requestTimeâ€ï¼‰ï¼Œåˆ™å‘ç°ä¸¤ä¸ªæ‘˜è¦æ˜¯ä¸€æ ·çš„ï¼Œç¬¦åˆé¢„æœŸã€‚</li></ul><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å®Œæ•´çš„å»é‡è§£å†³æ–¹æ¡ˆï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">String userId= <span class="string">&quot;12345678&quot;</span>;<span class="comment">//ç”¨æˆ·</span></span><br><span class="line"><span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> <span class="string">&quot;pay&quot;</span>;<span class="comment">//æ¥å£å</span></span><br><span class="line"><span class="type">String</span> <span class="variable">dedupMD5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReqDedupHelper</span>().dedupParamMD5(req,<span class="string">&quot;requestTime&quot;</span>);<span class="comment">//è®¡ç®—è¯·æ±‚å‚æ•°æ‘˜è¦ï¼Œå…¶ä¸­å‰”é™¤é‡Œé¢è¯·æ±‚æ—¶é—´çš„å¹²æ‰°</span></span><br><span class="line"><span class="type">String</span> <span class="variable">KEY</span> <span class="operator">=</span> <span class="string">&quot;dedup:U=&quot;</span> + userId + <span class="string">&quot;M=&quot;</span> + method + <span class="string">&quot;P=&quot;</span> + dedupMD5;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">expireTime</span> <span class="operator">=</span>  <span class="number">1000</span>;<span class="comment">// 1000æ¯«ç§’è¿‡æœŸï¼Œ1000mså†…çš„é‡å¤è¯·æ±‚ä¼šè®¤ä¸ºé‡å¤</span></span><br><span class="line"><span class="type">long</span> <span class="variable">expireAt</span> <span class="operator">=</span> System.currentTimeMillis() + expireTime;</span><br><span class="line"><span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> <span class="string">&quot;expireAt@&quot;</span> + expireAt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span>ç›´æ¥SETNXä¸æ”¯æŒå¸¦è¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥è®¾ç½®+è¿‡æœŸä¸æ˜¯åŸå­æ“ä½œï¼Œæç«¯æƒ…å†µä¸‹å¯èƒ½è®¾ç½®äº†å°±ä¸è¿‡æœŸäº†ï¼Œåé¢ç›¸åŒè¯·æ±‚å¯èƒ½ä¼šè¯¯ä»¥ä¸ºéœ€è¦å»é‡ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨åº•å±‚APIï¼Œä¿è¯SETNX+è¿‡æœŸæ—¶é—´æ˜¯åŸå­æ“ä½œ</span></span><br><span class="line"><span class="type">Boolean</span> <span class="variable">firstSet</span> <span class="operator">=</span> stringRedisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; connection.set(KEY.getBytes(), val.getBytes(), Expiration.milliseconds(expireTime),</span><br><span class="line">        RedisStringCommands.SetOption.SET_IF_ABSENT));</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> isConsiderDup;</span><br><span class="line"><span class="keyword">if</span> (firstSet != <span class="literal">null</span> &amp;&amp; firstSet) &#123;</span><br><span class="line">    isConsiderDup = <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    isConsiderDup = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Spring-AOPçœ‹è¿™ç¯‡å°±å¤Ÿè¾£"><a href="#Spring-AOPçœ‹è¿™ç¯‡å°±å¤Ÿè¾£" class="headerlink" title="Spring AOPçœ‹è¿™ç¯‡å°±å¤Ÿè¾£~"></a>Spring AOPçœ‹è¿™ç¯‡å°±å¤Ÿè¾£~</h1><h2 id="åŸºæœ¬çŸ¥è¯†"><a href="#åŸºæœ¬çŸ¥è¯†" class="headerlink" title="åŸºæœ¬çŸ¥è¯†"></a>åŸºæœ¬çŸ¥è¯†</h2><p>å…¶å®, æ¥è§¦äº†è¿™ä¹ˆä¹…çš„ AOP, æˆ‘æ„Ÿè§‰, AOP ç»™äººéš¾ä»¥ç†è§£çš„ä¸€ä¸ªå…³é”®ç‚¹æ˜¯å®ƒçš„æ¦‚å¿µæ¯”è¾ƒå¤š, è€Œä¸”å‘çˆ¹çš„æ˜¯, è¿™äº›æ¦‚å¿µç»è¿‡äº†ä¸­æ–‡ç¿»è¯‘å, å˜å¾—é¢ç›®å…¨é, ç›¸åŒçš„ä¸€ä¸ªæœ¯è¯­, åœ¨ä¸åŒçš„ç¿»è¯‘ä¸‹, å«ä¹‰æ€»æœ‰ç€å„ç§è«åå…¶å¦™çš„å·®åˆ«. é‰´äºæ­¤, æˆ‘åœ¨æœ¬ç« çš„å¼€å¤´, ç€é‡ä¸ºä¸ºå¤§å®¶ä»‹ç»ä¸€ä¸ª Spring AOP çš„å„é¡¹æœ¯è¯­çš„åŸºæœ¬å«ä¹‰. ä¸ºäº†æœ¯è¯­ä¼ è¾¾çš„å‡†ç¡®æ€§, æˆ‘åœ¨æ¥ä¸‹æ¥çš„å™è¿°ä¸­, èƒ½ä½¿ç”¨è‹±æ–‡æœ¯è¯­çš„åœ°æ–¹, å°½é‡ä½¿ç”¨è‹±æ–‡.</p><h2 id="ä»€ä¹ˆæ˜¯-AOP"><a href="#ä»€ä¹ˆæ˜¯-AOP" class="headerlink" title="ä»€ä¹ˆæ˜¯ AOP"></a>ä»€ä¹ˆæ˜¯ AOP</h2><p>AOP(Aspect-Oriented Programming), å³ <strong>é¢å‘åˆ‡é¢ç¼–ç¨‹</strong> , å®ƒä¸ OOP( Object-Oriented Programming, é¢å‘å¯¹è±¡ç¼–ç¨‹) ç›¸è¾…ç›¸æˆ, æä¾›äº†ä¸ OOP ä¸åŒçš„æŠ½è±¡è½¯ä»¶ç»“æ„çš„è§†è§’. åœ¨ OOP ä¸­, æˆ‘ä»¬ä»¥ç±»(class)ä½œä¸ºæˆ‘ä»¬çš„åŸºæœ¬å•å…ƒ, è€Œ AOP ä¸­çš„åŸºæœ¬å•å…ƒæ˜¯ <strong>Aspect(åˆ‡é¢)</strong></p><h2 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h2><h3 id="Aspect-åˆ‡é¢"><a href="#Aspect-åˆ‡é¢" class="headerlink" title="Aspect(åˆ‡é¢)"></a>Aspect(åˆ‡é¢)</h3><p><code>aspect</code> ç”± <code>pointcount</code> å’Œ <code>advice</code> ç»„æˆ, å®ƒæ—¢åŒ…å«äº†æ¨ªåˆ‡é€»è¾‘çš„å®šä¹‰, ä¹ŸåŒ…æ‹¬äº†è¿æ¥ç‚¹çš„å®šä¹‰. Spring AOPå°±æ˜¯è´Ÿè´£å®æ–½åˆ‡é¢çš„æ¡†æ¶, å®ƒå°†åˆ‡é¢æ‰€å®šä¹‰çš„æ¨ªåˆ‡é€»è¾‘ç»‡å…¥åˆ°åˆ‡é¢æ‰€æŒ‡å®šçš„è¿æ¥ç‚¹ä¸­. AOPçš„å·¥ä½œé‡å¿ƒåœ¨äºå¦‚ä½•å°†å¢å¼ºç»‡å…¥ç›®æ ‡å¯¹è±¡çš„è¿æ¥ç‚¹ä¸Š, è¿™é‡ŒåŒ…å«ä¸¤ä¸ªå·¥ä½œ:</p><ol><li>å¦‚ä½•é€šè¿‡ pointcut å’Œ advice å®šä½åˆ°ç‰¹å®šçš„ joinpoint ä¸Š</li><li>å¦‚ä½•åœ¨ advice ä¸­ç¼–å†™åˆ‡é¢ä»£ç .</li></ol><p><strong>å¯ä»¥ç®€å•åœ°è®¤ä¸º, ä½¿ç”¨ @Aspect æ³¨è§£çš„ç±»å°±æ˜¯åˆ‡é¢.</strong></p><h3 id="advice-å¢å¼º"><a href="#advice-å¢å¼º" class="headerlink" title="advice(å¢å¼º)"></a>advice(å¢å¼º)</h3><p>ç”± aspect æ·»åŠ åˆ°ç‰¹å®šçš„ join point(å³æ»¡è¶³ point cut è§„åˆ™çš„ join point) çš„ä¸€æ®µä»£ç . è®¸å¤š AOPæ¡†æ¶, åŒ…æ‹¬ Spring AOP, ä¼šå°† advice æ¨¡æ‹Ÿä¸ºä¸€ä¸ªæ‹¦æˆªå™¨(interceptor), å¹¶ä¸”åœ¨ join point ä¸Šç»´æŠ¤å¤šä¸ª advice, è¿›è¡Œå±‚å±‚æ‹¦æˆª. ä¾‹å¦‚ HTTP é‰´æƒçš„å®ç°, æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªä½¿ç”¨ RequestMapping æ ‡æ³¨çš„æ–¹æ³•ç»‡å…¥ advice, å½“ HTTP è¯·æ±‚åˆ°æ¥æ—¶, é¦–å…ˆè¿›å…¥åˆ° advice ä»£ç ä¸­, åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ†æè¿™ä¸ª HTTP è¯·æ±‚æ˜¯å¦æœ‰ç›¸åº”çš„æƒé™, å¦‚æœæœ‰, åˆ™æ‰§è¡Œ Controller, å¦‚æœæ²¡æœ‰, åˆ™æŠ›å‡ºå¼‚å¸¸. è¿™é‡Œçš„ advice å°±æ‰®æ¼”ç€é‰´æƒæ‹¦æˆªå™¨çš„è§’è‰²äº†.</p><h3 id="è¿æ¥ç‚¹-join-point"><a href="#è¿æ¥ç‚¹-join-point" class="headerlink" title="è¿æ¥ç‚¹(join point)"></a>è¿æ¥ç‚¹(join point)</h3><blockquote><p>a point during the execution of a program, such as the execution of a method or the handling of an exception. In Spring AOP, a join point always represents a method execution.</p></blockquote><p>ç¨‹åºè¿è¡Œä¸­çš„ä¸€äº›æ—¶é—´ç‚¹, ä¾‹å¦‚ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œ, æˆ–è€…æ˜¯ä¸€ä¸ªå¼‚å¸¸çš„å¤„ç†.<code>åœ¨ Spring AOP ä¸­, join point æ€»æ˜¯æ–¹æ³•çš„æ‰§è¡Œç‚¹, å³åªæœ‰æ–¹æ³•è¿æ¥ç‚¹.</code></p><h3 id="åˆ‡ç‚¹-point-cut"><a href="#åˆ‡ç‚¹-point-cut" class="headerlink" title="åˆ‡ç‚¹(point cut)"></a>åˆ‡ç‚¹(point cut)</h3><p>åŒ¹é… join point çš„è°“è¯(a predicate that matches join points). Advice æ˜¯å’Œç‰¹å®šçš„ point cut å…³è”çš„, å¹¶ä¸”åœ¨ point cut ç›¸åŒ¹é…çš„ join point ä¸­æ‰§è¡Œ.<code>åœ¨ Spring ä¸­, æ‰€æœ‰çš„æ–¹æ³•éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ joinpoint, ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœ¨æ‰€æœ‰çš„æ–¹æ³•ä¸Šéƒ½æ·»åŠ  Advice, è€Œ pointcut çš„ä½œç”¨å°±æ˜¯æä¾›ä¸€ç»„è§„åˆ™(ä½¿ç”¨ AspectJ pointcut expression language æ¥æè¿°) æ¥åŒ¹é…joinpoint, ç»™æ»¡è¶³è§„åˆ™çš„ joinpoint æ·»åŠ  Advice.</code></p><h3 id="å…³äºjoin-point-å’Œ-point-cut-çš„åŒºåˆ«"><a href="#å…³äºjoin-point-å’Œ-point-cut-çš„åŒºåˆ«" class="headerlink" title="å…³äºjoin point å’Œ point cut çš„åŒºåˆ«"></a>å…³äºjoin point å’Œ point cut çš„åŒºåˆ«</h3><p>åœ¨ Spring AOP ä¸­, æ‰€æœ‰çš„æ–¹æ³•æ‰§è¡Œéƒ½æ˜¯ join point. è€Œ point cut æ˜¯ä¸€ä¸ªæè¿°ä¿¡æ¯, å®ƒä¿®é¥°çš„æ˜¯ join point, é€šè¿‡ point cut, æˆ‘ä»¬å°±å¯ä»¥ç¡®å®šå“ªäº› join point å¯ä»¥è¢«ç»‡å…¥ Advice. å› æ­¤ join point å’Œ point cut æœ¬è´¨ä¸Šå°±æ˜¯ä¸¤ä¸ªä¸åŒçº¬åº¦ä¸Šçš„ä¸œè¥¿.<code>advice æ˜¯åœ¨ join point ä¸Šæ‰§è¡Œçš„, è€Œ point cut è§„å®šäº†å“ªäº› join point å¯ä»¥æ‰§è¡Œå“ªäº› advice</code></p><h3 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h3><p>ä¸ºä¸€ä¸ªç±»å‹æ·»åŠ é¢å¤–çš„æ–¹æ³•æˆ–å­—æ®µ. Spring AOP å…è®¸æˆ‘ä»¬ä¸º <code>ç›®æ ‡å¯¹è±¡</code> å¼•å…¥æ–°çš„æ¥å£(å’Œå¯¹åº”çš„å®ç°). ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ introduction æ¥ä¸ºä¸€ä¸ª bean å®ç° IsModified æ¥å£, å¹¶ä»¥æ­¤æ¥ç®€åŒ– caching çš„å®ç°.</p><h3 id="ç›®æ ‡å¯¹è±¡-Target"><a href="#ç›®æ ‡å¯¹è±¡-Target" class="headerlink" title="ç›®æ ‡å¯¹è±¡(Target)"></a>ç›®æ ‡å¯¹è±¡(Target)</h3><p>ç»‡å…¥ advice çš„ç›®æ ‡å¯¹è±¡. ç›®æ ‡å¯¹è±¡ä¹Ÿè¢«ç§°ä¸º <code>advised object</code>.<code>å› ä¸º Spring AOP ä½¿ç”¨è¿è¡Œæ—¶ä»£ç†çš„æ–¹å¼æ¥å®ç° aspect, å› æ­¤ adviced object æ€»æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡(proxied object)``æ³¨æ„, adviced object æŒ‡çš„ä¸æ˜¯åŸæ¥çš„ç±», è€Œæ˜¯ç»‡å…¥ advice åæ‰€äº§ç”Ÿçš„ä»£ç†ç±».</code></p><h3 id="AOP-proxy"><a href="#AOP-proxy" class="headerlink" title="AOP proxy"></a>AOP proxy</h3><p>ä¸€ä¸ªç±»è¢« AOP ç»‡å…¥ advice, å°±ä¼šäº§ç”Ÿä¸€ä¸ªç»“æœç±», å®ƒæ˜¯èåˆäº†åŸç±»å’Œå¢å¼ºé€»è¾‘çš„ä»£ç†ç±». åœ¨ Spring AOP ä¸­, ä¸€ä¸ª AOP ä»£ç†æ˜¯ä¸€ä¸ª JDK åŠ¨æ€ä»£ç†å¯¹è±¡æˆ– CGLIB ä»£ç†å¯¹è±¡.</p><h3 id="ç»‡å…¥-Weaving"><a href="#ç»‡å…¥-Weaving" class="headerlink" title="ç»‡å…¥(Weaving)"></a>ç»‡å…¥(Weaving)</h3><p>å°† aspect å’Œå…¶ä»–å¯¹è±¡è¿æ¥èµ·æ¥, å¹¶åˆ›å»º adviced object çš„è¿‡ç¨‹. æ ¹æ®ä¸åŒçš„å®ç°æŠ€æœ¯, AOPç»‡å…¥æœ‰ä¸‰ç§æ–¹å¼:</p><ul><li>ç¼–è¯‘å™¨ç»‡å…¥, è¿™è¦æ±‚æœ‰ç‰¹æ®Šçš„Javaç¼–è¯‘å™¨.</li><li>ç±»è£…è½½æœŸç»‡å…¥, è¿™éœ€è¦æœ‰ç‰¹æ®Šçš„ç±»è£…è½½å™¨.</li><li>åŠ¨æ€ä»£ç†ç»‡å…¥, åœ¨è¿è¡ŒæœŸä¸ºç›®æ ‡ç±»æ·»åŠ å¢å¼º(Advice)ç”Ÿæˆå­ç±»çš„æ–¹å¼. Spring é‡‡ç”¨åŠ¨æ€ä»£ç†ç»‡å…¥, è€ŒAspectJé‡‡ç”¨ç¼–è¯‘å™¨ç»‡å…¥å’Œç±»è£…è½½æœŸç»‡å…¥.</li></ul><h2 id="advice-çš„ç±»å‹"><a href="#advice-çš„ç±»å‹" class="headerlink" title="advice çš„ç±»å‹"></a>advice çš„ç±»å‹</h2><ul><li>before advice, åœ¨ join point å‰è¢«æ‰§è¡Œçš„ advice. è™½ç„¶ before advice æ˜¯åœ¨ join point å‰è¢«æ‰§è¡Œ, ä½†æ˜¯å®ƒå¹¶ä¸èƒ½å¤Ÿé˜»æ­¢ join point çš„æ‰§è¡Œ, é™¤éå‘ç”Ÿäº†å¼‚å¸¸(å³æˆ‘ä»¬åœ¨ before advice ä»£ç ä¸­, ä¸èƒ½äººä¸ºåœ°å†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œ join point ä¸­çš„ä»£ç )</li><li>after return advice, åœ¨ä¸€ä¸ª join point æ­£å¸¸è¿”å›åæ‰§è¡Œçš„ advice</li><li>after throwing advice, å½“ä¸€ä¸ª join point æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œçš„ advice</li><li>after(final) advice, æ— è®ºä¸€ä¸ª join point æ˜¯æ­£å¸¸é€€å‡ºè¿˜æ˜¯å‘ç”Ÿäº†å¼‚å¸¸, éƒ½ä¼šè¢«æ‰§è¡Œçš„ advice.</li><li>around advice, åœ¨ join point å‰å’Œ joint point é€€å‡ºåéƒ½æ‰§è¡Œçš„ advice. è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ advice.</li></ul><h2 id="å…³äº-AOP-Proxy"><a href="#å…³äº-AOP-Proxy" class="headerlink" title="å…³äº AOP Proxy"></a>å…³äº AOP Proxy</h2><p>Spring AOP é»˜è®¤ä½¿ç”¨æ ‡å‡†çš„ JDK åŠ¨æ€ä»£ç†(dynamic proxy)æŠ€æœ¯æ¥å®ç° AOP ä»£ç†, é€šè¿‡å®ƒ, æˆ‘ä»¬å¯ä»¥ä¸ºä»»æ„çš„æ¥å£å®ç°ä»£ç†.<code>å¦‚æœéœ€è¦ä¸ºä¸€ä¸ªç±»å®ç°ä»£ç†, é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ CGLIB ä»£ç†.</code> å½“ä¸€ä¸ªä¸šåŠ¡é€»è¾‘å¯¹è±¡æ²¡æœ‰å®ç°æ¥å£æ—¶, é‚£ä¹ˆSpring AOP å°±é»˜è®¤ä½¿ç”¨ CGLIB æ¥ä½œä¸º AOP ä»£ç†äº†. å³å¦‚æœæˆ‘ä»¬éœ€è¦ä¸ºä¸€ä¸ªæ–¹æ³•ç»‡å…¥ advice, ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸æ˜¯ä¸€ä¸ªæ¥å£æ‰€æä¾›çš„æ–¹æ³•, åˆ™æ­¤æ—¶ Spring AOP ä¼šä½¿ç”¨ CGLIB æ¥å®ç°åŠ¨æ€ä»£ç†. é‰´äºæ­¤, Spring AOP å»ºè®®åŸºäºæ¥å£ç¼–ç¨‹, å¯¹æ¥å£è¿›è¡Œ AOP è€Œä¸æ˜¯ç±».</p><h2 id="å½»åº•ç†è§£-aspect-join-point-point-cut-advice"><a href="#å½»åº•ç†è§£-aspect-join-point-point-cut-advice" class="headerlink" title="å½»åº•ç†è§£ aspect, join point, point cut, advice"></a>å½»åº•ç†è§£ aspect, join point, point cut, advice</h2><p>çœ‹å®Œäº†ä¸Šé¢çš„ç†è®ºéƒ¨åˆ†çŸ¥è¯†, æˆ‘ç›¸ä¿¡è¿˜æ˜¯ä¼šæœ‰ä¸å°‘æœ‹å‹æ„Ÿè§‰åˆ° AOP çš„æ¦‚å¿µè¿˜æ˜¯å¾ˆæ¨¡ç³Š, å¯¹ AOP ä¸­çš„å„ç§æ¦‚å¿µç†è§£çš„è¿˜ä¸æ˜¯å¾ˆé€å½». å…¶å®è¿™å¾ˆæ­£å¸¸, å› ä¸º AOP ä¸­çš„æ¦‚å¿µæ˜¯åœ¨æ˜¯å¤ªå¤šäº†, æˆ‘å½“æ—¶ä¹Ÿæ˜¯èŠ±äº†è€å¤§åŠ²æ‰æ¢³ç†æ¸…æ¥šçš„. ä¸‹é¢æˆ‘ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æ¯”å–»ä¸€ä¸‹ AOP ä¸­ aspect, jointpoint, pointcut ä¸ advice ä¹‹é—´çš„å…³ç³».</p><p>è®©æˆ‘ä»¬æ¥å‡è®¾ä¸€ä¸‹, ä»å‰æœ‰ä¸€ä¸ªå«çˆªå“‡çš„å°å¿åŸ, åœ¨ä¸€ä¸ªæœˆé»‘é£é«˜çš„æ™šä¸Š, è¿™ä¸ªå¿åŸä¸­å‘ç”Ÿäº†å‘½æ¡ˆ. ä½œæ¡ˆçš„å‡¶æ‰‹ååˆ†ç‹¡çŒ¾, ç°åœºæ²¡æœ‰ç•™ä¸‹ä»€ä¹ˆæœ‰ä»·å€¼çš„çº¿ç´¢. ä¸è¿‡ä¸‡å¹¸çš„æ˜¯, åˆšä»éš”å£å›æ¥çš„è€ç‹æ°å¥½åœ¨è¿™æ—¶å€™æ— æ„ä¸­å‘ç°äº†å‡¶æ‰‹è¡Œå‡¶çš„è¿‡ç¨‹, ä½†æ˜¯ç”±äºå¤©è‰²å·²æ™š, åŠ ä¸Šå‡¶æ‰‹è’™ç€é¢, è€ç‹å¹¶æ²¡æœ‰çœ‹æ¸…å‡¶æ‰‹çš„é¢ç›®, åªçŸ¥é“å‡¶æ‰‹æ˜¯ä¸ªç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸. çˆªå“‡å¿çš„å¿ä»¤æ ¹æ®è€ç‹çš„æè¿°, å¯¹å®ˆé—¨çš„å£«å…µä¸‹å‘½ä»¤è¯´: å‡¡æ˜¯å‘ç°æœ‰èº«é«˜ä¸ƒå°ºäº”å¯¸çš„ç”·æ€§, éƒ½è¦æŠ“è¿‡æ¥å®¡é—®. å£«å…µå½“ç„¶ä¸æ•¢è¿èƒŒå¿ä»¤çš„å‘½ä»¤, åªå¥½æŠŠè¿›å‡ºåŸçš„æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„äººéƒ½æŠ“äº†èµ·æ¥.</p><p>æ¥è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šé¢çš„ä¸€ä¸ªå°æ•…äº‹å’Œ AOP åˆ°åº•æœ‰ä»€ä¹ˆå¯¹åº”å…³ç³». é¦–å…ˆæˆ‘ä»¬çŸ¥é“, åœ¨ Spring AOP ä¸­ join point æŒ‡ä»£çš„æ˜¯æ‰€æœ‰æ–¹æ³•çš„æ‰§è¡Œç‚¹, è€Œ point cut æ˜¯ä¸€ä¸ªæè¿°ä¿¡æ¯, å®ƒä¿®é¥°çš„æ˜¯ join point, é€šè¿‡ point cut, æˆ‘ä»¬å°±å¯ä»¥ç¡®å®šå“ªäº› join point å¯ä»¥è¢«ç»‡å…¥ Advice. å¯¹åº”åˆ°æˆ‘ä»¬åœ¨ä¸Šé¢ä¸¾çš„ä¾‹å­, æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªç®€å•çš„ç±»æ¯”, join point å°±ç›¸å½“äº <strong>çˆªå“‡çš„å°å¿åŸé‡Œçš„ç™¾å§“</strong> , point cut å°±ç›¸å½“äº <strong>è€ç‹æ‰€åšçš„æŒ‡æ§, å³å‡¶æ‰‹æ˜¯ä¸ªç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸</strong> , è€Œ advice åˆ™æ˜¯æ–½åŠ åœ¨ç¬¦åˆè€ç‹æ‰€æè¿°çš„å«Œç–‘äººçš„åŠ¨ä½œ: <strong>æŠ“è¿‡æ¥å®¡é—®</strong> . ä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·ç±»æ¯”å‘¢?</p><ul><li>join point â€“&gt; çˆªå“‡çš„å°å¿åŸé‡Œçš„ç™¾å§“: å› ä¸ºæ ¹æ®å®šä¹‰, join point æ˜¯æ‰€æœ‰å¯èƒ½è¢«ç»‡å…¥ advice çš„å€™é€‰çš„ç‚¹, åœ¨ Spring AOPä¸­, åˆ™å¯ä»¥è®¤ä¸ºæ‰€æœ‰æ–¹æ³•æ‰§è¡Œç‚¹éƒ½æ˜¯ join point. è€Œåœ¨æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ä¸­, å‘½æ¡ˆå‘ç”Ÿåœ¨å°å¿åŸä¸­, æŒ‰ç†è¯´åœ¨æ­¤å¿åŸä¸­çš„æ‰€æœ‰äººéƒ½æœ‰å¯èƒ½æ˜¯å«Œç–‘äºº.</li><li>point cut â€“&gt; ç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸: æˆ‘ä»¬çŸ¥é“, æ‰€æœ‰çš„æ–¹æ³•(joint point) éƒ½å¯ä»¥ç»‡å…¥ advice, ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœ¨æ‰€æœ‰æ–¹æ³•ä¸Šéƒ½ç»‡å…¥ advice, è€Œ pointcut çš„ä½œç”¨å°±æ˜¯æä¾›ä¸€ç»„è§„åˆ™æ¥åŒ¹é…joinpoint, ç»™æ»¡è¶³è§„åˆ™çš„ joinpoint æ·»åŠ  advice. åŒç†, å¯¹äºå¿ä»¤æ¥è¯´, ä»–å†æ˜åº¸, ä¹ŸçŸ¥é“ä¸èƒ½æŠŠå¿åŸä¸­çš„æ‰€æœ‰ç™¾å§“éƒ½æŠ“èµ·æ¥å®¡é—®, è€Œæ˜¯æ ¹æ®<code>å‡¶æ‰‹æ˜¯ä¸ªç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸</code>, æŠŠç¬¦åˆæ¡ä»¶çš„äººæŠ“èµ·æ¥. åœ¨è¿™é‡Œ <code>å‡¶æ‰‹æ˜¯ä¸ªç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸</code> å°±æ˜¯ä¸€ä¸ªä¿®é¥°è°“è¯­, å®ƒé™å®šäº†å‡¶æ‰‹çš„èŒƒå›´, æ»¡è¶³æ­¤ä¿®é¥°è§„åˆ™çš„ç™¾å§“éƒ½æ˜¯å«Œç–‘äºº, éƒ½éœ€è¦æŠ“èµ·æ¥å®¡é—®.</li><li>advice â€“&gt; æŠ“è¿‡æ¥å®¡é—®, advice æ˜¯ä¸€ä¸ªåŠ¨ä½œ, å³ä¸€æ®µ Java ä»£ç , è¿™æ®µ Java ä»£ç æ˜¯ä½œç”¨äº point cut æ‰€é™å®šçš„é‚£äº› join point ä¸Šçš„. åŒç†, å¯¹æ¯”åˆ°æˆ‘ä»¬çš„ä¾‹å­ä¸­, <code>æŠ“è¿‡æ¥å®¡é—®</code> è¿™ä¸ªåŠ¨ä½œå°±æ˜¯å¯¹ä½œç”¨äºé‚£äº›æ»¡è¶³ <code>ç”·æ€§, èº«é«˜çº¦ä¸ƒå°ºäº”å¯¸</code> çš„<code>çˆªå“‡çš„å°å¿åŸé‡Œçš„ç™¾å§“</code>.</li><li>aspect: aspect æ˜¯ point cut ä¸ advice çš„ç»„åˆ, å› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç±»æ¯”: <strong>â€œæ ¹æ®è€ç‹çš„çº¿ç´¢, å‡¡æ˜¯å‘ç°æœ‰èº«é«˜ä¸ƒå°ºäº”å¯¸çš„ç”·æ€§, éƒ½è¦æŠ“è¿‡æ¥å®¡é—®â€</strong> è¿™ä¸€æ•´ä¸ªåŠ¨ä½œå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª aspect.</li></ul><hr><p>æˆ–åˆ™æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»è¯­æ³•çš„è§’åº¦æ¥ç®€å•ç±»æ¯”ä¸€ä¸‹. æˆ‘ä»¬åœ¨å­¦è‹±è¯­æ—¶, ç»å¸¸ä¼šæ¥è§¦ä»€ä¹ˆ <code>å®šè¯­</code>, <code>è¢«åŠ¨å¥</code> ä¹‹ç±»çš„æ¦‚å¿µ, é‚£ä¹ˆå¯ä»¥åšä¸€ä¸ªä¸ä¸¥è°¨çš„ç±»æ¯”, å³ <code>joinpoint</code> å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ª <code>å®¾è¯­</code>, è€Œ <code>pointcut</code> åˆ™å¯ä»¥ç±»æ¯”ä¸ºä¿®é¥° <code>joinpoint</code> çš„å®šè¯­, é‚£ä¹ˆæ•´ä¸ª <code>aspect</code> å°±å¯ä»¥æè¿°ä¸º: <code>æ»¡è¶³ pointcut è§„åˆ™çš„ joinpoint ä¼šè¢«æ·»åŠ ç›¸åº”çš„ advice æ“ä½œ.</code></p><h2 id="AspectJ-æ”¯æŒ"><a href="#AspectJ-æ”¯æŒ" class="headerlink" title="@AspectJ æ”¯æŒ"></a>@AspectJ æ”¯æŒ</h2><p><strong>@AspectJ</strong> æ˜¯ä¸€ç§ä½¿ç”¨ Java æ³¨è§£æ¥å®ç° AOP çš„ç¼–ç é£æ ¼. @AspectJ é£æ ¼çš„ AOP æ˜¯ AspectJ Project åœ¨ AspectJ 5 ä¸­å¼•å…¥çš„, å¹¶ä¸” Spring ä¹Ÿæ”¯æŒ@AspectJ çš„ AOP é£æ ¼.</p><h2 id="ä½¿èƒ½-AspectJ-æ”¯æŒ"><a href="#ä½¿èƒ½-AspectJ-æ”¯æŒ" class="headerlink" title="ä½¿èƒ½ @AspectJ æ”¯æŒ"></a>ä½¿èƒ½ @AspectJ æ”¯æŒ</h2><p>@AspectJ å¯ä»¥ä»¥ XML çš„æ–¹å¼æˆ–ä»¥æ³¨è§£çš„æ–¹å¼æ¥ä½¿èƒ½, å¹¶ä¸”ä¸è®ºä»¥å“ªç§æ–¹å¼ä½¿èƒ½@ASpectJ, æˆ‘ä»¬éƒ½å¿…é¡»ä¿è¯ aspectjweaver.jar åœ¨ classpath ä¸­.</p><h3 id="ä½¿ç”¨-Java-Configuration-æ–¹å¼ä½¿èƒ½-AspectJ"><a href="#ä½¿ç”¨-Java-Configuration-æ–¹å¼ä½¿èƒ½-AspectJ" class="headerlink" title="ä½¿ç”¨ Java Configuration æ–¹å¼ä½¿èƒ½@AspectJ"></a>ä½¿ç”¨ Java Configuration æ–¹å¼ä½¿èƒ½@AspectJ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-XML-æ–¹å¼ä½¿èƒ½-AspectJ"><a href="#ä½¿ç”¨-XML-æ–¹å¼ä½¿èƒ½-AspectJ" class="headerlink" title="ä½¿ç”¨ XML æ–¹å¼ä½¿èƒ½@AspectJ"></a>ä½¿ç”¨ XML æ–¹å¼ä½¿èƒ½@AspectJ</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰-aspect-åˆ‡é¢"><a href="#å®šä¹‰-aspect-åˆ‡é¢" class="headerlink" title="å®šä¹‰ aspect(åˆ‡é¢)"></a>å®šä¹‰ aspect(åˆ‡é¢)</h2><p>å½“ä½¿ç”¨æ³¨è§£ <strong>@Aspect</strong> æ ‡æ³¨ä¸€ä¸ª Bean å, é‚£ä¹ˆ Spring æ¡†æ¶ä¼šè‡ªåŠ¨æ”¶é›†è¿™äº› Bean, å¹¶æ·»åŠ åˆ° Spring AOP ä¸­, ä¾‹å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">æ³¨æ„, ä»…ä»…ä½¿ç”¨<span class="meta">@Aspect</span> æ³¨è§£, å¹¶ä¸èƒ½å°†ä¸€ä¸ª Java å¯¹è±¡è½¬æ¢ä¸º Bean, å› æ­¤æˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ç±»ä¼¼ <span class="meta">@Component</span> ä¹‹ç±»çš„æ³¨è§£.`</span><br><span class="line">`æ³¨æ„, å¦‚æœä¸€ä¸ª ç±»è¢«<span class="meta">@Aspect</span> æ ‡æ³¨, åˆ™è¿™ä¸ªç±»å°±ä¸èƒ½æ˜¯å…¶ä»– aspect çš„ **advised object** äº†, å› ä¸ºä½¿ç”¨ <span class="meta">@Aspect</span> å, è¿™ä¸ªç±»å°±ä¼šè¢«æ’é™¤åœ¨ auto-proxying æœºåˆ¶ä¹‹å¤–.</span><br></pre></td></tr></table></figure><h2 id="å£°æ˜-pointcut"><a href="#å£°æ˜-pointcut" class="headerlink" title="å£°æ˜ pointcut"></a>å£°æ˜ pointcut</h2><p>ä¸€ä¸ª pointcut çš„å£°æ˜ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:</p><ul><li>ä¸€ä¸ªæ–¹æ³•ç­¾å, åŒ…æ‹¬æ–¹æ³•åå’Œç›¸å…³å‚æ•°</li><li>ä¸€ä¸ª pointcut è¡¨è¾¾å¼, ç”¨æ¥æŒ‡å®šå“ªäº›æ–¹æ³•æ‰§è¡Œæ˜¯æˆ‘ä»¬æ„Ÿå…´è¶£çš„(å³å› æ­¤å¯ä»¥ç»‡å…¥ advice).</li></ul><p>åœ¨@AspectJ é£æ ¼çš„ AOP ä¸­, æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•æ¥æè¿° pointcut, å³:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(* com.xys.service.UserService.*(..))&quot;)</span> <span class="comment">// åˆ‡ç‚¹è¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dataAccessOperation</span><span class="params">()</span> &#123;&#125; <span class="comment">// åˆ‡ç‚¹å‰é¢</span></span><br></pre></td></tr></table></figure><p><code>è¿™ä¸ªæ–¹æ³•å¿…é¡»æ— è¿”å›å€¼.``è¿™ä¸ªæ–¹æ³•æœ¬èº«å°±æ˜¯ pointcut signature, pointcut è¡¨è¾¾å¼ä½¿ç”¨@Pointcut æ³¨è§£æŒ‡å®š.</code>ä¸Šé¢æˆ‘ä»¬ç®€å•åœ°å®šä¹‰äº†ä¸€ä¸ª pointcut, è¿™ä¸ª pointcut æ‰€æè¿°çš„æ˜¯: åŒ¹é…æ‰€æœ‰åœ¨åŒ… <strong>com.xys.service.UserService</strong> ä¸‹çš„æ‰€æœ‰æ–¹æ³•çš„æ‰§è¡Œ.</p><h3 id="åˆ‡ç‚¹æ ‡å¿—ç¬¦-designator"><a href="#åˆ‡ç‚¹æ ‡å¿—ç¬¦-designator" class="headerlink" title="åˆ‡ç‚¹æ ‡å¿—ç¬¦(designator)"></a>åˆ‡ç‚¹æ ‡å¿—ç¬¦(designator)</h3><p>AspectJ5 çš„åˆ‡ç‚¹è¡¨è¾¾å¼ç”±æ ‡å¿—ç¬¦(designator)å’Œæ“ä½œå‚æ•°ç»„æˆ. å¦‚ â€œexecution( <em>greetTo(..))â€ çš„åˆ‡ç‚¹è¡¨è¾¾å¼, <strong>execution</strong> å°±æ˜¯ æ ‡å¿—ç¬¦, è€Œåœ†æ‹¬å·é‡Œçš„</em> greetTo(..) å°±æ˜¯æ“ä½œå‚æ•°</p><h4 id="execution"><a href="#execution" class="headerlink" title="execution"></a>execution</h4><p>åŒ¹é… join point çš„æ‰§è¡Œ, ä¾‹å¦‚ â€œexecution(* hello(..))â€ è¡¨ç¤ºåŒ¹é…æ‰€æœ‰ç›®æ ‡ç±»ä¸­çš„ hello() æ–¹æ³•. è¿™ä¸ªæ˜¯æœ€åŸºæœ¬çš„ pointcut æ ‡å¿—ç¬¦.</p><h4 id="within"><a href="#within" class="headerlink" title="within"></a>within</h4><p>åŒ¹é…ç‰¹å®šåŒ…ä¸‹çš„æ‰€æœ‰ join point, ä¾‹å¦‚ <code>within(com.xys.*)</code> è¡¨ç¤º com.xys åŒ…ä¸­çš„æ‰€æœ‰è¿æ¥ç‚¹, å³åŒ…ä¸­çš„æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•. è€Œ <code>within(com.xys.service.*Service)</code> è¡¨ç¤ºåœ¨ com.xys.service åŒ…ä¸­æ‰€æœ‰ä»¥ Service ç»“å°¾çš„ç±»çš„æ‰€æœ‰çš„è¿æ¥ç‚¹.</p><h4 id="this-ä¸-target"><a href="#this-ä¸-target" class="headerlink" title="this ä¸ target"></a>this ä¸ target</h4><p>this çš„ä½œç”¨æ˜¯åŒ¹é…ä¸€ä¸ª bean, è¿™ä¸ª bean(Spring AOP proxy) æ˜¯ä¸€ä¸ªç»™å®šç±»å‹çš„å®ä¾‹(instance of). è€Œ target åŒ¹é…çš„æ˜¯ä¸€ä¸ªç›®æ ‡å¯¹è±¡(target object, å³éœ€è¦ç»‡å…¥ advice çš„åŸå§‹çš„ç±»), æ­¤å¯¹è±¡æ˜¯ä¸€ä¸ªç»™å®šç±»å‹çš„å®ä¾‹(instance of).</p><h4 id="bean"><a href="#bean" class="headerlink" title="bean"></a>bean</h4><p>åŒ¹é… bean åå­—ä¸ºæŒ‡å®šå€¼çš„ bean ä¸‹çš„æ‰€æœ‰æ–¹æ³•, ä¾‹å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bean(*Service) <span class="comment">// åŒ¹é…åå­—åç¼€ä¸º Service çš„ bean ä¸‹çš„æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line">bean(myService) <span class="comment">// åŒ¹é…åå­—ä¸º myService çš„ bean ä¸‹çš„æ‰€æœ‰æ–¹æ³•</span></span><br></pre></td></tr></table></figure><h4 id="args"><a href="#args" class="headerlink" title="args"></a>args</h4><p>åŒ¹é…å‚æ•°æ»¡è¶³è¦æ±‚çš„çš„æ–¹æ³•. ä¾‹å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;within(com.xys.demo2.*)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointcut2</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before(value = &quot;pointcut2()  &amp;&amp;  args(name)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    logger.info(<span class="string">&quot;---page: &#123;&#125;---&quot;</span>, name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NormalService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">someMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;---NormalService: someMethod invoked---&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;---NormalService: test invoked---&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æœåŠ¡ä¸€åˆ‡æ­£å¸¸&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ NormalService.test æ‰§è¡Œæ—¶, åˆ™ advice <code>doSomething</code> å°±ä¼šæ‰§è¡Œ, test æ–¹æ³•çš„å‚æ•° name å°±ä¼šä¼ é€’åˆ° <code>doSomething</code> ä¸­.</p><p>å¸¸ç”¨ä¾‹å­:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒ¹é…åªæœ‰ä¸€ä¸ªå‚æ•° name çš„æ–¹æ³•</span></span><br><span class="line"><span class="meta">@Before(value = &quot;aspectMethod()  &amp;&amp;  args(name)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">(String name)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°ä¸º name çš„æ–¹æ³•</span></span><br><span class="line"><span class="meta">@Before(value = &quot;aspectMethod()  &amp;&amp;  args(name, ..)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">(String name)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…ç¬¬äºŒä¸ªå‚æ•°ä¸º name çš„æ–¹æ³•</span></span><br><span class="line">Before(value = <span class="string">&quot;aspectMethod()  &amp;&amp;  args(*, name, ..)&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">(String name)</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="annotation"><a href="#annotation" class="headerlink" title="@annotation"></a>@annotation</h4><p>åŒ¹é…ç”±æŒ‡å®šæ³¨è§£æ‰€æ ‡æ³¨çš„æ–¹æ³•, ä¾‹å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;@annotation(com.xys.demo1.AuthChecker)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointcut</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ™åŒ¹é…ç”±æ³¨è§£ <code>AuthChecker</code> æ‰€æ ‡æ³¨çš„æ–¹æ³•.</p><h3 id="å¸¸è§çš„åˆ‡ç‚¹è¡¨è¾¾å¼"><a href="#å¸¸è§çš„åˆ‡ç‚¹è¡¨è¾¾å¼" class="headerlink" title="å¸¸è§çš„åˆ‡ç‚¹è¡¨è¾¾å¼"></a>å¸¸è§çš„åˆ‡ç‚¹è¡¨è¾¾å¼</h3><h4 id="åŒ¹é…æ–¹æ³•ç­¾å"><a href="#åŒ¹é…æ–¹æ³•ç­¾å" class="headerlink" title="åŒ¹é…æ–¹æ³•ç­¾å"></a>åŒ¹é…æ–¹æ³•ç­¾å</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒ¹é…æŒ‡å®šåŒ…ä¸­çš„æ‰€æœ‰çš„æ–¹æ³•</span></span><br><span class="line">execution(* com.xys.service.*(..))</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…å½“å‰åŒ…ä¸­çš„æŒ‡å®šç±»çš„æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line">execution(* UserService.*(..))</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…æŒ‡å®šåŒ…ä¸­çš„æ‰€æœ‰ public æ–¹æ³•</span></span><br><span class="line">execution(<span class="keyword">public</span> * com.xys.service.*(..))</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…æŒ‡å®šåŒ…ä¸­çš„æ‰€æœ‰ public æ–¹æ³•, å¹¶ä¸”è¿”å›å€¼æ˜¯ int ç±»å‹çš„æ–¹æ³•</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="type">int</span> com.xys.service.*(..))</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…æŒ‡å®šåŒ…ä¸­çš„æ‰€æœ‰ public æ–¹æ³•, å¹¶ä¸”ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ String, è¿”å›å€¼æ˜¯ int ç±»å‹çš„æ–¹æ³•</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="type">int</span> com.xys.service.*(String name, ..))</span><br></pre></td></tr></table></figure><h4 id="åŒ¹é…ç±»å‹ç­¾å"><a href="#åŒ¹é…ç±»å‹ç­¾å" class="headerlink" title="åŒ¹é…ç±»å‹ç­¾å"></a>åŒ¹é…ç±»å‹ç­¾å</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒ¹é…æŒ‡å®šåŒ…ä¸­çš„æ‰€æœ‰çš„æ–¹æ³•, ä½†ä¸åŒ…æ‹¬å­åŒ…</span></span><br><span class="line">within(com.xys.service.*)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…æŒ‡å®šåŒ…ä¸­çš„æ‰€æœ‰çš„æ–¹æ³•, åŒ…æ‹¬å­åŒ…</span></span><br><span class="line">within(com.xys.service..*)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…å½“å‰åŒ…ä¸­çš„æŒ‡å®šç±»ä¸­çš„æ–¹æ³•</span></span><br><span class="line">within(UserService)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…ä¸€ä¸ªæ¥å£çš„æ‰€æœ‰å®ç°ç±»ä¸­çš„å®ç°çš„æ–¹æ³•</span></span><br><span class="line">within(UserDao+)</span><br></pre></td></tr></table></figure><h4 id="åŒ¹é…-Bean-åå­—"><a href="#åŒ¹é…-Bean-åå­—" class="headerlink" title="åŒ¹é… Bean åå­—"></a>åŒ¹é… Bean åå­—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒ¹é…ä»¥æŒ‡å®šåå­—ç»“å°¾çš„ Bean ä¸­çš„æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line">bean(*Service)</span><br></pre></td></tr></table></figure><h4 id="åˆ‡ç‚¹è¡¨è¾¾å¼ç»„åˆ"><a href="#åˆ‡ç‚¹è¡¨è¾¾å¼ç»„åˆ" class="headerlink" title="åˆ‡ç‚¹è¡¨è¾¾å¼ç»„åˆ"></a>åˆ‡ç‚¹è¡¨è¾¾å¼ç»„åˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒ¹é…ä»¥ Service æˆ– ServiceImpl ç»“å°¾çš„ bean</span></span><br><span class="line">bean(*Service || *ServiceImpl)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ¹é…åå­—ä»¥ Service ç»“å°¾, å¹¶ä¸”åœ¨åŒ… com.xys.service ä¸­çš„ bean</span></span><br><span class="line">bean(*Service) &amp;&amp; within(com.xys.service.*)</span><br></pre></td></tr></table></figure><h2 id="å£°æ˜-advice"><a href="#å£°æ˜-advice" class="headerlink" title="å£°æ˜ advice"></a>å£°æ˜ advice</h2><p>advice æ˜¯å’Œä¸€ä¸ª pointcut è¡¨è¾¾å¼å…³è”åœ¨ä¸€èµ·çš„, å¹¶ä¸”ä¼šåœ¨åŒ¹é…çš„ join point çš„æ–¹æ³•æ‰§è¡Œçš„å‰/å/å‘¨å›´ è¿è¡Œ. <code>pointcut è¡¨è¾¾å¼å¯ä»¥æ˜¯ç®€å•çš„ä¸€ä¸ª pointcut åå­—çš„å¼•ç”¨, æˆ–è€…æ˜¯å®Œæ•´çš„ pointcut è¡¨è¾¾å¼</code>. ä¸‹é¢æˆ‘ä»¬ä»¥å‡ ä¸ªç®€å•çš„ advice ä¸ºä¾‹å­, æ¥çœ‹ä¸€ä¸‹ä¸€ä¸ª advice æ˜¯å¦‚ä½•å£°æ˜çš„.</p><h3 id="Before-advice"><a href="#Before-advice" class="headerlink" title="Before advice"></a>Before advice</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiongyongshun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@created</span> 16/9/9 13:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeforeAspectTest</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ª Pointcut, ä½¿ç”¨ åˆ‡ç‚¹è¡¨è¾¾å¼å‡½æ•° æ¥æè¿°å¯¹å“ªäº› Join point ä½¿ç”¨ advise.</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.xys.service.UserService.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dataAccessOperation</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdviseDefine</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ advise</span></span><br><span class="line">    <span class="meta">@Before(&quot;com.xys.aspect.PointcutDefine.dataAccessOperation()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBeforeAccessCheck</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;*****Before advise, method: &quot;</span> + joinPoint.getSignature().toShortString() + <span class="string">&quot; *****&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ, <strong>@Before</strong> å¼•ç”¨äº†ä¸€ä¸ª pointcut, å³ â€œcom.xys.aspect.PointcutDefine.dataAccessOperation()â€ æ˜¯ä¸€ä¸ª pointcut çš„åå­—. å¦‚æœæˆ‘ä»¬åœ¨ advice åœ¨å†…ç½® pointcut, åˆ™å¯ä»¥:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdviseDefine</span> &#123;</span><br><span class="line">    <span class="comment">// å°† pointcut å’Œ advice åŒæ—¶å®šä¹‰</span></span><br><span class="line">    <span class="meta">@Before(&quot;within(com.xys.service..*)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAccessCheck</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;*****doAccessCheck, Before advise, method: &quot;</span> + joinPoint.getSignature().toShortString() + <span class="string">&quot; *****&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="around-advice"><a href="#around-advice" class="headerlink" title="around advice"></a>around advice</h3><p>around advice æ¯”è¾ƒç‰¹åˆ«, å®ƒå¯ä»¥åœ¨ä¸€ä¸ªæ–¹æ³•çš„ä¹‹å‰ä¹‹å‰å’Œä¹‹åæ·»åŠ ä¸åŒçš„æ“ä½œ, å¹¶ä¸”ç”šè‡³å¯ä»¥å†³å®šä½•æ—¶, å¦‚ä½•, æ˜¯å¦è°ƒç”¨åŒ¹é…åˆ°çš„æ–¹æ³•.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdviseDefine</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ advise</span></span><br><span class="line">    <span class="meta">@Around(&quot;com.xys.aspect.PointcutDefine.dataAccessOperation()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doAroundAccessCheck</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">        stopWatch.start();</span><br><span class="line">        <span class="comment">// å¼€å§‹</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">retVal</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        <span class="comment">// ç»“æŸ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;invoke method: &quot;</span> + pjp.getSignature().getName() + <span class="string">&quot;, elapsed time: &quot;</span> + stopWatch.getTotalTimeMillis());</span><br><span class="line">        <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>around advice å’Œå‰é¢çš„ before advice å·®ä¸å¤š, åªæ˜¯æˆ‘ä»¬æŠŠæ³¨è§£ <strong>@Before</strong> æ”¹ä¸ºäº† <strong>@Around</strong> äº†.</p><h1 id="Java8-Stream-æµå¼ç¼–ç¨‹ï¼Œæå¤§è§£æ”¾ä½ çš„ç”Ÿäº§åŠ›ï¼"><a href="#Java8-Stream-æµå¼ç¼–ç¨‹ï¼Œæå¤§è§£æ”¾ä½ çš„ç”Ÿäº§åŠ›ï¼" class="headerlink" title="Java8 Stream æµå¼ç¼–ç¨‹ï¼Œæå¤§è§£æ”¾ä½ çš„ç”Ÿäº§åŠ›ï¼"></a>Java8 Stream æµå¼ç¼–ç¨‹ï¼Œæå¤§è§£æ”¾ä½ çš„ç”Ÿäº§åŠ›ï¼</h1><p>[<img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="http://wx.qlogo.cn/mmhead/Q3auHgzwzM6ic4X45AUnpXYUQkPs87V3XX2hTH9r0OK9hbLAD6j77dg/0" alt="å°å“ˆå­¦Java"><strong>Java</strong>ä¸“æ³¨äºJavaé¢†åŸŸå¹²è´§åˆ†äº«ï¼Œä¸é™äºBATé¢è¯•, ç®—æ³•ï¼Œæ•°</p><p><code>Stream</code> æµå¯ä»¥è¯´æ˜¯ Java8 æ–°ç‰¹æ€§ä¸­ç”¨èµ·æ¥æœ€çˆ½çš„ä¸€ä¸ªåŠŸèƒ½äº†ï¼Œæœ‰äº†å®ƒï¼Œä»æ­¤æ“ä½œé›†åˆå‘Šåˆ«ç¹ççš„ <code>for</code> å¾ªç¯ã€‚ä½†æ˜¯è¿˜æœ‰å¾ˆå¤šå°ä¼™ä¼´å¯¹ Stream æµä¸æ˜¯å¾ˆäº†è§£ã€‚ä»Šå¤©å°±é€šè¿‡è¿™ç¯‡ @Winterbe çš„è¯‘æ–‡ï¼Œä¸€èµ·æ·±å…¥äº†è§£ä¸‹å¦‚ä½•ä½¿ç”¨å®ƒå§ã€‚</p><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><p>ä¸€ã€Stream æµæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</p><p>äºŒã€ä¸åŒç±»å‹çš„ Stream æµ</p><p>ä¸‰ã€Stream æµçš„å¤„ç†é¡ºåº</p><p>å››ã€ä¸­é—´æ“ä½œé¡ºåºè¿™ä¹ˆé‡è¦ï¼Ÿ</p><p>äº”ã€æ•°æ®æµå¤ç”¨é—®é¢˜</p><p>å…­ã€é«˜çº§æ“ä½œ</p><ul><li>6.1 Collect</li><li>6.2 FlatMap</li><li>6.3 Reduce</li></ul><p>ä¸ƒã€å¹¶è¡Œæµ</p><p>å…«ã€ç»“è¯­</p><hr><p>å½“æˆ‘ç¬¬ä¸€æ¬¡é˜…è¯» Java8 ä¸­çš„ Stream API æ—¶ï¼Œè¯´å®è¯ï¼Œæˆ‘éå¸¸å›°æƒ‘ï¼Œå› ä¸ºå®ƒçš„åå­—å¬èµ·æ¥ä¸ Java I0 æ¡†æ¶ä¸­çš„ <code>InputStream</code> å’Œ <code>OutputStream</code> éå¸¸ç±»ä¼¼ã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œå®ƒä»¬å®Œå…¨æ˜¯ä¸åŒçš„ä¸œè¥¿ã€‚</p><p>Java8 Stream ä½¿ç”¨çš„æ˜¯å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼ï¼Œå¦‚åŒå®ƒçš„åå­—ä¸€æ ·ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥å¯¹é›†åˆè¿›è¡Œé“¾çŠ¶æµå¼çš„æ“ä½œã€‚</p><p>æœ¬æ–‡å°±å°†å¸¦ç€ä½ å¦‚ä½•ä½¿ç”¨ Java 8 ä¸åŒç±»å‹çš„ Stream æ“ä½œã€‚åŒæ—¶æ‚¨è¿˜å°†äº†è§£æµçš„å¤„ç†é¡ºåºï¼Œä»¥åŠä¸åŒé¡ºåºçš„æµæ“ä½œæ˜¯å¦‚ä½•å½±å“è¿è¡Œæ—¶æ€§èƒ½çš„ã€‚</p><p>æˆ‘ä»¬è¿˜å°†å­¦ä¹ ç»ˆç«¯æ“ä½œ API <code>reduce</code>ï¼Œ <code>collect</code> ä»¥åŠ <code>flatMap</code>çš„è¯¦ç»†ä»‹ç»ï¼Œæœ€åæˆ‘ä»¬å†æ¥æ·±å…¥çš„æ¢è®¨ä¸€ä¸‹ Java8 å¹¶è¡Œæµã€‚</p><blockquote><p>æ³¨æ„ï¼šå¦‚æœæ‚¨è¿˜ä¸ç†Ÿæ‚‰ Java 8 lambda è¡¨è¾¾å¼ï¼Œå‡½æ•°å¼æ¥å£ä»¥åŠæ–¹æ³•å¼•ç”¨ï¼Œæ‚¨å¯ä»¥å…ˆé˜…è¯»ä¸€ä¸‹å°å“ˆçš„å¦ä¸€ç¯‡è¯‘æ–‡ ã€Š<a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU4MDUyMDQyNQ==&mid=2247483703&idx=1&sn=9a1721b7ffd578455e29fcdc323e6817&chksm=fd54d1b1ca2358a7c3699a30748bc4e596c89d6d91cd41b2893bbd9c3d572dcfbe72f1567fae&scene=21#wechat_redirect">å¹²è´§ | Java8 æ–°ç‰¹æ€§æŒ‡å¯¼æ‰‹å†Œ</a>ã€‹</p></blockquote><p>æ¥ä¸‹æ¥ï¼Œå°±è®©æˆ‘ä»¬è¿›å…¥æ­£é¢˜å§ï¼</p><h2 id="ä¸€ã€Stream-æµæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"><a href="#ä¸€ã€Stream-æµæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ" class="headerlink" title="ä¸€ã€Stream æµæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"></a>ä¸€ã€Stream æµæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2><p>æµè¡¨ç¤ºåŒ…å«ç€ä¸€ç³»åˆ—å…ƒç´ çš„é›†åˆï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶åšä¸åŒç±»å‹çš„æ“ä½œï¼Œç”¨æ¥å¯¹è¿™äº›å…ƒç´ æ‰§è¡Œè®¡ç®—ã€‚å¬ä¸Šå»å¯èƒ½æœ‰ç‚¹æ‹—å£ï¼Œè®©æˆ‘ä»¬ç”¨ä»£ç è¯´è¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; myList =    Arrays.asList(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;c2&quot;</span>, <span class="string">&quot;c1&quot;</span>);</span><br><span class="line">myList    .stream() <span class="comment">// åˆ›å»ºæµ    .filter(s -&gt; s.startsWith(&quot;c&quot;)) // æ‰§è¡Œè¿‡æ»¤ï¼Œè¿‡æ»¤å‡ºä»¥ c ä¸ºå‰ç¼€çš„å­—ç¬¦ä¸²    .map(String::toUpperCase) // è½¬æ¢æˆå¤§å†™    .sorted() // æ’åº    .forEach(System.out::println); // for å¾ªç¯æ‰“å°</span></span><br><span class="line"><span class="comment">// C1// C2</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å¯¹æµè¿›è¡Œä¸­é—´æ“ä½œæˆ–è€…ç»ˆç«¯æ“ä½œã€‚å°ä¼™ä¼´ä»¬å¯èƒ½ä¼šç–‘é—®ï¼Ÿ<strong>ä»€ä¹ˆæ˜¯ä¸­é—´æ“ä½œï¼Ÿä»€ä¹ˆåˆæ˜¯ç»ˆç«¯æ“ä½œï¼Ÿ</strong></p><p><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p><ul><li><strong>â‘ </strong>ï¼šä¸­é—´æ“ä½œä¼šå†æ¬¡è¿”å›ä¸€ä¸ªæµï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é“¾æ¥å¤šä¸ªä¸­é—´æ“ä½œï¼Œæ³¨æ„è¿™é‡Œæ˜¯ä¸ç”¨åŠ åˆ†å·çš„ã€‚ä¸Šå›¾ä¸­çš„ <code>filter</code> è¿‡æ»¤ï¼Œ <code>map</code> å¯¹è±¡è½¬æ¢ï¼Œ <code>sorted</code> æ’åºï¼Œå°±å±äºä¸­é—´æ“ä½œã€‚</li><li><strong>â‘¡</strong>ï¼šç»ˆç«¯æ“ä½œæ˜¯å¯¹æµæ“ä½œçš„ä¸€ä¸ªç»“æŸåŠ¨ä½œï¼Œä¸€èˆ¬è¿”å› <code>void</code> æˆ–è€…ä¸€ä¸ªéæµçš„ç»“æœã€‚ä¸Šå›¾ä¸­çš„ <code>forEach</code>å¾ªç¯ å°±æ˜¯ä¸€ä¸ªç»ˆæ­¢æ“ä½œã€‚</li></ul><p>çœ‹å®Œä¸Šé¢çš„æ“ä½œï¼Œæ„Ÿè§‰æ˜¯ä¸æ˜¯å¾ˆåƒä¸€ä¸ªæµæ°´çº¿å¼æ“ä½œå‘¢ã€‚</p><p>å®é™…ä¸Šï¼Œå¤§éƒ¨åˆ†æµæ“ä½œéƒ½æ”¯æŒ lambda è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ï¼Œæ­£ç¡®ç†è§£ï¼Œåº”è¯¥è¯´æ˜¯æ¥å—ä¸€ä¸ªå‡½æ•°å¼æ¥å£çš„å®ç°ä½œä¸ºå‚æ•°ã€‚</p><h2 id="äºŒã€ä¸åŒç±»å‹çš„-Stream-æµ"><a href="#äºŒã€ä¸åŒç±»å‹çš„-Stream-æµ" class="headerlink" title="äºŒã€ä¸åŒç±»å‹çš„ Stream æµ"></a>äºŒã€ä¸åŒç±»å‹çš„ Stream æµ</h2><p>æˆ‘ä»¬å¯ä»¥ä»å„ç§æ•°æ®æºä¸­åˆ›å»º Stream æµï¼Œå…¶ä¸­ä»¥ Collection é›†åˆæœ€ä¸ºå¸¸è§ã€‚å¦‚ <code>List</code> å’Œ <code>Set</code> å‡æ”¯æŒ <code>stream()</code> æ–¹æ³•æ¥åˆ›å»ºé¡ºåºæµæˆ–è€…æ˜¯å¹¶è¡Œæµã€‚</p><p>å¹¶è¡Œæµæ˜¯é€šè¿‡å¤šçº¿ç¨‹çš„æ–¹å¼æ¥æ‰§è¡Œçš„ï¼Œå®ƒèƒ½å¤Ÿå……åˆ†å‘æŒ¥å¤šæ ¸ CPU çš„ä¼˜åŠ¿æ¥æå‡æ€§èƒ½ã€‚æœ¬æ–‡åœ¨æœ€åå†æ¥ä»‹ç»å¹¶è¡Œæµï¼Œæˆ‘ä»¬å…ˆè®¨è®ºé¡ºåºæµï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Arrays.asList(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;a3&quot;</span>)    .stream() <span class="comment">// åˆ›å»ºæµ    .findFirst() // æ‰¾åˆ°ç¬¬ä¸€ä¸ªå…ƒç´     .ifPresent(System.out::println);  // å¦‚æœå­˜åœ¨ï¼Œå³è¾“å‡º</span></span><br><span class="line"><span class="comment">// a1</span></span><br></pre></td></tr></table></figure><p>åœ¨é›†åˆä¸Šè°ƒç”¨ <code>stream()</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ™®é€šçš„ Stream æµã€‚ä½†æ˜¯, æ‚¨å¤§å¯ä¸å¿…åˆ»æ„åœ°åˆ›å»ºä¸€ä¸ªé›†åˆï¼Œå†é€šè¿‡é›†åˆæ¥è·å– Stream æµï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡å¦‚ä¸‹è¿™ç§æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;a3&quot;</span>)    .findFirst()    .ifPresent(System.out::println);  <span class="comment">// a1</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ä¸Šé¢è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Stream.of()</code> ä»ä¸€å †å¯¹è±¡ä¸­åˆ›å»º Stream æµã€‚</p><p>é™¤äº†å¸¸è§„å¯¹è±¡æµä¹‹å¤–ï¼ŒJava 8è¿˜é™„å¸¦äº†ä¸€äº›ç‰¹æ®Šç±»å‹çš„æµï¼Œç”¨äºå¤„ç†åŸå§‹æ•°æ®ç±»å‹ <code>int</code>ï¼Œ <code>long</code>ä»¥åŠ <code>double</code>ã€‚è¯´é“è¿™é‡Œï¼Œä½ å¯èƒ½å·²ç»çŒœåˆ°äº†å®ƒä»¬å°±æ˜¯ <code>IntStream</code>ï¼Œ <code>LongStream</code>è¿˜æœ‰ <code>DoubleStream</code>ã€‚</p><p>å…¶ä¸­ï¼Œ <code>IntStreams.range()</code>æ–¹æ³•è¿˜å¯ä»¥è¢«ç”¨æ¥å–ä»£å¸¸è§„çš„ <code>for</code> å¾ªç¯, å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IntStream.range(<span class="number">1</span>, <span class="number">4</span>)    .forEach(System.out::println); <span class="comment">// ç›¸å½“äº for (int i = 1; i &lt; 4; i++) &#123;&#125;</span></span><br><span class="line"><span class="comment">// 1// 2// 3</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™äº›åŸå§‹ç±»å‹æµçš„å·¥ä½œæ–¹å¼ä¸å¸¸è§„å¯¹è±¡æµåŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼Œä½†è¿˜æ˜¯ç•¥å¾®å­˜åœ¨ä¸€äº›åŒºåˆ«ï¼š</p><ul><li>åŸå§‹ç±»å‹æµä½¿ç”¨å…¶ç‹¬æœ‰çš„å‡½æ•°å¼æ¥å£ï¼Œä¾‹å¦‚ <code>IntFunction</code>ä»£æ›¿ <code>Function</code>ï¼Œ <code>IntPredicate</code>ä»£æ›¿ <code>Predicate</code>ã€‚</li><li>åŸå§‹ç±»å‹æµæ”¯æŒé¢å¤–çš„ç»ˆç«¯èšåˆæ“ä½œï¼Œ <code>sum()</code>ä»¥åŠ <code>average()</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.stream(<span class="keyword">new</span> <span class="title class_">int</span>[] &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)    .map(n -&gt; <span class="number">2</span> * n + <span class="number">1</span>) <span class="comment">// å¯¹æ•°å€¼ä¸­çš„æ¯ä¸ªå¯¹è±¡æ‰§è¡Œ 2*n + 1 æ“ä½œ    .average() // æ±‚å¹³å‡å€¼    .ifPresent(System.out::println);  // å¦‚æœå€¼ä¸ä¸ºç©ºï¼Œåˆ™è¾“å‡º// 5.0</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå¶å°”æˆ‘ä»¬ä¹Ÿæœ‰è¿™ç§éœ€æ±‚ï¼Œéœ€è¦å°†å¸¸è§„å¯¹è±¡æµè½¬æ¢ä¸ºåŸå§‹ç±»å‹æµï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸­é—´æ“ä½œ <code>mapToInt()</code>ï¼Œ <code>mapToLong()</code> ä»¥åŠ <code>mapToDouble</code>å°±æ´¾ä¸Šç”¨åœºäº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;a3&quot;</span>)    .map(s -&gt; s.substring(<span class="number">1</span>)) <span class="comment">// å¯¹æ¯ä¸ªå­—ç¬¦ä¸²å…ƒç´ ä»ä¸‹æ ‡1ä½ç½®å¼€å§‹æˆªå–    .mapToInt(Integer::parseInt) // è½¬æˆ int åŸºç¡€ç±»å‹ç±»å‹æµ    .max() // å–æœ€å¤§å€¼    .ifPresent(System.out::println);  // ä¸ä¸ºç©ºåˆ™è¾“å‡º</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè¯´ï¼Œæ‚¨éœ€è¦å°†åŸå§‹ç±»å‹æµè£…æ¢æˆå¯¹è±¡æµï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>mapToObj()</code>æ¥è¾¾åˆ°ç›®çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IntStream.range(<span class="number">1</span>, <span class="number">4</span>)    .mapToObj(i -&gt; <span class="string">&quot;a&quot;</span> + i) <span class="comment">// for å¾ªç¯ 1-&gt;4, æ‹¼æ¥å‰ç¼€ a    .forEach(System.out::println); // for å¾ªç¯æ‰“å°</span></span><br><span class="line"><span class="comment">// a1// a2// a3</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç»„åˆç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†åŒç²¾åº¦æµé¦–å…ˆè½¬æ¢æˆ <code>int</code> ç±»å‹æµï¼Œç„¶åå†å°†å…¶è£…æ¢æˆå¯¹è±¡æµï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>)    .mapToInt(Double::intValue) <span class="comment">// double ç±»å‹è½¬ int    .mapToObj(i -&gt; &quot;a&quot; + i) // å¯¹å€¼æ‹¼æ¥å‰ç¼€ a    .forEach(System.out::println); // for å¾ªç¯æ‰“å°</span></span><br><span class="line"><span class="comment">// a1// a2// a3</span></span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€Stream-æµçš„å¤„ç†é¡ºåº"><a href="#ä¸‰ã€Stream-æµçš„å¤„ç†é¡ºåº" class="headerlink" title="ä¸‰ã€Stream æµçš„å¤„ç†é¡ºåº"></a>ä¸‰ã€Stream æµçš„å¤„ç†é¡ºåº</h2><p>ä¸Šå°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¦‚ä½•åˆ›å»ºä¸åŒç±»å‹çš„ Stream æµï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ·±å…¥äº†è§£ä¸‹æ•°æ®æµçš„æ‰§è¡Œé¡ºåºã€‚</p><p>åœ¨è®¨è®ºå¤„ç†é¡ºåºä¹‹å‰ï¼Œæ‚¨éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯ä¸­é—´æ“ä½œçš„æœ‰ä¸ªé‡è¦ç‰¹æ€§ â€”â€” <strong>å»¶è¿Ÿæ€§</strong>ã€‚è§‚å¯Ÿä¸‹é¢è¿™ä¸ªæ²¡æœ‰ç»ˆç«¯æ“ä½œçš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)    .filter(s -&gt; &#123;        System.out.println(<span class="string">&quot;filter: &quot;</span> + s);        <span class="keyword">return</span> <span class="literal">true</span>;    &#125;);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ­¤ä»£ç æ®µæ—¶ï¼Œæ‚¨å¯èƒ½ä¼šè®¤ä¸ºï¼Œå°†ä¾æ¬¡æ‰“å° â€œd2â€, â€œa2â€, â€œb1â€, â€œb3â€, â€œcâ€ å…ƒç´ ã€‚ç„¶è€Œå½“ä½ å®é™…å»æ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒä¸ä¼šæ‰“å°ä»»ä½•å†…å®¹ã€‚</p><p><strong>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</strong></p><p>åŸå› æ˜¯ï¼šå½“ä¸”ä»…å½“å­˜åœ¨ç»ˆç«¯æ“ä½œæ—¶ï¼Œä¸­é—´æ“ä½œæ“ä½œæ‰ä¼šè¢«æ‰§è¡Œã€‚</p><p>æ˜¯ä¸æ˜¯ä¸ä¿¡ï¼Ÿæ¥ä¸‹æ¥ï¼Œå¯¹ä¸Šé¢çš„ä»£ç æ·»åŠ  <code>forEach</code>ç»ˆç«¯æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)    .filter(s -&gt; &#123;        System.out.println(<span class="string">&quot;filter: &quot;</span> + s);        <span class="keyword">return</span> <span class="literal">true</span>;    &#125;)    .forEach(s -&gt; System.out.println(<span class="string">&quot;forEach: &quot;</span> + s));</span><br></pre></td></tr></table></figure><p>å†æ¬¡æ‰§è¡Œï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter:  d2forEach: d2filter:  a2forEach: a2filter:  b1forEach: b1filter:  b3forEach: b3filter:  cforEach: c</span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„é¡ºåºå¯èƒ½ä¼šè®©ä½ å¾ˆæƒŠè®¶ï¼ä½ è„‘æµ·é‡Œè‚¯å®šä¼šæƒ³ï¼Œåº”è¯¥æ˜¯å…ˆå°†æ‰€æœ‰ <code>filter</code> å‰ç¼€çš„å­—ç¬¦ä¸²æ‰“å°å‡ºæ¥ï¼Œæ¥ç€æ‰ä¼šæ‰“å° <code>forEach</code> å‰ç¼€çš„å­—ç¬¦ä¸²ã€‚</p><p>äº‹å®ä¸Šï¼Œè¾“å‡ºçš„ç»“æœå´æ˜¯éšç€é“¾æ¡å‚ç›´ç§»åŠ¨çš„ã€‚æ¯”å¦‚è¯´ï¼Œå½“ Stream å¼€å§‹å¤„ç† d2 å…ƒç´ æ—¶ï¼Œå®ƒå®é™…ä¸Šä¼šåœ¨æ‰§è¡Œå®Œ filter æ“ä½œåï¼Œå†æ‰§è¡Œ forEach æ“ä½œï¼Œæ¥ç€æ‰ä¼šå¤„ç†ç¬¬äºŒä¸ªå…ƒç´ ã€‚</p><p>æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Ÿä¸ºä»€ä¹ˆè¦è®¾è®¡æˆè¿™æ ·å‘¢ï¼Ÿ</p><p>åŸå› æ˜¯å‡ºäºæ€§èƒ½çš„è€ƒè™‘ã€‚è¿™æ ·è®¾è®¡å¯ä»¥å‡å°‘å¯¹æ¯ä¸ªå…ƒç´ çš„å®é™…æ“ä½œæ•°ï¼Œçœ‹å®Œä¸‹é¢ä»£ç ä½ å°±æ˜ç™½äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)    .map(s -&gt; &#123;        System.out.println(<span class="string">&quot;map: &quot;</span> + s);        <span class="keyword">return</span> s.toUpperCase(); <span class="comment">// è½¬å¤§å†™    &#125;)    .anyMatch(s -&gt; &#123;        System.out.println(&quot;anyMatch: &quot; + s);        return s.startsWith(&quot;A&quot;); // è¿‡æ»¤å‡ºä»¥ A ä¸ºå‰ç¼€çš„å…ƒç´     &#125;);</span></span><br><span class="line"><span class="comment">// map:      d2// anyMatch: D2// map:      a2// anyMatch: A2</span></span><br></pre></td></tr></table></figure><p>ç»ˆç«¯æ“ä½œ <code>anyMatch()</code>è¡¨ç¤ºä»»ä½•ä¸€ä¸ªå…ƒç´ ä»¥ A ä¸ºå‰ç¼€ï¼Œè¿”å›ä¸º <code>true</code>ï¼Œå°±åœæ­¢å¾ªç¯ã€‚æ‰€ä»¥å®ƒä¼šä» <code>d2</code> å¼€å§‹åŒ¹é…ï¼Œæ¥ç€å¾ªç¯åˆ° <code>a2</code> çš„æ—¶å€™ï¼Œè¿”å›ä¸º <code>true</code> ï¼Œäºæ˜¯åœæ­¢å¾ªç¯ã€‚</p><p>ç”±äºæ•°æ®æµçš„é“¾å¼è°ƒç”¨æ˜¯å‚ç›´æ‰§è¡Œçš„ï¼Œ <code>map</code>è¿™é‡Œåªéœ€è¦æ‰§è¡Œä¸¤æ¬¡ã€‚ç›¸å¯¹äºæ°´å¹³æ‰§è¡Œæ¥è¯´ï¼Œ <code>map</code>ä¼šæ‰§è¡Œå°½å¯èƒ½å°‘çš„æ¬¡æ•°ï¼Œè€Œä¸æ˜¯æŠŠæ‰€æœ‰å…ƒç´ éƒ½ <code>map</code> è½¬æ¢ä¸€éã€‚</p><h2 id="å››ã€ä¸­é—´æ“ä½œé¡ºåºè¿™ä¹ˆé‡è¦ï¼Ÿ"><a href="#å››ã€ä¸­é—´æ“ä½œé¡ºåºè¿™ä¹ˆé‡è¦ï¼Ÿ" class="headerlink" title="å››ã€ä¸­é—´æ“ä½œé¡ºåºè¿™ä¹ˆé‡è¦ï¼Ÿ"></a>å››ã€ä¸­é—´æ“ä½œé¡ºåºè¿™ä¹ˆé‡è¦ï¼Ÿ</h2><p>ä¸‹é¢çš„ä¾‹å­ç”±ä¸¤ä¸ªä¸­é—´æ“ä½œ <code>map</code>å’Œ <code>filter</code>ï¼Œä»¥åŠä¸€ä¸ªç»ˆç«¯æ“ä½œ <code>forEach</code>ç»„æˆã€‚è®©æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™äº›æ“ä½œæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)    .map(s -&gt; &#123;        System.out.println(<span class="string">&quot;map: &quot;</span> + s);        <span class="keyword">return</span> s.toUpperCase(); <span class="comment">// è½¬å¤§å†™    &#125;)    .filter(s -&gt; &#123;        System.out.println(&quot;filter: &quot; + s);        return s.startsWith(&quot;A&quot;); // è¿‡æ»¤å‡ºä»¥ A ä¸ºå‰ç¼€çš„å…ƒç´     &#125;)    .forEach(s -&gt; System.out.println(&quot;forEach: &quot; + s)); // for å¾ªç¯è¾“å‡º</span></span><br><span class="line"><span class="comment">// map:     d2// filter:  D2// map:     a2// filter:  A2// forEach: A2// map:     b1// filter:  B1// map:     b3// filter:  B3// map:     c// filter:  C</span></span><br></pre></td></tr></table></figure><p>å­¦ä¹ äº†ä¸Šé¢ä¸€å°èŠ‚ï¼Œæ‚¨åº”è¯¥å·²ç»çŸ¥é“äº†ï¼Œ <code>map</code>å’Œ <code>filter</code>ä¼šå¯¹é›†åˆä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²è°ƒç”¨äº”æ¬¡ï¼Œè€Œ <code>forEach</code>å´åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œå› ä¸ºåªæœ‰ â€œa2â€ æ»¡è¶³è¿‡æ»¤æ¡ä»¶ã€‚</p><p>å¦‚æœæˆ‘ä»¬æ”¹å˜ä¸­é—´æ“ä½œçš„é¡ºåºï¼Œå°† <code>filter</code>ç§»åŠ¨åˆ°é“¾å¤´çš„æœ€å¼€å§‹ï¼Œå°±å¯ä»¥å¤§å¤§å‡å°‘å®é™…çš„æ‰§è¡Œæ¬¡æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)    .filter(s -&gt; &#123;        System.out.println(<span class="string">&quot;filter: &quot;</span> + s)        <span class="keyword">return</span> s.startsWith(<span class="string">&quot;a&quot;</span>); <span class="comment">// è¿‡æ»¤å‡ºä»¥ a ä¸ºå‰ç¼€çš„å…ƒç´     &#125;)    .map(s -&gt; &#123;        System.out.println(&quot;map: &quot; + s);        return s.toUpperCase(); // è½¬å¤§å†™    &#125;)    .forEach(s -&gt; System.out.println(&quot;forEach: &quot; + s)); // for å¾ªç¯è¾“å‡º</span></span><br><span class="line"><span class="comment">// filter:  d2// filter:  a2// map:     a2// forEach: A2// filter:  b1// filter:  b3// filter:  c</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œ <code>map</code>ä»…ä»…åªéœ€è°ƒç”¨ä¸€æ¬¡ï¼Œæ€§èƒ½å¾—åˆ°äº†æå‡ï¼Œè¿™ç§å°æŠ€å·§å¯¹äºæµä¸­å­˜åœ¨å¤§é‡å…ƒç´ æ¥è¯´ï¼Œæ˜¯éå¸¸å¾ˆæœ‰ç”¨çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç å†æ·»åŠ ä¸€ä¸ªä¸­é—´æ“ä½œ <code>sorted</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)    .sorted((s1, s2) -&gt; &#123;        System.out.printf(<span class="string">&quot;sort: %s; %s\n&quot;</span>, s1, s2);        <span class="keyword">return</span> s1.compareTo(s2); <span class="comment">// æ’åº    &#125;)    .filter(s -&gt; &#123;        System.out.println(&quot;filter: &quot; + s);        return s.startsWith(&quot;a&quot;); // è¿‡æ»¤å‡ºä»¥ a ä¸ºå‰ç¼€çš„å…ƒç´     &#125;)    .map(s -&gt; &#123;        System.out.println(&quot;map: &quot; + s);        return s.toUpperCase(); // è½¬å¤§å†™    &#125;)    .forEach(s -&gt; System.out.println(&quot;forEach: &quot; + s)); // for å¾ªç¯è¾“å‡º</span></span><br></pre></td></tr></table></figure><p><code>sorted</code> æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„æ“ä½œï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œä¿å­˜çŠ¶æ€ä»¥å¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚</p><p>æ‰§è¡Œä¸Šé¢ä»£ç ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort:    a2; d2sort:    b1; a2sort:    b1; d2sort:    b1; a2sort:    b3; b1sort:    b3; d2sort:    c; b3sort:    c; d2filter:  a2map:     a2forEach: A2filter:  b1filter:  b3filter:  cfilter:  d2</span><br></pre></td></tr></table></figure><p>å’¦å’¦å’¦ï¼Ÿè¿™æ¬¡æ€ä¹ˆåˆä¸æ˜¯å‚ç›´æ‰§è¡Œäº†ã€‚ä½ éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œ <code>sorted</code>æ˜¯æ°´å¹³æ‰§è¡Œçš„ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>sorted</code>ä¼šå¯¹é›†åˆä¸­çš„å…ƒç´ ç»„åˆè°ƒç”¨å…«æ¬¡ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨ä¸Šé¢è¯´é“çš„ä¼˜åŒ–æŠ€å·§ï¼Œå°† filter è¿‡æ»¤ä¸­é—´æ“ä½œç§»åŠ¨åˆ°å¼€å¤´éƒ¨åˆ†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)    .filter(s -&gt; &#123;        System.out.println(&quot;filter: &quot; + s);        return s.startsWith(&quot;a&quot;);    &#125;)    .sorted((s1, s2) -&gt; &#123;        System.out.printf(&quot;sort: %s; %s\n&quot;, s1, s2);        return s1.compareTo(s2);    &#125;)    .map(s -&gt; &#123;        System.out.println(&quot;map: &quot; + s);        return s.toUpperCase();    &#125;)    .forEach(s -&gt; System.out.println(&quot;forEach: &quot; + s));</span><br><span class="line">// filter:  d2// filter:  a2// filter:  b1// filter:  b3// filter:  c// map:     a2// forEach: A2</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† <code>sorted</code>ä»æœªè¢«è°ƒç”¨è¿‡ï¼Œå› ä¸ºç»è¿‡ <code>filter</code>è¿‡åçš„å…ƒç´ å·²ç»å‡å°‘åˆ°åªæœ‰ä¸€ä¸ªï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯ä¸ç”¨æ‰§è¡Œæ’åºæ“ä½œçš„ã€‚å› æ­¤æ€§èƒ½è¢«å¤§å¤§æé«˜äº†ã€‚</p><h2 id="äº”ã€æ•°æ®æµå¤ç”¨é—®é¢˜"><a href="#äº”ã€æ•°æ®æµå¤ç”¨é—®é¢˜" class="headerlink" title="äº”ã€æ•°æ®æµå¤ç”¨é—®é¢˜"></a>äº”ã€æ•°æ®æµå¤ç”¨é—®é¢˜</h2><p>Java8 Stream æµæ˜¯ä¸èƒ½è¢«å¤ç”¨çš„ï¼Œä¸€æ—¦ä½ è°ƒç”¨ä»»ä½•ç»ˆç«¯æ“ä½œï¼Œæµå°±ä¼šå…³é—­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;String&gt; stream =    Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)        .filter(s -&gt; s.startsWith(&quot;a&quot;));</span><br><span class="line">stream.anyMatch(s -&gt; true);    // okstream.noneMatch(s -&gt; true);   // exception</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å¯¹ stream è°ƒç”¨äº† <code>anyMatch</code> ç»ˆç«¯æ“ä½œä»¥åï¼Œæµå³å…³é—­äº†ï¼Œå†è°ƒç”¨ <code>noneMatch</code> å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalStateException: stream has already been operated upon or closed    at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:229)    at java.util.stream.ReferencePipeline.noneMatch(ReferencePipeline.java:459)    at com.winterbe.java8.Streams5.test7(Streams5.java:38)    at com.winterbe.java8.Streams5.main(Streams5.java:28)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å…‹æœè¿™ä¸ªé™åˆ¶ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„æ¯ä¸ªç»ˆç«¯æ“ä½œåˆ›å»ºä¸€ä¸ªæ–°çš„æµé“¾ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Supplier</code> æ¥åŒ…è£…ä¸€ä¸‹æµï¼Œé€šè¿‡ <code>get()</code> æ–¹æ³•æ¥æ„å»ºä¸€ä¸ªæ–°çš„ <code>Stream</code> æµï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Supplier&lt;Stream&lt;String&gt;&gt; streamSupplier =    () -&gt; Stream.of(&quot;d2&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;b3&quot;, &quot;c&quot;)            .filter(s -&gt; s.startsWith(&quot;a&quot;));</span><br><span class="line">streamSupplier.get().anyMatch(s -&gt; true);   // okstreamSupplier.get().noneMatch(s -&gt; true);  // ok</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ„é€ ä¸€ä¸ªæ–°çš„æµï¼Œæ¥é¿å¼€æµä¸èƒ½è¢«å¤ç”¨çš„é™åˆ¶, è¿™ä¹Ÿæ˜¯å–å·§çš„ä¸€ç§æ–¹å¼ã€‚</p><h2 id="å…­ã€é«˜çº§æ“ä½œ"><a href="#å…­ã€é«˜çº§æ“ä½œ" class="headerlink" title="å…­ã€é«˜çº§æ“ä½œ"></a>å…­ã€é«˜çº§æ“ä½œ</h2><p><code>Streams</code> æ”¯æŒçš„æ“ä½œå¾ˆä¸°å¯Œï¼Œé™¤äº†ä¸Šé¢ä»‹ç»çš„è¿™äº›æ¯”è¾ƒå¸¸ç”¨çš„ä¸­é—´æ“ä½œï¼Œå¦‚ <code>filter</code>æˆ– <code>map</code>ï¼ˆå‚è§Stream Javadocï¼‰å¤–ã€‚è¿˜æœ‰ä¸€äº›æ›´å¤æ‚çš„æ“ä½œï¼Œå¦‚ <code>collect</code>ï¼Œ <code>flatMap</code>ä»¥åŠ <code>reduce</code>ã€‚æ¥ä¸‹æ¥ï¼Œå°±è®©æˆ‘ä»¬å­¦ä¹ ä¸€ä¸‹ï¼š</p><p>æœ¬å°èŠ‚ä¸­çš„å¤§å¤šæ•°ä»£ç ç¤ºä¾‹å‡ä¼šä½¿ç”¨ä»¥ä¸‹ <code>List&lt;Person&gt;</code>è¿›è¡Œæ¼”ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;    String name;    int age;</span><br><span class="line">    Person(String name, int age) &#123;        this.name = name;        this.age = age;    &#125;</span><br><span class="line">    @Override    public String toString() &#123;        return name;    &#125;&#125;</span><br><span class="line">// æ„å»ºä¸€ä¸ª Person é›†åˆList&lt;Person&gt; persons =    Arrays.asList(        new Person(&quot;Max&quot;, 18),        new Person(&quot;Peter&quot;, 23),        new Person(&quot;Pamela&quot;, 23),        new Person(&quot;David&quot;, 12));</span><br></pre></td></tr></table></figure><h3 id="6-1-Collect"><a href="#6-1-Collect" class="headerlink" title="6.1 Collect"></a>6.1 Collect</h3><p>collect æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç»ˆç«¯æ“ä½œï¼Œå®ƒå¯ä»¥å°†æµä¸­çš„å…ƒç´ è½¬å˜æˆå¦å¤–ä¸€ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œä¾‹å¦‚ä¸€ä¸ª <code>List</code>ï¼Œ <code>Set</code>æˆ– <code>Map</code>ã€‚collect æ¥å—å…¥å‚ä¸º <code>Collector</code>ï¼ˆæ”¶é›†å™¨ï¼‰ï¼Œå®ƒç”±å››ä¸ªä¸åŒçš„æ“ä½œç»„æˆï¼šä¾›åº”å™¨ï¼ˆsupplierï¼‰ã€ç´¯åŠ å™¨ï¼ˆaccumulatorï¼‰ã€ç»„åˆå™¨ï¼ˆcombinerï¼‰å’Œç»ˆæ­¢å™¨ï¼ˆfinisherï¼‰ã€‚</p><p>è¿™äº›éƒ½æ˜¯ä¸ªå•¥ï¼Ÿåˆ«æ…Œï¼Œçœ‹ä¸Šå»éå¸¸å¤æ‚çš„æ ·å­ï¼Œä½†å¥½åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨å¹¶ä¸éœ€è¦è‡ªå·±å»å®ç°æ”¶é›†å™¨ã€‚å› ä¸º Java 8é€šè¿‡ <code>Collectors</code>ç±»å†…ç½®äº†å„ç§å¸¸ç”¨çš„æ”¶é›†å™¨ï¼Œä½ ç›´æ¥æ‹¿æ¥ç”¨å°±è¡Œäº†ã€‚</p><p>è®©æˆ‘ä»¬å…ˆä»ä¸€ä¸ªéå¸¸å¸¸è§çš„ç”¨ä¾‹å¼€å§‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Person&gt; filtered =    persons        .stream() // æ„å»ºæµ        .filter(p -&gt; p.name.startsWith(&quot;P&quot;)) // è¿‡æ»¤å‡ºåå­—ä»¥ P å¼€å¤´çš„        .collect(Collectors.toList()); // ç”Ÿæˆä¸€ä¸ªæ–°çš„ List</span><br><span class="line">System.out.println(filtered);    // [Peter, Pamela]</span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿçœ‹åˆ°äº†ï¼Œä»æµä¸­æ„é€ ä¸€ä¸ª <code>List</code> å¼‚å¸¸ç®€å•ã€‚å¦‚æœè¯´ä½ éœ€è¦æ„é€ ä¸€ä¸ª <code>Set</code> é›†åˆï¼Œåªéœ€è¦ä½¿ç”¨ <code>Collectors.toSet()</code>å°±å¯ä»¥äº†ã€‚</p><p>æ¥ä¸‹æ¥è¿™ä¸ªç¤ºä¾‹ï¼Œå°†ä¼šæŒ‰å¹´é¾„å¯¹æ‰€æœ‰äººè¿›è¡Œåˆ†ç»„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, List&lt;Person&gt;&gt; personsByAge = persons    .stream()    .collect(Collectors.groupingBy(p -&gt; p.age)); // ä»¥å¹´é¾„ä¸º key,è¿›è¡Œåˆ†ç»„</span><br><span class="line">personsByAge    .forEach((age, p) -&gt; System.out.format(&quot;age %s: %s\n&quot;, age, p));</span><br><span class="line">// age 18: [Max]// age 23: [Peter, Pamela]// age 12: [David]</span><br></pre></td></tr></table></figure><p>é™¤äº†ä¸Šé¢è¿™äº›æ“ä½œã€‚æ‚¨è¿˜å¯ä»¥åœ¨æµä¸Šæ‰§è¡Œèšåˆæ“ä½œï¼Œä¾‹å¦‚ï¼Œè®¡ç®—æ‰€æœ‰äººçš„å¹³å‡å¹´é¾„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Double averageAge = persons    .stream()    .collect(Collectors.averagingInt(p -&gt; p.age)); // èšåˆå‡ºå¹³å‡å¹´é¾„</span><br><span class="line">System.out.println(averageAge);     // 19.0</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨è¿˜æƒ³å¾—åˆ°ä¸€ä¸ªæ›´å…¨é¢çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ‘˜è¦æ”¶é›†å™¨å¯ä»¥è¿”å›ä¸€ä¸ªç‰¹æ®Šçš„å†…ç½®ç»Ÿè®¡å¯¹è±¡ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è®¡ç®—å‡ºæœ€å°å¹´é¾„ã€æœ€å¤§å¹´é¾„ã€å¹³å‡å¹´é¾„ã€æ€»å’Œä»¥åŠæ€»æ•°é‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IntSummaryStatistics ageSummary =    persons        .stream()        .collect(Collectors.summarizingInt(p -&gt; p.age)); // ç”Ÿæˆæ‘˜è¦ç»Ÿè®¡</span><br><span class="line">System.out.println(ageSummary);// IntSummaryStatistics&#123;count=4, sum=76, min=12, average=19.000000, max=23&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹ä¸€ä¸ªè¿™ä¸ªç¤ºä¾‹ï¼Œå¯ä»¥å°†æ‰€æœ‰äººåè¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String phrase = persons    .stream()    .filter(p -&gt; p.age &gt;= 18) // è¿‡æ»¤å‡ºå¹´é¾„å¤§äºç­‰äº18çš„    .map(p -&gt; p.name) // æå–åå­—    .collect(Collectors.joining(&quot; and &quot;, &quot;In Germany &quot;, &quot; are of legal age.&quot;)); // ä»¥ In Germany å¼€å¤´ï¼Œand è¿æ¥å„å…ƒç´ ï¼Œå†ä»¥ are of legal age. ç»“æŸ</span><br><span class="line">System.out.println(phrase);// In Germany Max and Peter and Pamela are of legal age.</span><br></pre></td></tr></table></figure><p>è¿æ¥æ”¶é›†å™¨çš„å…¥å‚æ¥å—åˆ†éš”ç¬¦ï¼Œä»¥åŠå¯é€‰çš„å‰ç¼€ä»¥åŠåç¼€ã€‚</p><p>å¯¹äºå¦‚ä½•å°†æµè½¬æ¢ä¸º <code>Map</code>é›†åˆï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®š <code>Map</code> çš„é”®å’Œå€¼ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ <code>Map</code> çš„é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>IllegalStateException</code> å¼‚å¸¸ã€‚</p><p>ä½ å¯ä»¥é€‰æ‹©ä¼ é€’ä¸€ä¸ªåˆå¹¶å‡½æ•°ä½œä¸ºé¢å¤–çš„å‚æ•°æ¥é¿å…å‘ç”Ÿè¿™ä¸ªå¼‚å¸¸:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, String&gt; map = persons    .stream()    .collect(Collectors.toMap(        p -&gt; p.age,        p -&gt; p.name,        (name1, name2) -&gt; name1 + &quot;;&quot; + name2)); // å¯¹äºåŒæ · key çš„ï¼Œå°†å€¼æ‹¼æ¥</span><br><span class="line">System.out.println(map);// &#123;18=Max, 23=Peter;Pamela, 12=David&#125;</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“äº†è¿™äº›å¼ºå¤§çš„å†…ç½®æ”¶é›†å™¨ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬å°è¯•æ„å»ºè‡ªå®šä¹‰æ”¶é›†å™¨å§ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æµä¸­çš„æ‰€æœ‰äººè½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒ…å«æ‰€æœ‰å¤§å†™çš„åç§°ï¼Œå¹¶ä»¥ <code>|</code>åˆ†å‰²ã€‚ä¸ºäº†è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ <code>Collector.of()</code>åˆ›å»ºä¸€ä¸ªæ–°çš„æ”¶é›†å™¨ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¼ å…¥æ”¶é›†å™¨çš„å››ä¸ªç»„æˆéƒ¨åˆ†ï¼šä¾›åº”å™¨ã€ç´¯åŠ å™¨ã€ç»„åˆå™¨å’Œç»ˆæ­¢å™¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Collector&lt;Person, StringJoiner, String&gt; personNameCollector =    Collector.of(        () -&gt; new StringJoiner(&quot; | &quot;),          // supplier ä¾›åº”å™¨        (j, p) -&gt; j.add(p.name.toUpperCase()),  // accumulator ç´¯åŠ å™¨        (j1, j2) -&gt; j1.merge(j2),               // combiner ç»„åˆå™¨        StringJoiner::toString);                // finisher ç»ˆæ­¢å™¨</span><br><span class="line">String names = persons    .stream()    .collect(personNameCollector); // ä¼ å…¥è‡ªå®šä¹‰çš„æ”¶é›†å™¨</span><br><span class="line">System.out.println(names);  // MAX | PETER | PAMELA | DAVID</span><br></pre></td></tr></table></figure><p>ç”±äºJava ä¸­çš„å­—ç¬¦ä¸²æ˜¯ final ç±»å‹çš„ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©è¾…åŠ©ç±» <code>StringJoiner</code>ï¼Œæ¥å¸®æˆ‘ä»¬æ„é€ å­—ç¬¦ä¸²ã€‚</p><p>æœ€å¼€å§‹ä¾›åº”å™¨ä½¿ç”¨åˆ†éš”ç¬¦æ„é€ äº†ä¸€ä¸ª <code>StringJointer</code>ã€‚</p><p>ç´¯åŠ å™¨ç”¨äºå°†æ¯ä¸ªäººçš„äººåè½¬å¤§å†™ï¼Œç„¶ååŠ åˆ° <code>StringJointer</code>ä¸­ã€‚</p><p>ç»„åˆå™¨å°†ä¸¤ä¸ª <code>StringJointer</code>åˆå¹¶ä¸ºä¸€ä¸ªã€‚</p><p>æœ€ç»ˆï¼Œç»ˆç»“å™¨ä» <code>StringJointer</code>æ„é€ å‡ºé¢„æœŸçš„å­—ç¬¦ä¸²ã€‚</p><h3 id="6-2-FlatMap"><a href="#6-2-FlatMap" class="headerlink" title="6.2 FlatMap"></a>6.2 FlatMap</h3><p>ä¸Šé¢æˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¦‚é€šè¿‡ <code>map</code>æ“ä½œ, å°†æµä¸­çš„å¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚ä½†æ˜¯ï¼Œ <code>Map</code>åªèƒ½å°†æ¯ä¸ªå¯¹è±¡æ˜ å°„åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>å¦‚æœè¯´ï¼Œæˆ‘ä»¬æƒ³è¦å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¤šä¸ªå…¶ä»–å¯¹è±¡æˆ–è€…æ ¹æœ¬ä¸åšè½¬æ¢æ“ä½œå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™ï¼Œ <code>flatMap</code>å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><p><code>FlatMap</code> èƒ½å¤Ÿå°†æµçš„æ¯ä¸ªå…ƒç´ , è½¬æ¢ä¸ºå…¶ä»–å¯¹è±¡çš„æµã€‚å› æ­¤ï¼Œæ¯ä¸ªå¯¹è±¡å¯ä»¥è¢«è½¬æ¢ä¸ºé›¶ä¸ªï¼Œä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–å¯¹è±¡ï¼Œå¹¶ä»¥æµçš„æ–¹å¼è¿”å›ã€‚ä¹‹åï¼Œè¿™äº›æµçš„å†…å®¹ä¼šè¢«æ”¾å…¥ <code>flatMap</code>è¿”å›çš„æµä¸­ã€‚</p><p>åœ¨å­¦ä¹ å¦‚ä½•å®é™…æ“ä½œ <code>flatMap</code>ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ–°å»ºä¸¤ä¸ªç±»ï¼Œç”¨æ¥æµ‹è¯•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Foo &#123;    String name;    List&lt;Bar&gt; bars = new ArrayList&lt;&gt;();</span><br><span class="line">    Foo(String name) &#123;        this.name = name;    &#125;&#125;</span><br><span class="line">class Bar &#123;    String name;</span><br><span class="line">    Bar(String name) &#123;        this.name = name;    &#125;&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡æˆ‘ä»¬ä¸Šé¢å­¦ä¹ åˆ°çš„æµçŸ¥è¯†ï¼Œæ¥å®ä¾‹åŒ–ä¸€äº›å¯¹è±¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Foo&gt; foos = new ArrayList&lt;&gt;();</span><br><span class="line">// åˆ›å»º foos é›†åˆIntStream    .range(1, 4)    .forEach(i -&gt; foos.add(new Foo(&quot;Foo&quot; + i)));</span><br><span class="line">// åˆ›å»º bars é›†åˆfoos.forEach(f -&gt;    IntStream        .range(1, 4)        .forEach(i -&gt; f.bars.add(new Bar(&quot;Bar&quot; + i + &quot; &lt;- &quot; + f.name))));</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ›å»ºäº†åŒ…å«ä¸‰ä¸ª <code>foo</code>çš„é›†åˆï¼Œæ¯ä¸ª <code>foo</code>ä¸­åˆåŒ…å«ä¸‰ä¸ª <code>bar</code>ã€‚</p><p><code>flatMap</code> çš„å…¥å‚æ¥å—ä¸€ä¸ªè¿”å›å¯¹è±¡æµçš„å‡½æ•°ã€‚ä¸ºäº†å¤„ç†æ¯ä¸ª <code>foo</code>ä¸­çš„ <code>bar</code>ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥ç›¸åº” stream æµï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foos.stream()    .flatMap(f -&gt; f.bars.stream())    .forEach(b -&gt; System.out.println(b.name));</span><br><span class="line">// Bar1 &lt;- Foo1// Bar2 &lt;- Foo1// Bar3 &lt;- Foo1// Bar1 &lt;- Foo2// Bar2 &lt;- Foo2// Bar3 &lt;- Foo2// Bar1 &lt;- Foo3// Bar2 &lt;- Foo3// Bar3 &lt;- Foo3</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬å·²æˆåŠŸå°†ä¸‰ä¸ª <code>foo</code>å¯¹è±¡çš„æµè½¬æ¢ä¸ºä¹ä¸ª <code>bar</code>å¯¹è±¡çš„æµã€‚</p><p>æœ€åï¼Œä¸Šé¢çš„è¿™æ®µä»£ç å¯ä»¥ç®€åŒ–ä¸ºå•ä¸€çš„æµå¼æ“ä½œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IntStream.range(1, 4)    .mapToObj(i -&gt; new Foo(&quot;Foo&quot; + i))    .peek(f -&gt; IntStream.range(1, 4)        .mapToObj(i -&gt; new Bar(&quot;Bar&quot; + i + &quot; &lt;- &quot; f.name))        .forEach(f.bars::add))    .flatMap(f -&gt; f.bars.stream())    .forEach(b -&gt; System.out.println(b.name));</span><br></pre></td></tr></table></figure><p><code>flatMap</code>ä¹Ÿå¯ç”¨äºJava8å¼•å…¥çš„ <code>Optional</code>ç±»ã€‚<code>Optional</code>çš„ <code>flatMap</code>æ“ä½œè¿”å›ä¸€ä¸ª <code>Optional</code>æˆ–å…¶ä»–ç±»å‹çš„å¯¹è±¡ã€‚æ‰€ä»¥å®ƒå¯ä»¥ç”¨äºé¿å…ç¹ççš„ <code>null</code>æ£€æŸ¥ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå±‚æ¬¡æ›´æ·±çš„å¯¹è±¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Outer &#123;    Nested nested;&#125;</span><br><span class="line">class Nested &#123;    Inner inner;&#125;</span><br><span class="line">class Inner &#123;    String foo;&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å¤„ç†ä» Outer å¯¹è±¡ä¸­è·å–æœ€åº•å±‚çš„ foo å­—ç¬¦ä¸²ï¼Œä½ éœ€è¦æ·»åŠ å¤šä¸ª <code>null</code>æ£€æŸ¥æ¥é¿å…å¯èƒ½å‘ç”Ÿçš„ <code>NullPointerException</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Outer outer = new Outer();if (outer != null &amp;&amp; outer.nested != null &amp;&amp; outer.nested.inner != null) &#123;    System.out.println(outer.nested.inner.foo);&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>Optional</code>çš„ <code>flatMap</code>æ“ä½œï¼Œæ¥å®Œæˆä¸Šè¿°ç›¸åŒåŠŸèƒ½çš„åˆ¤æ–­ï¼Œä¸”æ›´åŠ ä¼˜é›…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional.of(new Outer())    .flatMap(o -&gt; Optional.ofNullable(o.nested))    .flatMap(n -&gt; Optional.ofNullable(n.inner))    .flatMap(i -&gt; Optional.ofNullable(i.foo))    .ifPresent(System.out::println);</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œæ¯ä¸ª <code>flatMap</code>çš„è°ƒç”¨éƒ½ä¼šè¿”å›é¢„æœŸå¯¹è±¡çš„ <code>Optional</code>åŒ…è£…ï¼Œå¦åˆ™è¿”å›ä¸º <code>null</code>çš„ <code>Optional</code>åŒ…è£…ç±»ã€‚</p><blockquote><p>ç¬”è€…è¡¥å……ï¼šå…³äº Optional å¯å‚è§æˆ‘å¦ä¸€ç¯‡è¯‘æ–‡ã€Š<a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU4MDUyMDQyNQ==&mid=2247483709&idx=1&sn=95e60956cd8e4946dda33ff0aebb93dc&chksm=fd54d1bbca2358ada7a3db7ddff10be62497b711dbb6409b47c1bc3f0cfc0ef6e95d11c45f76&scene=21#wechat_redirect">å¦‚ä½•åœ¨ Java8 ä¸­é£éªšèµ°ä½é¿å¼€ç©ºæŒ‡é’ˆå¼‚å¸¸</a>ã€‹</p></blockquote><h3 id="6-3-Reduce"><a href="#6-3-Reduce" class="headerlink" title="6.3 Reduce"></a>6.3 Reduce</h3><p>è§„çº¦æ“ä½œå¯ä»¥å°†æµçš„æ‰€æœ‰å…ƒç´ ç»„åˆæˆä¸€ä¸ªç»“æœã€‚Java 8 æ”¯æŒä¸‰ç§ä¸åŒçš„ <code>reduce</code>æ–¹æ³•ã€‚ç¬¬ä¸€ç§å°†æµä¸­çš„å…ƒç´ è§„çº¦æˆæµä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæ¥ç­›é€‰å‡ºå¹´é¾„æœ€å¤§çš„é‚£ä¸ªäººï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">persons    .stream()    .reduce((p1, p2) -&gt; p1.age &gt; p2.age ? p1 : p2)    .ifPresent(System.out::println);    // Pamela</span><br></pre></td></tr></table></figure><p><code>reduce</code>æ–¹æ³•æ¥å— <code>BinaryOperator</code>ç§¯ç´¯å‡½æ•°ã€‚è¯¥å‡½æ•°å®é™…ä¸Šæ˜¯ä¸¤ä¸ªæ“ä½œæ•°ç±»å‹ç›¸åŒçš„ <code>BiFunction</code>ã€‚<code>BiFunction</code>åŠŸèƒ½å’Œ <code>Function</code>ä¸€æ ·ï¼Œä½†æ˜¯å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒä¸¤ä¸ªäººçš„å¹´é¾„ï¼Œæ¥è¿”å›å¹´é¾„è¾ƒå¤§çš„äººã€‚</p><p>ç¬¬äºŒç§ <code>reduce</code>æ–¹æ³•æ¥å—æ ‡è¯†å€¼å’Œ <code>BinaryOperator</code>ç´¯åŠ å™¨ã€‚æ­¤æ–¹æ³•å¯ç”¨äºæ„é€ ä¸€ä¸ªæ–°çš„ <code>Person</code>ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ªæµä¸­æ‰€æœ‰å…¶ä»–äººçš„èšåˆåç§°å’Œå¹´é¾„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Person result =    persons        .stream()        .reduce(new Person(&quot;&quot;, 0), (p1, p2) -&gt; &#123;            p1.age += p2.age;            p1.name += p2.name;            return p1;        &#125;);</span><br><span class="line">System.out.format(&quot;name=%s; age=%s&quot;, result.name, result.age);// name=MaxPeterPamelaDavid; age=76</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ç§ <code>reduce</code>æ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šæ ‡è¯†å€¼ï¼Œ <code>BiFunction</code>ç´¯åŠ å™¨å’Œç±»å‹çš„ç»„åˆå™¨å‡½æ•° <code>BinaryOperator</code>ã€‚ç”±äºåˆå§‹å€¼çš„ç±»å‹ä¸ä¸€å®šä¸º <code>Person</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå½’çº¦å‡½æ•°æ¥è®¡ç®—æ‰€æœ‰äººçš„å¹´é¾„æ€»å’Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer ageSum = persons    .stream()    .reduce(0, (sum, p) -&gt; sum += p.age, (sum1, sum2) -&gt; sum1 + sum2);</span><br><span class="line">System.out.println(ageSum);  // 76</span><br></pre></td></tr></table></figure><p>ç»“æœä¸º76ï¼Œä½†æ˜¯å†…éƒ¨ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿè®©æˆ‘ä»¬å†æ‰“å°ä¸€äº›è°ƒè¯•æ—¥å¿—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer ageSum = persons    .stream()    .reduce(0,        (sum, p) -&gt; &#123;            System.out.format(&quot;accumulator: sum=%s; person=%s\n&quot;, sum, p);            return sum += p.age;        &#125;,        (sum1, sum2) -&gt; &#123;            System.out.format(&quot;combiner: sum1=%s; sum2=%s\n&quot;, sum1, sum2);            return sum1 + sum2;        &#125;);</span><br><span class="line">// accumulator: sum=0; person=Max// accumulator: sum=18; person=Peter// accumulator: sum=41; person=Pamela// accumulator: sum=64; person=David</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œç´¯åŠ å™¨å‡½æ•°å®Œæˆäº†æ‰€æœ‰å·¥ä½œã€‚å®ƒé¦–å…ˆä½¿ç”¨åˆå§‹å€¼ <code>0</code>å’Œç¬¬ä¸€ä¸ªäººå¹´é¾„ç›¸åŠ ã€‚æ¥ä¸‹æ¥çš„ä¸‰æ­¥ä¸­ <code>sum</code>ä¼šæŒç»­å¢åŠ ï¼Œç›´åˆ°76ã€‚</p><p>ç­‰ç­‰ï¼Ÿå¥½åƒå“ªé‡Œä¸å¤ªå¯¹ï¼ç»„åˆå™¨ä»æ¥éƒ½æ²¡æœ‰è°ƒç”¨è¿‡å•Šï¼Ÿ</p><p>æˆ‘ä»¬ä»¥å¹¶è¡Œæµçš„æ–¹å¼è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œçœ‹çœ‹æ—¥å¿—è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer ageSum = persons    .parallelStream()    .reduce(0,        (sum, p) -&gt; &#123;            System.out.format(&quot;accumulator: sum=%s; person=%s\n&quot;, sum, p);            return sum += p.age;        &#125;,        (sum1, sum2) -&gt; &#123;            System.out.format(&quot;combiner: sum1=%s; sum2=%s\n&quot;, sum1, sum2);            return sum1 + sum2;        &#125;);</span><br><span class="line">// accumulator: sum=0; person=Pamela// accumulator: sum=0; person=David// accumulator: sum=0; person=Max// accumulator: sum=0; person=Peter// combiner: sum1=18; sum2=23// combiner: sum1=23; sum2=12// combiner: sum1=41; sum2=35</span><br></pre></td></tr></table></figure><p>å¹¶è¡Œæµçš„æ‰§è¡Œæ–¹å¼å®Œå…¨ä¸åŒã€‚è¿™é‡Œç»„åˆå™¨è¢«è°ƒç”¨äº†ã€‚å®é™…ä¸Šï¼Œç”±äºç´¯åŠ å™¨è¢«å¹¶è¡Œè°ƒç”¨ï¼Œç»„åˆå™¨éœ€è¦è¢«ç”¨äºè®¡ç®—éƒ¨åˆ†ç´¯åŠ å€¼çš„æ€»å’Œã€‚</p><p>è®©æˆ‘ä»¬åœ¨ä¸‹ä¸€ç« æ·±å…¥æ¢è®¨å¹¶è¡Œæµã€‚</p><h2 id="ä¸ƒã€å¹¶è¡Œæµ"><a href="#ä¸ƒã€å¹¶è¡Œæµ" class="headerlink" title="ä¸ƒã€å¹¶è¡Œæµ"></a>ä¸ƒã€å¹¶è¡Œæµ</h2><p>æµæ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„ï¼Œå½“æµä¸­å­˜åœ¨å¤§é‡å…ƒç´ æ—¶ï¼Œå¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚å¹¶è¡Œæµåº•å±‚ä½¿ç”¨çš„ <code>ForkJoinPool</code>, å®ƒç”± <code>ForkJoinPool.commonPool()</code>æ–¹æ³•æä¾›ã€‚åº•å±‚çº¿ç¨‹æ± çš„å¤§å°æœ€å¤šä¸ºäº”ä¸ª - å…·ä½“å–å†³äº CPU å¯ç”¨æ ¸å¿ƒæ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ForkJoinPool commonPool = ForkJoinPool.commonPool();System.out.println(commonPool.getParallelism());    // 3</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œå…¬å…±æ± åˆå§‹åŒ–é»˜è®¤å€¼ä¸º 3ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®ä»¥ä¸‹JVMå‚æ•°å¯ä»¥å‡å°æˆ–å¢åŠ æ­¤å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Djava.util.concurrent.ForkJoinPool.common.parallelism=5</span><br></pre></td></tr></table></figure><p>é›†åˆæ”¯æŒ <code>parallelStream()</code>æ–¹æ³•æ¥åˆ›å»ºå…ƒç´ çš„å¹¶è¡Œæµã€‚æˆ–è€…ä½ å¯ä»¥åœ¨å·²å­˜åœ¨çš„æ•°æ®æµä¸Šè°ƒç”¨ä¸­é—´æ–¹æ³• <code>parallel()</code>ï¼Œå°†ä¸²è¡Œæµè½¬æ¢ä¸ºå¹¶è¡Œæµï¼Œè¿™ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>ä¸ºäº†è¯¦ç»†äº†è§£å¹¶è¡Œæµçš„æ‰§è¡Œè¡Œä¸ºï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæ‰“å°å½“å‰çº¿ç¨‹çš„ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.asList(&quot;a1&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;c2&quot;, &quot;c1&quot;)    .parallelStream()    .filter(s -&gt; &#123;        System.out.format(&quot;filter: %s [%s]\n&quot;,            s, Thread.currentThread().getName());        return true;    &#125;)    .map(s -&gt; &#123;        System.out.format(&quot;map: %s [%s]\n&quot;,            s, Thread.currentThread().getName());        return s.toUpperCase();    &#125;)    .forEach(s -&gt; System.out.format(&quot;forEach: %s [%s]\n&quot;,        s, Thread.currentThread().getName()));</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ—¥å¿—è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å“ªä¸ªçº¿ç¨‹è¢«ç”¨äºæ‰§è¡Œæµå¼æ“ä½œï¼Œæœ‰ä¸ªæ›´æ·±å…¥çš„ç†è§£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter:  b1 [main]filter:  a2 [ForkJoinPool.commonPool-worker-1]map:     a2 [ForkJoinPool.commonPool-worker-1]filter:  c2 [ForkJoinPool.commonPool-worker-3]map:     c2 [ForkJoinPool.commonPool-worker-3]filter:  c1 [ForkJoinPool.commonPool-worker-2]map:     c1 [ForkJoinPool.commonPool-worker-2]forEach: C2 [ForkJoinPool.commonPool-worker-3]forEach: A2 [ForkJoinPool.commonPool-worker-1]map:     b1 [main]forEach: B1 [main]filter:  a1 [ForkJoinPool.commonPool-worker-3]map:     a1 [ForkJoinPool.commonPool-worker-3]forEach: A1 [ForkJoinPool.commonPool-worker-3]forEach: C1 [ForkJoinPool.commonPool-worker-2]</span><br></pre></td></tr></table></figure><p>å¦‚æ‚¨æ‰€è§ï¼Œå¹¶è¡Œæµä½¿ç”¨äº†æ‰€æœ‰çš„ <code>ForkJoinPool</code>ä¸­çš„å¯ç”¨çº¿ç¨‹æ¥æ‰§è¡Œæµå¼æ“ä½œã€‚åœ¨æŒç»­çš„è¿è¡Œä¸­ï¼Œè¾“å‡ºç»“æœå¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå› ä¸ºæ‰€ä½¿ç”¨çš„ç‰¹å®šçº¿ç¨‹æ˜¯éç‰¹å®šçš„ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡æ·»åŠ ä¸­é—´æ“ä½œ <code>sort</code>æ¥æ‰©å±•ä¸Šé¢ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.asList(&quot;a1&quot;, &quot;a2&quot;, &quot;b1&quot;, &quot;c2&quot;, &quot;c1&quot;)    .parallelStream()    .filter(s -&gt; &#123;        System.out.format(&quot;filter: %s [%s]\n&quot;,            s, Thread.currentThread().getName());        return true;    &#125;)    .map(s -&gt; &#123;        System.out.format(&quot;map: %s [%s]\n&quot;,            s, Thread.currentThread().getName());        return s.toUpperCase();    &#125;)    .sorted((s1, s2) -&gt; &#123;        System.out.format(&quot;sort: %s &lt;&gt; %s [%s]\n&quot;,            s1, s2, Thread.currentThread().getName());        return s1.compareTo(s2);    &#125;)    .forEach(s -&gt; System.out.format(&quot;forEach: %s [%s]\n&quot;,        s, Thread.currentThread().getName()));</span><br></pre></td></tr></table></figure><p>è¿è¡Œä»£ç ï¼Œè¾“å‡ºç»“æœçœ‹ä¸Šå»æœ‰äº›å¥‡æ€ªï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter:  c2 [ForkJoinPool.commonPool-worker-3]filter:  c1 [ForkJoinPool.commonPool-worker-2]map:     c1 [ForkJoinPool.commonPool-worker-2]filter:  a2 [ForkJoinPool.commonPool-worker-1]map:     a2 [ForkJoinPool.commonPool-worker-1]filter:  b1 [main]map:     b1 [main]filter:  a1 [ForkJoinPool.commonPool-worker-2]map:     a1 [ForkJoinPool.commonPool-worker-2]map:     c2 [ForkJoinPool.commonPool-worker-3]sort:    A2 &lt;&gt; A1 [main]sort:    B1 &lt;&gt; A2 [main]sort:    C2 &lt;&gt; B1 [main]sort:    C1 &lt;&gt; C2 [main]sort:    C1 &lt;&gt; B1 [main]sort:    C1 &lt;&gt; C2 [main]forEach: A1 [ForkJoinPool.commonPool-worker-1]forEach: C2 [ForkJoinPool.commonPool-worker-3]forEach: B1 [main]forEach: A2 [ForkJoinPool.commonPool-worker-2]forEach: C1 [ForkJoinPool.commonPool-worker-1]</span><br></pre></td></tr></table></figure><p>è²Œä¼¼ <code>sort</code>åªåœ¨ä¸»çº¿ç¨‹ä¸Šä¸²è¡Œæ‰§è¡Œã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œå¹¶è¡Œæµä¸­çš„ <code>sort</code>åœ¨åº•å±‚ä½¿ç”¨äº†Java8ä¸­æ–°çš„æ–¹æ³• <code>Arrays.parallelSort()</code>ã€‚å¦‚ javadocå®˜æ–¹æ–‡æ¡£è§£é‡Šçš„ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŒ‰ç…§æ•°æ®é•¿åº¦æ¥å†³å®šä»¥ä¸²è¡Œæ–¹å¼ï¼Œæˆ–è€…ä»¥å¹¶è¡Œçš„æ–¹å¼æ¥æ‰§è¡Œã€‚</p><blockquote><p>å¦‚æœæŒ‡å®šæ•°æ®çš„é•¿åº¦å°äºæœ€å°æ•°å€¼ï¼Œå®ƒåˆ™ä½¿ç”¨ç›¸åº”çš„ <code>Arrays.sort</code>æ–¹æ³•æ¥è¿›è¡Œæ’åºã€‚</p></blockquote><p>å›åˆ°ä¸Šå°èŠ‚ <code>reduce</code>çš„ä¾‹å­ã€‚æˆ‘ä»¬å·²ç»å‘ç°äº†ç»„åˆå™¨å‡½æ•°åªåœ¨å¹¶è¡Œæµä¸­è°ƒç”¨ï¼Œè€Œä¸ä¸ä¼šåœ¨ä¸²è¡Œæµä¸­è¢«è°ƒç”¨ã€‚</p><p>è®©æˆ‘ä»¬æ¥å®é™…è§‚å¯Ÿä¸€ä¸‹æ¶‰åŠåˆ°å“ªä¸ªçº¿ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Person&gt; persons = Arrays.asList(    new Person(&quot;Max&quot;, 18),    new Person(&quot;Peter&quot;, 23),    new Person(&quot;Pamela&quot;, 23),    new Person(&quot;David&quot;, 12));</span><br><span class="line">persons    .parallelStream()    .reduce(0,        (sum, p) -&gt; &#123;            System.out.format(&quot;accumulator: sum=%s; person=%s [%s]\n&quot;,                sum, p, Thread.currentThread().getName());            return sum += p.age;        &#125;,        (sum1, sum2) -&gt; &#123;            System.out.format(&quot;combiner: sum1=%s; sum2=%s [%s]\n&quot;,                sum1, sum2, Thread.currentThread().getName());            return sum1 + sum2;        &#125;);</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ§åˆ¶å°æ—¥å¿—è¾“å‡ºï¼Œç´¯åŠ å™¨å’Œç»„åˆå™¨å‡åœ¨æ‰€æœ‰å¯ç”¨çš„çº¿ç¨‹ä¸Šå¹¶è¡Œæ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accumulator: sum=0; person=Pamela; [main]accumulator: sum=0; person=Max;    [ForkJoinPool.commonPool-worker-3]accumulator: sum=0; person=David;  [ForkJoinPool.commonPool-worker-2]accumulator: sum=0; person=Peter;  [ForkJoinPool.commonPool-worker-1]combiner:    sum1=18; sum2=23;     [ForkJoinPool.commonPool-worker-1]combiner:    sum1=23; sum2=12;     [ForkJoinPool.commonPool-worker-2]combiner:    sum1=41; sum2=35;     [ForkJoinPool.commonPool-worker-2]</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹ï¼Œä½ éœ€è¦è®°ä½çš„æ˜¯ï¼Œå¹¶è¡Œæµå¯¹å«æœ‰å¤§é‡å…ƒç´ çš„æ•°æ®æµæå‡æ€§èƒ½æå¤§ã€‚ä½†æ˜¯ä½ ä¹Ÿéœ€è¦è®°ä½å¹¶è¡Œæµçš„ä¸€äº›æ“ä½œï¼Œä¾‹å¦‚ <code>reduce</code>å’Œ <code>collect</code>æ“ä½œï¼Œéœ€è¦é¢å¤–çš„è®¡ç®—ï¼ˆå¦‚ç»„åˆæ“ä½œï¼‰ï¼Œè¿™åœ¨ä¸²è¡Œæ‰§è¡Œæ—¶æ˜¯å¹¶ä¸éœ€è¦ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿäº†è§£äº†ï¼Œæ‰€æœ‰å¹¶è¡Œæµæ“ä½œéƒ½å…±äº«ç›¸åŒçš„ JVM ç›¸å…³çš„å…¬å…± <code>ForkJoinPool</code>ã€‚æ‰€ä»¥ä½ å¯èƒ½éœ€è¦é¿å…å†™å‡ºä¸€äº›åˆæ…¢åˆå¡çš„æµå¼æ“ä½œï¼Œè¿™å¾ˆæœ‰å¯èƒ½ä¼šæ‹–æ…¢ä½ åº”ç”¨ä¸­ï¼Œä¸¥é‡ä¾èµ–å¹¶è¡Œæµçš„å…¶å®ƒéƒ¨åˆ†ä»£ç çš„æ€§èƒ½ã€‚</p><h2 id="å…«ã€ç»“è¯­"><a href="#å…«ã€ç»“è¯­" class="headerlink" title="å…«ã€ç»“è¯­"></a>å…«ã€ç»“è¯­</h2><p>Java8 Stream æµç¼–ç¨‹æŒ‡å—åˆ°è¿™é‡Œå°±ç»“æŸäº†ã€‚å¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æ›´å¤šæœ‰å…³ Java 8 Stream æµçš„ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘å»ºè®®æ‚¨ä½¿ç”¨ Stream Javadoc é˜…è¯»å®˜æ–¹æ–‡æ¡£ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³åº•å±‚æœºåˆ¶çš„æ›´å¤šä¿¡æ¯ï¼Œæ‚¨ä¹Ÿå¯ä»¥é˜…è¯» Martin Fowlers å…³äº Collection Pipelines çš„æ–‡ç« ã€‚</p><p>æœ€åï¼Œç¥æ‚¨å­¦ä¹ æ„‰å¿«ï¼</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="mailto:undefined">By_Xb</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="https://wtnl.xyz/2024/11/04/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%B8%80/">https://wtnl.xyz/2024/11/04/æ‘˜æ–‡ç¬”è®°ä¸€/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://wtnl.xyz" target="_blank">By_Xb</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring-Boot/">Spring-Boot</a><a class="post-meta__tags" href="/tags/Docker/">Docker</a><a class="post-meta__tags" href="/tags/springmvc/">springmvc</a><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post_share"><div class="social-share" data-image="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411051341276.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/11/04/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%BA%8C/"><img class="prev-cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411051342002.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">æ‘˜æ–‡ç¬”è®°_å¸¸ç”¨æŠ€æœ¯äºŒ</div></div></a></div><div class="next-post pull-right"><a href="/2024/11/04/%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8(%E4%B8%80)/"><img class="next-cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/u=3388573831,1341912953&amp;fm=26&amp;fmt=auto&amp;gp=0.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">å¼€æºå·¥å…·æ€»ç»“ä½¿ç”¨(ä¸€)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2024/11/04/%E6%96%87%E7%AB%A0%E5%BC%95%E7%94%A8/" title="ä¼˜ç§€å¼€æºæ¡†æ¶åŠæ–‡ç« "><img class="cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/hgtrgh4wt56gtw654gy5t6r.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">ä¼˜ç§€å¼€æºæ¡†æ¶åŠæ–‡ç« </div></div></a></div><div><a href="/2024/11/04/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%BA%8C/" title="æ‘˜æ–‡ç¬”è®°_å¸¸ç”¨æŠ€æœ¯äºŒ"><img class="cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411051342002.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">æ‘˜æ–‡ç¬”è®°_å¸¸ç”¨æŠ€æœ¯äºŒ</div></div></a></div><div><a href="/2024/11/04/Spring-Boot%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" title="å¿«é€Ÿä¸Šæ‰‹SpringBoot1.X"><img class="cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411042141756.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">å¿«é€Ÿä¸Šæ‰‹SpringBoot1.X</div></div></a></div><div><a href="/2024/11/04/Spring-Boot%E6%95%B4%E5%90%88%E5%85%B6%E4%BB%96%E6%A1%86%E6%9E%B6/" title="SpringBootå…¥é—¨ æ•´åˆmybatis,Redis,Junit"><img class="cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411042141756.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">SpringBootå…¥é—¨ æ•´åˆmybatis,Redis,Junit</div></div></a></div><div><a href="/2024/11/04/Spring-Boot%E9%AB%98%E7%BA%A7/" title="SpringBootåŸç†,å¯åŠ¨æµç¨‹å’Œç›‘å¬æœºåˆ¶"><img class="cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411042141756.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">SpringBootåŸç†,å¯åŠ¨æµç¨‹å’Œç›‘å¬æœºåˆ¶</div></div></a></div><div><a href="/2024/11/04/springboot%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F/" title="springBootè§£å†³è·¨åŸŸçš„ä¸‰ç§æ–¹æ³•"><img class="cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/20210918212344.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">springBootè§£å†³è·¨åŸŸçš„ä¸‰ç§æ–¹æ³•</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050018773.webp" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">By_Xb</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">88</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">35</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://byxiaobian.github.io/"><i class="fa fa-paper-plane-o"></i><span>å‰å¾€ä¸»é¡µ</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>å…¬å‘Š</span></div><div class="announcement_content"><p class="div-border blue" style="color:#000;text-align:center"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050016305.gif" style="float:left" width="25" height="25"><b>è®°å½•ä¸€äº›åç«¯çŸ¥è¯†</b><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050016305.gif" style="float:right" width="25" height="25"></p><p class="div-border yellow" style="color:#000;text-align:center"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050017011.gif" style="float:left" width="25" height="25"><b>åˆ†äº«ä¸€äº›ç¬”è®°å¿ƒå¾—</b><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050017011.gif" style="float:right" width="25" height="25"></p><p class="div-border green" style="color:#000;text-align:center"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050017574.gif" style="float:left" width="25" height="25"><b>åƒå–åƒå–åƒå–åƒå–</b><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050017574.gif" style="float:right" width="25" height="25"></p></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Log4j2%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E5%BC%82%E6%AD%A5%E6%80%A7%E8%83%BD"><span class="toc-text">Log4j2ä½¿ç”¨ä»¥åŠå¼‚æ­¥æ€§èƒ½</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Log4j2%E7%AE%80%E4%BB%8B"><span class="toc-text">Log4j2ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E7%89%9B%E9%80%BC%E7%9A%84%E6%80%A7%E8%83%BD"><span class="toc-text">æœ€ç‰›é€¼çš„æ€§èƒ½</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%BC%BA%E7%9A%84%E5%BC%82%E6%AD%A5%E6%80%A7%E8%83%BD"><span class="toc-text">æœ€å¼ºçš„å¼‚æ­¥æ€§èƒ½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%B6GC%EF%BC%88Garbage-free%EF%BC%89"><span class="toc-text">é›¶GCï¼ˆGarbage-freeï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E9%AB%98%E6%80%A7%E8%83%BD-I-O-%E5%86%99%E5%85%A5%E7%9A%84%E6%94%AF%E6%8C%81"><span class="toc-text">æ›´é«˜æ€§èƒ½ I&#x2F;O å†™å…¥çš„æ”¯æŒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%BC%BA%E5%A4%A7%E7%9A%84%E5%8F%82%E6%95%B0%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-text">æ›´å¼ºå¤§çš„å‚æ•°æ ¼å¼åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-%E5%8D%A0%E4%BD%8D%E7%AC%A6%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%8F%82%E6%95%B0"><span class="toc-text">ä½¿ç”¨{}å ä½ç¬¦æ ¼å¼åŒ–å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8String-format%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%8F%82%E6%95%B0"><span class="toc-text">ä½¿ç”¨String.formatçš„å½¢å¼æ ¼å¼åŒ–å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8logger-printf%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%8F%82%E6%95%B0"><span class="toc-text">ä½¿ç”¨logger.printfæ ¼å¼åŒ–å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%9C%E6%83%B0%E6%80%A7%E2%80%9D%E6%89%93%E6%97%A5%E5%BF%97%EF%BC%88lazy-logging%EF%BC%89"><span class="toc-text">â€œæƒ°æ€§â€æ‰“æ—¥å¿—ï¼ˆlazy loggingï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E7%AE%80%E5%8C%96%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text">æ›´ç®€åŒ–çš„é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#logback-xml"><span class="toc-text">logback.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#log4j2-xml"><span class="toc-text">log4j2.xml</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97%E6%8A%BD%E8%B1%A1-%E9%97%A8%E9%9D%A2%E9%80%82%E9%85%8D"><span class="toc-text">ä¸å…¶ä»–æ—¥å¿—æŠ½è±¡&#x2F;é—¨é¢é€‚é…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text">å…¶ä»–çš„ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-text">åŸºæœ¬ç”¨æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8log4j2%E7%9A%84maven%E4%BE%9D%E8%B5%96"><span class="toc-text">å¼•ç”¨log4j2çš„mavenä¾èµ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B"><span class="toc-text">é…ç½®æ–‡ä»¶ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%AD%E6%B3%95"><span class="toc-text">XMLé…ç½®æ–‡ä»¶è¯­æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BALogger"><span class="toc-text">åˆ›å»ºLogger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%BC%82%E6%AD%A5%E9%85%8D%E7%BD%AE%EF%BC%88%E9%87%8D%E8%A6%81%EF%BC%81%EF%BC%81%EF%BC%89"><span class="toc-text">å…¨å¼‚æ­¥é…ç½®ï¼ˆé‡è¦ï¼ï¼ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot-%E7%9A%84%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">SpringBoot çš„å…¨å±€å¼‚å¸¸å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%87%86%E5%A4%87"><span class="toc-text">SpringBootå…¨å±€å¼‚å¸¸å‡†å¤‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87"><span class="toc-text">å¼€å‘å‡†å¤‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99"><span class="toc-text">ä»£ç ç¼–å†™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-text">åŠŸèƒ½æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8SpringBoot%E9%A1%B9%E7%9B%AE%E4%B8%AD%EF%BC%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3-%E6%8B%A6%E6%88%AA%E5%99%A8%E4%BC%98%E9%9B%85%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%A0%E8%A7%A3%E5%AF%86%EF%BC%81"><span class="toc-text">åœ¨SpringBooté¡¹ç›®ä¸­ï¼Œè‡ªå®šä¹‰æ³¨è§£+æ‹¦æˆªå™¨ä¼˜é›…çš„å®ç°æ•æ„Ÿæ•°æ®çš„åŠ è§£å¯†ï¼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFMybatis-Plugin"><span class="toc-text">ä¸€ã€ä»€ä¹ˆæ˜¯Mybatis Plugin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E5%8A%A0%E8%A7%A3%E5%AF%86%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">äºŒã€å®ç°åŸºäºæ³¨è§£çš„æ•æ„Ÿä¿¡æ¯åŠ è§£å¯†æ‹¦æˆªå™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-text">2.1 å®ç°æ€è·¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%AE%9A%E4%B9%89%E9%9C%80%E8%A6%81%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E7%9A%84%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%B3%A8%E8%A7%A3"><span class="toc-text">2.2 å®šä¹‰éœ€è¦åŠ å¯†è§£å¯†çš„æ•æ„Ÿä¿¡æ¯æ³¨è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%AE%9A%E4%B9%89%E5%8A%A0%E5%AF%86%E6%8E%A5%E5%8F%A3%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-text">2.3 å®šä¹‰åŠ å¯†æ¥å£åŠå…¶å®ç°ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%AE%9E%E7%8E%B0%E5%85%A5%E5%8F%82%E5%8A%A0%E5%AF%86%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">2.4 å®ç°å…¥å‚åŠ å¯†æ‹¦æˆªå™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%AE%9A%E4%B9%89%E8%A7%A3%E5%AF%86%E6%8E%A5%E5%8F%A3%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-text">2.5 å®šä¹‰è§£å¯†æ¥å£åŠå…¶å®ç°ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E5%AE%9A%E4%B9%89%E5%87%BA%E5%8F%82%E8%A7%A3%E5%AF%86%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">2.6 å®šä¹‰å‡ºå‚è§£å¯†æ‹¦æˆªå™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%B3%A8%E8%A7%A3%E5%AE%9E%E4%BD%93%E7%B1%BB%E4%B8%AD%E9%9C%80%E8%A6%81%E5%8A%A0%E8%A7%A3%E5%AF%86%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="toc-text">3ã€æ³¨è§£å®ä½“ç±»ä¸­éœ€è¦åŠ è§£å¯†çš„å­—æ®µ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%B7%A5%E5%85%B7%EF%BC%9APortainer"><span class="toc-text">Docker å›¾å½¢åŒ–å·¥å…·ï¼šPortainer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-Docker%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%B7%A5%E5%85%B7"><span class="toc-text">ä¸€.Dockerå›¾å½¢åŒ–å·¥å…·</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-DockerUI"><span class="toc-text">äºŒ.DockerUI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-Shipyard"><span class="toc-text">ä¸‰.Shipyard</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-Portainer"><span class="toc-text">å››.Portainer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8Bportainer%E9%95%9C%E5%83%8F"><span class="toc-text">1.æŸ¥çœ‹portaineré•œåƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%80%89%E6%8B%A9%E5%96%9C%E6%AC%A2%E7%9A%84portainer%E9%A3%8E%E6%A0%BC%E9%95%9C%E5%83%8F%EF%BC%8C%E4%B8%8B%E8%BD%BD"><span class="toc-text">2.é€‰æ‹©å–œæ¬¢çš„portaineré£æ ¼é•œåƒï¼Œä¸‹è½½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%90%AF%E5%8A%A8dockerui%E5%AE%B9%E5%99%A8"><span class="toc-text">3.å¯åŠ¨dockeruiå®¹å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-web%E7%AE%A1%E7%90%86"><span class="toc-text">4.webç®¡ç†</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringMVC%EF%BC%9A%E6%B3%A8%E8%A7%A3-ControllerAdvice%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">SpringMVCï¼šæ³¨è§£@ControllerAdviceçš„å·¥ä½œåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%B3%A8%E8%A7%A3-ControllerAdvice%E6%98%AF%E5%A6%82%E4%BD%95%E8%A2%AB%E5%8F%91%E7%8E%B0%E7%9A%84"><span class="toc-text">1. æ³¨è§£@ControllerAdviceæ˜¯å¦‚ä½•è¢«å‘ç°çš„ ?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-ControllerAdvice-%E5%AE%9A%E4%B9%89%E4%BF%A1%E6%81%AF%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2. @ControllerAdvice å®šä¹‰ä¿¡æ¯çš„ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-requestResponseBodyAdvice%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">1. requestResponseBodyAdviceçš„ä½¿ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-modelAttributeAdviceCache%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2. modelAttributeAdviceCacheçš„ä½¿ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-initBinderAdviceCache%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">3. initBinderAdviceCacheçš„ä½¿ç”¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%A4%84%E7%90%86%E9%87%8D%E5%A4%8D%E8%AF%B7%E6%B1%82-%E5%B9%B6%E5%8F%91%E8%AF%B7%E6%B1%82%EF%BC%9F"><span class="toc-text">å¦‚ä½•ä¼˜é›…å¤„ç†é‡å¤è¯·æ±‚&#x2F;å¹¶å‘è¯·æ±‚ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%94%AF%E4%B8%80%E8%AF%B7%E6%B1%82%E7%BC%96%E5%8F%B7%E5%8E%BB%E9%87%8D"><span class="toc-text">åˆ©ç”¨å”¯ä¸€è¯·æ±‚ç¼–å·å»é‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%8F%82%E6%95%B0%E5%8E%BB%E9%87%8D"><span class="toc-text">ä¸šåŠ¡å‚æ•°å»é‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%9A%84%E6%91%98%E8%A6%81%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0%E6%A0%87%E8%AF%86"><span class="toc-text">è®¡ç®—è¯·æ±‚å‚æ•°çš„æ‘˜è¦ä½œä¸ºå‚æ•°æ ‡è¯†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E7%BB%AD%E4%BC%98%E5%8C%96%EF%BC%8C%E8%80%83%E8%99%91%E5%89%94%E9%99%A4%E9%83%A8%E5%88%86%E6%97%B6%E9%97%B4%E5%9B%A0%E5%AD%90"><span class="toc-text">ç»§ç»­ä¼˜åŒ–ï¼Œè€ƒè™‘å‰”é™¤éƒ¨åˆ†æ—¶é—´å› å­</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%8E%BB%E9%87%8D%E5%B7%A5%E5%85%B7%E7%B1%BB%EF%BC%8CJava%E5%AE%9E%E7%8E%B0"><span class="toc-text">è¯·æ±‚å»é‡å·¥å…·ç±»ï¼ŒJavaå®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-AOP%E7%9C%8B%E8%BF%99%E7%AF%87%E5%B0%B1%E5%A4%9F%E8%BE%A3"><span class="toc-text">Spring AOPçœ‹è¿™ç¯‡å°±å¤Ÿè¾£~</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86"><span class="toc-text">åŸºæœ¬çŸ¥è¯†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-AOP"><span class="toc-text">ä»€ä¹ˆæ˜¯ AOP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AF%E8%AF%AD"><span class="toc-text">æœ¯è¯­</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Aspect-%E5%88%87%E9%9D%A2"><span class="toc-text">Aspect(åˆ‡é¢)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#advice-%E5%A2%9E%E5%BC%BA"><span class="toc-text">advice(å¢å¼º)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%82%B9-join-point"><span class="toc-text">è¿æ¥ç‚¹(join point)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E7%82%B9-point-cut"><span class="toc-text">åˆ‡ç‚¹(point cut)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Ejoin-point-%E5%92%8C-point-cut-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">å…³äºjoin point å’Œ point cut çš„åŒºåˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#introduction"><span class="toc-text">introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E5%AF%B9%E8%B1%A1-Target"><span class="toc-text">ç›®æ ‡å¯¹è±¡(Target)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP-proxy"><span class="toc-text">AOP proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%87%E5%85%A5-Weaving"><span class="toc-text">ç»‡å…¥(Weaving)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#advice-%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-text">advice çš„ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-AOP-Proxy"><span class="toc-text">å…³äº AOP Proxy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3-aspect-join-point-point-cut-advice"><span class="toc-text">å½»åº•ç†è§£ aspect, join point, point cut, advice</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AspectJ-%E6%94%AF%E6%8C%81"><span class="toc-text">@AspectJ æ”¯æŒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E8%83%BD-AspectJ-%E6%94%AF%E6%8C%81"><span class="toc-text">ä½¿èƒ½ @AspectJ æ”¯æŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Java-Configuration-%E6%96%B9%E5%BC%8F%E4%BD%BF%E8%83%BD-AspectJ"><span class="toc-text">ä½¿ç”¨ Java Configuration æ–¹å¼ä½¿èƒ½@AspectJ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-XML-%E6%96%B9%E5%BC%8F%E4%BD%BF%E8%83%BD-AspectJ"><span class="toc-text">ä½¿ç”¨ XML æ–¹å¼ä½¿èƒ½@AspectJ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-aspect-%E5%88%87%E9%9D%A2"><span class="toc-text">å®šä¹‰ aspect(åˆ‡é¢)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E-pointcut"><span class="toc-text">å£°æ˜ pointcut</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E7%82%B9%E6%A0%87%E5%BF%97%E7%AC%A6-designator"><span class="toc-text">åˆ‡ç‚¹æ ‡å¿—ç¬¦(designator)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#execution"><span class="toc-text">execution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#within"><span class="toc-text">within</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#this-%E4%B8%8E-target"><span class="toc-text">this ä¸ target</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bean"><span class="toc-text">bean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#args"><span class="toc-text">args</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#annotation"><span class="toc-text">@annotation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%87%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">å¸¸è§çš„åˆ‡ç‚¹è¡¨è¾¾å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E6%96%B9%E6%B3%95%E7%AD%BE%E5%90%8D"><span class="toc-text">åŒ¹é…æ–¹æ³•ç­¾å</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E7%B1%BB%E5%9E%8B%E7%AD%BE%E5%90%8D"><span class="toc-text">åŒ¹é…ç±»å‹ç­¾å</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D-Bean-%E5%90%8D%E5%AD%97"><span class="toc-text">åŒ¹é… Bean åå­—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%BB%84%E5%90%88"><span class="toc-text">åˆ‡ç‚¹è¡¨è¾¾å¼ç»„åˆ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E-advice"><span class="toc-text">å£°æ˜ advice</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Before-advice"><span class="toc-text">Before advice</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#around-advice"><span class="toc-text">around advice</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Java8-Stream-%E6%B5%81%E5%BC%8F%E7%BC%96%E7%A8%8B%EF%BC%8C%E6%9E%81%E5%A4%A7%E8%A7%A3%E6%94%BE%E4%BD%A0%E7%9A%84%E7%94%9F%E4%BA%A7%E5%8A%9B%EF%BC%81"><span class="toc-text">Java8 Stream æµå¼ç¼–ç¨‹ï¼Œæå¤§è§£æ”¾ä½ çš„ç”Ÿäº§åŠ›ï¼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-text">ç›®å½•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Stream-%E6%B5%81%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F"><span class="toc-text">ä¸€ã€Stream æµæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84-Stream-%E6%B5%81"><span class="toc-text">äºŒã€ä¸åŒç±»å‹çš„ Stream æµ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Stream-%E6%B5%81%E7%9A%84%E5%A4%84%E7%90%86%E9%A1%BA%E5%BA%8F"><span class="toc-text">ä¸‰ã€Stream æµçš„å¤„ç†é¡ºåº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%B8%AD%E9%97%B4%E6%93%8D%E4%BD%9C%E9%A1%BA%E5%BA%8F%E8%BF%99%E4%B9%88%E9%87%8D%E8%A6%81%EF%BC%9F"><span class="toc-text">å››ã€ä¸­é—´æ“ä½œé¡ºåºè¿™ä¹ˆé‡è¦ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%95%B0%E6%8D%AE%E6%B5%81%E5%A4%8D%E7%94%A8%E9%97%AE%E9%A2%98"><span class="toc-text">äº”ã€æ•°æ®æµå¤ç”¨é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%AB%98%E7%BA%A7%E6%93%8D%E4%BD%9C"><span class="toc-text">å…­ã€é«˜çº§æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-Collect"><span class="toc-text">6.1 Collect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-FlatMap"><span class="toc-text">6.2 FlatMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-Reduce"><span class="toc-text">6.3 Reduce</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%B9%B6%E8%A1%8C%E6%B5%81"><span class="toc-text">ä¸ƒã€å¹¶è¡Œæµ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E7%BB%93%E8%AF%AD"><span class="toc-text">å…«ã€ç»“è¯­</span></a></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/08/docker%E5%AE%89%E8%A3%85Rabbitmq%E6%95%99%E7%A8%8B%EF%BC%88%E8%AF%A6%E7%BB%86%E5%9B%BE%E6%96%87%EF%BC%89/" title="dockerå®‰è£…Rabbitmqæ•™ç¨‹ï¼ˆè¯¦ç»†å›¾æ–‡ï¼‰"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-08/6a76dcad3ecc4bb2e2273a49a0cdb67c.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="dockerå®‰è£…Rabbitmqæ•™ç¨‹ï¼ˆè¯¦ç»†å›¾æ–‡ï¼‰"></a><div class="content"><a class="title" href="/2024/11/08/docker%E5%AE%89%E8%A3%85Rabbitmq%E6%95%99%E7%A8%8B%EF%BC%88%E8%AF%A6%E7%BB%86%E5%9B%BE%E6%96%87%EF%BC%89/" title="dockerå®‰è£…Rabbitmqæ•™ç¨‹ï¼ˆè¯¦ç»†å›¾æ–‡ï¼‰">dockerå®‰è£…Rabbitmqæ•™ç¨‹ï¼ˆè¯¦ç»†å›¾æ–‡ï¼‰</a><time datetime="2024-11-08T04:57:07.310Z" title="å‘è¡¨äº 2024-11-08 12:57:07">2024-11-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/08/021-%E4%BF%A1%E6%81%AF%E6%89%93%E7%82%B9-%E5%85%AC%E4%BC%97%E5%8F%B7%E6%9C%8D%E5%8A%A1&amp;Github%E7%9B%91%E6%8E%A7&amp;%E4%BE%9B%E5%BA%94%E9%93%BE&amp;%E7%BD%91%E7%9B%98%E6%B3%84%E6%BC%8F&amp;%E8%AF%81%E4%B9%A6%E5%9B%BE%E6%A0%87%E9%82%AE%E7%AE%B1%E8%B5%84%E4%BA%A7/" title="021-ä¿¡æ¯æ‰“ç‚¹-å…¬ä¼—å·æœåŠ¡&amp;Githubç›‘æ§&amp;ä¾›åº”é“¾&amp;ç½‘ç›˜æ³„æ¼&amp;è¯ä¹¦å›¾æ ‡é‚®ç®±èµ„äº§"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-08/3c9919214e5c87560961e1317fe6eb23.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="021-ä¿¡æ¯æ‰“ç‚¹-å…¬ä¼—å·æœåŠ¡&amp;Githubç›‘æ§&amp;ä¾›åº”é“¾&amp;ç½‘ç›˜æ³„æ¼&amp;è¯ä¹¦å›¾æ ‡é‚®ç®±èµ„äº§"></a><div class="content"><a class="title" href="/2024/11/08/021-%E4%BF%A1%E6%81%AF%E6%89%93%E7%82%B9-%E5%85%AC%E4%BC%97%E5%8F%B7%E6%9C%8D%E5%8A%A1&amp;Github%E7%9B%91%E6%8E%A7&amp;%E4%BE%9B%E5%BA%94%E9%93%BE&amp;%E7%BD%91%E7%9B%98%E6%B3%84%E6%BC%8F&amp;%E8%AF%81%E4%B9%A6%E5%9B%BE%E6%A0%87%E9%82%AE%E7%AE%B1%E8%B5%84%E4%BA%A7/" title="021-ä¿¡æ¯æ‰“ç‚¹-å…¬ä¼—å·æœåŠ¡&amp;Githubç›‘æ§&amp;ä¾›åº”é“¾&amp;ç½‘ç›˜æ³„æ¼&amp;è¯ä¹¦å›¾æ ‡é‚®ç®±èµ„äº§">021-ä¿¡æ¯æ‰“ç‚¹-å…¬ä¼—å·æœåŠ¡&amp;Githubç›‘æ§&amp;ä¾›åº”é“¾&amp;ç½‘ç›˜æ³„æ¼&amp;è¯ä¹¦å›¾æ ‡é‚®ç®±èµ„äº§</a><time datetime="2024-11-07T19:31:31.884Z" title="å‘è¡¨äº 2024-11-08 03:31:31">2024-11-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/08/020-%E4%BF%A1%E6%81%AF%E6%89%93%E7%82%B9-%E7%BA%A2%E8%93%9D%E9%98%9F%E8%87%AA%E5%8A%A8%E5%8C%96%E9%A1%B9%E7%9B%AE&amp;%E8%B5%84%E4%BA%A7%E4%BE%A6%E5%AF%9F&amp;%E4%BC%81%E6%9F%A5%E4%BA%A7%E6%9D%83&amp;%E6%AD%A6%E5%99%A8%E5%BA%93%E9%83%A8%E7%BD%B2&amp;%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4/" title="020-ä¿¡æ¯æ‰“ç‚¹-çº¢è“é˜Ÿè‡ªåŠ¨åŒ–é¡¹ç›®&amp;èµ„äº§ä¾¦å¯Ÿ&amp;ä¼æŸ¥äº§æƒ&amp;æ­¦å™¨åº“éƒ¨ç½²&amp;ç½‘ç»œç©ºé—´"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-08/ecd24c114c581fe6098263870ee23e2e.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="020-ä¿¡æ¯æ‰“ç‚¹-çº¢è“é˜Ÿè‡ªåŠ¨åŒ–é¡¹ç›®&amp;èµ„äº§ä¾¦å¯Ÿ&amp;ä¼æŸ¥äº§æƒ&amp;æ­¦å™¨åº“éƒ¨ç½²&amp;ç½‘ç»œç©ºé—´"></a><div class="content"><a class="title" href="/2024/11/08/020-%E4%BF%A1%E6%81%AF%E6%89%93%E7%82%B9-%E7%BA%A2%E8%93%9D%E9%98%9F%E8%87%AA%E5%8A%A8%E5%8C%96%E9%A1%B9%E7%9B%AE&amp;%E8%B5%84%E4%BA%A7%E4%BE%A6%E5%AF%9F&amp;%E4%BC%81%E6%9F%A5%E4%BA%A7%E6%9D%83&amp;%E6%AD%A6%E5%99%A8%E5%BA%93%E9%83%A8%E7%BD%B2&amp;%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4/" title="020-ä¿¡æ¯æ‰“ç‚¹-çº¢è“é˜Ÿè‡ªåŠ¨åŒ–é¡¹ç›®&amp;èµ„äº§ä¾¦å¯Ÿ&amp;ä¼æŸ¥äº§æƒ&amp;æ­¦å™¨åº“éƒ¨ç½²&amp;ç½‘ç»œç©ºé—´">020-ä¿¡æ¯æ‰“ç‚¹-çº¢è“é˜Ÿè‡ªåŠ¨åŒ–é¡¹ç›®&amp;èµ„äº§ä¾¦å¯Ÿ&amp;ä¼æŸ¥äº§æƒ&amp;æ­¦å™¨åº“éƒ¨ç½²&amp;ç½‘ç»œç©ºé—´</a><time datetime="2024-11-07T19:30:53.991Z" title="å‘è¡¨äº 2024-11-08 03:30:53">2024-11-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/08/019-%E4%BF%A1%E6%81%AF%E6%89%93%E7%82%B9-%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BA%94%E7%94%A8&amp;%E8%A7%A3%E5%8C%85%E5%8F%8D%E7%BC%96%E8%AF%91&amp;%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95&amp;%E6%8A%93%E5%8C%85&amp;%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90&amp;%E6%BA%90%E7%A0%81%E6%9E%B6%E6%9E%84/" title="019-ä¿¡æ¯æ‰“ç‚¹-å°ç¨‹åºåº”ç”¨&amp;è§£åŒ…åç¼–è¯‘&amp;åŠ¨æ€è°ƒè¯•&amp;æŠ“åŒ…&amp;é™æ€åˆ†æ&amp;æºç æ¶æ„"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-08/284f34398dd93faea9b963944ba6bdf0.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="019-ä¿¡æ¯æ‰“ç‚¹-å°ç¨‹åºåº”ç”¨&amp;è§£åŒ…åç¼–è¯‘&amp;åŠ¨æ€è°ƒè¯•&amp;æŠ“åŒ…&amp;é™æ€åˆ†æ&amp;æºç æ¶æ„"></a><div class="content"><a class="title" href="/2024/11/08/019-%E4%BF%A1%E6%81%AF%E6%89%93%E7%82%B9-%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BA%94%E7%94%A8&amp;%E8%A7%A3%E5%8C%85%E5%8F%8D%E7%BC%96%E8%AF%91&amp;%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95&amp;%E6%8A%93%E5%8C%85&amp;%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90&amp;%E6%BA%90%E7%A0%81%E6%9E%B6%E6%9E%84/" title="019-ä¿¡æ¯æ‰“ç‚¹-å°ç¨‹åºåº”ç”¨&amp;è§£åŒ…åç¼–è¯‘&amp;åŠ¨æ€è°ƒè¯•&amp;æŠ“åŒ…&amp;é™æ€åˆ†æ&amp;æºç æ¶æ„">019-ä¿¡æ¯æ‰“ç‚¹-å°ç¨‹åºåº”ç”¨&amp;è§£åŒ…åç¼–è¯‘&amp;åŠ¨æ€è°ƒè¯•&amp;æŠ“åŒ…&amp;é™æ€åˆ†æ&amp;æºç æ¶æ„</a><time datetime="2024-11-07T19:30:15.451Z" title="å‘è¡¨äº 2024-11-08 03:30:15">2024-11-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/08/018-%E4%BF%A1%E6%81%AF%E6%89%93%E7%82%B9-APP%E8%B5%84%E4%BA%A7&amp;%E7%9F%A5%E8%AF%86%E4%BA%A7%E6%9D%83&amp;%E5%BA%94%E7%94%A8%E7%9B%91%E6%8E%A7&amp;%E9%9D%99%E6%80%81%E6%8F%90%E5%8F%96&amp;%E5%8A%A8%E6%80%81%E6%8A%93%E5%8C%85&amp;%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/" title="018-ä¿¡æ¯æ‰“ç‚¹-APPèµ„äº§&amp;çŸ¥è¯†äº§æƒ&amp;åº”ç”¨ç›‘æ§&amp;é™æ€æå–&amp;åŠ¨æ€æŠ“åŒ…&amp;åŠ¨æ€è°ƒè¯•"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-08/e5a0d95c4da6760cc13e26f07c1a5dfe.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="018-ä¿¡æ¯æ‰“ç‚¹-APPèµ„äº§&amp;çŸ¥è¯†äº§æƒ&amp;åº”ç”¨ç›‘æ§&amp;é™æ€æå–&amp;åŠ¨æ€æŠ“åŒ…&amp;åŠ¨æ€è°ƒè¯•"></a><div class="content"><a class="title" href="/2024/11/08/018-%E4%BF%A1%E6%81%AF%E6%89%93%E7%82%B9-APP%E8%B5%84%E4%BA%A7&amp;%E7%9F%A5%E8%AF%86%E4%BA%A7%E6%9D%83&amp;%E5%BA%94%E7%94%A8%E7%9B%91%E6%8E%A7&amp;%E9%9D%99%E6%80%81%E6%8F%90%E5%8F%96&amp;%E5%8A%A8%E6%80%81%E6%8A%93%E5%8C%85&amp;%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/" title="018-ä¿¡æ¯æ‰“ç‚¹-APPèµ„äº§&amp;çŸ¥è¯†äº§æƒ&amp;åº”ç”¨ç›‘æ§&amp;é™æ€æå–&amp;åŠ¨æ€æŠ“åŒ…&amp;åŠ¨æ€è°ƒè¯•">018-ä¿¡æ¯æ‰“ç‚¹-APPèµ„äº§&amp;çŸ¥è¯†äº§æƒ&amp;åº”ç”¨ç›‘æ§&amp;é™æ€æå–&amp;åŠ¨æ€æŠ“åŒ…&amp;åŠ¨æ€è°ƒè¯•</a><time datetime="2024-11-07T19:29:09.108Z" title="å‘è¡¨äº 2024-11-08 03:29:09">2024-11-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2016 - 2024 By_Xb</div><div class="footer_custom_text"><p><a target="_blank" href="https://hexo.io/"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="åšå®¢æ¡†æ¶ä¸ºHexo"></a>&nbsp;<a target="_blank" href="https://demo.jerryc.me/"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="ä¸»é¢˜é‡‡ç”¨butterfly"></a>&nbsp;<a target="_blank" href="https://metroui.org.ua/index.html"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="æœ¬ç«™ä½¿ç”¨JsDelivrä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ"></a> &nbsp;<a target="_blank" href="https://vercel.com/"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œé»˜è®¤çº¿è·¯æ‰˜ç®¡äºVercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œè”é€šçº¿è·¯æ‰˜ç®¡äºCoding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="æœ¬ç«™é¡¹ç›®ç”±Gtihubæ‰˜ç®¡"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    //document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    //document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://bian123x-twikoo.hf.space',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://bian123x-twikoo.hf.space',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script><script defer="defer" src="https://at.alicdn.com/t/font_2100218_rqdhd0ud6wd.js?spm=a313x.7781069.1998910419.88&file=font_2100218_rqdhd0ud6wd.js"></script><script defer="defer" src="/js/icon.js"></script><script defer="defer" src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><script type="text/javascript" data-pjax src="https://unpkg.com/artitalk"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/shuoshuo/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()

  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax], .pjax-reload script').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><div class="pjax-reload"><script async="async">for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("footer_custom_text"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInX"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("article-sort-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("category-lists"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInX"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("tag-cloud-list is-center"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInX"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("comment-wrap"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__slideInUp"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer="defer" src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script><script defer="defer" src="/js/wow_init.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script data-pjax>function butterfly_swiper_injector_config(){var a=document.getElementById("recent-posts");console.log("å·²æŒ‚è½½butterfly_swiper"),a.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/11/04/springbootæ•´åˆshiro/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/20210918204817.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-11-04</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/11/04/springbootæ•´åˆshiro/&quot;);" href="javascript:void(0);" alt="">springbootæ•´åˆshiro jwt</a><div class="blog-slider__text">shiroæ¡†æ¶æ˜¯å¦‚ä»Šwebå¼€å‘åšæƒé™æ§åˆ¶çš„é‡è¦é€‰æ‹©ä¹‹ä¸€ï¼Œé™¤äº†è¿™ä¸ªä¹‹å¤–é€‰æ‹©spring securityçš„ä¹Ÿå¾ˆå¤šã€‚ä¸¤è€…éƒ½æœ‰å„è‡ªçš„ä¼˜ç‚¹ã€‚shiroæ›´åŠ ç®€å•ï¼Œè€Œspring securityæœ¬æ¥å°±æ˜¯springå®¶æ—çš„ï¼Œapiæ•´åˆèµ·æ¥æ›´åŠ å‹å¥½ã€‚åšä¸»åœ¨å®é™…é¡¹ç›®ä¸­åªç”¨è¿‡shiroï¼Œç›¸æ¯”spring securityï¼Œshiroç®€å•ä¸€äº›ã€‚ä½†æ˜¯è¿™äº›å®‰å…¨æ¡†æ¶éƒ½ä¸æ˜¯ç‰¹åˆ«å®¹æ˜“ç†è§£ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/11/04/springbootæ•´åˆshiro/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/11/04/Telegram æœºå™¨äººå¼€å‘/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/images1202211220911801.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-11-04</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/11/04/Telegram æœºå™¨äººå¼€å‘/&quot;);" href="javascript:void(0);" alt="">Telegramæœºå™¨äººå¼€å‘</a><div class="blog-slider__text">Telegram æ˜¯ä¸€ä¸ªç¤¾äº¤èŠå¤©è½¯ä»¶ã€‚ é‡Œé¢æœ‰ä¸€ä¸ªå¾ˆæœ‰ç‰¹è‰²çš„åŠŸèƒ½å°±æ˜¯æœºå™¨äººã€‚ æœºå™¨äººæ˜¯ç”±ç¨‹åºæ§åˆ¶ çš„ç”¨æˆ·ã€‚ æˆ‘ä»¬å¯ä»¥å†™ç¨‹åºæ¥æ§åˆ¶è¿™ä¸ªæœºå™¨äººã€‚ è€Œä¸”å†™èµ·æ¥ä¹Ÿä¸éš¾å“¦ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/11/04/Telegram æœºå™¨äººå¼€å‘/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/11/04/Golangå­¦ä¹ /&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/images1202211220946656.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-11-04</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/11/04/Golangå­¦ä¹ /&quot;);" href="javascript:void(0);" alt="">Golangå­¦ä¹ </a><div class="blog-slider__text">Golangå­¦ä¹ </div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/11/04/Golangå­¦ä¹ /&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/11/04/springbootè§£å†³è·¨åŸŸ/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/20210918212344.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-11-04</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/11/04/springbootè§£å†³è·¨åŸŸ/&quot;);" href="javascript:void(0);" alt="">springBootè§£å†³è·¨åŸŸçš„ä¸‰ç§æ–¹æ³•</a><div class="blog-slider__text">springBootå‰åç«¯å¯¹æ¥ è§£å†³è·¨åŸŸ</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/11/04/springbootè§£å†³è·¨åŸŸ/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2024/11/04/vue2å­¦ä¹ /&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/u=2181711937,4147085500&amp;fm=26&amp;fmt=auto&amp;gp=0.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-11-04</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2024/11/04/vue2å­¦ä¹ /&quot;);" href="javascript:void(0);" alt="">Vue2å¿«é€Ÿä¸Šæ‰‹</a><div class="blog-slider__text">Vue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼æ¡†æ¶ã€‚ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨æä¾›é©±åŠ¨ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2024/11/04/vue2å­¦ä¹ /&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="/",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;"all"===epage&&0==flag?butterfly_swiper_injector_config():epage===cpage&&butterfly_swiper_injector_config()</script><script defer="defer" src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer="defer" data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script></body></html>