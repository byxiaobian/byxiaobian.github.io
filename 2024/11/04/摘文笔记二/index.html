<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>摘文笔记_常用技术二 | By_Xb</title><meta name="keywords" content="MySQL,Spring-Boot,Docker"><meta name="author" content="By_Xb"><meta name="copyright" content="By_Xb"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Docker常用命令 , Springboot切面实现权限校验  , Springboot五种热部署方式, 基于springboot实现MySQL读写分离技术  , springboot注解大全. SpringBoot第三方jar包打包问题 若依框架二级域名配置        Docker常用命令1、Docker容器信息123456##查看docker容器版本docker version##查看"><meta property="og:type" content="article"><meta property="og:title" content="摘文笔记_常用技术二"><meta property="og:url" content="https://wtnl.xyz/2024/11/04/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%BA%8C/index.html"><meta property="og:site_name" content="By_Xb"><meta property="og:description" content="Docker常用命令 , Springboot切面实现权限校验  , Springboot五种热部署方式, 基于springboot实现MySQL读写分离技术  , springboot注解大全. SpringBoot第三方jar包打包问题 若依框架二级域名配置        Docker常用命令1、Docker容器信息123456##查看docker容器版本docker version##查看"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320"><meta property="article:published_time" content="2024-11-04T12:45:01.404Z"><meta property="article:modified_time" content="2024-11-04T13:04:33.600Z"><meta property="article:author" content="By_Xb"><meta property="article:tag" content="MySQL"><meta property="article:tag" content="Spring-Boot"><meta property="article:tag" content="Docker"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320"><link rel="shortcut icon" href="/img/siteicon/favicon-32x32.png"><link rel="canonical" href="https://wtnl.xyz/2024/11/04/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%BA%8C/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-center"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
}
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"摘文笔记_常用技术二",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-11-04 21:04:33"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link defer="defer" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/css/extrastyle.css" media="defer" onload='this.media="all"'><link async rel="stylesheet" href="/css/foter.css" media="defer" onload='this.media="all"'><link async rel="stylesheet" href="/css/myblog.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xingjiahui/modify@2.0.0/pace/themes/pink/pace-theme-flash.css"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="By_Xb" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050018773.webp" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">72</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>清单</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa fa-spinner"></i> <span>追番</span></a></li><li><a class="site-page child" href="/gallery/index.htm"><i class="fa-fw fas fa-images"></i> <span>相册</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-cloud"></i> <span>动态</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">By_Xb</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>清单</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa fa-spinner"></i> <span>追番</span></a></li><li><a class="site-page child" href="/gallery/index.htm"><i class="fa-fw fas fa-images"></i> <span>相册</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-cloud"></i> <span>动态</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">摘文笔记_常用技术二</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-04T12:45:01.404Z" title="发表于 2024-11-04 20:45:01">2024-11-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-04T13:04:33.600Z" title="更新于 2024-11-04 21:04:33">2024-11-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF-%E7%AC%94%E8%AE%B0/">后端-笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">12.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>46分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="摘文笔记_常用技术二"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="tip cogs"><ol><li>Docker常用命令 ,</li><li>Springboot切面实现权限校验 ,</li><li>Springboot五种热部署方式,</li><li>基于springboot实现MySQL读写分离技术 ,</li><li>springboot注解大全.</li><li>SpringBoot第三方jar包打包问题</li><li>若依框架二级域名配置</li></ol></div><h1 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h1><h2 id="1、Docker容器信息"><a href="#1、Docker容器信息" class="headerlink" title="1、Docker容器信息"></a>1、Docker容器信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看docker容器版本</span></span></span><br><span class="line">docker version</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看docker容器信息</span></span></span><br><span class="line">docker info</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看docker容器帮助</span></span></span><br><span class="line">docker --help</span><br></pre></td></tr></table></figure><h2 id="2、镜像操作"><a href="#2、镜像操作" class="headerlink" title="2、镜像操作"></a>2、镜像操作</h2><p>提示：对于镜像的操作可使用镜像名、镜像长ID和短ID。</p><h3 id="2-1、镜像查看"><a href="#2-1、镜像查看" class="headerlink" title="2.1、镜像查看"></a>2.1、镜像查看</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#列出本地images</span></span></span><br><span class="line">docker images</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#含中间映像层</span></span></span><br><span class="line">docker images -a</span><br></pre></td></tr></table></figure><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606070321356.png" alt="image-20210606070321356"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#只显示镜像ID</span></span></span><br><span class="line">docker images -q</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#含中间映像层</span></span></span><br><span class="line">docker images -qa   </span><br></pre></td></tr></table></figure><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606070347956.png" alt="image-20210606070347956"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#显示镜像摘要信息(DIGEST列)</span></span></span><br><span class="line">docker images --digests</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#显示镜像完整信息</span></span></span><br><span class="line">docker images --no-trunc</span><br></pre></td></tr></table></figure><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606070445847.png" alt="image-20210606070445847"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#搜索仓库MySQL镜像</span></span></span><br><span class="line">docker search mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># --filter=stars=600：只显示 starts&gt;=600 的镜像</span></span></span><br><span class="line">docker search --filter=stars=600 mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># --no-trunc 显示镜像完整 DESCRIPTION 描述</span></span></span><br><span class="line">docker search --no-trunc mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># --automated ：只列出 AUTOMATED=OK 的镜像</span></span></span><br><span class="line">docker search  --automated mysql</span><br></pre></td></tr></table></figure><h3 id="2-2、镜像搜索"><a href="#2-2、镜像搜索" class="headerlink" title="2.2、镜像搜索"></a>2.2、镜像搜索</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#搜索仓库MySQL镜像</span></span></span><br><span class="line">docker search mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># --filter=stars=600：只显示 starts&gt;=600 的镜像</span></span></span><br><span class="line">docker search --filter=stars=600 mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># --no-trunc 显示镜像完整 DESCRIPTION 描述</span></span></span><br><span class="line">docker search --no-trunc mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># --automated ：只列出 AUTOMATED=OK 的镜像</span></span></span><br><span class="line">docker search  --automated mysql</span><br></pre></td></tr></table></figure><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606070459602.png" alt="image-20210606070459602"></p><h3 id="2-3、镜像下载"><a href="#2-3、镜像下载" class="headerlink" title="2.3、镜像下载"></a>2.3、镜像下载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#下载Redis官方最新镜像，相当于：docker pull redis:latest</span></span></span><br><span class="line">docker pull redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#下载仓库所有Redis镜像</span></span></span><br><span class="line">docker pull -a redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#下载私人仓库镜像</span></span></span><br><span class="line">docker pull bitnami/redis</span><br></pre></td></tr></table></figure><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606070509700.png" alt="image-20210606070509700"></p><h3 id="2-4、镜像删除"><a href="#2-4、镜像删除" class="headerlink" title="2.4、镜像删除"></a>2.4、镜像删除</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#单个镜像删除，相当于：docker rmi redis:latest</span></span></span><br><span class="line">docker rmi redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#强制删除(针对基于镜像有运行的容器进程)</span></span></span><br><span class="line">docker rmi -f redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#多个镜像删除，不同镜像间以空格间隔</span></span></span><br><span class="line">docker rmi -f redis tomcat nginx</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#删除本地全部镜像</span></span></span><br><span class="line">docker rmi -f $(docker images -q)</span><br></pre></td></tr></table></figure><h3 id="2-5、镜像构建"><a href="#2-5、镜像构建" class="headerlink" title="2.5、镜像构建"></a>2.5、镜像构建</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#（1）编写dockerfile</span></span></span><br><span class="line">cd /docker/dockerfile</span><br><span class="line">vim mycentos</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#（2）构建docker镜像</span></span></span><br><span class="line">docker build -f /docker/dockerfile/mycentos -t mycentos:1.1</span><br></pre></td></tr></table></figure><h2 id="3、容器操作"><a href="#3、容器操作" class="headerlink" title="3、容器操作"></a>3、容器操作</h2><p>提示：对于容器的操作可使用CONTAINER ID 或 NAMES。</p><h3 id="3-1、容器启动"><a href="#3-1、容器启动" class="headerlink" title="3.1、容器启动"></a>3.1、容器启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#新建并启动容器，参数：-i  以交互模式运行容器；-t  为容器重新分配一个伪输入终端；--name  为容器指定一个名称</span></span></span><br><span class="line">docker run -i -t --name mycentos</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#后台启动容器，参数：-d  已守护方式启动容器</span></span></span><br><span class="line">docker run -d mycentos</span><br></pre></td></tr></table></figure><p>注意：此时使用”docker ps -a”会发现容器已经退出。这是docker的机制：要使Docker容器后台运行，就必须有一个前台进程。解决方案：将你要运行的程序以前台进程的形式运行。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#启动一个或多个已经被停止的容器</span></span></span><br><span class="line">docker start redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#重启容器</span></span></span><br><span class="line">docker restart redis</span><br></pre></td></tr></table></figure><h3 id="3-2、容器进程"><a href="#3-2、容器进程" class="headerlink" title="3.2、容器进程"></a>3.2、容器进程</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#top支持 ps 命令参数，格式：docker top [OPTIONS] CONTAINER [ps OPTIONS]</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#列出redis容器中运行进程</span></span></span><br><span class="line">docker top redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看所有运行容器的进程信息</span></span></span><br><span class="line">for i in  `docker ps |grep Up|awk &#x27;&#123;print $1&#125;&#x27;`;do echo \ &amp;&amp;docker top $i; done</span><br></pre></td></tr></table></figure><h3 id="3-3、容器日志"><a href="#3-3、容器日志" class="headerlink" title="3.3、容器日志"></a>3.3、容器日志</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看redis容器日志，默认参数</span></span></span><br><span class="line">docker logs rabbitmq</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看redis容器日志，参数：-f  跟踪日志输出；-t   显示时间戳；--tail  仅列出最新N条容器日志；</span></span></span><br><span class="line">docker logs -f -t --tail=20 redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看容器redis从2019年05月21日后的最新10条日志。</span></span></span><br><span class="line">docker logs --since=&quot;2019-05-21&quot; --tail=10 redis</span><br></pre></td></tr></table></figure><h3 id="3-4、容器的进入与退出"><a href="#3-4、容器的进入与退出" class="headerlink" title="3.4、容器的进入与退出"></a>3.4、容器的进入与退出</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#使用run方式在创建时进入</span></span></span><br><span class="line">docker run -it centos /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#关闭容器并退出</span></span></span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#仅退出容器，不关闭</span></span></span><br><span class="line">快捷键：Ctrl + P + Q</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#直接进入centos 容器启动命令的终端，不会启动新进程，多个attach连接共享容器屏幕，参数：--sig-proxy=false  确保CTRL-D或CTRL-C不会关闭容器</span></span></span><br><span class="line">docker attach --sig-proxy=false centos </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#在 centos 容器中打开新的交互模式终端，可以启动新进程，参数：-i  即使没有附加也保持STDIN 打开；-t  分配一个伪终端</span></span></span><br><span class="line">docker exec -i -t  centos /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#以交互模式在容器中执行命令，结果返回到当前终端屏幕</span></span></span><br><span class="line">docker exec -i -t centos ls -l /tmp</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#以分离模式在容器中执行命令，程序后台运行，结果不会反馈到当前终端</span></span></span><br><span class="line">docker exec -d centos  touch cache.txt </span><br></pre></td></tr></table></figure><h3 id="3-5、查看容器"><a href="#3-5、查看容器" class="headerlink" title="3.5、查看容器"></a>3.5、查看容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看正在运行的容器</span></span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看正在运行的容器的ID</span></span></span><br><span class="line">docker ps -q</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看正在运行+历史运行过的容器</span></span></span><br><span class="line">docker ps -a</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#显示运行容器总文件大小</span></span></span><br><span class="line">docker ps -s</span><br></pre></td></tr></table></figure><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606070531344.png" alt="image-20210606070531344"></p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606070545897.png" alt="image-20210606070545897"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#显示最近创建容器</span></span></span><br><span class="line">docker ps -l</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#显示最近创建的3个容器</span></span></span><br><span class="line">docker ps -n 3</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#不截断输出</span></span></span><br><span class="line">docker ps --no-trunc </span><br></pre></td></tr></table></figure><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606070557255.png" alt="image-20210606070557255"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#获取镜像redis的元信息</span></span></span><br><span class="line">docker inspect redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#获取正在运行的容器redis的 IP</span></span></span><br><span class="line">docker inspect --format=&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27; redis</span><br></pre></td></tr></table></figure><h3 id="3-6、容器的停止与删除"><a href="#3-6、容器的停止与删除" class="headerlink" title="3.6、容器的停止与删除"></a>3.6、容器的停止与删除</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#停止一个运行中的容器</span></span></span><br><span class="line">docker stop redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#杀掉一个运行中的容器</span></span></span><br><span class="line">docker kill redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#删除一个已停止的容器</span></span></span><br><span class="line">docker rm redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#删除一个运行中的容器</span></span></span><br><span class="line">docker rm -f redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#删除多个容器</span></span></span><br><span class="line">docker rm -f $(docker ps -a -q)</span><br><span class="line">docker ps -a -q | xargs docker rm</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># -l 移除容器间的网络连接，连接名为 db</span></span></span><br><span class="line">docker rm -l db </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># -v 删除容器，并删除容器挂载的数据卷</span></span></span><br><span class="line">docker rm -v redis</span><br></pre></td></tr></table></figure><h3 id="3-7、生成镜像"><a href="#3-7、生成镜像" class="headerlink" title="3.7、生成镜像"></a>3.7、生成镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#基于当前redis容器创建一个新的镜像；参数：-a 提交的镜像作者；-c 使用Dockerfile指令来创建镜像；-m :提交时的说明文字；-p :在commit时，将容器暂停</span></span></span><br><span class="line">docker commit -a=&quot;DeepInThought&quot; -m=&quot;my redis&quot; [redis容器ID]  myredis:v1.1</span><br></pre></td></tr></table></figure><h3 id="3-8、容器与主机间的数据拷贝"><a href="#3-8、容器与主机间的数据拷贝" class="headerlink" title="3.8、容器与主机间的数据拷贝"></a>3.8、容器与主机间的数据拷贝</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#将rabbitmq容器中的文件copy至本地路径</span></span></span><br><span class="line">docker cp rabbitmq:/[container_path] [local_path]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#将主机文件copy至rabbitmq容器</span></span></span><br><span class="line">docker cp [local_path] rabbitmq:/[container_path]/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#将主机文件copy至rabbitmq容器，目录重命名为[container_path]（注意与非重命名copy的区别）</span></span></span><br><span class="line">docker cp [local_path] rabbitmq:/[container_path]</span><br><span class="line">推荐阅读</span><br></pre></td></tr></table></figure><ul><li><p>理解AOP</p></li><li><ul><li>什么是AOP</li><li>AOP体系与概念</li></ul></li><li><p>AOP实例</p></li><li><ul><li>第一个实例</li><li>第二个实例</li></ul></li><li><p>AOP相关注解</p></li><li><ul><li>@Pointcut</li><li>@Around</li><li>@Before</li><li>@After</li><li>@AfterReturning</li><li>@AfterThrowing</li></ul></li></ul><h1 id="SpringBoot：切面AOP实现权限校验：实例演示与注解全解"><a href="#SpringBoot：切面AOP实现权限校验：实例演示与注解全解" class="headerlink" title="SpringBoot：切面AOP实现权限校验：实例演示与注解全解"></a>SpringBoot：切面AOP实现权限校验：实例演示与注解全解</h1><h2 id="1-理解AOP"><a href="#1-理解AOP" class="headerlink" title="1 理解AOP"></a>1 理解AOP</h2><h3 id="1-1-什么是AOP"><a href="#1-1-什么是AOP" class="headerlink" title="1.1 什么是AOP"></a>1.1 什么是AOP</h3><blockquote><p>AOP（Aspect Oriented Programming），面向切面思想，是Spring的三大核心思想之一（两外两个：IOC-控制反转、DI-依赖注入）。</p></blockquote><p>那么AOP为何那么重要呢？在我们的程序中，经常存在一些系统性的需求，比如权限校验、日志记录、统计等，这些代码会散落穿插在各个业务逻辑中，非常冗余且不利于维护。例如下面这个示意图：<br><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071038326.png" alt="image-20210606071038326"><br>有多少业务操作，就要写多少重复的校验和日志记录代码，这显然是无法接受的。当然，用面向对象的思想，我们可以把这些重复的代码抽离出来，写成公共方法，就是下面这样：</p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071447347.png" alt="image-20210606071447347"><br>这样，代码冗余和可维护性的问题得到了解决，但每个业务方法中依然要依次手动调用这些公共方法，也是略显繁琐。有没有更好的方式呢？有的，那就是AOP，AOP将权限校验、日志记录等非业务代码完全提取出来，与业务代码分离，并寻找节点切入业务代码中：</p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071049481.png" alt="image-20210606071049481"></p><h3 id="1-2-AOP体系与概念"><a href="#1-2-AOP体系与概念" class="headerlink" title="1.2 AOP体系与概念"></a>1.2 AOP体系与概念</h3><p>简单地去理解，其实AOP要做三类事：</p><ul><li>在哪里切入，也就是权限校验等非业务操作在哪些业务代码中执行。</li><li>在什么时候切入，是业务代码执行前还是执行后。</li><li>切入后做什么事，比如做权限校验、日志记录等。</li></ul><p>因此，AOP的体系可以梳理为下图：<br><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071502493.png" alt="image-20210606071502493"><br>一些概念详解：</p><ul><li><code>Pointcut</code>：切点，决定处理如权限校验、日志记录等在何处切入业务代码中（即织入切面）。切点分为<code>execution</code>方式和<code>annotation</code>方式。前者可以用路径表达式指定哪些类织入切面，后者可以指定被哪些注解修饰的代码织入切面。</li><li><code>Advice</code>：处理，包括处理时机和处理内容。处理内容就是要做什么事，比如校验权限和记录日志。处理时机就是在什么时机执行处理内容，分为前置处理（即业务代码执行前）、后置处理（业务代码执行后）等。</li><li><code>Aspect</code>：切面，即<code>Pointcut</code>和<code>Advice</code>。</li><li><code>Joint point</code>：连接点，是程序执行的一个点。例如，一个方法的执行或者一个异常的处理。在 Spring AOP 中，一个连接点总是代表一个方法执行。</li><li><code>Weaving</code>：织入，就是通过动态代理，在目标对象方法中执行处理内容的过程。</li></ul><p>网络上有张图，我觉得非常传神，贴在这里供大家观详：<br><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071530358.png" alt="image-20210606071530358"></p><h2 id="2-AOP实例"><a href="#2-AOP实例" class="headerlink" title="2 AOP实例"></a>2 AOP实例</h2><p>实践出真知，接下来我们就撸代码来实现一下AOP。完成项目已上传至：</p><blockquote><p><a target="_blank" rel="noopener" href="https://github.com/ThinkMugz/aopDemo">https://github.com/ThinkMugz/aopDemo</a></p></blockquote><p>使用 AOP，首先需要引入 AOP 的依赖。参数校验：<a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&mid=2247489603&idx=2&sn=c7a766500122c02694860bd2470204cf&chksm=ebd6276fdca1ae7997a98d8c038ad3462c7ee9b492f28b4de8b7461ca0965fac55d94f96dd37&scene=21#wechat_redirect">这么写参数校验(validator)就不会被劝退了~</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-1-第一个实例"><a href="#2-1-第一个实例" class="headerlink" title="2.1 第一个实例"></a>2.1 第一个实例</h3><p>接下来，我们先看一个极简的例子：所有的<code>get</code>请求被调用前在控制台输出一句”get请求的advice触发了”。</p><p>具体实现如下：</p><ol><li>创建一个AOP切面类，只要在类上加个 <code>@Aspect</code> 注解即可。<code>@Aspect</code> 注解用来描述一个切面类，定义切面类的时候需要打上这个注解。<code>@Component</code> 注解将该类交给 Spring 来管理。在这个类里实现advice：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mu.demo.advice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAdvice</span> &#123;</span><br><span class="line">    <span class="comment">// 定义一个切点：所有被GetMapping注解修饰的方法会织入advice</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(org.springframework.web.bind.annotation.GetMapping)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">logAdvicePointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Before表示logAdvice将在目标方法执行前执行</span></span><br><span class="line">    <span class="meta">@Before(&quot;logAdvicePointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logAdvice</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="comment">// 这里只是一个示例，你可以写任何处理逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;get请求的advice触发了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>创建一个接口类，内部创建一个get请求：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mu.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/aop&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/getTest&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JSONObject <span class="title function_">aopTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(<span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;SUCCESS\&quot;,\&quot;code\&quot;:200&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"> <span class="meta">@PostMapping(value = &quot;/postTest&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JSONObject <span class="title function_">aopTest2</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(<span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;SUCCESS\&quot;,\&quot;code\&quot;:200&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>项目启动后，请求<code>http://localhost:8085/aop/getTest</code>接口：</p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/640" alt="图片">在这里插入图片描述</p><p>请求<code>http://localhost:8085/aop/postTest</code>接口，控制台无输出，证明切点确实是只针对被<code>GetMapping</code>修饰的方法。</p><h3 id="2-2-第二个实例"><a href="#2-2-第二个实例" class="headerlink" title="2.2 第二个实例"></a>2.2 第二个实例</h3><p>下面我们将问题复杂化一些，该例的场景是：</p><ol><li>自定义一个注解<code>PermissionsAnnotation</code></li><li>创建一个切面类，切点设置为拦截所有标注<code>PermissionsAnnotation</code>的方法，截取到接口的参数，进行简单的权限校验</li><li>将<code>PermissionsAnnotation</code>标注在测试接口类的测试接口<code>test</code>上</li></ol><p>具体的实现步骤：</p><ol><li>使用<code>@Target、@Retention、@Documented</code>自定义一个注解：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> PermissionAnnotation&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>创建第一个AOP切面类，，只要在类上加个 <code>@Aspect</code> 注解即可。<code>@Aspect</code> 注解用来描述一个切面类，定义切面类的时候需要打上这个注解。<code>@Component</code> 注解将该类交给 Spring 来管理。在这个类里实现第一步权限校验逻辑：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PermissionFirstAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 定义一个切面，括号内写入第1步中自定义注解的路径</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.mu.demo.annotation.PermissionAnnotation)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">permissionCheck</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;permissionCheck()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">permissionCheckFirst</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===================第一个切面===================：&quot;</span> + System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取请求参数，详见接口类</span></span><br><span class="line">        Object[] objects = joinPoint.getArgs();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> ((JSONObject) objects[<span class="number">0</span>]).getLong(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> ((JSONObject) objects[<span class="number">0</span>]).getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;id1-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span> + id);</span><br><span class="line">        System.out.println(<span class="string">&quot;name1-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span> + name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// id小于0则抛出非法id的异常</span></span><br><span class="line">        <span class="keyword">if</span> (id &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> JSON.parseObject(<span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;illegal id\&quot;,\&quot;code\&quot;:403&#125;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>创建接口类，并在目标方法上标注自定义注解 <code>PermissionsAnnotation</code>：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/permission&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/check&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="comment">// 添加这个注解</span></span><br><span class="line">    <span class="meta">@PermissionsAnnotation()</span></span><br><span class="line">    <span class="keyword">public</span> JSONObject <span class="title function_">getGroupList</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(<span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;SUCCESS\&quot;,\&quot;code\&quot;:200&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里，我们先进行一个测试。首先，填好请求地址和header：</p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071700914.png" alt="image-20210606071700914"></p><p>其次，构造正常的参数：</p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071714488.png" alt="image-20210606071714488"></p><p>可以拿到正常的响应结果：</p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071730869.png" alt="image-20210606071730869"></p><p>然后，构造一个异常参数，再次请求：</p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071745609.png" alt="image-20210606071745609"></p><p>响应结果显示，切面类进行了判断，并返回相应结果：</p><p>!<img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071816202.png" alt="image-20210606071816202"></p><p>有人会问，如果我一个接口想设置多个切面类进行校验怎么办？这些切面的执行顺序如何管理？</p><p>很简单，一个自定义的<code>AOP</code>注解可以对应多个切面类，这些切面类执行顺序由<code>@Order</code>注解管理，该注解后的数字越小，所在切面类越先执行。</p><p>下面在实例中进行演示：</p><p>创建第二个AOP切面类，在这个类里实现第二步权限校验：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PermissionSecondAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Pointcut(&quot;@annotation(com.example.demo.PermissionsAnnotation)&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">permissionCheck</span><span class="params">()</span> &#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Around(&quot;permissionCheck()&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Object <span class="title function_">permissionCheckSecond</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;===================第二个切面===================：&quot;</span> + System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">       <span class="comment">//获取请求参数，详见接口类</span></span><br><span class="line">       Object[] objects = joinPoint.getArgs();</span><br><span class="line">       <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> ((JSONObject) objects[<span class="number">0</span>]).getLong(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> ((JSONObject) objects[<span class="number">0</span>]).getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;id-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span> + id);</span><br><span class="line">       System.out.println(<span class="string">&quot;name-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span> + name);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// name不是管理员则抛出异常</span></span><br><span class="line">       <span class="keyword">if</span> (!name.equals(<span class="string">&quot;admin&quot;</span>)) &#123;</span><br><span class="line">           <span class="keyword">return</span> JSON.parseObject(<span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;not admin\&quot;,\&quot;code\&quot;:403&#125;&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重启项目，继续测试，构造两个参数都异常的情况：</p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071836461.png" alt="image-20210606071836461"></p><p>响应结果，表面第二个切面类执行顺序更靠前：</p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/HV4yTI6PjbLsHvicPPQst11FJvVicm1woPr9ZoScibZqiaILzkhx2q9AavWJwVvqLu7p1fN2njOL8ZLlxZghGWElnw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p><h2 id="3-AOP相关注解"><a href="#3-AOP相关注解" class="headerlink" title="3 AOP相关注解"></a>3 AOP相关注解</h2><p>上面的案例中，用到了诸多注解，下面针对这些注解进行详解。</p><h3 id="3-1-Pointcut"><a href="#3-1-Pointcut" class="headerlink" title="3.1 @Pointcut"></a>3.1 @Pointcut</h3><p><code>@Pointcut</code> 注解，用来定义一个切面，即上文中所关注的某件事情的入口，切入点定义了事件触发时机。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspectHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义一个切面，拦截 com.itcodai.course09.controller 包和子包下的所有方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.mutest.controller..*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Pointcut 注解指定一个切面，定义需要拦截的东西，这里介绍两个常用的表达式：一个是使用 <code>execution()</code>，另一个是使用 <code>annotation()</code>。</p><p>更多参考：<a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&mid=2247488811&idx=2&sn=0d054027651bef114ae6bec5a8f62359&chksm=ebd62a07dca1a3111269692dd9b0a5ab8af7d2038b8ec6600a057573364e76db1332adc5fd46&scene=21#wechat_redirect">SpringBoot内容聚合</a></p><p>execution表达式：</p><p>以 <code>execution(* * com.mutest.controller..*.*(..)))</code> 表达式为例：</p><ul><li>第一个 * 号的位置：表示返回值类型，* 表示所有类型。</li><li>包名：表示需要拦截的包名，后面的两个句点表示当前包和当前包的所有子包，在本例中指 com.mutest.controller包、子包下所有类的方法。</li><li>第二个 * 号的位置：表示类名，* 表示所有类。</li><li><em>(..)：这个星号表示方法名，</em> 表示所有的方法，后面括弧里面表示方法的参数，两个句点表示任何参数。</li></ul><p>annotation() 表达式：</p><p><code>annotation()</code> 方式是针对某个注解来定义切面，比如我们对具有 @PostMapping 注解的方法做切面，可以如下定义切面：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;@annotation(org.springframework.web.bind.annotation.PostMapping)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">annotationPointcut</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>然后使用该切面的话，就会切入注解是 <code>@PostMapping</code> 的所有方法。这种方式很适合处理 <code>@GetMapping、@PostMapping、@DeleteMapping</code>不同注解有各种特定处理逻辑的场景。</p><p>还有就是如上面案例所示，针对自定义注解来定义切面。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;@annotation(com.example.demo.PermissionsAnnotation)&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">permissionCheck</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-Around"><a href="#3-2-Around" class="headerlink" title="3.2 @Around"></a>3.2 @Around</h3><p><code>@Around</code>注解用于修饰<code>Around</code>增强处理，<code>Around</code>增强处理非常强大，表现在：</p><ol><li><code>@Around</code>可以自由选择增强动作与目标方法的执行顺序，也就是说可以在增强动作前后，甚至过程中执行目标方法。这个特性的实现在于，调用<code>ProceedingJoinPoint</code>参数的<code>procedd()</code>方法才会执行目标方法。</li><li><code>@Around</code>可以改变执行目标方法的参数值，也可以改变执行目标方法之后的返回值。</li></ol><p><code>Around</code>增强处理有以下特点：</p><ol><li>当定义一个<code>Around</code>增强处理方法时，该方法的第一个形参必须是 <code>ProceedingJoinPoint</code> 类型（至少一个形参）。在增强处理方法体内，调用<code>ProceedingJoinPoint</code>的<code>proceed</code>方法才会执行目标方法：这就是<code>@Around</code>增强处理可以完全控制目标方法执行时机、如何执行的关键；如果程序没有调用<code>ProceedingJoinPoint</code>的<code>proceed</code>方法，则目标方法不会执行。</li><li>调用<code>ProceedingJoinPoint</code>的<code>proceed</code>方法时，还可以传入一个<code>Object[ ]</code>对象，该数组中的值将被传入目标方法作为实参——这就是<code>Around</code>增强处理方法可以改变目标方法参数值的关键。这就是如果传入的<code>Object[ ]</code>数组长度与目标方法所需要的参数个数不相等，或者<code>Object[ ]</code>数组元素与目标方法所需参数的类型不匹配，程序就会出现异常。</li></ol><p><code>@Around</code>功能虽然强大，但通常需要在线程安全的环境下使用。因此，如果使用普通的<code>Before</code>、<code>AfterReturning</code>就能解决的问题，就没有必要使用<code>Around</code>了。如果需要目标方法执行之前和之后共享某种状态数据，则应该考虑使用<code>Around</code>。尤其是需要使用增强处理阻止目标的执行，或需要改变目标方法的返回值时，则只能使用<code>Around</code>增强处理了。</p><p>下面，在前面例子上做一些改造，来观察<code>@Around</code>的特点。</p><p>自定义注解类不变。首先，定义接口类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/permission&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/check&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@PermissionsAnnotation()</span></span><br><span class="line">    <span class="keyword">public</span> JSONObject <span class="title function_">getGroupList</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(<span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;SUCCESS\&quot;,\&quot;code\&quot;:200,\&quot;data\&quot;:&quot;</span> + request + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>唯一切面类（前面案例有两个切面类，这里只需保留一个即可）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PermissionAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.example.demo.PermissionsAnnotation)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">permissionCheck</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;permissionCheck()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">permissionCheck</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===================开始增强处理===================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取请求参数，详见接口类</span></span><br><span class="line">        Object[] objects = joinPoint.getArgs();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> ((JSONObject) objects[<span class="number">0</span>]).getLong(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> ((JSONObject) objects[<span class="number">0</span>]).getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;id1-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span> + id);</span><br><span class="line">        System.out.println(<span class="string">&quot;name1-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span> + name);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改入参</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        object.put(<span class="string">&quot;id&quot;</span>, <span class="number">8</span>);</span><br><span class="line">        object.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        objects[<span class="number">0</span>] = object;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 将修改后的参数传入</span></span><br><span class="line">        <span class="keyword">return</span> joinPoint.proceed(objects);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同样使用JMeter调用接口，传入参数：<code>&#123;&quot;id&quot;:-5,&quot;name&quot;:&quot;admin&quot;&#125;</code>，响应结果表明：<code>@Around</code>截取到了接口的入参，并使接口返回了切面类中的结果。<br><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606071923271.png" alt="image-20210606071923271"></p><h3 id="3-3-Before"><a href="#3-3-Before" class="headerlink" title="3.3 @Before"></a>3.3 @Before</h3><p><code>@Before</code> 注解指定的方法在切面切入目标方法之前执行，可以做一些 <code>Log</code> 处理，也可以做一些信息的统计，比如获取用户的请求 <code>URL</code> 以及用户的 <code>IP</code> 地址等等，这个在做个人站点的时候都能用得到，都是常用的方法。例如下面代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspectHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在上面定义的切面方法之前执行该方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint jointPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBefore</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;====doBefore方法进入了====&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取签名</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        <span class="comment">// 获取切入的包名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">declaringTypeName</span> <span class="operator">=</span> signature.getDeclaringTypeName();</span><br><span class="line">        <span class="comment">// 获取即将执行的方法名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">funcName</span> <span class="operator">=</span> signature.getName();</span><br><span class="line">        log.info(<span class="string">&quot;即将执行方法为: &#123;&#125;，属于&#123;&#125;包&quot;</span>, funcName, declaringTypeName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 也可以用来记录一些信息，比如获取请求的 URL 和 IP</span></span><br><span class="line">        <span class="type">ServletRequestAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> attributes.getRequest();</span><br><span class="line">        <span class="comment">// 获取请求 URL</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.getRequestURL().toString();</span><br><span class="line">        <span class="comment">// 获取请求 IP</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> request.getRemoteAddr();</span><br><span class="line">        log.info(<span class="string">&quot;用户请求的url为：&#123;&#125;，ip地址为：&#123;&#125;&quot;</span>, url, ip);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>JointPoint</code> 对象很有用，可以用它来获取一个签名，利用签名可以获取请求的包名、方法名，包括参数（通过 <code>joinPoint.getArgs()</code> 获取）等。</p><h3 id="3-4-After"><a href="#3-4-After" class="headerlink" title="3.4 @After"></a>3.4 @After</h3><p><code>@After</code> 注解和 <code>@Before</code> 注解相对应，指定的方法在切面切入目标方法之后执行，也可以做一些完成某方法之后的 Log 处理。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspectHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义一个切面，拦截 com.mutest.controller 包下的所有方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.mutest.controller..*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在上面定义的切面方法之后执行该方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint jointPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfter</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;==== doAfter 方法进入了====&quot;</span>);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> signature.getName();</span><br><span class="line">        log.info(<span class="string">&quot;方法&#123;&#125;已经执行完&quot;</span>, method);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>到这里，我们来写个 Controller 测试一下执行结果，新建一个 AopController 如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/aop&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testAop</span><span class="params">(<span class="meta">@PathVariable</span> String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动项目，在浏览器中输入：localhost:8080/aop/csdn，观察一下控制台的输出信息：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">====doBefore 方法进入了====  </span><br><span class="line">即将执行方法为: testAop，属于com.itcodai.mutest.AopController包  </span><br><span class="line">用户请求的 url 为：http:<span class="comment">//localhost:8080/aop/name，ip地址为：0:0:0:0:0:0:0:1  </span></span><br><span class="line">==== doAfter 方法进入了====  </span><br><span class="line">方法 testAop 已经执行完</span><br></pre></td></tr></table></figure><p>从打印出来的 <code>Log</code> 中可以看出程序执行的逻辑与顺序，可以很直观的掌握 <code>@Before</code> 和 <code>@After</code> 两个注解的实际作用。</p><h3 id="3-5-AfterReturning"><a href="#3-5-AfterReturning" class="headerlink" title="3.5 @AfterReturning"></a>3.5 @AfterReturning</h3><p><code>@AfterReturning</code> 注解和 <code>@After</code> 有些类似，区别在于 <code>@AfterReturning</code> 注解可以用来捕获切入方法执行完之后的返回值，对返回值进行业务逻辑上的增强处理，例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspectHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在上面定义的切面方法返回后执行该方法，可以捕获返回对象或者对返回对象进行增强</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint joinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;pointCut()&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        <span class="type">String</span> <span class="variable">classMethod</span> <span class="operator">=</span> signature.getName();</span><br><span class="line">        log.info(<span class="string">&quot;方法&#123;&#125;执行完毕，返回参数为：&#123;&#125;&quot;</span>, classMethod, result);</span><br><span class="line">        <span class="comment">// 实际项目中可以根据业务做具体的返回值增强</span></span><br><span class="line">        log.info(<span class="string">&quot;对返回参数进行业务上的增强：&#123;&#125;&quot;</span>, result + <span class="string">&quot;增强版&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要注意的是，在 <code>@AfterReturning</code> 注解 中，属性 <code>returning</code> 的值必须要和参数保持一致，否则会检测不到。该方法中的第二个入参就是被切方法的返回值，在 <code>doAfterReturning</code> 方法中可以对返回值进行增强，可以根据业务需要做相应的封装。我们重启一下服务，再测试一下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">方法 testAop 执行完毕，返回参数为：Hello CSDN  </span><br><span class="line">对返回参数进行业务上的增强：Hello CSDN 增强版</span><br></pre></td></tr></table></figure><h3 id="3-6-AfterThrowing"><a href="#3-6-AfterThrowing" class="headerlink" title="3.6 @AfterThrowing"></a>3.6 @AfterThrowing</h3><p>当被切方法执行过程中抛出异常时，会进入 <code>@AfterThrowing</code> 注解的方法中执行，在该方法中可以做一些异常的处理逻辑。要注意的是 <code>throwing</code> 属性的值必须要和参数一致，否则会报错。该方法中的第二个入参即为抛出的异常。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspectHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在上面定义的切面方法执行抛异常时，执行该方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint jointPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex ex</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterThrowing(pointcut = &quot;pointCut()&quot;, throwing = &quot;ex&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(JoinPoint joinPoint, Throwable ex)</span> &#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> signature.getName();</span><br><span class="line">        <span class="comment">// 处理异常的逻辑</span></span><br><span class="line">        log.info(<span class="string">&quot;执行方法&#123;&#125;出错，异常为：&#123;&#125;&quot;</span>, method, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上就是AOP的全部内容。通过几个例子就可以感受到，AOP的便捷之处。欢迎大家指出文中不足之处，喜欢的朋友来个一键三连，听说这么做的人offer拿到手软( •̀ ω •́ )y</p><h1 id="Spring-Boot-五种热部署方式"><a href="#Spring-Boot-五种热部署方式" class="headerlink" title="Spring Boot 五种热部署方式"></a>Spring Boot 五种热部署方式</h1><ul><li>1、模板热部署</li><li>2、使用调试模式Debug实现热部署</li><li>3、spring-boot-devtools</li><li>4、Spring Loaded</li><li>5、JRebel</li></ul><h2 id="1、模板热部署"><a href="#1、模板热部署" class="headerlink" title="1、模板热部署"></a>1、模板热部署</h2><p>在 Spring Boot 中，模板引擎的页面默认是开启缓存的，如果修改了页面的内容，则刷新页面是得不到修改后的页面的，因此我们可以在application.properties中关闭模版引擎的缓存，如下：</p><p>Thymeleaf的配置：</p><blockquote><p>spring.thymeleaf.cache=false</p></blockquote><p>FreeMarker的配置：</p><blockquote><p>spring.freemarker.cache=false</p></blockquote><p>Groovy的配置：</p><blockquote><p>spring.groovy.template.cache=false</p></blockquote><p>Velocity的配置：</p><blockquote><p>spring.velocity.cache=false</p></blockquote><h2 id="2、使用调试模式Debug实现热部署"><a href="#2、使用调试模式Debug实现热部署" class="headerlink" title="2、使用调试模式Debug实现热部署"></a>2、使用调试模式Debug实现热部署</h2><p>此种方式为最简单最快速的一种热部署方式，运行系统时使用Debug模式，无需装任何插件即可，但是无发对配置文件，方法名称改变，增加类及方法进行热部署，使用范围有限。</p><h2 id="3、spring-boot-devtools"><a href="#3、spring-boot-devtools" class="headerlink" title="3、spring-boot-devtools"></a>3、spring-boot-devtools</h2><p>在 Spring Boot 项目中添加 spring-boot-devtools依赖即可实现页面和代码的热部署。</p><p>如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此种方式的特点是作用范围广，系统的任何变动包括配置文件修改、方法名称变化都能覆盖，但是后遗症也非常明显，它是采用文件变化后重启的策略来实现了，主要是节省了我们手动点击重启的时间，提高了实效性，在体验上会稍差。</p><p>spring-boot-devtools 默认关闭了模版缓存，如果使用这种方式不用单独配置关闭模版缓存。</p><h2 id="4、Spring-Loaded"><a href="#4、Spring-Loaded" class="headerlink" title="4、Spring Loaded"></a>4、Spring Loaded</h2><p>此种方式与Debug模式类似，适用范围有限，但是不依赖于Debug模式启动，通过Spring Loaded库文件启动，即可在正常模式下进行实时热部署。此种需要在 run confrgration 中进行配置。</p><h2 id="5、JRebel"><a href="#5、JRebel" class="headerlink" title="5、JRebel"></a>5、JRebel</h2><p>Jrebel是Java开发最好的热部署工具，对 Spring Boot 提供了极佳的支持，JRebel为收费软件，试用期14天。，可直接通过插件安装。</p><p><strong>JRebel破解方式</strong></p><p>服务器地址监听服务器地址：</p><p><a target="_blank" rel="noopener" href="http://jrebel.cicoding.cn/">http://jrebel.cicoding.cn</a></p><p>GUID生成器：</p><p><a target="_blank" rel="noopener" href="http://jrebel.cicoding.cn/guid">http://jrebel.cicoding.cn/guid</a></p><p>监听配置格式：</p><p><a target="_blank" rel="noopener" href="http://jrebel.cicoding.cn/GUID">http://jrebel.cicoding.cn/GUID</a></p><p>生成的如下：</p><p><a target="_blank" rel="noopener" href="http://jrebel.cicoding.cn/4B068EB5-0941-4645-1E98-FC077D530A61">http://jrebel.cicoding.cn/4B068EB5-0941-4645-1E98-FC077D530A61</a></p><p>打开IDEA中Settings如下：</p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606072421885.png" alt="image-20210606072421885"></p><p>找到File -&gt; Settings -&gt; JRebel &amp; XRebel 点击Chanage license，填写URL和邮箱地址</p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606072405800.png" alt="image-20210606072405800"></p><p>点击Chanage license！</p><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606072348040.png" alt="image-20210606072348040"></p><p>就监听成功激活成功了！鼓掌！</p><p>然后就可以启动使用了！</p><h1 id="基于SpringBoot，来实现MySQL读写分离技术"><a href="#基于SpringBoot，来实现MySQL读写分离技术" class="headerlink" title="基于SpringBoot，来实现MySQL读写分离技术"></a>基于SpringBoot，来实现MySQL读写分离技术</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h2><p>首先思考一个问题:在高并发的场景中,关于数据库都有哪些优化的手段？常用的有以下的实现方法:读写分离、加缓存、主从架构集群、分库分表等，在互联网应用中,大部分都是<strong>读多写少</strong>的场景,设置两个库,主库和读库。</p><p><strong>主库的职能是负责写,从库主要是负责读,可以建立读库集群,通过读写职能在数据源上的隔离达到减少读写冲突、</strong> 释压<strong>数据库负载</strong>、保护数据库<strong>的目的</strong>。在实际的使用中,凡是涉及到写的部分直接切换到主库，读的部分直接切换到读库，这就是典型的读写分离技术。本篇博文将聚焦读写分离,探讨如何实现它。</p><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a><strong>目录</strong></h2><ul><li>一: 主从数据源的配置</li><li>二: 数据源路由的配置</li><li>三：数据源上下文环境</li><li>四：切换注解和 Aop 配置</li><li>五：用法以及测试</li><li>六：总结</li></ul><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606072617768.png" alt="image-20210606072617768"></p><p><strong>主从同步的局限性</strong>：这里分为主数据库和从数据库,主数据库和从数据库保持数据库结构的一致,主库负责写,当写入数据的时候,会自动同步数据到从数据库；从数据库负责读,当读请求来的时候,直接从读库读取数据,主数据库会自动进行数据复制到从数据库中。不过本篇博客不介绍这部分配置的知识,因为它更偏运维工作一点。</p><p>这里涉及到一个问题:主从复制的延迟问题,当写入到主数据库的过程中,突然来了一个读请求,而此时数据还没有完全同步,就会出现读请求的数据读不到或者读出的数据比原始值少的情况。具体的解决方法最简单的就是将读请求暂时指向主库,但是同时也失去了主从分离的部分意义。也就是说在严格意义上的数据一致性场景中,读写分离并非是完全适合的,注意更新的时效性是读写分离使用的缺点。</p><p>好了,这部分只是了解,接下来我们看下具体如何通过 java 代码来实现读写分离:</p><p>该项目需要引入如下依赖：springBoot、spring-aop、spring-jdbc、aspectjweaver 等</p><h2 id="一-主从数据源的配置"><a href="#一-主从数据源的配置" class="headerlink" title="一: 主从数据源的配置"></a><strong>一: 主从数据源的配置</strong></h2><p>我们需要配置主从数据库,主从数据库的配置一般都是写在配置文件里面。通过@ConfigurationProperties 注解,可以将配置文件(一般命名为:application.Properties)里的属性映射到具体的类属性上,从而读取到写入的值注入到具体的代码配置中,按照习惯大于约定的原则,主库我们都是注为 master,从库注为 slave。</p><p>本项目采用了阿里的 druid 数据库连接池,使用 build 建造者模式创建 DataSource 对象,DataSource 就是代码层面抽象出来的数据源,接着需要配置 sessionFactory、sqlTemplate、事务管理器等</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主从配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wyq</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.wyq.mysqlreadwriteseparate.mapper&quot;, sqlSessionTemplateRef = &quot;sqlTemplate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource.master&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">master</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource.slave&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">slaver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DruidDataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实例化数据源路由</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceRouter <span class="title function_">dynamicDB</span><span class="params">(<span class="meta">@Qualifier(&quot;master&quot;)</span> DataSource masterDataSource,</span></span><br><span class="line"><span class="params">                                      <span class="meta">@Autowired(required = false)</span> <span class="meta">@Qualifier(&quot;slaver&quot;)</span> DataSource slaveDataSource)</span> &#123;</span><br><span class="line">        <span class="type">DataSourceRouter</span> <span class="variable">dynamicDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceRouter</span>();</span><br><span class="line">        Map&lt;Object, Object&gt; targetDataSources = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        targetDataSources.put(DataSourceEnum.MASTER.getDataSourceName(), masterDataSource);</span><br><span class="line">        <span class="keyword">if</span> (slaveDataSource != <span class="literal">null</span>) &#123;</span><br><span class="line">            targetDataSources.put(DataSourceEnum.SLAVE.getDataSourceName(), slaveDataSource);</span><br><span class="line">        &#125;</span><br><span class="line">        dynamicDataSource.setTargetDataSources(targetDataSources);</span><br><span class="line">        dynamicDataSource.setDefaultTargetDataSource(masterDataSource);</span><br><span class="line">        <span class="keyword">return</span> dynamicDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置sessionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dynamicDataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sessionFactory</span><span class="params">(<span class="meta">@Qualifier(&quot;dynamicDB&quot;)</span> DataSource dynamicDataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        bean.setMapperLocations(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(<span class="string">&quot;classpath*:mapper/*Mapper.xml&quot;</span>));</span><br><span class="line">        bean.setDataSource(dynamicDataSource);</span><br><span class="line">        <span class="keyword">return</span> bean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建sqlTemplate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sqlSessionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionTemplate <span class="title function_">sqlTemplate</span><span class="params">(<span class="meta">@Qualifier(&quot;sessionFactory&quot;)</span> SqlSessionFactory sqlSessionFactory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SqlSessionTemplate</span>(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 事务配置</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dynamicDataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = &quot;dataSourceTx&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceTransactionManager <span class="title function_">dataSourceTransactionManager</span><span class="params">(<span class="meta">@Qualifier(&quot;dynamicDB&quot;)</span> DataSource dynamicDataSource)</span> &#123;</span><br><span class="line">        <span class="type">DataSourceTransactionManager</span> <span class="variable">dataSourceTransactionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">        dataSourceTransactionManager.setDataSource(dynamicDataSource);</span><br><span class="line">        <span class="keyword">return</span> dataSourceTransactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="二-数据源路由的配置"><a href="#二-数据源路由的配置" class="headerlink" title="二: 数据源路由的配置"></a><strong>二: 数据源路由的配置</strong></h2><p>路由在主从分离是非常重要的,基本是读写切换的核心。Spring 提供了 AbstractRoutingDataSource 根据用户定义的规则选择当前的数据源，作用就是在执行查询之前，设置使用的数据源,实现动态路由的数据源，在每次数据库查询操作前执行它的抽象方法 determineCurrentLookupKey() 决定使用哪个数据源。</p><p>为了能有一个全局的数据源管理器,此时我们需要引入 DataSourceContextHolder 这个数据库上下文管理器,可以理解为全局的变量,随时可取(见下面详细介绍),它的主要作用就是保存当前的数据源;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceRouter</span> <span class="keyword">extends</span> <span class="title class_">AbstractRoutingDataSource</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最终的determineCurrentLookupKey返回的是从DataSourceContextHolder中拿到的,因此在动态切换数据源的时候注解</span></span><br><span class="line"><span class="comment">     * 应该给DataSourceContextHolder设值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">determineCurrentLookupKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceContextHolder.get();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三：数据源上下文环境"><a href="#三：数据源上下文环境" class="headerlink" title="三：数据源上下文环境"></a><strong>三：数据源上下文环境</strong></h2><p>数据源上下文保存器,便于程序中可以随时取到当前的数据源,它主要利用 ThreadLocal 封装,因为 ThreadLocal 是线程隔离的,天然具有线程安全的优势。这里暴露了 set 和 get、clear 方法，set 方法用于赋值当前的数据源名,get 方法用于获取当前的数据源名称,clear 方法用于清除 ThreadLocal 中的内容,因为 ThreadLocal 的 key 是 weakReference 是有内存泄漏风险的,通过 remove 方法防止内存泄漏；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 利用ThreadLocal封装的保存数据源上线的上下文context</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceContextHolder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; context = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 赋值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> datasourceType</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String datasourceType)</span> &#123;</span><br><span class="line">        context.set(datasourceType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> context.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        context.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="四：切换注解和-Aop-配置"><a href="#四：切换注解和-Aop-配置" class="headerlink" title="四：切换注解和 Aop 配置"></a><strong>四：切换注解和 Aop 配置</strong></h2><p>首先我们来定义一个@DataSourceSwitcher 注解,拥有两个属性 ① 当前的数据源 ② 是否清除当前的数据源,并且只能放在方法上,(不可以放在类上,也没必要放在类上,因为我们在进行数据源切换的时候肯定是方法操作),该注解的主要作用就是进行数据源的切换,在 dao 层进行操作数据库的时候,可以在方法上注明表示的是当前使用哪个数据源;</p><p>@DataSourceSwitcher 注解的定义:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DataSourceSwitcher &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认数据源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DataSourceEnum <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> DataSourceEnum.MASTER;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">clear</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DataSourceAop 配置</p><p>为了赋予@DataSourceSwitcher 注解能够切换数据源的能力,我们需要使用 AOP,然后使用@Aroud 注解找到方法上有@DataSourceSwitcher.class 的方法,然后取注解上配置的数据源的值,设置到 DataSourceContextHolder 中,就实现了将当前方法上配置的数据源注入到全局作用域当中;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(value = 1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceContextAop</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(com.wyq.mysqlreadwriteseparate.annotation.DataSourceSwitcher)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">setDynamicDataSource</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">clear</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> <span class="built_in">this</span>.getMethod(pjp);</span><br><span class="line">            <span class="type">DataSourceSwitcher</span> <span class="variable">dataSourceSwitcher</span> <span class="operator">=</span> method.getAnnotation(DataSourceSwitcher.class);</span><br><span class="line">            clear = dataSourceSwitcher.clear();</span><br><span class="line">            DataSourceContextHolder.set(dataSourceSwitcher.value().getDataSourceName());</span><br><span class="line">            log.info(<span class="string">&quot;数据源切换至：&#123;&#125;&quot;</span>, dataSourceSwitcher.value().getDataSourceName());</span><br><span class="line">            <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (clear) &#123;</span><br><span class="line">                DataSourceContextHolder.clear();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Method <span class="title function_">getMethod</span><span class="params">(JoinPoint pjp)</span> &#123;</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) pjp.getSignature();</span><br><span class="line">        <span class="keyword">return</span> signature.getMethod();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="五：用法以及测试"><a href="#五：用法以及测试" class="headerlink" title="五：用法以及测试"></a><strong>五：用法以及测试</strong></h2><p>在配置好了读写分离之后,就可以在代码中使用了,一般而言我们使用在 service 层或者 dao 层,在需要查询的方法上添加@DataSourceSwitcher(DataSourceEnum.SLAVE),它表示该方法下所有的操作都走的是读库;在需要 update 或者 insert 的时候使用@DataSourceSwitcher(DataSourceEnum.MASTER)表示接下来将会走写库。</p><p>其实还有一种更为自动的写法,可以根据方法的前缀来配置 AOP 自动切换数据源,比如 update、insert、fresh 等前缀的方法名一律自动设置为写库,select、get、query 等前缀的方法名一律配置为读库,这是一种更为自动的配置写法。缺点就是方法名需要按照 aop 配置的严格来定义,否则就会失效</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DataSourceSwitcher(DataSourceEnum.SLAVE)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">getOrder</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderMapper.listOrders(orderId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 写操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DataSourceSwitcher(DataSourceEnum.MASTER)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">insertOrder</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setOrderId(orderId);</span><br><span class="line">        <span class="keyword">return</span> orderMapper.saveOrder(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="六：总结"><a href="#六：总结" class="headerlink" title="六：总结"></a><strong>六：总结</strong></h2><p><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/image-20210606072657214.png" alt="image-20210606072657214"></p><p>上面是基本流程简图,本篇博客介绍了如何实现数据库读写分离,注意读写分离的核心点就是数据路由,需要继承 AbstractRoutingDataSource,复写它的 determineCurrentLookupKey 方法,同时需要注意全局的上下文管理器 DataSourceContextHolder,它是保存数据源上下文的主要类,也是路由方法中寻找的数据源取值,相当于数据源的中转站.再结合 jdbc-Template 的底层去创建和管理数据源、事务等，我们的数据库读写分离就完美实现了。</p><h1 id="Spring-Boot-注解大全"><a href="#Spring-Boot-注解大全" class="headerlink" title="Spring Boot 注解大全"></a>Spring Boot 注解大全</h1><h2 id="一、注解-annotations-列表"><a href="#一、注解-annotations-列表" class="headerlink" title="一、注解 (annotations) 列表"></a>一、注解 (annotations) 列表</h2><p><strong>@SpringBootApplication</strong>：</p><p>包含了 @ComponentScan、@Configuration 和 @EnableAutoConfiguration 注解。</p><p>其中 @ComponentScan 让 spring Boot 扫描到 Configuration 类并把它加入到程序上下文。</p><p><strong>@Configuration</strong> 等同于 spring 的 XML 配置文件；使用 Java 代码可以检查类型安全。</p><p>**@EnableAutoConfiguration ** 自动配置。</p><p>**@ComponentScan ** 组件扫描，可自动发现和装配一些 Bean。</p><p><strong>@Component</strong> 可配合 CommandLineRunner 使用，在程序启动后执行一些基础任务。</p><p><strong>@RestController</strong> 注解是 @Controller 和 @ResponseBody 的合集, 表示这是个控制器 bean, 并且是将函数的返回值直 接填入 HTTP 响应体中, 是 REST 风格的控制器。</p><p><strong>@Autowired</strong> 自动导入。</p><p><strong>@PathVariable</strong> 获取参数。</p><p><strong>@JsonBackReference</strong> 解决嵌套外链问题。</p><p><strong>@RepositoryRestResourcepublic</strong> 配合 spring-boot-starter-data-rest 使用。</p><h2 id="二、注解-annotations-详解"><a href="#二、注解-annotations-详解" class="headerlink" title="二、注解 (annotations) 详解"></a>二、注解 (annotations) 详解</h2><p><strong>@SpringBootApplication</strong>：申明让 spring boot 自动给程序进行必要的配置，这个配置等同于：@Configuration ，@EnableAutoConfiguration 和 @ComponentScan 三个配置。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myproject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span> <span class="comment">// same as @Configuration @EnableAutoConfiguration @ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>@ResponseBody</strong>：表示该方法的返回结果直接写入 HTTP response body 中，一般在异步获取数据时使用，用于构建 RESTful 的 api。</p><p>在使用 @RequestMapping 后，返回值通常解析为跳转路径，加上 @responsebody 后返回结果不会被解析为跳转路径，而是直接写入 HTTP response body 中。</p><p>比如异步获取 json 数据，加上 @responsebody 后，会直接返回 json 数据。</p><p>该注解一般会配合 @RequestMapping 一起使用。示例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(“/test”)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>”ok”;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>@Controller</strong>：用于定义控制器类，在 spring 项目中由控制器负责将用户发来的 URL 请求转发到对应的服务接口（service 层）</p><p>一般这个注解在类中，通常方法需要配合注解 @RequestMapping。</p><p>示例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(“/demoInfo”)</span></span><br><span class="line">publicclass DemoController &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DemoInfoService demoInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(Map map)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;DemoController.hello()&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;from TemplateController.helloHtml&quot;</span>);</span><br><span class="line">        <span class="comment">//会使用hello.html或者hello.ftl模板进行渲染显示.</span></span><br><span class="line">        <span class="keyword">return</span><span class="string">&quot;/hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>@RestController</strong>：用于标注控制层组件 (如 struts 中的 action)，@ResponseBody 和 @Controller 的合集。</p><p>示例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kfit.demo.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(“/demoInfo2”)</span></span><br><span class="line">publicclass DemoController2 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span><span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>@RequestMapping</strong>：提供路由信息，负责 URL 到 Controller 中的具体函数的映射。</p><p><strong>@EnableAutoConfiguration</strong>：Spring Boot 自动配置（auto-configuration）：尝试根据你添加的 jar 依赖自动配置你的 Spring 应用。</p><p>例如，如果你的 classpath 下存在 HSQLDB，并且你没有手动配置任何数据库连接 beans，那么我们将自动配置一个内存型（in-memory）数据库”。</p><p>你可以将 @EnableAutoConfiguration 或者 @SpringBootApplication 注解添加到一个 @Configuration 类上来选择自动配置。</p><p>如果发现应用了你不想要的特定自动配置类，你可以使用 @EnableAutoConfiguration 注解的排除属性来禁用它们。</p><p><strong>@ComponentScan</strong>：表示将该类自动发现扫描组件。</p><p>个人理解相当于，如果扫描到有 @Component、@Controller、@Service 等这些注解的类，并注册为 Bean，可以自动收集所有的 Spring 组件，包括 @Configuration 类。</p><p>我们经常使用 @ComponentScan 注解搜索 beans，并结合 @Autowired 注解导入。可以自动收集所有的 Spring 组件，包括 @Configuration 类。</p><p>如果没有配置的话，Spring Boot 会扫描启动类所在包下以及子包下的使用了 @Service,@Repository 等注解的类。</p><p><strong>@Configuration</strong>：相当于传统的 xml 配置文件，如果有些第三方库需要用到 xml 文件，建议仍然通过 @Configuration 类作为项目的配置主类——可以使用 @ImportResource 注解加载 xml 配置文件。</p><p><strong>@Import</strong>：用来导入其他配置类。</p><p><strong>@ImportResource</strong>：用来加载 xml 配置文件。</p><p><strong>@Autowired</strong>：自动导入依赖的 bean</p><p><strong>@Service</strong>：一般用于修饰 service 层的组件</p><p><strong>@Repository</strong>：使用 @Repository 注解可以确保 DAO 或者 repositories 提供异常转译，这个注解修饰的 DAO 或者 repositories 类会被 ComponetScan 发现并配置，同时也不需要为它们提供 XML 配置项。</p><p><strong>@Bean</strong>：用 @Bean 标注方法等价于 XML 中配置的 bean。</p><p><strong>@Value</strong>：注入 Spring boot application.properties 配置的属性的值。示例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(value = “#&#123;message&#125;”)</span></span><br><span class="line"><span class="keyword">private</span> String message;</span><br></pre></td></tr></table></figure><p><strong>@Inject</strong>：等价于默认的 @Autowired，只是没有 required 属性；</p><p><strong>@Component</strong>：泛指组件，当组件不好归类的时候，我们可以使用这个注解进行标注。</p><p><strong>@Bean</strong>：相当于 XML 中的, 放在方法的上面，而不是类，意思是产生一个 bean, 并交给 spring 管理。</p><p><strong>@AutoWired</strong>：自动导入依赖的 bean。byType 方式。把配置好的 Bean 拿来用，完成属性、方法的组装，它可以对类成员变量、方法及构造函数进行标注，完成自动装配的工作。当加上（required=false）时，就算找不到 bean 也不报错。</p><p><strong>@Qualifier</strong>：当有多个同一类型的 Bean 时，可以用 @Qualifier(“name”) 来指定。与 @Autowired 配合使用。@Qualifier 限定描述符除了能根据名字进行注入，但能进行更细粒度的控制如何选择候选者，具体使用方式如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(value = “demoInfoService”)</span></span><br><span class="line"><span class="keyword">private</span> DemoInfoService demoInfoService;</span><br></pre></td></tr></table></figure><p><strong>@Resource</strong>(name=”name”,type=”type”)：没有括号内内容的话，默认 byName。与 @Autowired 干类似的事。</p><h2 id="三、JPA-注解"><a href="#三、JPA-注解" class="headerlink" title="三、JPA 注解"></a>三、JPA 注解</h2><p><strong>@Entity</strong>：@Table(name=”“)：表明这是一个实体类。一般用于 jpa 这两个注解一般一块使用，但是如果表名和实体类名相同的话，@Table 可以省略</p><p><strong>@MappedSuperClass</strong>: 用在确定是父类的 entity 上。父类的属性子类可以继承。</p><p><strong>@NoRepositoryBean</strong>: 一般用作父类的 repository，有这个注解，spring 不会去实例化该 repository。</p><p><strong>@Column</strong>：如果字段名与列名相同，则可以省略。</p><p><strong>@Id</strong>：表示该属性为主键。</p><p><strong>@GeneratedValue</strong>(strategy=GenerationType.SEQUENCE,generator= “repair_seq”)：表示主键生成策略是 sequence（可以为 Auto、IDENTITY、native 等，Auto 表示可在多个数据库间切换），指定 sequence 的名字是 repair_seq。</p><p><strong>@SequenceGeneretor</strong>(name = “repair_seq”, sequenceName = “seq_repair”, allocationSize = 1)：name 为 sequence 的名称，以便使用，sequenceName 为数据库的 sequence 名称，两个名称可以一致。</p><p><strong>@Transient</strong>：表示该属性并非一个到数据库表的字段的映射, ORM 框架将忽略该属性。</p><p>如果一个属性并非数据库表的字段映射, 就务必将其标示为 @Transient, 否则, ORM 框架默认其注解为 @Basic。@Basic(fetch=FetchType.LAZY)：标记可以指定实体属性的加载方式</p><p><strong>@JsonIgnore</strong>：作用是 json 序列化时将 Java bean 中的一些属性忽略掉, 序列化和反序列化都受影响。</p><p><strong>@JoinColumn</strong>（name=”loginId”）: 一对一：本表中指向另一个表的外键。一对多：另一个表指向本表的外键。</p><p><strong>@OneToOne、@OneToMany、@ManyToOne</strong>：对应 hibernate 配置文件中的一对一，一对多，多对一。</p><h2 id="四、springMVC-相关注解"><a href="#四、springMVC-相关注解" class="headerlink" title="四、springMVC 相关注解"></a>四、springMVC 相关注解</h2><p><strong>@RequestMapping</strong>：@RequestMapping(“/path”)表示该控制器处理所有 “/path” 的 UR L 请求。</p><p>RequestMapping 是一个用来处理请求地址映射的注解，可用于类或方法上。</p><p>用于类上，表示类中的所有响应请求的方法都是以该地址作为父路径。该注解有六个属性：</p><p><strong>params</strong>: 指定 request 中必须包含某些参数值是，才让该方法处理。</p><p><strong>headers</strong>: 指定 request 中必须包含某些指定的 header 值，才能让该方法处理请求。</p><p><strong>value</strong>: 指定请求的实际地址，指定的地址可以是 URI Template 模式</p><p><strong>method</strong>: 指定请求的 method 类型， GET、POST、PUT、DELETE 等</p><p><strong>consumes</strong>: 指定处理请求的提交内容类型（Content-Type），如 application/json,text/html;</p><p><strong>produces</strong>: 指定返回的内容类型，仅当 request 请求头中的 (Accept) 类型中包含该指定类型才返回</p><p><strong>@RequestParam</strong>：用在方法的参数前面。<br>@RequestParam<br>String a =request.getParameter(“a”)。</p><p><strong>@PathVariable</strong>: 路径变量。如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RequestMapping(“user/get/mac/&#123;macAddress&#125;”)</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getByMacAddress</span><span class="params">(<span class="meta">@PathVariable</span> String macAddress)</span>&#123;</span><br><span class="line">    <span class="comment">//do something;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参数与大括号里的名字一样要相同。</p><h2 id="五、全局异常处理"><a href="#五、全局异常处理" class="headerlink" title="五、全局异常处理"></a>五、全局异常处理</h2><p><strong>@ControllerAdvice</strong>：包含 @Component。可以被扫描到。统一处理异常。</p><p><strong>@ExceptionHandler</strong>（Exception.class）：用在方法上面表示遇到这个异常就执行以下方法。</p><h1 id="SpringBoot第三方jar包打包问题"><a href="#SpringBoot第三方jar包打包问题" class="headerlink" title="SpringBoot第三方jar包打包问题"></a>SpringBoot第三方jar包打包问题</h1><h4 id="一、操作步骤"><a href="#一、操作步骤" class="headerlink" title="一、操作步骤"></a>一、操作步骤</h4><p>1、首先项目引入jar包</p><p><img src="https://upload-images.jianshu.io/upload_images/9571610-da2830a7eb417078.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/274/format/webp" alt="img"></p><p>引入jar包</p><p>2、pom文件中引入jar</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入本地jar --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.topsoft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cms-pak<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources/lib/cms-pak.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3、plugin配置<br> 加上配置，将本地依赖包打进jar里</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">includeSystemScope</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeSystemScope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">includeSystemScope</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeSystemScope</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="二、补充"><a href="#二、补充" class="headerlink" title="二、补充"></a>二、补充</h4><p>可以通过jd-gui工具查看jar源码</p><h1 id="若依框架二级域名配置"><a href="#若依框架二级域名配置" class="headerlink" title="若依框架二级域名配置"></a>若依框架二级域名配置</h1><h3 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h3><p>若依官网项目部署手册，前端部署到80端口一级域名下的。一级域名官网占用，这时就需要配置二级域名。</p><h3 id="二、ruoyi-ui-前端vue配置"><a href="#二、ruoyi-ui-前端vue配置" class="headerlink" title="二、ruoyi-ui 前端vue配置"></a>二、ruoyi-ui 前端vue配置</h3><h4 id="2-1-配置vue-config-js"><a href="#2-1-配置vue-config-js" class="headerlink" title="2.1 配置vue.config.js"></a>2.1 配置vue.config.js</h4><p>修改publicPath</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 部署生产环境和开发环境下的URL。</span></span><br><span class="line">  <span class="comment">// 默认情况下，Vue CLI 会假设你的应用是被部署在一个域名的根路径上</span></span><br><span class="line">  <span class="comment">// 例如 https://www.ruoyi.vip/。如果应用被部署在一个子路径上，你就需要用这个选项指定这个子路径。例如，如果你的应用被部署在 https://www.ruoyi.vip/admin/，则设置 baseUrl 为 /admin/。</span></span><br><span class="line">  <span class="comment">//publicPath: process.env.NODE_ENV === &quot;production&quot; ? &quot;/&quot; : &quot;/&quot;,</span></span><br><span class="line">   <span class="attr">publicPath</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span> ? <span class="string">&quot;/admin/&quot;</span> : <span class="string">&quot;/admin/&quot;</span>,</span><br><span class="line">  <span class="comment">// 在npm run build 或 yarn build 时 ，生成文件的目录名称（要和baseUrl的生产环境路径一致）（默认dist）</span></span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">  <span class="comment">// 用于放置生成的静态资源 (js、css、img、fonts) 的；（项目打包之后，静态资源会放在这个文件夹下）</span></span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">  <span class="comment">// 是否开启eslint保存检测，有效值：ture | false | &#x27;error&#x27;</span></span><br><span class="line">  <span class="attr">lintOnSave</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="comment">// 如果你不需要生产环境的 source map，可以将其设置为 false 以加速生产环境构建。</span></span><br><span class="line">  <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br></pre></td></tr></table></figure><h4 id="2-2-配置router"><a href="#2-2-配置router" class="headerlink" title="2.2 配置router"></a>2.2 配置router</h4><p>修改router目录下的index.js文件<br>添加 base:‘admin’</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">base</span>:<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;history&#x27;</span>, <span class="comment">// 去掉url中的#</span></span><br><span class="line">  <span class="attr">scrollBehavior</span>: <span class="function">() =&gt;</span> (&#123; <span class="attr">y</span>: <span class="number">0</span> &#125;),</span><br><span class="line">  <span class="attr">routes</span>: constantRoutes</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="2-3-配置登出地址"><a href="#2-3-配置登出地址" class="headerlink" title="2.3 配置登出地址"></a>2.3 配置登出地址</h4><p>修改/src/layout/componets/Navbar.vue文件里的logout()方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">toggleSideBar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;app/toggleSideBar&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$confirm(<span class="string">&#x27;确定注销并退出系统吗？&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">      <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;LogOut&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// location.href = &#x27;/index&#x27;;</span></span><br><span class="line">        location.<span class="property">href</span> = <span class="string">&#x27;/admin&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="三、Nginx配置"><a href="#三、Nginx配置" class="headerlink" title="三、Nginx配置"></a>三、Nginx配置</h3><p>一级域名一般部署的是公司官网website-dist，二级域名部署后台项目ruoyi-dist。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">   <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">		<span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">		</span><br><span class="line">   <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   /root/website/website-dist;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="section">location</span> /admin &#123;</span><br><span class="line">        <span class="attribute">alias</span>  /home/ruoyi/ruoyi-dist;</span><br><span class="line">		<span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="section">location</span> /prod-api/ &#123;</span><br><span class="line">		<span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">		<span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">		<span class="attribute">proxy_set_header</span> REMOTE-HOST <span class="variable">$remote_addr</span>;</span><br><span class="line">		<span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">		<span class="attribute">proxy_pass</span> http://127.0.0.1:9004/;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="四，常见报错"><a href="#四，常见报错" class="headerlink" title="四，常见报错"></a>四，常见报错</h3><p><strong>安装页面部署，使用nginx 在前面做代理，但是无法打开页面，系统页面也报错：Error: Cannot find module ‘@/views/system/role/index</strong></p><p>修改 src/store/modules/permission.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">loadView</span> = (<span class="params">view</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">require</span>([<span class="string">`@/views/<span class="subst">$&#123;view&#125;</span>`</span>], resolve)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 import 实现生产环境的路由懒加载</span></span><br><span class="line">    <span class="comment">//return () =&gt; import(`@/views/$&#123;view&#125;`)</span></span><br><span class="line">    <span class="comment">//修改成下面的，我也不知道为什么</span></span><br><span class="line">     <span class="keyword">return</span> <span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">require</span>([<span class="string">`@/views/<span class="subst">$&#123;view&#125;</span>`</span>], resolve);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">By_Xb</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://wtnl.xyz/2024/11/04/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%BA%8C/">https://wtnl.xyz/2024/11/04/摘文笔记二/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wtnl.xyz" target="_blank">By_Xb</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a><a class="post-meta__tags" href="/tags/Spring-Boot/">Spring-Boot</a><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/11/04/%E6%91%98%E9%97%AE%E7%AC%94%E8%AE%B0%E4%B8%89/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">摘文笔记_常用技术三</div></div></a></div><div class="next-post pull-right"><a href="/2024/11/04/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%B8%80/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">摘文笔记_常用技术一</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/11/04/%E6%96%87%E7%AB%A0%E5%BC%95%E7%94%A8/" title="优秀开源框架及文章"><img class="cover" src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-04/hgtrgh4wt56gtw654gy5t6r.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">优秀开源框架及文章</div></div></a></div><div><a href="/2024/11/04/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%B8%80/" title="摘文笔记_常用技术一"><img class="cover" src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">摘文笔记_常用技术一</div></div></a></div><div><a href="/2024/11/04/MySQL%E5%9F%BA%E7%A1%80(%E4%B8%80)/" title="MySQL基础(一)"><img class="cover" src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411042116054.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">MySQL基础(一)</div></div></a></div><div><a href="/2024/11/04/MySQL%E6%80%BB%E7%BB%93(%E4%BA%94)/" title="MySQL总结(五)"><img class="cover" src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411042130742.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">MySQL总结(五)</div></div></a></div><div><a href="/2024/11/04/MySQL%E9%AB%98%E7%BA%A7(%E4%B8%89)/" title="MySQL高级(三)"><img class="cover" src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411042122935.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">MySQL高级(三)</div></div></a></div><div><a href="/2024/11/04/MySQL%E8%BF%9B%E9%98%B6(%E4%BA%8C)/" title="MySQL进阶(二)"><img class="cover" src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411042116054.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-04</div><div class="title">MySQL进阶(二)</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050018773.webp" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">By_Xb</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">72</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://byxiaobian.github.io/"><i class="fa fa-paper-plane-o"></i><span>前往主页</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content"><p class="div-border blue" style="color:#000;text-align:center"><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050016305.gif" style="float:left" width="25" height="25"><b>记录一些后端知识</b><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050016305.gif" style="float:right" width="25" height="25"></p><p class="div-border yellow" style="color:#000;text-align:center"><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050017011.gif" style="float:left" width="25" height="25"><b>分享一些笔记心得</b><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050017011.gif" style="float:right" width="25" height="25"></p><p class="div-border green" style="color:#000;text-align:center"><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050017574.gif" style="float:left" width="25" height="25"><b>吃喝吃喝吃喝吃喝</b><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/202411050017574.gif" style="float:right" width="25" height="25"></p></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">Docker常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Docker%E5%AE%B9%E5%99%A8%E4%BF%A1%E6%81%AF"><span class="toc-text">1、Docker容器信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C"><span class="toc-text">2、镜像操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81%E9%95%9C%E5%83%8F%E6%9F%A5%E7%9C%8B"><span class="toc-text">2.1、镜像查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81%E9%95%9C%E5%83%8F%E6%90%9C%E7%B4%A2"><span class="toc-text">2.2、镜像搜索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E3%80%81%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD"><span class="toc-text">2.3、镜像下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4%E3%80%81%E9%95%9C%E5%83%8F%E5%88%A0%E9%99%A4"><span class="toc-text">2.4、镜像删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5%E3%80%81%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA"><span class="toc-text">2.5、镜像构建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">3、容器操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8"><span class="toc-text">3.1、容器启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E3%80%81%E5%AE%B9%E5%99%A8%E8%BF%9B%E7%A8%8B"><span class="toc-text">3.2、容器进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E3%80%81%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97"><span class="toc-text">3.3、容器日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E3%80%81%E5%AE%B9%E5%99%A8%E7%9A%84%E8%BF%9B%E5%85%A5%E4%B8%8E%E9%80%80%E5%87%BA"><span class="toc-text">3.4、容器的进入与退出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5%E3%80%81%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8"><span class="toc-text">3.5、查看容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6%E3%80%81%E5%AE%B9%E5%99%A8%E7%9A%84%E5%81%9C%E6%AD%A2%E4%B8%8E%E5%88%A0%E9%99%A4"><span class="toc-text">3.6、容器的停止与删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7%E3%80%81%E7%94%9F%E6%88%90%E9%95%9C%E5%83%8F"><span class="toc-text">3.7、生成镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8%E3%80%81%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%B8%BB%E6%9C%BA%E9%97%B4%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8B%B7%E8%B4%9D"><span class="toc-text">3.8、容器与主机间的数据拷贝</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot%EF%BC%9A%E5%88%87%E9%9D%A2AOP%E5%AE%9E%E7%8E%B0%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C%EF%BC%9A%E5%AE%9E%E4%BE%8B%E6%BC%94%E7%A4%BA%E4%B8%8E%E6%B3%A8%E8%A7%A3%E5%85%A8%E8%A7%A3"><span class="toc-text">SpringBoot：切面AOP实现权限校验：实例演示与注解全解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%90%86%E8%A7%A3AOP"><span class="toc-text">1 理解AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AFAOP"><span class="toc-text">1.1 什么是AOP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-AOP%E4%BD%93%E7%B3%BB%E4%B8%8E%E6%A6%82%E5%BF%B5"><span class="toc-text">1.2 AOP体系与概念</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-AOP%E5%AE%9E%E4%BE%8B"><span class="toc-text">2 AOP实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BE%8B"><span class="toc-text">2.1 第一个实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%AE%9E%E4%BE%8B"><span class="toc-text">2.2 第二个实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-AOP%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3"><span class="toc-text">3 AOP相关注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Pointcut"><span class="toc-text">3.1 @Pointcut</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Around"><span class="toc-text">3.2 @Around</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Before"><span class="toc-text">3.3 @Before</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-After"><span class="toc-text">3.4 @After</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-AfterReturning"><span class="toc-text">3.5 @AfterReturning</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-AfterThrowing"><span class="toc-text">3.6 @AfterThrowing</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Boot-%E4%BA%94%E7%A7%8D%E7%83%AD%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F"><span class="toc-text">Spring Boot 五种热部署方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%A8%A1%E6%9D%BF%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-text">1、模板热部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8FDebug%E5%AE%9E%E7%8E%B0%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-text">2、使用调试模式Debug实现热部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81spring-boot-devtools"><span class="toc-text">3、spring-boot-devtools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81Spring-Loaded"><span class="toc-text">4、Spring Loaded</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81JRebel"><span class="toc-text">5、JRebel</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8ESpringBoot%EF%BC%8C%E6%9D%A5%E5%AE%9E%E7%8E%B0MySQL%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%8A%80%E6%9C%AF"><span class="toc-text">基于SpringBoot，来实现MySQL读写分离技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E4%B8%BB%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text">一: 主从数据源的配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E6%95%B0%E6%8D%AE%E6%BA%90%E8%B7%AF%E7%94%B1%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text">二: 数据源路由的配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%EF%BC%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E4%B8%8A%E4%B8%8B%E6%96%87%E7%8E%AF%E5%A2%83"><span class="toc-text">三：数据源上下文环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%EF%BC%9A%E5%88%87%E6%8D%A2%E6%B3%A8%E8%A7%A3%E5%92%8C-Aop-%E9%85%8D%E7%BD%AE"><span class="toc-text">四：切换注解和 Aop 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%EF%BC%9A%E7%94%A8%E6%B3%95%E4%BB%A5%E5%8F%8A%E6%B5%8B%E8%AF%95"><span class="toc-text">五：用法以及测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%EF%BC%9A%E6%80%BB%E7%BB%93"><span class="toc-text">六：总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Boot-%E6%B3%A8%E8%A7%A3%E5%A4%A7%E5%85%A8"><span class="toc-text">Spring Boot 注解大全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%B3%A8%E8%A7%A3-annotations-%E5%88%97%E8%A1%A8"><span class="toc-text">一、注解 (annotations) 列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%B3%A8%E8%A7%A3-annotations-%E8%AF%A6%E8%A7%A3"><span class="toc-text">二、注解 (annotations) 详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81JPA-%E6%B3%A8%E8%A7%A3"><span class="toc-text">三、JPA 注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81springMVC-%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3"><span class="toc-text">四、springMVC 相关注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">五、全局异常处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot%E7%AC%AC%E4%B8%89%E6%96%B9jar%E5%8C%85%E6%89%93%E5%8C%85%E9%97%AE%E9%A2%98"><span class="toc-text">SpringBoot第三方jar包打包问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-text">一、操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%A1%A5%E5%85%85"><span class="toc-text">二、补充</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8B%A5%E4%BE%9D%E6%A1%86%E6%9E%B6%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D%E9%85%8D%E7%BD%AE"><span class="toc-text">若依框架二级域名配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80"><span class="toc-text">一、前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81ruoyi-ui-%E5%89%8D%E7%AB%AFvue%E9%85%8D%E7%BD%AE"><span class="toc-text">二、ruoyi-ui 前端vue配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E9%85%8D%E7%BD%AEvue-config-js"><span class="toc-text">2.1 配置vue.config.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AErouter"><span class="toc-text">2.2 配置router</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E9%85%8D%E7%BD%AE%E7%99%BB%E5%87%BA%E5%9C%B0%E5%9D%80"><span class="toc-text">2.3 配置登出地址</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81Nginx%E9%85%8D%E7%BD%AE"><span class="toc-text">三、Nginx配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%EF%BC%8C%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99"><span class="toc-text">四，常见报错</span></a></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/05/007-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8-%E6%8A%93%E5%8C%85%E6%8A%80%E6%9C%AF&amp;%E5%85%A8%E5%B1%80%E5%8D%8F%E8%AE%AE&amp;%E5%B0%81%E5%8C%85%E7%9B%91%E5%90%AC&amp;%E7%BD%91%E5%8D%A1%E6%A8%A1%E5%BC%8F&amp;APP&amp;%E5%B0%8F%E7%A8%8B%E5%BA%8F&amp;PC%E5%BA%94%E7%94%A8/" title="007-基础入门-抓包技术&amp;全局协议&amp;封包监听&amp;网卡模式&amp;APP&amp;小程序&amp;PC应用"><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-05/a1483445bbd7004e706a8047ef7a43d3.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="007-基础入门-抓包技术&amp;全局协议&amp;封包监听&amp;网卡模式&amp;APP&amp;小程序&amp;PC应用"></a><div class="content"><a class="title" href="/2024/11/05/007-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8-%E6%8A%93%E5%8C%85%E6%8A%80%E6%9C%AF&amp;%E5%85%A8%E5%B1%80%E5%8D%8F%E8%AE%AE&amp;%E5%B0%81%E5%8C%85%E7%9B%91%E5%90%AC&amp;%E7%BD%91%E5%8D%A1%E6%A8%A1%E5%BC%8F&amp;APP&amp;%E5%B0%8F%E7%A8%8B%E5%BA%8F&amp;PC%E5%BA%94%E7%94%A8/" title="007-基础入门-抓包技术&amp;全局协议&amp;封包监听&amp;网卡模式&amp;APP&amp;小程序&amp;PC应用">007-基础入门-抓包技术&amp;全局协议&amp;封包监听&amp;网卡模式&amp;APP&amp;小程序&amp;PC应用</a><time datetime="2024-11-04T19:55:37.275Z" title="发表于 2024-11-05 03:55:37">2024-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/05/006-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8-%E6%8A%93%E5%8C%85%E6%8A%80%E6%9C%AF&amp;HTTPS%E5%8D%8F%E8%AE%AE&amp;APP&amp;%E5%B0%8F%E7%A8%8B%E5%BA%8F&amp;PC%E5%BA%94%E7%94%A8&amp;WEB&amp;%E8%BD%AC%E5%8F%91%E8%81%94%E5%8A%A8/" title="006-基础入门-抓包技术&amp;HTTPS协议&amp;APP&amp;小程序&amp;PC应用&amp;WEB&amp;转发联动"><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-05/7d9b3bf9875a365ff4f1cae51a92e495.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="006-基础入门-抓包技术&amp;HTTPS协议&amp;APP&amp;小程序&amp;PC应用&amp;WEB&amp;转发联动"></a><div class="content"><a class="title" href="/2024/11/05/006-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8-%E6%8A%93%E5%8C%85%E6%8A%80%E6%9C%AF&amp;HTTPS%E5%8D%8F%E8%AE%AE&amp;APP&amp;%E5%B0%8F%E7%A8%8B%E5%BA%8F&amp;PC%E5%BA%94%E7%94%A8&amp;WEB&amp;%E8%BD%AC%E5%8F%91%E8%81%94%E5%8A%A8/" title="006-基础入门-抓包技术&amp;HTTPS协议&amp;APP&amp;小程序&amp;PC应用&amp;WEB&amp;转发联动">006-基础入门-抓包技术&amp;HTTPS协议&amp;APP&amp;小程序&amp;PC应用&amp;WEB&amp;转发联动</a><time datetime="2024-11-04T19:39:32.528Z" title="发表于 2024-11-05 03:39:32">2024-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/05/001-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8-Web%E6%BC%94%E7%A4%BA%E6%BA%90%E7%A0%81&amp;%E8%B5%84%E6%BA%90&amp;%E5%B7%A5%E5%85%B7%E7%AE%B1%E7%AD%89/" title="001-基础入门-Web演示源码&amp;资源&amp;工具箱等"><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-05/db1d7d4409e0070157f494acae908672.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="001-基础入门-Web演示源码&amp;资源&amp;工具箱等"></a><div class="content"><a class="title" href="/2024/11/05/001-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8-Web%E6%BC%94%E7%A4%BA%E6%BA%90%E7%A0%81&amp;%E8%B5%84%E6%BA%90&amp;%E5%B7%A5%E5%85%B7%E7%AE%B1%E7%AD%89/" title="001-基础入门-Web演示源码&amp;资源&amp;工具箱等">001-基础入门-Web演示源码&amp;资源&amp;工具箱等</a><time datetime="2024-11-04T19:35:33.391Z" title="发表于 2024-11-05 03:35:33">2024-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/05/002-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8-Web%E6%9E%B6%E6%9E%84&amp;%E9%9B%86%E6%88%90%E8%BD%AF%E4%BB%B6&amp;Docker&amp;%E8%B5%84%E6%BA%90%E5%B9%B3%E5%8F%B0%E7%AD%89/" title="002-基础入门-Web架构&amp;集成软件&amp;Docker&amp;资源平台等"><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-05/de22fc35df359817afd5381071625675.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="002-基础入门-Web架构&amp;集成软件&amp;Docker&amp;资源平台等"></a><div class="content"><a class="title" href="/2024/11/05/002-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8-Web%E6%9E%B6%E6%9E%84&amp;%E9%9B%86%E6%88%90%E8%BD%AF%E4%BB%B6&amp;Docker&amp;%E8%B5%84%E6%BA%90%E5%B9%B3%E5%8F%B0%E7%AD%89/" title="002-基础入门-Web架构&amp;集成软件&amp;Docker&amp;资源平台等">002-基础入门-Web架构&amp;集成软件&amp;Docker&amp;资源平台等</a><time datetime="2024-11-04T19:35:05.746Z" title="发表于 2024-11-05 03:35:05">2024-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/05/003-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8-Web%E6%9E%B6%E6%9E%84&amp;OSS%E5%AD%98%E5%82%A8&amp;%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1&amp;CDN%E5%8A%A0%E9%80%9F&amp;%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86&amp;WAF%E9%98%B2%E6%8A%A4/" title="003-基础入门-Web架构&amp;OSS存储&amp;负载均衡&amp;CDN加速&amp;反向代理&amp;WAF防护"><img src="https://soobsj.oss-cn-hangzhou.aliyuncs.com/images/2024-11-05/0e303db0a8eccede47f51de2cc9df985.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="003-基础入门-Web架构&amp;OSS存储&amp;负载均衡&amp;CDN加速&amp;反向代理&amp;WAF防护"></a><div class="content"><a class="title" href="/2024/11/05/003-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8-Web%E6%9E%B6%E6%9E%84&amp;OSS%E5%AD%98%E5%82%A8&amp;%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1&amp;CDN%E5%8A%A0%E9%80%9F&amp;%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86&amp;WAF%E9%98%B2%E6%8A%A4/" title="003-基础入门-Web架构&amp;OSS存储&amp;负载均衡&amp;CDN加速&amp;反向代理&amp;WAF防护">003-基础入门-Web架构&amp;OSS存储&amp;负载均衡&amp;CDN加速&amp;反向代理&amp;WAF防护</a><time datetime="2024-11-04T19:34:24.650Z" title="发表于 2024-11-05 03:34:24">2024-11-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2016 - 2024 By_Xb</div><div class="footer_custom_text"><p><a target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a>&nbsp;<a target="_blank" href="https://demo.jerryc.me/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a>&nbsp;<a target="_blank" href="https://metroui.org.ua/index.html"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用JsDelivr为静态资源提供CDN加速"></a> &nbsp;<a target="_blank" href="https://vercel.com/"><img src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="本站采用双线部署，默认线路托管于Vercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/"><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="本站采用双线部署，联通线路托管于Coding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-eosin-one.vercel.app/',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://twikoo-eosin-one.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script><script defer="defer" src="https://at.alicdn.com/t/font_2100218_rqdhd0ud6wd.js?spm=a313x.7781069.1998910419.88&file=font_2100218_rqdhd0ud6wd.js"></script><script defer="defer" src="/js/icon.js"></script><script defer="defer" src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><script defer="defer" src="https://myhkw.cn/player/js/player.js" id="myhk" key="159939764320" m="1"></script><script type="text/javascript" data-pjax src="https://unpkg.com/artitalk"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/shuoshuo/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()

  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax], .pjax-reload script').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><div class="pjax-reload"><script async="async">for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("footer_custom_text"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInX"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("article-sort-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("category-lists"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInX"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("tag-cloud-list is-center"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInX"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("comment-wrap"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__slideInUp"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer="defer" src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script><script defer="defer" src="/js/wow_init.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>