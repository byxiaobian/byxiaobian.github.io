<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MySQL高级(四) | By_Xb</title><meta name="keywords" content="MySQL数据库操作"><meta name="author" content="By_Xb"><meta name="copyright" content="By_Xb"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL数据库操作"><meta property="og:type" content="article"><meta property="og:title" content="MySQL高级(四)"><meta property="og:url" content="https://wtnl.xyz/2023/06/23/MySQL%E9%AB%98%E7%BA%A7(%E5%9B%9B)/index.html"><meta property="og:site_name" content="By_Xb"><meta property="og:description" content="MySQL数据库操作"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1807960243,3532704884&fm=26&gp=0.jpg"><meta property="article:published_time" content="2023-06-23T06:47:58.870Z"><meta property="article:modified_time" content="2021-04-01T06:42:36.000Z"><meta property="article:author" content="By_Xb"><meta property="article:tag" content="MySQL"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1807960243,3532704884&fm=26&gp=0.jpg"><link rel="shortcut icon" href="/img/siteicon/favicon-32x32.png"><link rel="canonical" href="https://wtnl.xyz/2023/06/23/MySQL%E9%AB%98%E7%BA%A7(%E5%9B%9B)/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-center"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
}
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"MySQL高级(四)",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-04-01 14:42:36"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link defer="defer" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/css/extrastyle.css" media="defer" onload='this.media="all"'><link async rel="stylesheet" href="/css/foter.css" media="defer" onload='this.media="all"'><link async rel="stylesheet" href="/css/myblog.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xingjiahui/modify@2.0.0/pace/themes/pink/pace-theme-flash.css"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="By_Xb" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images2/author.webp" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">74</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">33</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>清单</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa fa-spinner"></i> <span>追番</span></a></li><li><a class="site-page child" href="/gallery/index.htm"><i class="fa-fw fas fa-images"></i> <span>相册</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-cloud"></i> <span>动态</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1807960243,3532704884&amp;fm=26&amp;gp=0.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">By_Xb</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>清单</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa fa-spinner"></i> <span>追番</span></a></li><li><a class="site-page child" href="/gallery/index.htm"><i class="fa-fw fas fa-images"></i> <span>相册</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-cloud"></i> <span>动态</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL高级(四)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-23T06:47:58.870Z" title="发表于 2023-06-23 14:47:58">2023-06-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-04-01T06:42:36.000Z" title="更新于 2021-04-01 14:42:36">2021-04-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF-%E6%A1%86%E6%9E%B6/">后端-框架</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">12.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>45分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL高级(四)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MySQL高级-四"><a href="#MySQL高级-四" class="headerlink" title="MySQL高级(四)"></a>MySQL高级(四)</h1><h3 id="一、MySQL存储引擎"><a href="#一、MySQL存储引擎" class="headerlink" title="一、MySQL存储引擎"></a>一、MySQL存储引擎</h3><h4 id="1-MySQL体系结构"><a href="#1-MySQL体系结构" class="headerlink" title="1.MySQL体系结构"></a>1.MySQL体系结构</h4><ul><li><p>体系结构的概念</p><ul><li>任何一套系统当中，每个部件都能起到一定的作用！</li></ul></li><li><p>MySQL的体系结构</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/02.png" alt="02"></p><ul><li>体系结构详解<ul><li>客户端连接<ul><li>支持接口：支持的客户端连接，例如C、Java、PHP等语言来连接MySQL数据库</li></ul></li><li>第一层：网络连接层<ul><li>连接池：管理、缓冲用户的连接，线程处理等需要缓存的需求。</li><li>例如：当客户端发送一个请求连接，会从连接池中获取一个连接进行使用。</li></ul></li><li>第二层：核心服务层<ul><li>管理服务和工具：系统的管理和控制工具，例如备份恢复、复制、集群等。</li><li>SQL接口：接受SQL命令，并且返回查询结果。</li><li>查询解析器：验证和解析SQL命令，例如过滤条件、语法结构等。</li><li>查询优化器：在执行查询之前，使用默认的一套优化机制进行优化sql语句</li><li>缓存：如果缓存当中有想查询的数据，则直接将缓存中的数据返回。没有的话再重新查询！</li></ul></li><li>第三层：存储引擎层<ul><li>插件式存储引擎：管理和操作数据的一种机制，包括(存储数据、如何更新、查询数据等)</li></ul></li><li>第四层：系统文件层<ul><li>文件系统：配置文件、数据文件、日志文件、错误文件、二进制文件等等的保存</li></ul></li></ul></li></ul><h4 id="2-MySQL存储引擎"><a href="#2-MySQL存储引擎" class="headerlink" title="2.MySQL存储引擎"></a>2.MySQL存储引擎</h4><ul><li><p>引擎的概念</p><ul><li>生活中，引擎就是整个机器运行的核心，不同的引擎具备不同的功能。</li></ul></li><li><p>MySQL存储引擎的概念</p><ul><li>MySQL数据库使用不同的机制存取表文件 , 机制的差别在于不同的存储方式、索引技巧、锁定水平以及广泛的不同的功能和能力，在MySQL中 , 将这些不同的技术及配套的功能称为<strong>存储引擎</strong></li><li>在关系型数据库中数据的存储是以表的形式存进行储的，所以存储引擎也可以称为<strong>表类型</strong>（即存储和操作此表的类型）。</li><li>Oracle , SqlServer等数据库只有一种存储引擎 , 而MySQL针对不同的需求, 配置MySQL的不同的存储引擎 , 就会让数据库采取了不同的处理数据的方式和扩展功能。</li><li>通过选择不同的引擎 ,能够获取最佳的方案 , 也能够获得额外的速度或者功能，提高程序的整体效果。所以了解引擎的特性 , 才能贴合我们的需求 , 更好的发挥数据库的性能。</li></ul></li><li><p>MySQL支持的存储引擎</p><ul><li>MySQL5.7支持的引擎包括：InnoDB、MyISAM、MEMORY、Archive、Federate、CSV、BLACKHOLE等</li><li>其中较为常用的有三种：InnoDB、MyISAM、MEMORY</li></ul></li></ul><h4 id="3-常用引擎的特性对比"><a href="#3-常用引擎的特性对比" class="headerlink" title="3.常用引擎的特性对比"></a>3.常用引擎的特性对比</h4><ul><li>常用的存储引擎<ul><li>MyISAM存储引擎<ul><li>访问快,不支持事务和外键。表结构保存在.frm文件中，表数据保存在.MYD文件中，索引保存在.MYI文件中。</li></ul></li><li>InnoDB存储引擎(MySQL5.5版本后默认的存储引擎)<ul><li>支持事务 ,占用磁盘空间大 ,支持并发控制。表结构保存在.frm文件中，如果是共享表空间，数据和索引保存在 innodb_data_home_dir 和 innodb_data_file_path定义的表空间中，可以是多个文件。如果是多表空间存储，每个表的数据和索引单独保存在 .ibd 中。</li></ul></li><li>MEMORY存储引擎<ul><li>内存存储 , 速度快 ,不安全 ,适合小量快速访问的数据。表结构保存在.frm中。</li></ul></li></ul></li><li>特性对比</li></ul><table><thead><tr><th>特性</th><th>MyISAM</th><th>InnoDB</th><th>MEMORY</th></tr></thead><tbody><tr><td>存储限制</td><td>有(平台对文件系统大小的限制)</td><td>64TB</td><td>有(平台的内存限制)</td></tr><tr><td><strong>事务安全</strong></td><td><strong>不支持</strong></td><td><strong>支持</strong></td><td><strong>不支持</strong></td></tr><tr><td><strong>锁机制</strong></td><td><strong>表锁</strong></td><td><strong>表锁/行锁</strong></td><td><strong>表锁</strong></td></tr><tr><td>B+Tree索引</td><td>支持</td><td>支持</td><td>支持</td></tr><tr><td>哈希索引</td><td>不支持</td><td>不支持</td><td>支持</td></tr><tr><td>全文索引</td><td>支持</td><td>支持</td><td>不支持</td></tr><tr><td><strong>集群索引</strong></td><td><strong>不支持</strong></td><td><strong>支持</strong></td><td><strong>不支持</strong></td></tr><tr><td>数据索引</td><td>不支持</td><td>支持</td><td>支持</td></tr><tr><td>数据缓存</td><td>不支持</td><td>支持</td><td>N/A</td></tr><tr><td>索引缓存</td><td>支持</td><td>支持</td><td>N/A</td></tr><tr><td>数据可压缩</td><td>支持</td><td>不支持</td><td>不支持</td></tr><tr><td>空间使用</td><td>低</td><td>高</td><td>N/A</td></tr><tr><td>内存使用</td><td>低</td><td>高</td><td>中等</td></tr><tr><td>批量插入速度</td><td>高</td><td>低</td><td>高</td></tr><tr><td><strong>外键</strong></td><td><strong>不支持</strong></td><td><strong>支持</strong></td><td><strong>不支持</strong></td></tr></tbody></table><h4 id="4-引擎的操作"><a href="#4-引擎的操作" class="headerlink" title="4.引擎的操作"></a>4.引擎的操作</h4><ul><li>查询数据库支持的引擎</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">SHOW ENGINES;</span><br><span class="line"></span><br><span class="line">-- 查询数据库支持的存储引擎</span><br><span class="line">SHOW ENGINES;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 表含义:</span><br><span class="line">  - support : 指服务器是否支持该存储引擎</span><br><span class="line">  - transactions : 指存储引擎是否支持事务</span><br><span class="line">  - XA : 指存储引擎是否支持分布式事务处理</span><br><span class="line">  - Savepoints : 指存储引擎是否支持保存点</span><br></pre></td></tr></table></figure><ul><li>查询某个数据库中所有数据表的引擎</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">SHOW TABLE STATUS FROM 数据库名称;</span><br><span class="line"></span><br><span class="line">-- 查看db9数据库所有表的存储引擎</span><br><span class="line">SHOW TABLE STATUS FROM db9;</span><br></pre></td></tr></table></figure><ul><li>查询某个数据库中某个数据表的引擎</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">SHOW TABLE STATUS FROM 数据库名称 WHERE NAME = &#x27;数据表名称&#x27;;</span><br><span class="line"></span><br><span class="line">-- 查看db9数据库中stu_score表的存储引擎</span><br><span class="line">SHOW TABLE STATUS FROM db9 WHERE NAME = &#x27;stu_score&#x27;;</span><br></pre></td></tr></table></figure><ul><li>创建数据表，指定存储引擎</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">CREATE TABLE 表名(</span><br><span class="line">	列名,数据类型,</span><br><span class="line">    ...</span><br><span class="line">)ENGINE = 引擎名称;</span><br><span class="line"></span><br><span class="line">-- 创建db11数据库</span><br><span class="line">CREATE DATABASE db11;</span><br><span class="line"></span><br><span class="line">-- 使用db11数据库</span><br><span class="line">USE db11;</span><br><span class="line"></span><br><span class="line">-- 创建engine_test表，指定存储引擎为MyISAM</span><br><span class="line">CREATE TABLE engine_test(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(10)</span><br><span class="line">)ENGINE = MYISAM;</span><br><span class="line"></span><br><span class="line">-- 查询engine_test表的引擎</span><br><span class="line">SHOW TABLE STATUS FROM db11 WHERE NAME = &#x27;engine_test&#x27;;</span><br></pre></td></tr></table></figure><ul><li>修改表的存储引擎</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">ALTER TABLE 表名 ENGINE = 引擎名称;</span><br><span class="line"></span><br><span class="line">-- 修改engine_test表的引擎为InnoDB</span><br><span class="line">ALTER TABLE engine_test ENGINE = INNODB;</span><br><span class="line"></span><br><span class="line">-- 查询engine_test表的引擎</span><br><span class="line">SHOW TABLE STATUS FROM db11 WHERE NAME = &#x27;engine_test&#x27;;</span><br></pre></td></tr></table></figure><h4 id="5-总结：引擎的选择"><a href="#5-总结：引擎的选择" class="headerlink" title="5.总结：引擎的选择"></a>5.总结：引擎的选择</h4><ul><li>MyISAM ：由于MyISAM不支持事务、不支持外键、支持全文检索和表级锁定，读写相互阻塞，读取速度快，节约资源，所以如果应用是以<strong>查询操作</strong>和<strong>插入操作</strong>为主，只有很少的<strong>更新和删除</strong>操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。</li><li>InnoDB : 是MySQL的默认存储引擎， 由于InnoDB支持事务、支持外键、行级锁定 ，支持所有辅助索引(5.5.5后不支持全文检索)，高缓存，所以用于对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，读写频繁的操作，那么InnoDB存储引擎是比较合适的选择，比如BBS、计费系统、充值转账等</li><li>MEMORY：将所有数据保存在RAM中，在需要快速定位记录和其他类似数据环境下，可以提供更快的访问。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，其次是要确保表的数据可以恢复，数据库异常终止后表中的数据是可以恢复的。MEMORY表通常用于更新不太频繁的小表，用以快速得到访问结果。</li><li>总结：针对不同的需求场景，来选择最适合的存储引擎即可！如果不确定、则使用数据库默认的存储引擎！</li></ul><h3 id="二、MySQL索引"><a href="#二、MySQL索引" class="headerlink" title="二、MySQL索引"></a>二、MySQL索引</h3><h4 id="1-索引的概念"><a href="#1-索引的概念" class="headerlink" title="1.索引的概念"></a>1.索引的概念</h4><ul><li>我们之前学习过集合，其中的ArrayList集合的特点之一就是有索引。那么有索引会带来哪些好处呢？</li><li>没错，查询数据快！我们可以通过索引来快速查找到想要的数据。那么对于我们的MySQL数据库中的索引功能也是类似的！</li><li>MySQL数据库中的索引：是帮助MySQL高效获取数据的一种数据结构！所以，索引的本质就是数据结构。</li><li>在表数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式指向数据， 这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</li><li>一张数据表，用于保存数据。 一个索引配置文件，用于保存索引，每个索引都去指向了某一个数据(表格演示)</li><li>举例，无索引和有索引的查找原理</li></ul><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/04.png" alt="04"></p><h4 id="2-索引的分类"><a href="#2-索引的分类" class="headerlink" title="2.索引的分类"></a>2.索引的分类</h4><ul><li>功能分类<ul><li>普通索引： 最基本的索引，它没有任何限制。</li><li>唯一索引：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值组合必须唯一。</li><li>主键索引：一种特殊的唯一索引，不允许有空值。一般在建表时同时创建主键索引。</li><li>组合索引：顾名思义，就是将单列索引进行组合。</li><li>外键索引：只有InnoDB引擎支持外键索引，用来保证数据的一致性、完整性和实现级联操作。</li><li>全文索引：快速匹配全部文档的方式。InnoDB引擎5.6版本后才支持全文索引。MEMORY引擎不支持。</li></ul></li><li>结构分类<ul><li>B+Tree索引 ：MySQL使用最频繁的一个索引数据结构，是InnoDB和MyISAM存储引擎默认的索引类型。</li><li>Hash索引 : MySQL中Memory存储引擎默认支持的索引类型。</li></ul></li></ul><h4 id="3-索引的操作"><a href="#3-索引的操作" class="headerlink" title="3.索引的操作"></a>3.索引的操作</h4><ul><li>数据准备</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- 创建db12数据库</span><br><span class="line">CREATE DATABASE db12;</span><br><span class="line"></span><br><span class="line">-- 使用db12数据库</span><br><span class="line">USE db12;</span><br><span class="line"></span><br><span class="line">-- 创建student表</span><br><span class="line">CREATE TABLE student(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(10),</span><br><span class="line">	age INT,</span><br><span class="line">	score INT</span><br><span class="line">);</span><br><span class="line">-- 添加数据</span><br><span class="line">INSERT INTO student VALUES (NULL,&#x27;张三&#x27;,23,98),(NULL,&#x27;李四&#x27;,24,95),</span><br><span class="line">(NULL,&#x27;王五&#x27;,25,96),(NULL,&#x27;赵六&#x27;,26,94),(NULL,&#x27;周七&#x27;,27,99);</span><br></pre></td></tr></table></figure><ul><li>创建索引<ul><li>注意：如果一个表中有一列是主键，那么就会默认为其创建主键索引！(主键列不需要单独创建索引)</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">CREATE [UNIQUE|FULLTEXT] INDEX 索引名称</span><br><span class="line">[USING 索引类型]  -- 默认是B+TREE</span><br><span class="line">ON 表名(列名...);</span><br><span class="line"></span><br><span class="line">-- 为student表中姓名列创建一个普通索引</span><br><span class="line">CREATE INDEX idx_name ON student(NAME);</span><br><span class="line"></span><br><span class="line">-- 为student表中年龄列创建一个唯一索引</span><br><span class="line">CREATE UNIQUE INDEX idx_age ON student(age);</span><br></pre></td></tr></table></figure><ul><li>查看索引</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">SHOW INDEX FROM 表名;</span><br><span class="line"></span><br><span class="line">-- 查看student表中的索引</span><br><span class="line">SHOW INDEX FROM student;</span><br></pre></td></tr></table></figure><ul><li>alter语句添加索引</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- 普通索引</span><br><span class="line">ALTER TABLE 表名 ADD INDEX 索引名称(列名);</span><br><span class="line"></span><br><span class="line">-- 组合索引</span><br><span class="line">ALTER TABLE 表名 ADD INDEX 索引名称(列名1,列名2,...);</span><br><span class="line"></span><br><span class="line">-- 主键索引</span><br><span class="line">ALTER TABLE 表名 ADD PRIMARY KEY(主键列名); </span><br><span class="line"></span><br><span class="line">-- 外键索引(添加外键约束，就是外键索引)</span><br><span class="line">ALTER TABLE 表名 ADD CONSTRAINT 外键名 FOREIGN KEY (本表外键列名) REFERENCES 主表名(主键列名);</span><br><span class="line"></span><br><span class="line">-- 唯一索引</span><br><span class="line">ALTER TABLE 表名 ADD UNIQUE 索引名称(列名);</span><br><span class="line"></span><br><span class="line">-- 全文索引(mysql只支持文本类型)</span><br><span class="line">ALTER TABLE 表名 ADD FULLTEXT 索引名称(列名);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 为student表中name列添加全文索引</span><br><span class="line">ALTER TABLE student ADD FULLTEXT idx_fulltext_name(name);</span><br><span class="line"></span><br><span class="line">-- 查看student表中的索引</span><br><span class="line">SHOW INDEX FROM student;</span><br></pre></td></tr></table></figure><ul><li>删除索引</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">DROP INDEX 索引名称 ON 表名;</span><br><span class="line"></span><br><span class="line">-- 删除student表中的idx_score索引</span><br><span class="line">DROP INDEX idx_score ON student;</span><br><span class="line"></span><br><span class="line">-- 查看student表中的索引</span><br><span class="line">SHOW INDEX FROM student;</span><br></pre></td></tr></table></figure><h4 id="4-索引效率的测试"><a href="#4-索引效率的测试" class="headerlink" title="4.索引效率的测试"></a>4.索引效率的测试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">-- 创建product商品表</span><br><span class="line">CREATE TABLE product(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,  -- 商品id</span><br><span class="line">	NAME VARCHAR(10),		    -- 商品名称</span><br><span class="line">	price INT                           -- 商品价格</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 定义存储函数，生成长度为10的随机字符串并返回</span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE FUNCTION rand_string() </span><br><span class="line">RETURNS VARCHAR(255)</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE big_str VARCHAR(100) DEFAULT &#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;;</span><br><span class="line">	DECLARE small_str VARCHAR(255) DEFAULT &#x27;&#x27;;</span><br><span class="line">	DECLARE i INT DEFAULT 1;</span><br><span class="line">	</span><br><span class="line">	WHILE i &lt;= 10 DO</span><br><span class="line">		SET small_str =CONCAT(small_str,SUBSTRING(big_str,FLOOR(1+RAND()*52),1));</span><br><span class="line">		SET i=i+1;</span><br><span class="line">	END WHILE;</span><br><span class="line">	</span><br><span class="line">	RETURN small_str;</span><br><span class="line">END$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 定义存储过程，添加100万条数据到product表中</span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE pro_test()</span><br><span class="line">BEGIN</span><br><span class="line">	DECLARE num INT DEFAULT 1;</span><br><span class="line">	</span><br><span class="line">	WHILE num &lt;= 1000000 DO</span><br><span class="line">		INSERT INTO product VALUES (NULL,rand_string(),num);</span><br><span class="line">		SET num = num + 1;</span><br><span class="line">	END WHILE;</span><br><span class="line">END$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">-- 调用存储过程</span><br><span class="line">CALL pro_test();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 查询总记录条数</span><br><span class="line">SELECT COUNT(*) FROM product;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 查询product表的索引</span><br><span class="line">SHOW INDEX FROM product;</span><br><span class="line"></span><br><span class="line">-- 查询name为OkIKDLVwtG的数据   (0.049)</span><br><span class="line">SELECT * FROM product WHERE NAME=&#x27;OkIKDLVwtG&#x27;;</span><br><span class="line"></span><br><span class="line">-- 通过id列查询OkIKDLVwtG的数据  (1毫秒)</span><br><span class="line">SELECT * FROM product WHERE id=999998;</span><br><span class="line"></span><br><span class="line">-- 为name列添加索引</span><br><span class="line">ALTER TABLE product ADD INDEX idx_name(NAME);</span><br><span class="line"></span><br><span class="line">-- 查询name为OkIKDLVwtG的数据   (0.001)</span><br><span class="line">SELECT * FROM product WHERE NAME=&#x27;OkIKDLVwtG&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">	范围查询</span><br><span class="line">*/</span><br><span class="line">-- 查询价格为800~1000之间的所有数据 (0.052)</span><br><span class="line">SELECT * FROM product WHERE price BETWEEN 800 AND 1000;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">	排序查询</span><br><span class="line">*/</span><br><span class="line">-- 查询价格为800~1000之间的所有数据,降序排列  (0.083)</span><br><span class="line">SELECT * FROM product WHERE price BETWEEN 800 AND 1000 ORDER BY price DESC;</span><br><span class="line"></span><br><span class="line">-- 为price列添加索引</span><br><span class="line">ALTER TABLE product ADD INDEX idx_price(price);</span><br><span class="line"></span><br><span class="line">-- 查询价格为800~1000之间的所有数据 (0.011)</span><br><span class="line">SELECT * FROM product WHERE price BETWEEN 800 AND 1000;</span><br><span class="line"></span><br><span class="line">-- 查询价格为800~1000之间的所有数据,降序排列  (0.001)</span><br><span class="line">SELECT * FROM product WHERE price BETWEEN 800 AND 1000 ORDER BY price DESC;</span><br></pre></td></tr></table></figure><h4 id="5-索引的实现原则"><a href="#5-索引的实现原则" class="headerlink" title="5.索引的实现原则"></a>5.索引的实现原则</h4><ul><li>索引是在MySQL的存储引擎中实现的，所以每种存储引擎的索引不一定完全相同，也不是所有的引擎支持所有的索引类型。这里我们主要介绍InnoDB引擎的实现的<strong>B+Tree索引</strong>。</li><li>B+Tree是一种树型数据结构，是B-Tree的变种。通常使用在数据库和操作系统中的文件系统，特点是能够保持数据稳定有序。我们逐步的来了解一下。</li></ul><h5 id="5-1磁盘存储"><a href="#5-1磁盘存储" class="headerlink" title="5.1磁盘存储"></a>5.1磁盘存储</h5><ul><li>系统从磁盘读取数据到内存时是以磁盘块（block）为基本单位的</li><li>位于同一个磁盘块中的数据会被一次性读取出来，而不是需要什么取什么。</li><li>InnoDB存储引擎中有页（Page）的概念，页是其磁盘管理的最小单位。InnoDB存储引擎中默认每个页的大小为16KB。</li><li>InnoDB引擎将若干个地址连接磁盘块，以此来达到页的大小16KB，在查询数据时如果一个页中的每条数据都能有助于定位数据记录的位置，这将会减少磁盘I/O次数，提高查询效率。</li></ul><h5 id="5-2BTree"><a href="#5-2BTree" class="headerlink" title="5.2BTree"></a>5.2BTree</h5><ul><li><p>BTree结构的数据可以让系统高效的找到数据所在的磁盘块。为了描述BTree，首先定义一条记录为一个二元组[key, data] ，key为记录的键值，对应表中的主键值，data为一行记录中除主键外的数据。对于不同的记录，key值互不相同。BTree中的每个节点根据实际情况可以包含大量的关键字信息和分支，如下图所示为一个3阶的BTree：</p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/05.png" alt="05"></p></li><li><p>根据图中结构显示，每个节点占用一个盘块的磁盘空间，一个节点上有两个升序排序的关键字和三个指向子树根节点的指针，指针存储的是子节点所在磁盘块的地址。两个关键词划分成的三个范围域对应三个指针指向的子树的数据的范围域。以根节点为例，关键字为17和35，P1指针指向的子树的数据范围为小于17，P2指针指向的子树的数据范围为17~35，P3指针指向的子树的数据范围为大于35。</p></li></ul><p>查找顺序：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">模拟查找15的过程 : </span><br><span class="line"></span><br><span class="line">1.根节点找到磁盘块1，读入内存。【磁盘I/O操作第1次】</span><br><span class="line">	比较关键字15在区间（&lt;17），找到磁盘块1的指针P1。</span><br><span class="line">2.P1指针找到磁盘块2，读入内存。【磁盘I/O操作第2次】</span><br><span class="line">	比较关键字15在区间（&gt;12），找到磁盘块2的指针P3。</span><br><span class="line">3.P3指针找到磁盘块7，读入内存。【磁盘I/O操作第3次】</span><br><span class="line">	在磁盘块7中找到关键字15。</span><br><span class="line">	</span><br><span class="line">-- 分析上面过程，发现需要3次磁盘I/O操作，和3次内存查找操作。</span><br><span class="line">-- 由于内存中的关键字是一个有序表结构，可以利用二分法查找提高效率。而3次磁盘I/O操作是影响整个BTree查找效率的决定因素。BTree使用较少的节点个数，使每次磁盘I/O取到内存的数据都发挥了作用，从而提高了查询效率。</span><br></pre></td></tr></table></figure><h5 id="5-3B-Tree"><a href="#5-3B-Tree" class="headerlink" title="5.3B+Tree"></a>5.3B+Tree</h5><ul><li>B+Tree是在BTree基础上的一种优化，使其更适合实现外存储索引结构，InnoDB存储引擎就是用B+Tree实现其索引结构。</li><li>从上一节中的BTree结构图中可以看到每个节点中不仅包含数据的key值，还有data值。而每一个页的存储空间是有限的，如果data数据较大时将会导致每个节点（即一个页）能存储的key的数量很小，当存储的数据量很大时同样会导致B-Tree的深度较大，增大查询时的磁盘I/O次数，进而影响查询效率。在B+Tree中，所有数据记录节点都是按照键值大小顺序存放在同一层的叶子节点上，而非叶子节点上只存储key值信息，这样可以大大加大每个节点存储的key值数量，降低B+Tree的高度。</li><li>B+Tree相对于BTree区别：<ul><li>非叶子节点只存储键值信息。</li><li>所有叶子节点之间都有一个连接指针。</li><li>数据记录都存放在叶子节点中。</li></ul></li><li>将上一节中的BTree优化，由于B+Tree的非叶子节点只存储键值信息，假设每个磁盘块能存储4个键值及指针信息，则变成B+Tree后其结构如下图所示：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/06.png" alt="06"></p><p>通常在B+Tree上有两个头指针，一个指向根节点，另一个指向关键字最小的叶子节点，而且所有叶子节点（即数据节点）之间是一种链式环结构。因此可以对B+Tree进行两种查找运算：</p><ul><li>【有范围】对于主键的范围查找和分页查找</li><li>【有顺序】从根节点开始，进行随机查找</li></ul><p>实际情况中每个节点可能不能填充满，因此在数据库中，B+Tree的高度一般都在2<del>4层。MySQL的InnoDB存储引擎在设计时是将根节点常驻内存的，也就是说查找某一键值的行记录时最多只需要1</del>3次磁盘I/O操作。</p><h4 id="6-总结：索引的设计原则"><a href="#6-总结：索引的设计原则" class="headerlink" title="6.总结：索引的设计原则"></a>6.总结：索引的设计原则</h4><p>索引的设计可以遵循一些已有的原则，创建索引的时候请尽量考虑符合这些原则，便于提升索引的使用效率，更高效的使用索引。</p><ul><li>创建索引时的原则<ul><li>对查询频次较高，且数据量比较大的表建立索引。</li><li>使用唯一索引，区分度越高，使用索引的效率越高。</li><li>索引字段的选择，最佳候选列应当从where子句的条件中提取，如果where子句中的组合比较多，那么应当挑选最常用、过滤效果最好的列的组合。</li><li>使用短索引，索引创建之后也是使用硬盘来存储的，因此提升索引访问的I/O效率，也可以提升总体的访问效率。假如构成索引的字段总长度比较短，那么在给定大小的存储块内可以存储更多的索引值，相应的可以有效的提升MySQL访问索引的I/O效率。</li><li>索引可以有效的提升查询数据的效率，但索引数量不是多多益善，索引越多，维护索引的代价自然也就水涨船高。对于插入、更新、删除等DML操作比较频繁的表来说，索引过多，会引入相当高的维护代价，降低DML操作的效率，增加相应操作的时间消耗。另外索引过多的话，MySQL也会犯选择困难病，虽然最终仍然会找到一个可用的索引，但无疑提高了选择的代价。</li></ul></li><li>联合索引的特点</li></ul><p>在mysql建立联合索引时会遵循最左前缀匹配的原则，即最左优先，在检索数据时从联合索引的最左边开始匹配，<br>对列name列、address和列phone列建一个联合索引</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE user ADD INDEX index_three(name,address,phone);</span><br></pre></td></tr></table></figure><p>联合索引index_three实际建立了(name)、(name,address)、(name,address,phone)三个索引。所以下面的三个SQL语句都可以命中索引。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user WHERE address = &#x27;北京&#x27; AND phone = &#x27;12345&#x27; AND name = &#x27;张三&#x27;;</span><br><span class="line">SELECT * FROM user WHERE name = &#x27;张三&#x27; AND address = &#x27;北京&#x27;;</span><br><span class="line">SELECT * FROM user WHERE name = &#x27;张三&#x27;;</span><br></pre></td></tr></table></figure><p>上面三个查询语句执行时会依照最左前缀匹配原则，检索时分别会使用索引</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(name,address,phone)</span><br><span class="line">(name,address)</span><br><span class="line">(name)</span><br></pre></td></tr></table></figure><p>进行数据匹配。</p><p>索引的字段可以是任意顺序的，如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 优化器会帮助我们调整顺序，下面的SQL语句都可以命中索引</span><br><span class="line">SELECT * FROM user WHERE address = &#x27;北京&#x27; AND phone = &#x27;12345&#x27; AND name = &#x27;张三&#x27;;</span><br></pre></td></tr></table></figure><p>Mysql的优化器会帮助我们调整where条件中的顺序，以匹配我们建立的索引。</p><p>联合索引中最左边的列不包含在条件查询中，所以根据上面的原则，下面的SQL语句就不会命中索引。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 联合索引中最左边的列不包含在条件查询中，下面的SQL语句就不会命中索引</span><br><span class="line">SELECT * FROM user WHERE address = &#x27;北京&#x27; AND phone = &#x27;12345&#x27;;</span><br></pre></td></tr></table></figure><h3 id="三、MySQL锁"><a href="#三、MySQL锁" class="headerlink" title="三、MySQL锁"></a>三、MySQL锁</h3><h4 id="1-锁的概念"><a href="#1-锁的概念" class="headerlink" title="1.锁的概念"></a>1.锁的概念</h4><ul><li><p>之前我们学习过多线程，多线程当中如果想保证数据的准确性是如何实现的呢？没错，通过同步实现。同步就相当于是加锁。加了锁以后有什么好处呢？当一个线程真正在操作数据的时候，其他线程只能等待。当一个线程执行完毕后，释放锁。其他线程才能进行操作！</p></li><li><p>那么我们的MySQL数据库中的锁的功能也是类似的。在我们学习事务的时候，讲解过事务的隔离性，可能会出现脏读、不可重复读、幻读的问题，当时我们的解决方式是通过修改事务的隔离级别来控制，但是数据库的隔离级别呢我们并不推荐修改。所以，锁的作用也可以解决掉之前的问题！</p></li><li><p>锁机制 : 数据库为了保证数据的一致性，而使用各种共享的资源在被并发访问时变得有序所设计的一种规则。</p></li><li><p>举例，在电商网站购买商品时，商品表中只存有1个商品，而此时又有两个人同时购买，那么谁能买到就是一个关键的问题。</p><p>这里会用到事务进行一系列的操作：</p><ol><li>先从商品表中取出物品的数据</li><li>然后插入订单</li><li>付款后，再插入付款表信息</li><li>更新商品表中商品的数量</li></ol><p>以上过程中，使用锁可以对商品数量数据信息进行保护，实现隔离，即只允许第一位用户完成整套购买流程，而其他用户只能等待，这样就解决了并发中的矛盾问题。</p></li><li><p>在数据库中，数据是一种供许多用户共享访问的资源，如何保证数据并发访问的一致性、有效性，是所有数据库必须解决的一个问题，MySQL由于自身架构的特点，在不同的存储引擎中，都设计了面对特定场景的锁定机制，所以引擎的差别，导致锁机制也是有很大差别的。</p></li></ul><h4 id="2-锁的分类"><a href="#2-锁的分类" class="headerlink" title="2.锁的分类"></a>2.锁的分类</h4><ul><li>按操作分类：<ul><li>共享锁：也叫读锁。针对同一份数据，多个事务读取操作可以同时加锁而不互相影响 ，但是不能修改数据记录。</li><li>排他锁：也叫写锁。当前的操作没有完成前,会阻断其他操作的读取和写入</li></ul></li><li>按粒度分类：<ul><li>表级锁：操作时，会锁定整个表。开销小，加锁快；不会出现死锁；锁定力度大，发生锁冲突概率高，并发度最低。偏向于MyISAM存储引擎！</li><li>行级锁：操作时，会锁定当前操作行。开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率低，并发度高。偏向于InnoDB存储引擎！</li><li>页级锁：锁的粒度、发生冲突的概率和加锁的开销介于表锁和行锁之间，会出现死锁，并发性能一般。</li></ul></li><li>按使用方式分类：<ul><li>悲观锁：每次查询数据时都认为别人会修改，很悲观，所以查询时加锁。</li><li>乐观锁：每次查询数据时都认为别人不会修改，很乐观，但是更新时会判断一下在此期间别人有没有去更新这个数据</li></ul></li><li>不同存储引擎支持的锁</li></ul><table><thead><tr><th>存储引擎</th><th>表级锁</th><th>行级锁</th><th>页级锁</th></tr></thead><tbody><tr><td>MyISAM</td><td>支持</td><td>不支持</td><td>不支持</td></tr><tr><td>InnoDB</td><td>支持</td><td>支持</td><td>不支持</td></tr><tr><td>MEMORY</td><td>支持</td><td>不支持</td><td>不支持</td></tr><tr><td>BDB</td><td>支持</td><td>不支持</td><td>支持</td></tr></tbody></table><h4 id="3-演示InnoDB锁"><a href="#3-演示InnoDB锁" class="headerlink" title="3.演示InnoDB锁"></a>3.演示InnoDB锁</h4><ul><li>数据准备</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- 创建db13数据库</span><br><span class="line">CREATE DATABASE db13;</span><br><span class="line"></span><br><span class="line">-- 使用db13数据库</span><br><span class="line">USE db13;</span><br><span class="line"></span><br><span class="line">-- 创建student表</span><br><span class="line">CREATE TABLE student(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(10),</span><br><span class="line">	age INT,</span><br><span class="line">	score INT</span><br><span class="line">);</span><br><span class="line">-- 添加数据</span><br><span class="line">INSERT INTO student VALUES (NULL,&#x27;张三&#x27;,23,99),(NULL,&#x27;李四&#x27;,24,95),</span><br><span class="line">(NULL,&#x27;王五&#x27;,25,98),(NULL,&#x27;赵六&#x27;,26,97);</span><br></pre></td></tr></table></figure><ul><li>共享锁</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">SELECT语句 LOCK IN SHARE MODE;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- 窗口1</span><br><span class="line">/*</span><br><span class="line">	共享锁：数据可以被多个事务查询，但是不能修改</span><br><span class="line">*/</span><br><span class="line">-- 开启事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">-- 查询id为1的数据记录。加入共享锁</span><br><span class="line">SELECT * FROM student WHERE id=1 LOCK IN SHARE MODE;</span><br><span class="line"></span><br><span class="line">-- 查询分数为99分的数据记录。加入共享锁</span><br><span class="line">SELECT * FROM student WHERE score=99 LOCK IN SHARE MODE;</span><br><span class="line"></span><br><span class="line">-- 提交事务</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 窗口2</span><br><span class="line">-- 开启事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">-- 查询id为1的数据记录(普通查询，可以查询)</span><br><span class="line">SELECT * FROM student WHERE id=1;</span><br><span class="line"></span><br><span class="line">-- 查询id为1的数据记录，并加入共享锁(可以查询。共享锁和共享锁兼容)</span><br><span class="line">SELECT * FROM student WHERE id=1 LOCK IN SHARE MODE;</span><br><span class="line"></span><br><span class="line">-- 修改id为1的姓名为张三三(不能修改，会出现锁的情况。只有窗口1提交事务后，才能修改成功)</span><br><span class="line">UPDATE student SET NAME=&#x27;张三三&#x27; WHERE id = 1;</span><br><span class="line"></span><br><span class="line">-- 修改id为2的姓名为李四四(修改成功，InnoDB引擎默认是行锁)</span><br><span class="line">UPDATE student SET NAME=&#x27;李四四&#x27; WHERE id = 2;</span><br><span class="line"></span><br><span class="line">-- 修改id为3的姓名为王五五(注意：InnoDB引擎如果不采用带索引的列。则会提升为表锁)</span><br><span class="line">UPDATE student SET NAME=&#x27;王五五&#x27; WHERE id = 3;</span><br><span class="line"></span><br><span class="line">-- 提交事务</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure><ul><li>排他锁</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">SELECT语句 FOR UPDATE;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-- 窗口1</span><br><span class="line">/*</span><br><span class="line">	排他锁：加锁的数据，不能被其他事务加锁查询或修改</span><br><span class="line">*/</span><br><span class="line">-- 开启事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">-- 查询id为1的数据记录，并加入排他锁</span><br><span class="line">SELECT * FROM student WHERE id=1 FOR UPDATE;</span><br><span class="line"></span><br><span class="line">-- 提交事务</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-- 窗口2</span><br><span class="line">-- 开启事务</span><br><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">-- 查询id为1的数据记录(普通查询没问题)</span><br><span class="line">SELECT * FROM student WHERE id=1;</span><br><span class="line"></span><br><span class="line">-- 查询id为1的数据记录，并加入共享锁(不能查询。因为排他锁不能和其他锁共存)</span><br><span class="line">SELECT * FROM student WHERE id=1 LOCK IN SHARE MODE;</span><br><span class="line"></span><br><span class="line">-- 查询id为1的数据记录，并加入排他锁(不能查询。因为排他锁不能和其他锁共存)</span><br><span class="line">SELECT * FROM student WHERE id=1 FOR UPDATE;</span><br><span class="line"></span><br><span class="line">-- 修改id为1的姓名为张三(不能修改，会出现锁的情况。只有窗口1提交事务后，才能修改成功)</span><br><span class="line">UPDATE student SET NAME=&#x27;张三&#x27; WHERE id=1;</span><br><span class="line"></span><br><span class="line">-- 提交事务</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure><ul><li>注意：锁的兼容性<ul><li>共享锁和共享锁 兼容</li><li>共享锁和排他锁 冲突</li><li>排他锁和排他锁 冲突</li><li>排他锁和共享锁 冲突</li></ul></li></ul><h4 id="4-演示MyISAM锁"><a href="#4-演示MyISAM锁" class="headerlink" title="4.演示MyISAM锁"></a>4.演示MyISAM锁</h4><ul><li>数据准备</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 创建product表</span><br><span class="line">CREATE TABLE product(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(20),</span><br><span class="line">	price INT</span><br><span class="line">)ENGINE = MYISAM;  -- 指定存储引擎为MyISAM</span><br><span class="line"></span><br><span class="line">-- 添加数据</span><br><span class="line">INSERT INTO product VALUES (NULL,&#x27;华为手机&#x27;,4999),(NULL,&#x27;小米手机&#x27;,2999),</span><br><span class="line">(NULL,&#x27;苹果&#x27;,8999),(NULL,&#x27;中兴&#x27;,1999);</span><br></pre></td></tr></table></figure><ul><li>读锁</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">-- 加锁</span><br><span class="line">LOCK TABLE 表名 READ;</span><br><span class="line"></span><br><span class="line">-- 解锁(将当前会话所有的表进行解锁)</span><br><span class="line">UNLOCK TABLES;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- 窗口1</span><br><span class="line">/*</span><br><span class="line">	读锁：所有连接只能读取数据，不能修改</span><br><span class="line">*/</span><br><span class="line">-- 为product表加入读锁</span><br><span class="line">LOCK TABLE product READ;</span><br><span class="line"></span><br><span class="line">-- 查询product表(查询成功)</span><br><span class="line">SELECT * FROM product;</span><br><span class="line"></span><br><span class="line">-- 修改华为手机的价格为5999(修改失败)</span><br><span class="line">UPDATE product SET price=5999 WHERE id=1;</span><br><span class="line"></span><br><span class="line">-- 解锁</span><br><span class="line">UNLOCK TABLES;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 窗口2</span><br><span class="line">-- 查询product表(查询成功)</span><br><span class="line">SELECT * FROM product;</span><br><span class="line"></span><br><span class="line">-- 修改华为手机的价格为5999(不能修改，窗口1解锁后才能修改成功)</span><br><span class="line">UPDATE product SET price=5999 WHERE id=1;</span><br></pre></td></tr></table></figure><ul><li>写锁</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 标准语法</span><br><span class="line">-- 加锁</span><br><span class="line">LOCK TABLE 表名 WRITE;</span><br><span class="line"></span><br><span class="line">-- 解锁(将当前会话所有的表进行解锁)</span><br><span class="line">UNLOCK TABLES;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- 窗口1</span><br><span class="line">/*</span><br><span class="line">	写锁：其他连接不能查询和修改数据</span><br><span class="line">*/</span><br><span class="line">-- 为product表添加写锁</span><br><span class="line">LOCK TABLE product WRITE;</span><br><span class="line"></span><br><span class="line">-- 查询product表(查询成功)</span><br><span class="line">SELECT * FROM product;</span><br><span class="line"></span><br><span class="line">-- 修改小米手机的金额为3999(修改成功)</span><br><span class="line">UPDATE product SET price=3999 WHERE id=2;</span><br><span class="line"></span><br><span class="line">-- 解锁</span><br><span class="line">UNLOCK TABLES;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 窗口2</span><br><span class="line">-- 查询product表(不能查询。只有窗口1解锁后才能查询成功)</span><br><span class="line">SELECT * FROM product;</span><br><span class="line"></span><br><span class="line">-- 修改小米手机的金额为2999(不能修改。只有窗口1解锁后才能修改成功)</span><br><span class="line">UPDATE product SET price=2999 WHERE id=2;</span><br></pre></td></tr></table></figure><h4 id="5-演示悲观锁和乐观锁"><a href="#5-演示悲观锁和乐观锁" class="headerlink" title="5.演示悲观锁和乐观锁"></a>5.演示悲观锁和乐观锁</h4><ul><li><p>悲观锁的概念</p><ul><li>就是很悲观，它对于数据被外界修改的操作持保守态度，认为数据随时会修改。</li><li>整个数据处理中需要将数据加锁。悲观锁一般都是依靠关系型数据库提供的锁机制。</li><li>我们之前所学的行锁，表锁不论是读写锁都是悲观锁。</li></ul></li><li><p>乐观锁的概念</p><ul><li>就是很乐观，每次自己操作数据的时候认为没有人会来修改它，所以不去加锁。</li><li>但是在更新的时候会去判断在此期间数据有没有被修改。</li><li>需要用户自己去实现，不会发生并发抢占资源，只有在提交操作的时候检查是否违反数据完整性。</li></ul></li><li><p>悲观锁和乐观锁使用前提</p><ul><li>对于读的操作远多于写的操作的时候，这时候一个更新操作加锁会阻塞所有的读取操作，降低了吞吐量。最后还要释放锁，锁是需要一些开销的，这时候可以选择乐观锁。</li><li>如果是读写比例差距不是非常大或者系统没有响应不及时，吞吐量瓶颈的问题，那就不要去使用乐观锁，它增加了复杂度，也带来了业务额外的风险。这时候可以选择悲观锁。</li></ul></li><li><p>乐观锁的实现方式</p><ul><li><p>版本号</p><ul><li>给数据表中添加一个version列，每次更新后都将这个列的值加1。</li><li>读取数据时，将版本号读取出来，在执行更新的时候，比较版本号。</li><li>如果相同则执行更新，如果不相同，说明此条数据已经发生了变化。</li><li>用户自行根据这个通知来决定怎么处理，比如重新开始一遍，或者放弃本次更新。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- 创建city表</span><br><span class="line">CREATE TABLE city(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,  -- 城市id</span><br><span class="line">	NAME VARCHAR(20),                   -- 城市名称</span><br><span class="line">	VERSION INT                         -- 版本号</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 添加数据</span><br><span class="line">INSERT INTO city VALUES (NULL,&#x27;北京&#x27;,1),(NULL,&#x27;上海&#x27;,1),(NULL,&#x27;广州&#x27;,1),(NULL,&#x27;深圳&#x27;,1);</span><br><span class="line"></span><br><span class="line">-- 修改北京为北京市</span><br><span class="line">-- 1.查询北京的version</span><br><span class="line">SELECT VERSION FROM city WHERE NAME=&#x27;北京&#x27;;</span><br><span class="line">-- 2.修改北京为北京市，版本号+1。并对比版本号</span><br><span class="line">UPDATE city SET NAME=&#x27;北京市&#x27;,VERSION=VERSION+1 WHERE NAME=&#x27;北京&#x27; AND VERSION=1;</span><br></pre></td></tr></table></figure></li><li><p>时间戳</p><ul><li>和版本号方式基本一样，给数据表中添加一个列，名称无所谓，数据类型需要是timestamp</li><li>每次更新后都将最新时间插入到此列。</li><li>读取数据时，将时间读取出来，在执行更新的时候，比较时间。</li><li>如果相同则执行更新，如果不相同，说明此条数据已经发生了变化。</li></ul></li></ul></li></ul><h4 id="6-锁的总结"><a href="#6-锁的总结" class="headerlink" title="6.锁的总结"></a>6.锁的总结</h4><ul><li><p>表锁和行锁</p><ul><li>行锁：锁的粒度更细，加行锁的性能损耗较大。并发处理能力较高。InnoDB引擎默认支持！</li><li>表锁：锁的粒度较粗，加表锁的性能损耗较小。并发处理能力较低。InnoDB、MyISAM引擎支持！</li></ul></li><li><p>InnoDB锁优化建议</p><ul><li><p>尽量通过带索引的列来完成数据查询，从而避免InnoDB无法加行锁而升级为表锁。</p></li><li><p>合理设计索引，索引要尽可能准确，尽可能的缩小锁定范围，避免造成不必要的锁定。</p></li><li><p>尽可能减少基于范围的数据检索过滤条件。</p></li><li><p>尽量控制事务的大小，减少锁定的资源量和锁定时间长度。</p></li><li><p>在同一个事务中，尽可能做到一次锁定所需要的所有资源，减少死锁产生概率。</p></li><li><p>对于非常容易产生死锁的业务部分，可以尝试使用升级锁定颗粒度，通过表级锁定来减少死锁的产生。</p></li></ul></li></ul><h3 id="四、集群"><a href="#四、集群" class="headerlink" title="四、集群"></a>四、集群</h3><h4 id="1-集群的概念"><a href="#1-集群的概念" class="headerlink" title="1.集群的概念"></a>1.集群的概念</h4><ul><li>如今随着互联网的发展，数据的量级也是成指数的增长，从GB到TB到PB。对数据的各种操作也是愈加的困难，传统的关系型数据库已经无法满足快速查询与插入数据的需求。一台数据库服务器已经无法满足海量数据的存储需求，所以由多台数据库构成的数据库集群成了必然的方式。不过，为了保证数据的一致性，查询效率等，同时又要解决多台服务器间的通信、负载均衡等问题。</li><li>MyCat是一款数据库集群软件，是阿里曾经开源的知名产品——Cobar，简单的说，MyCAT就是：一个新颖的数据库中间件产品支持MySQL集群，提供高可用性数据分片集群。你可以像使用mysql一样使用mycat。对于开发人员来说根本感觉不到mycat的存在。MyCat不单单是支持MySQL，像常用的关系型数据库Oracle、SqlServer都支持。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/07.png" alt="07"></p><h4 id="2-集群的原理"><a href="#2-集群的原理" class="headerlink" title="2.集群的原理"></a>2.集群的原理</h4><ul><li>我们来说个例子，大海捞针和一个水瓶里捞针，毋庸置疑水瓶里一定能更快找到针，因为它需要检索的范围更小。数据库集群也是如此原理，我们可以将一个数据量为300G的数据库数据平均拆分成3部分，每个数据库中只存储100G数据，此时用户搜索，先经过我们中间代理层，中间代理层同时发出3个请求执行查询，比如第1台返回100条数据，耗时3秒，第2台返回200条数据，耗时3秒，第3台返回500条数据，耗时3秒，此时中间件只需要在800条记录中进行筛选，即可检索出用户要的结果，此时耗时其实一共只有3秒，因为每台机器做运算的时候，都是同时执行。如果我们此时直接在300G的数据库查询，耗时10秒，那使用中间件进行集群的效率就非常明显</li></ul><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/08.png" alt="08"></p><ul><li>MyCat的实现流程和这个流程大致相似。MyCat自身不存储数据，但用户每次链接数据库的时候，直接连接MyCat即可.所以我们MyCat自身其实就是个逻辑数据库，它自身还有表结构，表结构叫逻辑表。</li></ul><h4 id="3-Mycat环境搭建"><a href="#3-Mycat环境搭建" class="headerlink" title="3.Mycat环境搭建"></a>3.Mycat环境搭建</h4><h5 id="3-1-Mycat下载和安装"><a href="#3-1-Mycat下载和安装" class="headerlink" title="3.1 Mycat下载和安装"></a>3.1 Mycat下载和安装</h5><ul><li><p>官网：<code>http://www.mycat.io/</code></p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/09.png" alt="09"></p></li><li><p>下载地址 : <code>http://dl.mycat.io/</code></p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/10.png" alt="10"></p></li><li><p>选择1.6.7.1的版本，下载到D盘，安装包入下图：</p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/11.png" alt="11"></p></li><li><p>上传：使用SecureCRT的SFTP命令，将文件发送到Linux虚拟机root目录下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sftp&gt; put D:\Mycat-server-<span class="number">1.6</span><span class="number">.7</span><span class="number">.1</span>-release-<span class="number">20190627191042</span>-linux.tar.gz </span><br></pre></td></tr></table></figure></li><li><p>解压：解压mycat.tar.gz并查看</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mycat.tar.gz</span><br><span class="line">cd mycat</span><br><span class="line">ll</span><br></pre></td></tr></table></figure><p><img src="MySQL%E9%AB%98%E7%BA%A7-04-%E6%8E%88%E8%AF%BE%E7%AC%94%E8%AE%B0.assets/12.png" alt="12"></p></li><li><p>授权：设置mycat权限</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R <span class="number">777</span> mycat</span><br></pre></td></tr></table></figure></li><li><p>环境变量：配置环境变量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile </span><br><span class="line"><span class="comment">// 添加</span></span><br><span class="line">export MYCAT_HOME=/root/mycat</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使环境变量生效</span></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure></li><li><p>启动mycat</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 进入bin目录</span></span><br><span class="line">[root<span class="meta">@localhost</span>]# cd /root/mycat/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行启动命令</span></span><br><span class="line">[root<span class="meta">@localhost</span> bin]# ./mycat start</span><br></pre></td></tr></table></figure></li><li><p>查看：检测端口监听状况，Mycat的端口号是8066</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@localhost</span> bin]# netstat -ant|grep <span class="number">8066</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/13.png" alt="13"></p></li><li><p>连接：使用SQLYog连接Mycat</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/14.png" alt="14"></p><ul><li><p>连接后显示：</p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/15.png" alt="15"></p></li></ul><h5 id="3-2-环境准备"><a href="#3-2-环境准备" class="headerlink" title="3.2 环境准备"></a>3.2 环境准备</h5><ul><li>配置模型</li></ul><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/16.png" alt="16"></p><ul><li>克隆虚拟机</li></ul><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/17.png" alt="17"></p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/18.png" alt="18"></p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/19.png" alt="19"></p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/20.png" alt="20"></p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/21.png" alt="21"></p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/22.png" alt="22"></p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/23.png" alt="23"></p><ul><li><p>修改配置网卡</p><ul><li>在第二个虚拟机中，生成全新mac地址</li></ul><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/24.png" alt="24"></p><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/25.png" alt="25"></p><ul><li>重启网络</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 重启网络</span><br><span class="line">service network restart</span><br><span class="line">//查看ip地址</span><br><span class="line">ip addr</span><br></pre></td></tr></table></figure></li><li><p>修改mysql配置文件,更改uuid</p><ul><li>在第二个服务器上，修改mysql的uuid</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 编辑配置文件</span><br><span class="line">vi /var/lib/mysql/auto.cnf</span><br><span class="line">// 将server-uuid更改</span><br></pre></td></tr></table></figure></li><li><p>启动MySQL并查看</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//将两台服务器的防火墙关闭</span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">//启动两台服务器的mysql</span><br><span class="line">service mysqld restart</span><br><span class="line"></span><br><span class="line">//启动两台服务器的mycat</span><br><span class="line">cd /root/mycat/bin</span><br><span class="line">./mycat restart</span><br><span class="line"></span><br><span class="line">//查看监听端口</span><br><span class="line">netstat -ant|grep 3306</span><br><span class="line">netstat -ant|grep 8066</span><br><span class="line"></span><br><span class="line">//使用sqlyog测试连接</span><br></pre></td></tr></table></figure><h4 id="4-主从复制"><a href="#4-主从复制" class="headerlink" title="4.主从复制"></a>4.主从复制</h4><ul><li><p>主从复制的概念</p><ul><li>为了使用Mycat进行读写分离，我们先要配置MySQL数据库的主从复制。</li><li>从服务器自动同步主服务器的数据，从而达到数据一致。</li><li>进而，我们可以写操作时，只操作主服务器，而读操作，就可以操作从服务器了。</li><li>原理：主服务器在处理数据时，生成binlog日志，通过对日志的备份，实现从服务器的数据同步。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/26.png" alt="26"></p></li><li><p>主服务器的配置</p><ul><li>在第一个服务器上，编辑mysql配置文件</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 编辑mysql配置文件</span><br><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">//在[mysqld]下面加上：</span><br><span class="line">log-bin=mysql-bin # 开启复制操作</span><br><span class="line">server-id=1 # master is 1</span><br><span class="line">innodb_flush_log_at_trx_commit=1</span><br><span class="line">sync_binlog=1</span><br></pre></td></tr></table></figure><ul><li>登录mysql，创建用户并授权</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 登录mysql</span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">// 去除密码权限</span><br><span class="line">SET GLOBAL validate_password_policy=0;</span><br><span class="line">SET GLOBAL validate_password_length=1;</span><br><span class="line"></span><br><span class="line">// 创建用户</span><br><span class="line">CREATE USER &#x27;hm&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;itheima&#x27;;</span><br><span class="line"></span><br><span class="line">// 授权</span><br><span class="line">GRANT ALL ON *.* TO &#x27;hm&#x27;@&#x27;%&#x27;;</span><br></pre></td></tr></table></figure><ul><li>重启mysql服务，登录mysql服务</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 重启mysql</span><br><span class="line">service mysqld restart</span><br><span class="line"></span><br><span class="line">// 登录mysql</span><br><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><ul><li>查看主服务器的配置</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 查看主服务器配置</span><br><span class="line">show master status;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/27.png" alt="27"></p></li><li><p>从服务器的配置</p><ul><li>在第二个服务器上，编辑mysql配置文件</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 编辑mysql配置文件</span><br><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">// 在[mysqld]下面加上：</span><br><span class="line">server-id=2</span><br></pre></td></tr></table></figure><ul><li>登录mysql</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 登录mysql</span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">// 执行</span><br><span class="line">use mysql;</span><br><span class="line">drop table slave_master_info;</span><br><span class="line">drop table slave_relay_log_info;</span><br><span class="line">drop table slave_worker_info;</span><br><span class="line">drop table innodb_index_stats;</span><br><span class="line">drop table innodb_table_stats;</span><br><span class="line">source /usr/share/mysql/mysql_system_tables.sql;</span><br></pre></td></tr></table></figure><ul><li>重启mysql，重新登录，配置从节点</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 重启mysql</span><br><span class="line">service mysqld restart</span><br><span class="line"></span><br><span class="line">// 重新登录mysql</span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">// 执行</span><br><span class="line">change master to master_host=&#x27;主服务器ip地址&#x27;,master_port=3306,master_user=&#x27;hm&#x27;,master_password=&#x27;itheima&#x27;,master_log_file=&#x27;mysql-bin.000001&#x27;,master_log_pos=4642;</span><br></pre></td></tr></table></figure><ul><li>重启mysql，重新登录，开启从节点</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 重启mysql</span><br><span class="line">service mysqld restart</span><br><span class="line"></span><br><span class="line">// 重新登录mysql</span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">// 开启从节点</span><br><span class="line">start slave;</span><br><span class="line"></span><br><span class="line">// 查询结果</span><br><span class="line">show slave status\G;</span><br><span class="line">//Slave_IO_Running和Slave_SQL_Running都为yes才表示同步成功。</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image3/28.png" alt="28"></p></li><li><p>测试</p><ul><li>sqlyog连接主服务器</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 主服务器创建db1数据库,从服务器会自动同步</span><br><span class="line">CREATE DATABASE db1;</span><br></pre></td></tr></table></figure><ul><li>sqlyog连接从服务器</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 从服务器创建db2数据库,主服务器不会自动同步</span><br><span class="line">CREATE DATABASE db2;</span><br></pre></td></tr></table></figure></li><li><p>启动失败的解决方案</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">启动失败：Slave_IO_Running为 NO </span><br><span class="line">方法一:重置slave</span><br><span class="line">slave stop;</span><br><span class="line">reset slave;</span><br><span class="line">start slave ;</span><br><span class="line">方法二:重设同步日志文件及读取位置</span><br><span class="line">slave stop;</span><br><span class="line">change master to master_log_file=’mysql-bin.000001’, master_log_pos=1;</span><br><span class="line">start slave ;</span><br></pre></td></tr></table></figure><h4 id="5-读写分离"><a href="#5-读写分离" class="headerlink" title="5.读写分离"></a>5.读写分离</h4><ul><li><p>读写分离的概念</p><ul><li>写操作只写入主服务器，读操作读取从服务器。</li></ul></li><li><p>在主服务器上修改server.xml</p><ul><li>user标签主要用于定义登录mycat的用户和权限。如上面定义用户名mycat和密码123456，该用户可以访问的schema的HEIMADB逻辑库。</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>HEIMADB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 表级 DML 权限设置 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 		</span></span><br><span class="line"><span class="comment">		&lt;privileges check=&quot;false&quot;&gt;</span></span><br><span class="line"><span class="comment">			&lt;schema name=&quot;TESTDB&quot; dml=&quot;0110&quot; &gt;</span></span><br><span class="line"><span class="comment">				&lt;table name=&quot;tb01&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;</span></span><br><span class="line"><span class="comment">				&lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;</span></span><br><span class="line"><span class="comment">			&lt;/schema&gt;</span></span><br><span class="line"><span class="comment">		&lt;/privileges&gt;		</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>在主服务器上修改schema.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;HEIMADB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db1&quot;</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">			  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 主服务器进行写操作 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;hostM1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;localhost:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">				   <span class="attr">password</span>=<span class="string">&quot;itheima&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 从服务器负责读操作 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;hostS1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;192.168.203.135:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;itheima&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>配置详解</p><ul><li><p>schema标签逻辑库的概念和mysql数据库中Datebase的概念相同，我们在查询这两个逻辑库中的表的时候，需要切换到该逻辑库下才可以查到所需要的表。</p></li><li><p>dataNode属性：该属性用于绑定逻辑库到某个具体的database上。</p></li><li><p>dataNode标签： dataNode标签定义了mycat中的数据节点，也就是数据分片。一个dataNode标签就是一个独立的数据分片。</p></li><li><p>name属性：定义数据节点的名字，这个名字需要是唯一的，我们需要在table标签上应用这个名字，来建立表与分片对应的关系。</p></li><li><p>dataHost属性：该属性用于定义该分片属于那个数据库实例，属性值是引用datahost标签定义的name属性。</p></li><li><p>database属性：该属性用于定义该分片属于那个具体数据库实例上的具体库，因为这里使用两个纬度来定义分片，就是：实例+具体的库。因为每个库上建立的表和表结构是一样的。所以这样做就可以轻松的对表进行水平拆分。</p></li><li><p>dataHost标签：该标签在mycat逻辑库中也是作为最底层的标签存在，直接定义了具体的数据库实例、读写分离配置和心跳语句。</p></li><li><p>balance属性： 负载均衡类型<br>​ balance=0: 不开启读写分离，所有读操作都发送到当前可用的writeHost上。<br>​ balance=1: 全部的readHost与Stand by writeHost都参与select语句的负载均衡<br>​ balance=2: 所有的读操作都随机在writeHost，readHost上分发。<br>​ balance=3: 所有的读请求都随机分配到writeHost对应的readHost上执行，writeHost不负担读压力。</p></li><li><p>switchType属性：<br>​ -1：表示不自动切换。<br>​ 1 ：默认值，表示自动切换<br>​ 2：表示基于MySQL主从同步状态决定是否切换，心跳语句： show slave status.<br>​ 3:表示基于mysql galary cluster的切换机制，适合mycat1.4之上的版本，心跳语句show status like “%esrep%”;</p></li><li><p>writeHost标签，readHost标签：这两个标签指定后端数据库的相关配置给mycat，用于实例化后端连接池。唯一不同的是，writeHost指定写实例、readHost指定读实例，组合这些读写实例来满足系统的要求。</p><ul><li>host属性：用于标识不同的实例，对于writehost，一般使用<em>M1；对于readhost一般使用</em>S1.</li><li>url属性：后端实例连接地址，如果使用native的dbDriver，则一般为address:port这种形式，用JDBC或其他的dbDriver，则需要特殊指定。当使用JDBC时则可以这么写：jdbc:mysql://localhost:3306/。</li><li>user属性：后端存储实例的用户名。</li><li>password属性：后端存储实例的密码</li></ul></li></ul></li><li><p>测试</p><ul><li>重启主服务器的mycat</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 重启mycat</span><br><span class="line">cd /root/mycat/bin</span><br><span class="line"></span><br><span class="line">./mycat restart</span><br><span class="line"></span><br><span class="line">// 查看端口监听</span><br><span class="line">netstat -ant|grep 8066</span><br></pre></td></tr></table></figure><ul><li>sqlyog连接mycat</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- 创建学生表</span><br><span class="line">CREATE TABLE student(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(10)</span><br><span class="line">);</span><br><span class="line">-- 查询学生表</span><br><span class="line">SELECT * FROM student;</span><br><span class="line"></span><br><span class="line">-- 添加两条记录</span><br><span class="line">INSERT INTO student VALUES (NULL,&#x27;张三&#x27;),(NULL,&#x27;李四&#x27;);</span><br><span class="line"></span><br><span class="line">-- 停止主从复制后，添加的数据只会保存到主服务器上。</span><br><span class="line">INSERT INTO student VALUES (NULL,&#x27;王五&#x27;);</span><br></pre></td></tr></table></figure><ul><li>sqlyog连接主服务器</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 主服务器：查询学生表，可以看到数据</span><br><span class="line">SELECT * FROM student;</span><br></pre></td></tr></table></figure><ul><li>sqlyog连接从服务器</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 从服务器：查询学生表，可以看到数据(因为有主从复制)</span><br><span class="line">SELECT * FROM student;</span><br><span class="line"></span><br><span class="line">-- 从服务器：删除一条记录。(主服务器并没有删除，mycat中间件查询的结果是从服务器的数据)</span><br><span class="line">DELETE FROM student WHERE id=2;</span><br></pre></td></tr></table></figure></li></ul><h4 id="6-分库分表"><a href="#6-分库分表" class="headerlink" title="6.分库分表"></a>6.分库分表</h4><ul><li><p>分库分表的概念</p><ul><li>将庞大的数据进行拆分</li><li>水平拆分：根据表的数据逻辑关系，将同一表中的数据按照某种条件，拆分到多台数据库服务器上，也叫做横向拆分。例如：一张1000万的大表，按照一模一样的结构，拆分成4个250万的小表，分别保存到4个数据库中。</li><li>垂直拆分：根据业务的维度，将不同的表切分到不同的数据库之上，也叫做纵向拆分。例如：所有的订单都保存到订单库中，所有的用户都保存到用户库中，同类型的表保存在同一库，不同的表分散在不同的库中。</li></ul></li><li><p>Mycat水平拆分</p><ul><li><p>修改主服务器的server.xml</p><ul><li><p>0：本地文件方式</p><p>在mycat/conf/sequence_conf.properties文件中：<br>GLOBAL.MINDI=10000最小值<br>GLOBAL.MAXID=20000最大值，建议修改到9999999999</p></li><li><p>1：数据库方式</p><p>分库分表中保证全局主键自增唯一，但是需要执行mycat函数，配置sequence_db_conf.properties</p></li><li><p>2：时间戳方式</p><p>mycat实现的时间戳，建议varchar类型，要注意id的长度</p></li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 修改主键的方式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sequnceHandlerType&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>修改主服务器的sequence_conf.properties</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#default global sequence</span></span><br><span class="line"><span class="attr">GLOBAL.HISIDS</span>=      <span class="string"># 可以自定义关键字</span></span><br><span class="line"><span class="attr">GLOBAL.MINID</span>=<span class="string">10001  # 最小值</span></span><br><span class="line"><span class="attr">GLOBAL.MAXID</span>=<span class="string">20000  # 最大值</span></span><br><span class="line"><span class="attr">GLOBAL.CURID</span>=<span class="string">10000</span></span><br></pre></td></tr></table></figure><ul><li>修改主服务器的schema.xml<ul><li>table标签定义了逻辑表，所有需要拆分的表都需要在这个标签中定义。</li><li>rule属性：拆分规则。mod-long是拆分规则之一，主键根据服务器数量取模，在rule.xml中指定。如果是3个数据库，那么数据取模后，平均分配到三个库中。</li><li>name属性：定义逻辑表的表名，这个名字就如同在数据库中执行create table命令指定的名字一样，同一个schema标签中定义的表名必须是唯一的。</li><li>dataNode属性： 定义这个逻辑表所属的dataNode，该属性的值需要和dataNode标签中name属性的值相互对应。</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;HEIMADB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;product&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2,dn3&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;mod-long&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db1&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn2&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db2&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db3&quot;</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">			  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- write --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;hostM1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;localhost:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">				   <span class="attr">password</span>=<span class="string">&quot;itheima&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- read --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;hostS1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;192.168.203.135:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;itheima&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>修改主服务器的rule.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">&quot;mod-long&quot;</span> <span class="attr">class</span>=<span class="string">&quot;io.mycat.route.function.PartitionByMod&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 数据库的数量 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>测试</p><ul><li>mycat操作</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- 创建product表</span><br><span class="line">CREATE TABLE product(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(20),</span><br><span class="line">	price INT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 添加6条数据</span><br><span class="line">INSERT INTO product(id,NAME,price) VALUES (NEXT VALUE FOR MYCATSEQ_GLOBAL,&#x27;苹果手机&#x27;,6999);</span><br><span class="line">INSERT INTO product(id,NAME,price) VALUES (NEXT VALUE FOR MYCATSEQ_GLOBAL,&#x27;华为手机&#x27;,5999); </span><br><span class="line">INSERT INTO product(id,NAME,price) VALUES (NEXT VALUE FOR MYCATSEQ_GLOBAL,&#x27;三星手机&#x27;,4999); </span><br><span class="line">INSERT INTO product(id,NAME,price) VALUES (NEXT VALUE FOR MYCATSEQ_GLOBAL,&#x27;小米手机&#x27;,3999); </span><br><span class="line">INSERT INTO product(id,NAME,price) VALUES (NEXT VALUE FOR MYCATSEQ_GLOBAL,&#x27;中兴手机&#x27;,2999); </span><br><span class="line">INSERT INTO product(id,NAME,price) VALUES (NEXT VALUE FOR MYCATSEQ_GLOBAL,&#x27;OOPO手机&#x27;,1999); </span><br><span class="line"></span><br><span class="line">-- 查询product表</span><br><span class="line">SELECT * FROM product; </span><br></pre></td></tr></table></figure><ul><li>主服务器操作</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 在不同数据库中查询product表</span><br><span class="line">SELECT * FROM product;</span><br></pre></td></tr></table></figure><ul><li>从服务器操作</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 在不同数据库中查询product表</span><br><span class="line">SELECT * FROM product;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Mycat垂直拆分</p><ul><li>修改主服务器的schema</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;HEIMADB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;product&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2,dn3&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;mod-long&quot;</span>/&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 动物类数据表 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">autoIncrement</span>=<span class="string">&quot;true&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn4&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">autoIncrement</span>=<span class="string">&quot;true&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn4&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">       <span class="comment">&lt;!-- 水果类数据表 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;apple&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">autoIncrement</span>=<span class="string">&quot;true&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn5&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;banana&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">autoIncrement</span>=<span class="string">&quot;true&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn5&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db1&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn2&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db2&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db3&quot;</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn4&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db4&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn5&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db5&quot;</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">			  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- write --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;hostM1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;localhost:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">				   <span class="attr">password</span>=<span class="string">&quot;itheima&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- read --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;hostS1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;192.168.203.135:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;itheima&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>测试</p><ul><li>sqlyog连接mycat</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">-- 创建dog表</span><br><span class="line">CREATE TABLE dog(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(10)</span><br><span class="line">);</span><br><span class="line">-- 添加数据</span><br><span class="line">INSERT INTO dog(id,NAME) VALUES (NEXT VALUE FOR MYCATSEQ_GLOBAL,&#x27;哈士奇&#x27;);</span><br><span class="line">-- 查询dog表</span><br><span class="line">SELECT * FROM dog;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 创建cat表</span><br><span class="line">CREATE TABLE cat(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(10)</span><br><span class="line">);</span><br><span class="line">-- 添加数据</span><br><span class="line">INSERT INTO cat(id,NAME) VALUES (NEXT VALUE FOR MYCATSEQ_GLOBAL,&#x27;波斯猫&#x27;);</span><br><span class="line">-- 查询cat表</span><br><span class="line">SELECT * FROM cat;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 创建apple表</span><br><span class="line">CREATE TABLE apple(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(10)</span><br><span class="line">);</span><br><span class="line">-- 添加数据</span><br><span class="line">INSERT INTO apple(id,NAME) VALUES (NEXT VALUE FOR MYCATSEQ_GLOBAL,&#x27;红富士&#x27;);</span><br><span class="line">-- 查询apple表</span><br><span class="line">SELECT * FROM apple;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 创建banana表</span><br><span class="line">CREATE TABLE banana(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	NAME VARCHAR(10)</span><br><span class="line">);</span><br><span class="line">-- 添加数据</span><br><span class="line">INSERT INTO banana(id,NAME) VALUES (NEXT VALUE FOR MYCATSEQ_GLOBAL,&#x27;香蕉&#x27;);</span><br><span class="line">-- 查询banana表</span><br><span class="line">SELECT * FROM banana;</span><br></pre></td></tr></table></figure><ul><li>sqlyog连接主服务器</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 查询dog表</span><br><span class="line">SELECT * FROM dog;</span><br><span class="line">-- 查询cat表</span><br><span class="line">SELECT * FROM cat;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 查询apple表</span><br><span class="line">SELECT * FROM apple;</span><br><span class="line">-- 查询banana表</span><br><span class="line">SELECT * FROM banana;</span><br></pre></td></tr></table></figure><ul><li>sqlyog连接从服务器</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 查询dog表</span><br><span class="line">SELECT * FROM dog;</span><br><span class="line">-- 查询cat表</span><br><span class="line">SELECT * FROM cat;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 查询apple表</span><br><span class="line">SELECT * FROM apple;</span><br><span class="line">-- 查询banana表</span><br><span class="line">SELECT * FROM banana;</span><br></pre></td></tr></table></figure></li></ul></li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">By_Xb</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://wtnl.xyz/2023/06/23/MySQL%E9%AB%98%E7%BA%A7(%E5%9B%9B)/">https://wtnl.xyz/2023/06/23/MySQL高级(四)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wtnl.xyz" target="_blank">By_Xb</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1807960243,3532704884&amp;fm=26&amp;gp=0.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/06/23/nginx%E9%85%8D%E7%BD%AE%E5%8F%8A%E4%BC%98%E5%8C%96/"><img class="prev-cover" src="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=3695391411,2685326593&amp;fm=26&amp;gp=0.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">nginx配置及优化</div></div></a></div><div class="next-post pull-right"><a href="/2023/06/23/MySQL%E9%AB%98%E7%BA%A7(%E4%B8%89)/"><img class="next-cover" src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1807960243,3532704884&amp;fm=26&amp;gp=0.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL高级(三)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/06/23/MySQL%E5%9F%BA%E7%A1%80(%E4%B8%80)/" title="MySQL基础(一)"><img class="cover" src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1807960243,3532704884&fm=26&gp=0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-23</div><div class="title">MySQL基础(一)</div></div></a></div><div><a href="/2023/06/23/MySQL%E6%80%BB%E7%BB%93(%E4%BA%94)/" title="MySQL总结(五)"><img class="cover" src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1807960243,3532704884&fm=26&gp=0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-23</div><div class="title">MySQL总结(五)</div></div></a></div><div><a href="/2023/06/23/MySQL%E8%BF%9B%E9%98%B6(%E4%BA%8C)/" title="MySQL进阶(二)"><img class="cover" src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1807960243,3532704884&fm=26&gp=0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-23</div><div class="title">MySQL进阶(二)</div></div></a></div><div><a href="/2023/06/23/MySQL%E9%AB%98%E7%BA%A7(%E4%B8%89)/" title="MySQL高级(三)"><img class="cover" src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1807960243,3532704884&fm=26&gp=0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-23</div><div class="title">MySQL高级(三)</div></div></a></div><div><a href="/2023/06/23/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%BA%8C/" title="摘文笔记_常用技术二"><img class="cover" src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-23</div><div class="title">摘文笔记_常用技术二</div></div></a></div><div><a href="/2023/06/23/%E6%96%87%E7%AB%A0%E5%BC%95%E7%94%A8/" title="优秀开源框架及文章"><img class="cover" src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image4/hgtrgh4wt56gtw654gy5t6r.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-23</div><div class="title">优秀开源框架及文章</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images2/author.webp" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">By_Xb</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">74</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">33</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://byxiaobian.github.io/"><i class="fa fa-paper-plane-o"></i><span>前往主页</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content"><p class="div-border blue" style="color:#000;text-align:center"><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/images5-140FGZS0.gif" style="float:left" width="25" height="25"><b>记录一些后端知识</b><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/images5-140FGZS0.gif" style="float:right" width="25" height="25"></p><p class="div-border yellow" style="color:#000;text-align:center"><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/images5-140FGZ249-51.gif" style="float:left" width="25" height="25"><b>分享一些笔记心得</b><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/images5-140FGZ249-51.gif" style="float:right" width="25" height="25"></p><p class="div-border green" style="color:#000;text-align:center"><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/images5-140FGZ250-51.gif" style="float:left" width="25" height="25"><b>吃喝吃喝吃喝吃喝</b><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/images5-140FGZ250-51.gif" style="float:right" width="25" height="25"></p></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E9%AB%98%E7%BA%A7-%E5%9B%9B"><span class="toc-text">MySQL高级(四)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81MySQL%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-text">一、MySQL存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-text">1.MySQL体系结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-MySQL%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-text">2.MySQL存储引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%B8%B8%E7%94%A8%E5%BC%95%E6%93%8E%E7%9A%84%E7%89%B9%E6%80%A7%E5%AF%B9%E6%AF%94"><span class="toc-text">3.常用引擎的特性对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%BC%95%E6%93%8E%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">4.引擎的操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%80%BB%E7%BB%93%EF%BC%9A%E5%BC%95%E6%93%8E%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-text">5.总结：引擎的选择</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81MySQL%E7%B4%A2%E5%BC%95"><span class="toc-text">二、MySQL索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%B4%A2%E5%BC%95%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text">1.索引的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">2.索引的分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%B4%A2%E5%BC%95%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">3.索引的操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%B4%A2%E5%BC%95%E6%95%88%E7%8E%87%E7%9A%84%E6%B5%8B%E8%AF%95"><span class="toc-text">4.索引效率的测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E5%88%99"><span class="toc-text">5.索引的实现原则</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8"><span class="toc-text">5.1磁盘存储</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2BTree"><span class="toc-text">5.2BTree</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3B-Tree"><span class="toc-text">5.3B+Tree</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%80%BB%E7%BB%93%EF%BC%9A%E7%B4%A2%E5%BC%95%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-text">6.总结：索引的设计原则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81MySQL%E9%94%81"><span class="toc-text">三、MySQL锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%94%81%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text">1.锁的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%94%81%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">2.锁的分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%BC%94%E7%A4%BAInnoDB%E9%94%81"><span class="toc-text">3.演示InnoDB锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%BC%94%E7%A4%BAMyISAM%E9%94%81"><span class="toc-text">4.演示MyISAM锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%BC%94%E7%A4%BA%E6%82%B2%E8%A7%82%E9%94%81%E5%92%8C%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-text">5.演示悲观锁和乐观锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E9%94%81%E7%9A%84%E6%80%BB%E7%BB%93"><span class="toc-text">6.锁的总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%9B%86%E7%BE%A4"><span class="toc-text">四、集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%9B%86%E7%BE%A4%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text">1.集群的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%9B%86%E7%BE%A4%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-text">2.集群的原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Mycat%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">3.Mycat环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-Mycat%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-text">3.1 Mycat下载和安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">3.2 环境准备</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">4.主从复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-text">5.读写分离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-text">6.分库分表</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/01/16/FastTunnel/" title="无题"><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images2/image120201218220827.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="无题"></a><div class="content"><a class="title" href="/2024/01/16/FastTunnel/" title="无题">无题</a><time datetime="2024-01-16T01:05:52.690Z" title="发表于 2024-01-16 09:05:52">2024-01-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/23/%E6%96%87%E7%AB%A0%E5%BC%95%E7%94%A8/" title="优秀开源框架及文章"><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image4/hgtrgh4wt56gtw654gy5t6r.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="优秀开源框架及文章"></a><div class="content"><a class="title" href="/2023/06/23/%E6%96%87%E7%AB%A0%E5%BC%95%E7%94%A8/" title="优秀开源框架及文章">优秀开源框架及文章</a><time datetime="2023-06-23T06:47:58.943Z" title="发表于 2023-06-23 14:47:58">2023-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/23/%E6%91%98%E9%97%AE%E7%AC%94%E8%AE%B0%E4%B8%89/" title="摘文笔记_常用技术三"><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="摘文笔记_常用技术三"></a><div class="content"><a class="title" href="/2023/06/23/%E6%91%98%E9%97%AE%E7%AC%94%E8%AE%B0%E4%B8%89/" title="摘文笔记_常用技术三">摘文笔记_常用技术三</a><time datetime="2023-06-23T06:47:58.941Z" title="发表于 2023-06-23 14:47:58">2023-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/23/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%BA%8C/" title="摘文笔记_常用技术二"><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="摘文笔记_常用技术二"></a><div class="content"><a class="title" href="/2023/06/23/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%BA%8C/" title="摘文笔记_常用技术二">摘文笔记_常用技术二</a><time datetime="2023-06-23T06:47:58.940Z" title="发表于 2023-06-23 14:47:58">2023-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/23/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%B8%80/" title="摘文笔记_常用技术一"><img src="https://cdn.jsdelivr.net/gh/byxiaobian/CDN/images/image1/320" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="摘文笔记_常用技术一"></a><div class="content"><a class="title" href="/2023/06/23/%E6%91%98%E6%96%87%E7%AC%94%E8%AE%B0%E4%B8%80/" title="摘文笔记_常用技术一">摘文笔记_常用技术一</a><time datetime="2023-06-23T06:47:58.937Z" title="发表于 2023-06-23 14:47:58">2023-06-23</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2016 - 2024 By_Xb</div><div class="footer_custom_text"><p><a target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a>&nbsp;<a target="_blank" href="https://demo.jerryc.me/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a>&nbsp;<a target="_blank" href="https://metroui.org.ua/index.html"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用JsDelivr为静态资源提供CDN加速"></a> &nbsp;<a target="_blank" href="https://vercel.com/"><img src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="本站采用双线部署，默认线路托管于Vercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/"><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="本站采用双线部署，联通线路托管于Coding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-eosin-one.vercel.app/',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://twikoo-eosin-one.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script><script defer="defer" src="https://at.alicdn.com/t/font_2100218_rqdhd0ud6wd.js?spm=a313x.7781069.1998910419.88&file=font_2100218_rqdhd0ud6wd.js"></script><script defer="defer" src="/js/icon.js"></script><script defer="defer" src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><script defer="defer" src="https://myhkw.cn/player/js/player.js" id="myhk" key="159939764320" m="1"></script><script type="text/javascript" data-pjax src="https://unpkg.com/artitalk"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/shuoshuo/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()

  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax], .pjax-reload script').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><div class="pjax-reload"><script async="async">for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("footer_custom_text"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInX"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("article-sort-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("category-lists"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInX"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("tag-cloud-list is-center"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInX"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async="async">for(var arr=document.getElementsByClassName("comment-wrap"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__slideInUp"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer="defer" src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script><script defer="defer" src="/js/wow_init.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>